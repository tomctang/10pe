
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>&lt;no title&gt; &#8212; Jonny Workbook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=8dedbda2" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '17MCM_QM_ipynb/variational-google-colab';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
  
    <p class="title logo__title">Jonny Workbook</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Mathe &amp; FP/Language</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Alevel_math.html">1. A-level-math</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Alevel_math_further.html">2. A-level-further</a></li>
<li class="toctree-l1"><a class="reference internal" href="../00intro_math.html">3. Math-FP-Lang Combo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01number_algebra.html">4. Number &amp; Algebra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02discrete_continuous.html">5. Discrete &amp; Continuous</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03real_world.html">6. Real World Math</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05math_as_code.html">7. Math as code</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">CS &amp; Physics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Course_MIT6001Python.html">8. MIT_CS6001-Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Course_MIT6002thinking.html">9. MIT_CS6002-CS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Course_Lean.html">10. Lean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PE50.html">11. Project Euler Q1-50</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PE75.html">12. Project Euler Q51-</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Course_MCM.html">13. Math Computational Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Course_MCM_QM.html">14. Quantum Mechanics</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Notebook</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../nb_past_courses.html">15. Past courses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nb_Geo.html">16. Geography and Maps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nb_lottery_simulator.html">17. Lottery Math</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/tomctang/10pe" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/17MCM_QM_ipynb/variational-google-colab.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1><no title></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="simple visible nav section-nav flex-column">
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><font color="DarkGreen"><strong>The variational method</strong>
<br><br>
<em>Interactive application and visualization of the variational method to aid conceptual understanding of introductory quantum mechanics</em>, Arjan van der Vaart*, Sang T. Le Phan, and Brielle Wolfe, Department of Chemistry, University of South Florida <br><br>
</font></p>
<p><a name='instructions' /></a><u>Instructions</u>: From the “Runtime” menu, select “Restart session and run all” and select “Yes” in the subsequent popup box. Then go back to the top of the file, and work your way down. Read the text, select your settings, and click the red “Go” button. Some of the calculations are a bit time consuming, so please be patient. Blue links <a href=#instructions>like this</a> are clickable and allow for quick navigation.</p>
<p><u>Trouble shooting</u>:</p>
<ol class="arabic simple">
<li><p><em>No buttons, nothing running, weird behavior</em>. From the “Runtime” menu, select “Restart session and run all” and select “Yes” in the subsequent popup box. <br></p></li>
<li><p><em>Code showing</em>. Click on the arrow next to the Main Driver section to hide the code. <br></p></li>
<li><p><em>Navigation not working</em>. From the “Runtime” menu, select “Restart session and run all” and select “Yes” in the subsequent popup box. Then click on the arrow next to the Main Driver section to hide the code.
<br><br></p></li>
</ol>
<hr class="docutils" />
<p>This lab will introduce the linear variational method by calculating the ground state energy and wave function of a one-dimensional confined particle. These follow from the time-independent Schrödinger equation. The  variational method solves this equation by expanding the unknown wave function as a linear combination of known functions, and subsequently minimizing the energy as a function of the unknown coefficients of this expansion.</p>
<p><font color="DarkGreen"><strong>1. Selection of the basis</strong></font></p>
<blockquote>
<div><p><mark> <b>Goals:</b> In this section you will compare and orthonormalize basis sets. </mark></p>
</div></blockquote>
<p>We aim to calculate the ground state energy (<span class="math notranslate nohighlight">\(E\)</span>) and wave function (<span class="math notranslate nohighlight">\(\Psi\)</span>) of a particle confined between <span class="math notranslate nohighlight">\(x=0\)</span> and <span class="math notranslate nohighlight">\(L\)</span> <span class="math notranslate nohighlight">\(\overset{\circ}{A}\)</span> (where <span class="math notranslate nohighlight">\(1\,\overset{\circ}{A} = 10^{-10}\)</span> m). The ground state is the lowest energy state and generally the most populated and important state. We will calculate these by solving the Schrödinger equation: <span class="math notranslate nohighlight">\(-\dfrac{\hbar^2}{2 m} \dfrac{d^2 \Psi(x)}{d x^2} + V(x) \Psi(x) = E\, \Psi(x)\)</span>. <span class="math notranslate nohighlight">\(E\)</span> and <span class="math notranslate nohighlight">\(\Psi\)</span> are the unknowns, <span class="math notranslate nohighlight">\(m\)</span> is the mass of the particle, <span class="math notranslate nohighlight">\(\hbar\)</span> is a constant, and <span class="math notranslate nohighlight">\(V(x)\)</span> is the potential that acts on the confined particle. Since <span class="math notranslate nohighlight">\(E = K + V\)</span>, where <span class="math notranslate nohighlight">\(K\)</span> is the kinetic energy, the term <span class="math notranslate nohighlight">\(-\dfrac{\hbar^2}{2 m} \dfrac{d^2}{d x^2}\)</span> represents the kinetic energy: <font color="Red">the higher the curvature of the wave function, the higher the kinetic energy</font>. While the wave function itself is hard to interpret, its square <font color="Red"><span class="math notranslate nohighlight">\(\vert \Psi(x) \vert^2 = \Psi^*(x) \Psi(x) = P(x)\)</span> is the <em>probability</em> that the particle is at position <span class="math notranslate nohighlight">\(x\)</span></font>.</p>
<p>We proceed by expanding the wave function into a linear combination of <span class="math notranslate nohighlight">\(N\)</span> known functions: <span class="math notranslate nohighlight">\(\Psi(x) = \sum\limits_{k=1}^N a_k \varphi_k(x)\)</span>, where <span class="math notranslate nohighlight">\(a_k\)</span> are the unknown coefficients of the expansion. The <span class="math notranslate nohighlight">\(\varphi_k\)</span> functions are called the <em>basis functions</em>, and collectively they form the <em>basis set</em>.  What functions to pick? Since the particle is confined, its probability <span class="math notranslate nohighlight">\(P(0)=P(L)=0\)</span>; consequently <span class="math notranslate nohighlight">\(\Psi(0)=\Psi(L)=0\)</span> (in fact, <span class="math notranslate nohighlight">\(P\)</span> and <span class="math notranslate nohighlight">\(\Psi\)</span> are zero for <span class="math notranslate nohighlight">\(x \notin (0, L)\)</span>). Therefore, we can simply choose functions <span class="math notranslate nohighlight">\(\varphi_k\)</span> for which <span class="math notranslate nohighlight">\(\varphi_k(0) = \varphi_k(L) = 0\)</span>. A few possibilities:</p>
<ol class="arabic simple" start="0">
<li><p>“Legendre-like”: <span class="math notranslate nohighlight">\(\;\varphi_k(x) = P_{2(k-1)+2}(\frac{2 x}{L}-1) - 1\)</span>
where <span class="math notranslate nohighlight">\(P_{j}\)</span> is the <span class="math notranslate nohighlight">\(j^\text{th}\)</span> Legendre polynomial. We only pick the even Legendre polynomials (<span class="math notranslate nohighlight">\(P_{2(k-1)+2}\)</span>), since the odd ones do not have the proper value at the <span class="math notranslate nohighlight">\(x=0\)</span> and <span class="math notranslate nohighlight">\(x=L\)</span> boundaries. We start from the 2<span class="math notranslate nohighlight">\(^\text{nd}\)</span> Legendre polynomial since the zeroth would result in <span class="math notranslate nohighlight">\(\varphi=0\)</span>.</p></li>
<li><p>“Polynomial 1”: <span class="math notranslate nohighlight">\(\;\varphi_k(x) = \left \{
\begin{array}{ll} x (x-L) &amp; \text{if}\;k=1\\
x (x-L) (x-\frac{L}{2})^{k-1} &amp; \text{if}\;k&gt;1\end{array} \right .\)</span></p></li>
<li><p>“Polynomial 2”: <span class="math notranslate nohighlight">\(\;\varphi_k(x) = \left \{
\begin{array}{ll} x (x-L) &amp; \text{if}\;k=1\\
x (x-L) \prod\limits_{i=1}^{k-1} (x-\frac{i L}{k}) &amp; \text{if}\;k&gt;1\end{array} \right .\)</span></p></li>
<li><p>“Sin”: <span class="math notranslate nohighlight">\(\;\varphi_k(x) = \sin(\frac{ k \pi x}{L})\)</span></p></li>
</ol>
<p>For simplicity, we restricted ourselves to real functions; therefore, <span class="math notranslate nohighlight">\(\Psi\)</span> will also be real. Because of rounding errors, the maximum number of basis functions will be set differently for the “Sin” basis (50) than for the other bases (20).</p>
<p><font color="DarkGreen"><a name='1a'><strong>Exercises</strong>
<a href=#calculate>Below</a>, select “1. Show basis” for the Section button, deselect “Orthonormalize” and deselect “Calculate S”.</p>
<p><strong>1a</strong>. Use the slider to set <span class="math notranslate nohighlight">\(L\)</span> to 1.00 <span class="math notranslate nohighlight">\(\overset{\circ}{A}\)</span>. Visualize the various basis sets by pressing the red “Go” button, and verify that <span class="math notranslate nohighlight">\(\varphi_k(0)=\varphi_k(L)=0 \;\forall k\)</span>.
</font></p>
<p><font color="DarkGreen"><strong>1b</strong>. How does a change in <span class="math notranslate nohighlight">\(L\)</span> affect the shape of the basis functions?
</font></p>
<p><font color="DarkGreen"><strong>1c</strong>. Compare the “Polynomial 1” basis set to the “Polynomial 2” basis set by inspecting the equations and graphing them (for <span class="math notranslate nohighlight">\(L=1 \overset{\circ}{A}\)</span>). For what values of <span class="math notranslate nohighlight">\(k\)</span> are the functions the same, for what values of <span class="math notranslate nohighlight">\(k\)</span> do they differ?
</font>
<br><br>
Continue below the red “Go” button and graph.
<br><br>
<a name='calculate' />
<mark><strong>Jump to</strong></font>: <a href=#1a>exercise 1a</a>, <a href=#1d>1d</a>, <a href=#2a>2a</a>, <a href=#2f>2f</a>, <a href=#2i>2i</a>, <a href=#2k>2k</a>, <a href=#2n>2n</a>, <a href=#3a>3a</a>, <a href=#3e>3e</a>, <a href=#4a>4a</a>, <a href=#5a>5a</a>, <a href=#6a>6a</a>, <a href=#6d>6d</a>, <a href=#6f>6f</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title Main driver</span>
<span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = &#39;svg&#39;
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sci</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.integrate</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">integrate</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy.polynomial.legendre</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">leg</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy.polynomial.polynomial</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pol</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy.linalg</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">la</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">Latex</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ipywidgets</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">widgets</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ipywidgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">interact</span><span class="p">,</span> <span class="n">interactive</span><span class="p">,</span> <span class="n">fixed</span><span class="p">,</span> <span class="n">interact_manual</span><span class="p">,</span> <span class="n">GridspecLayout</span><span class="p">,</span> <span class="n">Layout</span><span class="p">,</span> <span class="n">AppLayout</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">gridspec</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">copy</span><span class="w"> </span><span class="kn">import</span> <span class="n">deepcopy</span>

<span class="c1"># repress warnings - safe here, since we hard-coded nmax</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="c1">################### global settings ################</span>
<span class="c1"># maximum number of basis functions.</span>
<span class="c1"># a) nmax1: For Legendre-like and polynomials N&gt;20 can give numerical errors.</span>
<span class="n">nmax1</span> <span class="o">=</span> <span class="mi">20</span>
<span class="c1"># b) nmax3: We can use more functions for a sin-basis</span>
<span class="n">nmax3</span> <span class="o">=</span> <span class="mi">50</span>
<span class="c1"># initial setting</span>
<span class="n">nmax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nmax1</span><span class="p">,</span> <span class="n">nmax3</span><span class="p">)</span>

<span class="c1"># reduced units during calculation.</span>
<span class="n">hbarsqr</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># particle masses (in multitudes of electron mass)</span>
<span class="n">electronmass</span><span class="o">=</span><span class="mf">1.0</span>
<span class="n">protonmass</span><span class="o">=</span><span class="mf">1836.152673426</span>
<span class="n">deuteronmass</span><span class="o">=</span><span class="mf">3697.19111467</span>
<span class="n">ammoniamass</span><span class="o">=</span><span class="mf">4532.77</span> <span class="c1"># reduced mass ammonia = (3 m_H m_N)/(3 m_H + m_N) in electron mass</span>

<span class="c1"># conversion factor, particle mass of electron, box length in Angstrom</span>
<span class="n">toeV</span> <span class="o">=</span> <span class="mf">7.61996</span> <span class="c1"># hbar^2/(m (1e-10)^2)</span>

<span class="c1"># save settings:</span>
<span class="c1"># a. to save computer time when we can re-use orthogonalized basis</span>
<span class="n">old</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
<span class="c1"># b. to continue after hardcoded ammonia inversion potential</span>
<span class="n">beforeinversion</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">electronmass</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">]]</span>

<span class="c1">################### define sliders ################</span>
<span class="n">section</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
    <span class="n">options</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;1. Show basis&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;2. Particle in a box&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),(</span><span class="s1">&#39;3. Step potential&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),(</span><span class="s1">&#39;4. Central potential&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;5. Double barrier&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;6. Intersecting parabola&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;6d. Ammonia inversion&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)],</span>
    <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Section:&#39;</span><span class="p">,</span>
    <span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;255px&#39;</span><span class="p">))</span>
<span class="n">basistype</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
    <span class="n">options</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;Legendre-like&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Polynomial 1&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),(</span><span class="s1">&#39;Polynomial 2&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),(</span><span class="s1">&#39;Sin&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="p">],</span>
    <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Basis:&#39;</span><span class="p">,</span>
    <span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;240px&#39;</span><span class="p">))</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="n">nbasis</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">nmax</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">on_update_basistype</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">basistype</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">nbasis</span><span class="o">.</span><span class="n">max</span><span class="o">=</span><span class="n">nmax3</span>
        <span class="n">nmax</span><span class="o">=</span><span class="n">nmax3</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nbasis</span><span class="o">.</span><span class="n">max</span><span class="o">=</span><span class="n">nmax1</span>
        <span class="n">nmax</span><span class="o">=</span><span class="n">nmax1</span>
<span class="n">nbasis</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">on_update_basistype</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>

<span class="n">orthogonalize</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Orthonormalize&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">shows</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Calculate S&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">mass</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
    <span class="n">options</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;Electron&#39;</span><span class="p">,</span> <span class="n">electronmass</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Proton&#39;</span><span class="p">,</span> <span class="n">protonmass</span><span class="p">),</span>
             <span class="p">(</span><span class="s1">&#39;Deuteron&#39;</span><span class="p">,</span> <span class="n">deuteronmass</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Ammonia&#39;</span><span class="p">,</span> <span class="n">ammoniamass</span><span class="p">)],</span>
    <span class="n">value</span><span class="o">=</span><span class="n">electronmass</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Mass:&#39;</span><span class="p">,</span>
    <span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;250px&#39;</span><span class="p">))</span>
<span class="n">showexcited</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Show excited states&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">xrangea</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatRangeSlider</span><span class="p">(</span>
    <span class="n">value</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span>
    <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;x</span><span class="se">\u2081\u2081</span><span class="s1">-x</span><span class="se">\u2081\u2082</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span>
    <span class="n">readout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">readout_format</span><span class="o">=</span><span class="s1">&#39;.1f&#39;</span><span class="p">)</span>
<span class="n">xrangeb</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatRangeSlider</span><span class="p">(</span>
    <span class="n">value</span><span class="o">=</span><span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
    <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;x</span><span class="se">\u2082\u2081</span><span class="s1">-x</span><span class="se">\u2082\u2082</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span>
    <span class="n">readout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">readout_format</span><span class="o">=</span><span class="s1">&#39;.1f&#39;</span><span class="p">)</span>
<span class="n">heighta</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatText</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;h</span><span class="se">\u2081</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;240px&#39;</span><span class="p">))</span>
<span class="n">heightb</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatText</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;h</span><span class="se">\u2082</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;240px&#39;</span><span class="p">))</span>
<span class="n">x0a</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;x</span><span class="se">\u2081</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">x0b</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;x</span><span class="se">\u2082</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">ka</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatText</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;k</span><span class="se">\u2081</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;240px&#39;</span><span class="p">))</span>
<span class="n">kb</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatText</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;k</span><span class="se">\u2082</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;240px&#39;</span><span class="p">))</span>
<span class="n">prob</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatRangeSlider</span><span class="p">(</span>
    <span class="n">value</span><span class="o">=</span><span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span>
    <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;x</span><span class="se">\u208B</span><span class="s1">-x</span><span class="se">\u208A</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span>
    <span class="n">readout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">readout_format</span><span class="o">=</span><span class="s1">&#39;.1f&#39;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">on_update_l</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">value</span>
    <span class="n">xrangea</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">value</span>
    <span class="n">xrangeb</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">value</span>
    <span class="n">x0a</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">value</span>
    <span class="n">x0b</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">value</span>
<span class="n">L</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">on_update_l</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>

<span class="c1">############ put sliders in Grid (depending on the value of section.value, several may be made invisible) ##########</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">GridspecLayout</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">section</span>
<span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">basistype</span>
<span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">nbasis</span>
<span class="n">grid</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span>
<span class="n">grid</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">orthogonalize</span>
<span class="n">grid</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">shows</span>
<span class="n">grid</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">showexcited</span>
<span class="n">grid</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">mass</span>
<span class="n">grid</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span>
<span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">xrangea</span>
<span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">xrangeb</span>
<span class="n">grid</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">heighta</span>
<span class="n">grid</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">heightb</span>
<span class="n">grid</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">x0a</span>
<span class="n">grid</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">x0b</span>
<span class="n">grid</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ka</span>
<span class="n">grid</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">kb</span>

<span class="c1"># calculation button</span>
<span class="n">button</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Go&quot;</span><span class="p">,</span> <span class="n">button_style</span><span class="o">=</span><span class="s1">&#39;danger&#39;</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span>

<span class="c1"># default look (for section.value == 0 or &quot;1. Show basis&quot;)</span>
<span class="n">basistype</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
<span class="n">nbasis</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
<span class="n">L</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
<span class="n">mass</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
<span class="n">prob</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
<span class="n">orthogonalize</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
<span class="n">shows</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
<span class="n">showexcited</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
<span class="n">xrangea</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
<span class="n">xrangeb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
<span class="n">heighta</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
<span class="n">heightb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
<span class="n">x0a</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
<span class="n">x0b</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
<span class="n">ka</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
<span class="n">kb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">on_section_change</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">section</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># 1. Show basis</span>
        <span class="n">basistype</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">nbasis</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">L</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">orthogonalize</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">shows</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">showexcited</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">mass</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">xrangea</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">xrangeb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">heighta</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">heightb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">x0a</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">x0b</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">ka</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">kb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
    <span class="k">elif</span> <span class="n">section</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># 2. Particle in a box</span>
        <span class="n">basistype</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">nbasis</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">L</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">orthogonalize</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">shows</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">showexcited</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">mass</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">xrangea</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">xrangeb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">heighta</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">heightb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">x0a</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">x0b</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">ka</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">kb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
    <span class="k">elif</span> <span class="n">section</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1"># 3. Step potential</span>
        <span class="n">basistype</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">nbasis</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">L</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">orthogonalize</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">shows</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">showexcited</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">mass</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">xrangea</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">xrangeb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">heighta</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">heightb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">x0a</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">x0b</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">ka</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">kb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
    <span class="k">elif</span> <span class="n">section</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="c1"># 4. Central potential</span>
        <span class="n">basistype</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">nbasis</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">L</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">orthogonalize</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">shows</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">showexcited</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">mass</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">xrangea</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">xrangeb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">heighta</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">heightb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">x0a</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">x0b</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">ka</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">kb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
    <span class="k">elif</span> <span class="n">section</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="c1"># 5. Double barrier</span>
        <span class="n">basistype</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">nbasis</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">L</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">orthogonalize</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">shows</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">showexcited</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">mass</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">xrangea</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">xrangeb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">heighta</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">heightb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">x0a</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">x0b</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">ka</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">kb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
    <span class="k">elif</span> <span class="n">section</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="c1"># 6. Intersecting parabola</span>
        <span class="n">basistype</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">nbasis</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">L</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">orthogonalize</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">shows</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">showexcited</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">mass</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">xrangea</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">xrangeb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">heighta</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">heightb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">x0a</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">x0b</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">ka</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">kb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
    <span class="k">elif</span> <span class="n">section</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="c1"># 6d. Ammonia inversion</span>
        <span class="n">basistype</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">nbasis</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">L</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">orthogonalize</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">shows</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">showexcited</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">mass</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">xrangea</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">xrangeb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">heighta</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">heightb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">x0a</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">x0b</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">ka</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        <span class="n">kb</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
<span class="n">section</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">on_section_change</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>

<span class="c1">################ calculation of basis #########################</span>
<span class="c1"># unnormalized, nonorthogonal basis functions (n = 0 .. nmax)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">setbasis</span><span class="p">(</span><span class="n">ibasis</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets the basis set.</span>
<span class="sd">        ibasis: basis set</span>
<span class="sd">            allowed values:</span>
<span class="sd">                0 -- Legendre like</span>
<span class="sd">                1 -- Polynomial 1</span>
<span class="sd">                2 -- Polynomial 2</span>
<span class="sd">                3 -- Sin</span>
<span class="sd">        length: box length</span>

<span class="sd">    All basis functions are zero at x=0 and x=length (since we&#39;re treating</span>
<span class="sd">       confined systems)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># coef: coefficients of polynomials</span>
    <span class="n">coef</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># coef2: coefficients of 2nd derivative of polynomials</span>
    <span class="n">coef2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">ibasis</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># P_{2(n+1)}-1</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nmax</span><span class="p">):</span>
            <span class="n">l0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">l0</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">leg</span><span class="o">.</span><span class="n">leg2poly</span><span class="p">(</span><span class="n">l0</span><span class="p">)</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">coef</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="n">pol</span><span class="o">.</span><span class="n">polyder</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">coef2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">unorth</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">pol</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">length</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">unorthd2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="mi">4</span><span class="o">/</span><span class="p">(</span><span class="n">length</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">pol</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">length</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">c2</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">ibasis</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># x*(x-length)*(x-0.5*length)^n</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nmax</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">length</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="c1"># x*(x-length) = 0 -length*x + x^2</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">length</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">pol</span><span class="o">.</span><span class="n">polymul</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
            <span class="n">coef</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">pol</span><span class="o">.</span><span class="n">polyder</span><span class="p">(</span><span class="n">coef</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">coef2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">unorth</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">pol</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">unorthd2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">pol</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c2</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">ibasis</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1"># x*(x-length)*Product[x-i*length/(n+1),{i=1,n}]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nmax</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">length</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="c1"># x*(x-length) = 0 -length*x + x^2</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">i</span><span class="o">*</span><span class="n">length</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">])</span> <span class="c1"># (x-(i*length/(n+1)))</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">pol</span><span class="o">.</span><span class="n">polymul</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
            <span class="n">coef</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">pol</span><span class="o">.</span><span class="n">polyder</span><span class="p">(</span><span class="n">coef</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">coef2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">unorth</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">pol</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">unorthd2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">pol</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c2</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">ibasis</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="c1"># sin((n+1)*pi*x/L)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">unorth</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="n">length</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">unorthd2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">length</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="n">length</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">unorth</span><span class="p">,</span> <span class="n">unorthd2</span><span class="p">,</span> <span class="n">coef</span><span class="p">,</span> <span class="n">coef2</span>

<span class="k">def</span><span class="w"> </span><span class="nf">orthogonalizebasis</span><span class="p">(</span><span class="n">ibasis</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Orthonormalizes the basis.</span>
<span class="sd">        ibasis: basis set</span>
<span class="sd">            allowed values:</span>
<span class="sd">                0 -- Legendre like</span>
<span class="sd">                1 -- Polynomial 1</span>
<span class="sd">                2 -- Polynomial 2</span>
<span class="sd">                3 -- Sin</span>
<span class="sd">        length: box length</span>

<span class="sd">        returns the basis and its 2nd derivative</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ibasis</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">basis</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">pol</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">length</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">basisd2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="mi">4</span><span class="o">/</span><span class="p">(</span><span class="n">length</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">pol</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">length</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">c2</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">int2</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="k">lambda</span> <span class="n">xx</span><span class="p">:</span> <span class="n">basis</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">coef</span><span class="p">)</span><span class="o">*</span><span class="n">basis</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">coef</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">coef</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">coef</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">int2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">coef2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pol</span><span class="o">.</span><span class="n">polyder</span><span class="p">(</span><span class="n">coef</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">ibasis</span> <span class="o">!=</span><span class="mi">3</span> <span class="p">:</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">basis</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">pol</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">basisd2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">pol</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c2</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">int2</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="k">lambda</span> <span class="n">xx</span><span class="p">:</span> <span class="n">basis</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">coef</span><span class="p">)</span><span class="o">*</span><span class="n">basis</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">coef</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">coef</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">coef</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">int2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">coef2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pol</span><span class="o">.</span><span class="n">polyder</span><span class="p">(</span><span class="n">coef</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ibasis</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">sqrtl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">length</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">basis</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">sqrtl</span><span class="o">*</span><span class="n">unorth</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">basisd2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">sqrtl</span><span class="o">*</span><span class="n">unorthd2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c2</span><span class="p">)</span>

    <span class="c1"># Gram-Schmidt orthogonalization (not needed for sin basis)</span>
    <span class="k">if</span> <span class="n">ibasis</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nmax</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">coef</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">proj</span> <span class="o">=</span> <span class="n">int2</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">coef</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coef</span><span class="p">[</span><span class="n">j</span><span class="p">])):</span>
                    <span class="n">p</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">proj</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">coef</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
            <span class="n">coef</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">coef</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">int2</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
            <span class="n">coef2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pol</span><span class="o">.</span><span class="n">polyder</span><span class="p">(</span><span class="n">coef</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">basis</span><span class="p">,</span> <span class="n">basisd2</span>

<span class="c1">################ calculation of overlap matrix #########################</span>
<span class="c1"># calculate overlap matrix when using f as basis (n functions)</span>
<span class="c1"># not used for calculation, only to print</span>
<span class="k">def</span><span class="w"> </span><span class="nf">calcs</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">what</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate overlap matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">basis2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">coef</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">coef</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">basis2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">basis2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
    <span class="n">sp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">columns</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">what</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>

<span class="c1">################ plot basis #########################</span>
<span class="k">def</span><span class="w"> </span><span class="nf">plotbasis</span><span class="p">(</span><span class="n">docalcs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots the basis functions</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">unorth</span><span class="p">,</span> <span class="n">unorthd2</span><span class="p">,</span> <span class="n">coef</span><span class="p">,</span> <span class="n">coef2</span><span class="p">,</span> <span class="n">ucoef</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">nmax</span>
    <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="n">basistype</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">orthogonalize</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
    <span class="c1"># need to recalculate basis?</span>
    <span class="k">if</span> <span class="n">s</span> <span class="o">!=</span> <span class="n">old</span><span class="p">:</span>
        <span class="c1"># if user did change from sin to other basis, and did not move slider</span>
        <span class="c1"># nbasis may be too big; this is a slider quirk</span>
        <span class="n">on_update_basistype</span><span class="p">()</span>
        <span class="n">unorth</span><span class="p">,</span> <span class="n">unorthd2</span><span class="p">,</span> <span class="n">coef</span><span class="p">,</span> <span class="n">coef2</span> <span class="o">=</span> <span class="n">setbasis</span><span class="p">(</span><span class="n">basistype</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;ucoef&#39;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
            <span class="k">del</span> <span class="n">ucoef</span>
        <span class="n">ucoef</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">coef</span><span class="p">)</span>
        <span class="n">old</span> <span class="o">=</span> <span class="p">[</span><span class="n">basistype</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">orthogonalize</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbasis</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">unorth</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="n">coef</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x/\AA$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\varphi_k$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>
        <span class="n">legend</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.2</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">legend</span><span class="o">.</span><span class="n">get_frame</span><span class="p">()</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$k$&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">docalcs</span><span class="p">:</span>
        <span class="n">calcs</span><span class="p">(</span><span class="n">nbasis</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">unorth</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;Overlap matrix (S) of </span><span class="se">\u03C6</span><span class="s2"> basis:&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plotorthbasis</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots orthonormalized basis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">unorth</span><span class="p">,</span> <span class="n">unorthd2</span><span class="p">,</span> <span class="n">coef</span><span class="p">,</span> <span class="n">coef2</span><span class="p">,</span> <span class="n">ucoef</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">basisd2</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">nmax</span>
    <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="n">basistype</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">orthogonalize</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
    <span class="c1"># need to recalculate basis?</span>
    <span class="k">if</span> <span class="n">s</span> <span class="o">!=</span> <span class="n">old</span><span class="p">:</span>
        <span class="c1"># need to recalculate unorthonormalized basis?</span>
        <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="n">old</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]:</span>
            <span class="c1"># if user did change from sin to other basis, and did not move slider</span>
            <span class="c1"># nbasis may be too big; this is a slider quirk</span>
            <span class="n">on_update_basistype</span><span class="p">()</span>
            <span class="n">unorth</span><span class="p">,</span> <span class="n">unorthd2</span><span class="p">,</span> <span class="n">coef</span><span class="p">,</span> <span class="n">coef2</span> <span class="o">=</span> <span class="n">setbasis</span><span class="p">(</span><span class="n">basistype</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;ucoef&#39;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
                <span class="k">del</span> <span class="n">ucoef</span>
            <span class="n">ucoef</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">coef</span><span class="p">)</span>
        <span class="n">basis</span><span class="p">,</span> <span class="n">basisd2</span> <span class="o">=</span> <span class="n">orthogonalizebasis</span><span class="p">(</span><span class="n">basistype</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">old</span> <span class="o">=</span> <span class="p">[</span><span class="n">basistype</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">orthogonalize</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbasis</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">unorth</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="n">ucoef</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x/\AA$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\varphi_k$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbasis</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">basis</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="n">coef</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x/\AA$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\phi_k$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>
        <span class="n">legend</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.25</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">legend</span><span class="o">.</span><span class="n">get_frame</span><span class="p">()</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$k$&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">calcs</span><span class="p">(</span><span class="n">nbasis</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;Overlap matrix (S) of </span><span class="se">\u03D5</span><span class="s2"> basis:&quot;</span><span class="p">)</span>

<span class="c1">################ H matrix elements, wave function, probability calculations #########################</span>

<span class="c1"># return n-th basis function * H-operator (including V) on m-th basis function</span>
<span class="k">def</span><span class="w"> </span><span class="nf">hpotelement</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">mass</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    calculate phi_n H phi_m</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">basis</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">coef</span><span class="p">)</span><span class="o">*</span><span class="p">(</span> <span class="p">((</span><span class="o">-</span><span class="n">hbarsqr</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">mass</span><span class="p">))</span><span class="o">*</span><span class="n">basisd2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">coef2</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">pot</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">basis</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">coef</span><span class="p">))</span> <span class="p">)</span>

<span class="c1"># calculate H matrix (including V) when using n basis functions</span>
<span class="k">def</span><span class="w"> </span><span class="nf">calchpot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">mass</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    calculate H_ij matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">hpotelement</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">mass</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">hpotelement</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">mass</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">h</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">h</span>

<span class="c1"># wave function</span>
<span class="k">def</span><span class="w"> </span><span class="nf">psi</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">eigvec</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    calculate wave function</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="c1"># dot product of i^th eigenvector with basis functions</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">eigvec</span><span class="p">)):</span>
        <span class="nb">sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">+</span> <span class="n">eigvec</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">basis</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">coef</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span>

<span class="c1"># square of wave function</span>
<span class="k">def</span><span class="w"> </span><span class="nf">psi2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">eigvec</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    calculate wavefunction^2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="c1"># dot product of i^th eigenvector with basis functions</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">eigvec</span><span class="p">)):</span>
        <span class="nb">sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">+</span> <span class="n">eigvec</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">basis</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">coef</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="o">**</span><span class="mi">2</span>

<span class="c1"># probability between x0 and x1</span>
<span class="k">def</span><span class="w"> </span><span class="nf">intpsi2</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">eigval</span><span class="p">,</span> <span class="n">eigvec</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    calculate probability between x0 and x1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">eigval</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">psi2</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">eigvec</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># kinetic energy</span>
<span class="k">def</span><span class="w"> </span><span class="nf">kin</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">eigvec</span><span class="p">,</span> <span class="n">mass</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    calculate kinetic energy</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">k1</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">k2</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">eigvec</span><span class="p">)):</span>
        <span class="n">k1</span> <span class="o">=</span> <span class="n">k1</span> <span class="o">+</span> <span class="n">eigvec</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">basisd2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">coef2</span><span class="p">)</span> <span class="c1"># 2nd derivative</span>
        <span class="n">k2</span> <span class="o">=</span> <span class="n">k2</span> <span class="o">+</span> <span class="n">eigvec</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">basis</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">coef</span><span class="p">)</span> <span class="c1"># wave function</span>
    <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="n">hbarsqr</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">mass</span><span class="p">))</span><span class="o">*</span><span class="n">k2</span><span class="o">*</span><span class="n">k1</span>


<span class="c1"># calculate and report crossing points of intersecting parabola potential</span>
<span class="k">def</span><span class="w"> </span><span class="nf">crossing</span><span class="p">(</span><span class="n">kka</span><span class="p">,</span> <span class="n">kkb</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    calculate parabola crossing (for section 6. Intersecting parabola)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Parabola crossing and ground state probabilities:&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">kka</span><span class="o">-</span><span class="n">kkb</span><span class="p">)</span><span class="o">&lt;</span> <span class="mf">1.0e-9</span><span class="p">:</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">x0a</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="n">x0b</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="p">(</span><span class="n">h</span><span class="o">/</span><span class="p">((</span><span class="n">x0b</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">x0a</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">*</span><span class="n">kka</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">x1</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">x1</span> <span class="o">&gt;</span> <span class="n">length</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  No crossing&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ex1</span> <span class="o">=</span> <span class="n">kka</span><span class="o">*</span><span class="p">(</span><span class="n">x1</span><span class="o">-</span><span class="n">x0a</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">toeV</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Crossing at x=&quot;</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="s2">&quot; with energy of &quot;</span><span class="p">,</span><span class="n">ex1</span><span class="p">,</span><span class="s2">&quot; eV&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  P_A = Ground state probability between x= 0 and &quot;</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span><span class="s2">&quot;: &quot;</span><span class="p">,</span>\
              <span class="n">intpsi2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">eigval</span><span class="p">,</span> <span class="n">eigvec</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="n">kka</span><span class="o">-</span><span class="n">kkb</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">x0a</span><span class="o">.</span><span class="n">value</span><span class="o">-</span><span class="n">x0b</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">kka</span><span class="o">*</span><span class="n">kkb</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="n">xx</span><span class="o">=</span><span class="n">x0a</span><span class="o">.</span><span class="n">value</span><span class="o">*</span><span class="n">kka</span> <span class="o">-</span> <span class="n">x0b</span><span class="o">.</span><span class="n">value</span><span class="o">*</span><span class="n">kkb</span>
            <span class="n">den</span> <span class="o">=</span> <span class="n">kka</span><span class="o">-</span><span class="n">kkb</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="p">(</span><span class="n">xx</span> <span class="o">+</span> <span class="n">d</span><span class="p">)</span><span class="o">/</span><span class="n">den</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="p">(</span><span class="n">xx</span> <span class="o">-</span> <span class="n">d</span><span class="p">)</span><span class="o">/</span><span class="n">den</span>
            <span class="n">ex1</span> <span class="o">=</span> <span class="n">kka</span><span class="o">*</span><span class="p">(</span><span class="n">x1</span><span class="o">-</span><span class="n">x0a</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">toeV</span>
            <span class="n">ex2</span> <span class="o">=</span> <span class="n">kka</span><span class="o">*</span><span class="p">(</span><span class="n">x2</span><span class="o">-</span><span class="n">x0a</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">toeV</span>
            <span class="n">x1in</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">x2in</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">x1</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">x1</span> <span class="o">&gt;</span> <span class="n">length</span><span class="p">:</span>
                <span class="n">x1in</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">x2</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">x2</span> <span class="o">&gt;</span> <span class="n">length</span><span class="p">:</span>
                <span class="n">x2in</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">x1in</span> <span class="ow">and</span> <span class="n">x2in</span><span class="p">:</span>
                <span class="n">x1a</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
                <span class="n">x2a</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Crossings at x=&quot;</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="s2">&quot; and &quot;</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span><span class="s2">&quot; with energies of &quot;</span><span class="p">,</span><span class="n">ex1</span><span class="p">,</span><span class="s2">&quot; and &quot;</span><span class="p">,</span><span class="n">ex2</span><span class="p">,</span><span class="s2">&quot; eV&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Ground state probability between x=&quot;</span><span class="p">,</span> <span class="n">x1a</span><span class="p">,</span> <span class="s2">&quot; and &quot;</span><span class="p">,</span> <span class="n">x2a</span><span class="p">,</span><span class="s2">&quot;: &quot;</span><span class="p">,</span>\
                  <span class="n">intpsi2</span><span class="p">(</span><span class="n">x1a</span><span class="p">,</span> <span class="n">x2a</span><span class="p">,</span> <span class="n">eigval</span><span class="p">,</span> <span class="n">eigvec</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">x1in</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Crossing at x=&quot;</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="s2">&quot; with energy of &quot;</span><span class="p">,</span><span class="n">ex1</span><span class="p">,</span><span class="s2">&quot; eV&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  P_A = Ground state probability between x= 0 and &quot;</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span><span class="s2">&quot;: &quot;</span><span class="p">,</span>\
                  <span class="n">intpsi2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">eigval</span><span class="p">,</span> <span class="n">eigvec</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">x2in</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Crossing at x=&quot;</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="s2">&quot; with energy of &quot;</span><span class="p">,</span><span class="n">ex2</span><span class="p">,</span><span class="s2">&quot; eV&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  P_A = Ground state probability between x= 0 and &quot;</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span><span class="s2">&quot;: &quot;</span><span class="p">,</span>\
                  <span class="n">intpsi2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">eigval</span><span class="p">,</span> <span class="n">eigvec</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  No crossing&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  No crossing&quot;</span><span class="p">)</span>

<span class="c1">################ Plot wave function and probability #########################</span>
<span class="c1"># plot square of the wave function and potential</span>
<span class="c1"># as well as total, potential and kinetic energies</span>
<span class="k">def</span><span class="w"> </span><span class="nf">plotpsi2</span><span class="p">(</span><span class="n">eigval</span><span class="p">,</span> <span class="n">eigvec</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">showexc</span><span class="p">,</span> <span class="n">prange</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots wave function, probability and potential</span>
<span class="sd">        eigval: eigenvalues</span>
<span class="sd">        eigvec: eigenvectors</span>
<span class="sd">        length: length of box</span>
<span class="sd">        mass: mass of particle (in multiples of electronmass)</span>
<span class="sd">        showexc: True if excited states are shown</span>
<span class="sd">        prange: show probability between this range</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># eigenvalues are in ascending order; calculate ground state properties</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;pot&#39;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
        <span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="n">pot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">*</span><span class="n">toeV</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))]</span>
        <span class="n">totpot</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="k">lambda</span> <span class="n">xx</span><span class="p">:</span> <span class="n">pot</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span><span class="o">*</span><span class="n">psi2</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">eigvec</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))]</span>
        <span class="n">totpot</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">totkin</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="k">lambda</span> <span class="n">xx</span><span class="p">:</span> <span class="n">kin</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">eigvec</span><span class="p">,</span> <span class="n">mass</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span> <span class="c1">#8,6</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

    <span class="c1"># plot Psi</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x/\AA$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">showexc</span><span class="p">:</span>
        <span class="c1"># show 6 or fewer states</span>
        <span class="n">c</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;#990000&#39;</span><span class="p">,</span> <span class="s1">&#39;#CC0000&#39;</span><span class="p">,</span> <span class="s1">&#39;#FF3300&#39;</span><span class="p">,</span> <span class="s1">&#39;#FF9933&#39;</span><span class="p">,</span> <span class="s1">&#39;#FFCC00&#39;</span><span class="p">]</span>
        <span class="n">my</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">py</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">nexc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">eigval</span><span class="p">)])</span>
        <span class="c1"># use scaling to make wave function visible in energy diagram</span>
        <span class="k">if</span> <span class="n">nexc</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="p">(</span><span class="n">eigval</span><span class="p">[</span><span class="n">nexc</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">eigval</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">nexc</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nexc</span><span class="p">):</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="p">[</span><span class="n">eigval</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">toeV</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))]</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">scale</span><span class="o">*</span><span class="n">psi</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">eigvec</span><span class="p">)</span><span class="o">+</span><span class="n">eigval</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">toeV</span>
            <span class="n">my</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
            <span class="n">py</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$E$/eV&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;First &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nexc</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; states&quot;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymax</span><span class="o">=</span><span class="n">eigval</span><span class="p">[</span><span class="n">nexc</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">toeV</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">scale</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=-</span><span class="mi">3</span><span class="o">*</span><span class="n">scale</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">py</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nexc</span><span class="p">])</span><span class="o">+</span><span class="n">scale</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">my</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nexc</span><span class="p">])</span><span class="o">-</span><span class="n">scale</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax1a</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="n">ax1a</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">ax1a</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ax1a</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">ax1a</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Psi_0(x)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">psi</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">eigvec</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Ground state&quot;</span><span class="p">)</span>

    <span class="c1"># plot P (and V) of ground state</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="n">psi2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">eigvec</span><span class="p">)</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax2a</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">ax2a</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">ax2a</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax2a</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x/\AA$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$P_0(x)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">ax2a</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$V(x)$/eV&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;</span><span class="n">prange</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">prange</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightblue&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$E_0=$&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">eigval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">toeV</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span>\
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;$V_0=$&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">totpot</span><span class="o">*</span><span class="n">toeV</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span>\
                <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;$\;K_0=$&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">totkin</span><span class="o">*</span><span class="n">toeV</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; eV&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>

    <span class="c1"># plot ground state eigenvector</span>
    <span class="n">y3</span> <span class="o">=</span> <span class="p">[</span><span class="n">eigvec</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">eigvec</span><span class="p">))]</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">eigvec</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">y3</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$k$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$a_k$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_right</span><span class="p">()</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Psi_0$&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.35</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Orthonormalized basis.</span><span class="se">\n</span><span class="s2">Ground state properties: &quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  E_0 = &quot;</span><span class="p">,</span><span class="n">eigval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">toeV</span><span class="p">,</span><span class="s2">&quot; eV&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  First &quot;</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">nbasis</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span><span class="s2">&quot; elements eigenvector (a_k): &quot;</span><span class="p">,</span><span class="n">eigvec</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">min</span><span class="p">(</span><span class="n">nbasis</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">eigval</span><span class="p">)])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Probability between x=&quot;</span><span class="p">,</span> <span class="n">prob</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot; and &quot;</span><span class="p">,</span> <span class="n">prob</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s2">&quot;: &quot;</span><span class="p">,</span>\
      <span class="n">intpsi2</span><span class="p">(</span><span class="n">prob</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">prob</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">eigval</span><span class="p">,</span> <span class="n">eigvec</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">showexcited</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">First &quot;</span><span class="p">,</span><span class="n">nexc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot; excited states:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nexc</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  E_&quot;</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="s2">&quot; = &quot;</span><span class="p">,</span><span class="n">eigval</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">toeV</span><span class="p">,</span><span class="s2">&quot; eV&quot;</span><span class="p">)</span>

<span class="c1">################ calculation of wave function for given potentials  #########################</span>
<span class="k">def</span><span class="w"> </span><span class="nf">processpotentials</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates wave function and probability for given potentials</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">unorth</span><span class="p">,</span> <span class="n">unorthd2</span><span class="p">,</span> <span class="n">coef</span><span class="p">,</span> <span class="n">coef2</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">basisd2</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> \
        <span class="n">nmax</span><span class="p">,</span> <span class="n">eigval</span><span class="p">,</span> <span class="n">eigvec</span><span class="p">,</span> <span class="n">pot</span><span class="p">,</span> <span class="n">beforeinversion</span>

    <span class="c1"># artifact of interactive: need to define pot here, otherwise</span>
    <span class="c1"># it isn&#39;t always updated (especially when users go back in lab)</span>
    <span class="k">if</span> <span class="n">section</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># 2. Particle in a box</span>
       <span class="k">def</span><span class="w"> </span><span class="nf">pot</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">section</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1"># 3. Step potential</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">pot</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">x0a</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">heighta</span><span class="o">.</span><span class="n">value</span><span class="o">/</span><span class="n">toeV</span>
    <span class="k">elif</span> <span class="n">section</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="c1"># 4. Central potential</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">pot</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">xrangea</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">xrangea</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">return</span> <span class="n">heighta</span><span class="o">.</span><span class="n">value</span><span class="o">/</span><span class="n">toeV</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">section</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="c1"># 5. Double barrier</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">pot</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">xrangea</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">return</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">xrangea</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">heighta</span><span class="o">.</span><span class="n">value</span><span class="o">/</span><span class="n">toeV</span>
            <span class="k">elif</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">xrangeb</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">return</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">xrangeb</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">heightb</span><span class="o">.</span><span class="n">value</span><span class="o">/</span><span class="n">toeV</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">section</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="c1"># 6. Intersecting parabola</span>
        <span class="n">kka</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ka</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">/</span><span class="n">toeV</span>
        <span class="n">kkb</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">kb</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">/</span><span class="n">toeV</span>
        <span class="n">h</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">heightb</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">/</span><span class="n">toeV</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">pot</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">fa</span> <span class="o">=</span> <span class="n">kka</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x0a</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">fb</span> <span class="o">=</span> <span class="n">kkb</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x0b</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">h</span>
            <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">fa</span><span class="p">,</span> <span class="n">fb</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">section</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="c1"># 6d. Ammonia inversion</span>
        <span class="c1"># hardcoded - variables are restored after use</span>
        <span class="c1"># after Chem Phys Lett 14, 82 (1972)</span>
        <span class="n">basistype</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># sin basis</span>
        <span class="n">on_update_basistype</span><span class="p">()</span>
        <span class="n">nbasis</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">nmax3</span> <span class="c1"># maximum number of basis functions</span>
        <span class="n">L</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">mass</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">ammoniamass</span>
        <span class="n">showexcited</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.3</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">]</span>
        <span class="n">kappa</span><span class="o">=</span><span class="mf">3036.57</span>
        <span class="n">r</span><span class="o">=</span><span class="mf">0.397577</span>
        <span class="n">r2</span><span class="o">=</span><span class="n">r</span><span class="o">*</span><span class="n">r</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">pot</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">xx</span><span class="o">=</span><span class="n">x</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">L</span><span class="o">.</span><span class="n">value</span>
            <span class="k">return</span> <span class="n">kappa</span><span class="o">*</span><span class="p">(</span><span class="n">r2</span><span class="o">-</span><span class="n">xx</span><span class="o">*</span><span class="n">xx</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">r2</span><span class="p">)</span><span class="o">/</span><span class="mf">1822.89</span>

    <span class="n">orthogonalize</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="n">basistype</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">orthogonalize</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">s</span> <span class="o">!=</span> <span class="n">old</span><span class="p">:</span>
        <span class="c1"># need to recalculate unorthonormalized basis?</span>
        <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="n">old</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]:</span>
            <span class="c1"># if user did change from sin to other basis, and did not move slider</span>
            <span class="c1"># nbasis may be too big; this is a slider quirk</span>
            <span class="n">on_update_basistype</span><span class="p">()</span>
            <span class="n">unorth</span><span class="p">,</span> <span class="n">unorthd2</span><span class="p">,</span> <span class="n">coef</span><span class="p">,</span> <span class="n">coef2</span> <span class="o">=</span> <span class="n">setbasis</span><span class="p">(</span><span class="n">basistype</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">basis</span><span class="p">,</span> <span class="n">basisd2</span> <span class="o">=</span> <span class="n">orthogonalizebasis</span><span class="p">(</span><span class="n">basistype</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="n">hmatpot</span> <span class="o">=</span> <span class="n">calchpot</span><span class="p">(</span><span class="n">nbasis</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">mass</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="c1"># la.eigh returns eigenvalues in ascending order</span>
    <span class="n">eigval</span><span class="p">,</span> <span class="n">eigvec</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">hmatpot</span><span class="p">)</span>

    <span class="c1"># update old; keep last fields to None for dosomething3/..</span>
    <span class="n">old</span> <span class="o">=</span> <span class="p">[</span><span class="n">basistype</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">orthogonalize</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
    <span class="n">plotpsi2</span><span class="p">(</span><span class="n">eigval</span><span class="p">,</span> <span class="n">eigvec</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">mass</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">showexcited</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">prob</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="c1"># for intersecting parabola: calculate crossing point</span>
    <span class="k">if</span> <span class="n">section</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">crossing</span><span class="p">(</span><span class="n">kka</span><span class="p">,</span> <span class="n">kkb</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="c1"># restore handset values after hardcoded ammonia inversion values</span>
    <span class="k">if</span> <span class="n">section</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">beforeinversion</span> <span class="o">=</span> <span class="p">[</span><span class="n">basistype</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">nbasis</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                           <span class="n">mass</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">showexcited</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">prob</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">basistype</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">basistype</span><span class="o">.</span><span class="n">value</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="s2">&quot; basis, N=&quot;</span><span class="p">,</span><span class="n">nbasis</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">barrier</span> <span class="o">=</span> <span class="n">kappa</span><span class="o">*</span><span class="n">r2</span><span class="o">/</span><span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="mf">1822.89</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Barrier &quot;</span><span class="p">,</span> <span class="n">barrier</span><span class="o">*</span><span class="n">toeV</span><span class="p">,</span><span class="s2">&quot; eV&quot;</span><span class="p">)</span>

        <span class="n">basistype</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">beforeinversion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nbasis</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">beforeinversion</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">L</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">beforeinversion</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">mass</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">beforeinversion</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">showexcited</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">beforeinversion</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">beforeinversion</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>

<span class="c1">############### menu manipulation #############################</span>
<span class="k">def</span><span class="w"> </span><span class="nf">printall</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">section</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># 1. Show basis</span>
        <span class="k">if</span> <span class="n">orthogonalize</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">plotorthbasis</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plotbasis</span><span class="p">(</span><span class="n">shows</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># 2-6. Process all other sections</span>
        <span class="n">processpotentials</span><span class="p">()</span>

<span class="c1">#function to handle input.</span>
<span class="k">def</span><span class="w"> </span><span class="nf">showOutput</span><span class="p">(</span><span class="n">btn</span><span class="p">):</span>
    <span class="n">output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">output</span><span class="p">:</span>
        <span class="c1">#print(return_value)</span>
        <span class="n">printall</span><span class="p">()</span>

<span class="n">button</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">showOutput</span><span class="p">)</span>

<span class="n">ui</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">grid</span><span class="p">,</span> <span class="n">button</span><span class="p">,</span> <span class="n">output</span><span class="p">])</span>
<span class="n">ui</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "8f1c9ac658fe4fe1bfd300b06cdb32aa"}</script></div>
</div>
<p>We can now derive how the ground state energy and wave function are obtained with the linear variational method. Introducing <span class="math notranslate nohighlight">\(\hat{H} = -\dfrac{\hbar^2}{2 m} \dfrac{d^2 }{d x^2} + V(x)\)</span>, we start by taking a generalized dot product of <span class="math notranslate nohighlight">\(\Psi\)</span> with the Schrödinger equation. This gives <span class="math notranslate nohighlight">\(\int \Psi(x) \hat{H} \Psi(x) dx = E \int  \Psi(x) \Psi(x) dx\)</span>, where we used the fact that by construction, our <span class="math notranslate nohighlight">\(\Psi\)</span> is real. Since the particle is confined, <span class="math notranslate nohighlight">\(\Psi(x)=0\)</span> for <span class="math notranslate nohighlight">\(x\notin (0, L)\)</span>, and the integration can be performed between <span class="math notranslate nohighlight">\(x=0\)</span> and <span class="math notranslate nohighlight">\(L\)</span>.</p>
<p>The functional expansion of <span class="math notranslate nohighlight">\(\Psi\)</span> over the <span class="math notranslate nohighlight">\(N\)</span> real basis functions results in: <span class="math notranslate nohighlight">\(\int \Psi(x) \hat{H} \Psi(x) dx = \sum\limits_{i=1}^N \sum\limits_{j=1}^N a_i a_j \int \varphi_i(x)\hat{H}\varphi_j(x) dx = \sum\limits_{i=1}^N \sum\limits_{j=1}^N a_i a_j H_{ij}\)</span>, where <span class="math notranslate nohighlight">\(H_{ij} = \int \varphi_i(x) \hat{H} \varphi_j(x) dx\)</span> is an element of the real, symmetric <u>Hamiltonian matrix</u> (<span class="math notranslate nohighlight">\(H\)</span>). Similarly, <span class="math notranslate nohighlight">\(\int  \Psi(x) \Psi(x) dx =  \sum\limits_{i=1}^N \sum\limits_{j=1}^N a_i a_j S_{ij}\)</span>, where <span class="math notranslate nohighlight">\(S_{ij} = \int \varphi_i(x) \varphi_j(x) dx\)</span> is an element of the real, symmetric <u>overlap matrix</u> (<span class="math notranslate nohighlight">\(S\)</span>). Thus, we have translated the Schrödinger equation of our system to <span class="math notranslate nohighlight">\(\sum\limits_{i=1}^N \sum\limits_{j=1}^N a_i a_j H_{ij} = E \sum\limits_{i=1}^N \sum\limits_{j=1}^N a_i a_j S_{ij}\)</span>.<br></p>
<p>It would greatly help if the basis functions were <em>orthonormal</em>. To see this, let’s use the notation <span class="math notranslate nohighlight">\(\phi_k\)</span> for orthonormal basis functions. If the basis functions were orthonormal, then <span class="math notranslate nohighlight">\(S_{ij} = \int \phi_i(x) \phi_j(x) dx = \left \{ \begin{array}{ll}0 &amp; \text{if}\;i\ne j\\1 &amp; \text{if}\;i = j\end{array}\right .\)</span>. Then: <span class="math notranslate nohighlight">\(\sum\limits_{i=1}^N \sum\limits_{j=1}^N a_i a_j H_{ij} = E \sum\limits_{i=1}^N \sum\limits_{j=1}^N a_i a_j S_{ij} = E \sum\limits_{i=1}^N a_i^2\)</span>. Differentiating this equation to <span class="math notranslate nohighlight">\(a_k\)</span> gives <span class="math notranslate nohighlight">\(2 \sum\limits_{i=1}^N a_k H_{ik} = \dfrac{\partial E}{\partial a_k}\sum\limits_{i=1}^N a_i^2 + 2 E a_k\)</span>, where we used the fact that <span class="math notranslate nohighlight">\(H\)</span> is symmetric. In the ground state, the energy is minimal, or <span class="math notranslate nohighlight">\(\dfrac{\partial E}{\partial a_k}=0\;\forall k\)</span>. Therefore, <span class="math notranslate nohighlight">\(\sum\limits_{i=1}^N a_k H_{ik} = E a_k\)</span>, or <font color="Red"><span class="math notranslate nohighlight">\(H \overrightarrow{a} = E \overrightarrow{a}\)</span></font>, where <span class="math notranslate nohighlight">\(\overrightarrow{a}\)</span> is the vector of <span class="math notranslate nohighlight">\(a_k\)</span> coefficients.</p>
<p>In other words, <span class="math notranslate nohighlight">\(E\)</span> is an eigenvalue of the <span class="math notranslate nohighlight">\(H\)</span> matrix, and <span class="math notranslate nohighlight">\(\overrightarrow{a}\)</span> the associated normalized eigenvector. Both will be real, since the <span class="math notranslate nohighlight">\(H\)</span> matrix is real and symmetric. The wave function is obtained from <font color="Red"><span class="math notranslate nohighlight">\(\Psi(x) = \sum a_k \phi_k(x)\)</span></font>, or the dot product of <span class="math notranslate nohighlight">\(\overrightarrow{a}\)</span> with the basis. The components of this eigenvector represent the relative weight/importance of the basis functions: if <span class="math notranslate nohighlight">\(a_i = 0\)</span>, the weight of <span class="math notranslate nohighlight">\(\phi_k\)</span> is <span class="math notranslate nohighlight">\(0\)</span>, and <span class="math notranslate nohighlight">\(\phi_k\)</span> does not contribute to the wave function. Since the <em>ground state</em> is the lowest energy state, the ground state energy is the lowest eigenvalue, and the ground state wave function its associated eigenvector. We will use subscript “0” for all ground state properties (<em>e.g.</em> <span class="math notranslate nohighlight">\(E_0\)</span>, <span class="math notranslate nohighlight">\(\Psi_0\)</span>, and <span class="math notranslate nohighlight">\(P_0\)</span>).</p>
<p>In conclusion, <font color="Red">by selecting <u>orthonormal basis functions</u> <span class="math notranslate nohighlight">\(\phi_k\)</span>, the ground state energy (<span class="math notranslate nohighlight">\(E_0\)</span>) is the lowest eigenvalue of the <span class="math notranslate nohighlight">\(H\)</span> matrix and the wave function (<span class="math notranslate nohighlight">\(\Psi_0\)</span>) is obtained from the dot product of the associated eigenvector <span class="math notranslate nohighlight">\(\overrightarrow{a}\)</span> with the basis. The <span class="math notranslate nohighlight">\(i^\text{th}\)</span> component of the eigenvector (<span class="math notranslate nohighlight">\(a_i\)</span>) indicates the weight of the <span class="math notranslate nohighlight">\(i^\text{th}\)</span> basis function (<span class="math notranslate nohighlight">\(\phi_i\)</span>).</cspan></p>
<p><font color="DarkGreen"><a name='1d'><strong>Exercises</strong> <a href=#calculate>Above</a>, select “1. Show basis” for the Section button and deselect “Orthonormalize”. <font color="rgba(255, 255, 0, 0.5)"><strong>Tip</strong></font>: Use the <a href=#calculate>Above</a> and “Jump to” links to quickly move up and down.</p>
<p><strong>1d</strong>. Using <span class="math notranslate nohighlight">\(N=5\)</span>, now select “Calculate S” to evaluate the overlap matrix and check if our bases are orthonormal. Because computers represent numbers using finite precision, tiny numbers like -6.47e-16 <span class="math notranslate nohighlight">\(=-6.47\cdot 10^{-16}\)</span> and 3.78e-14 <span class="math notranslate nohighlight">\(=3.78\cdot 10^{-14}\)</span> can safely be interpreted as zero.
</font></p>
<p>Clearly, none of our bases is orthonormal, and only the “Sin” basis is orthogonal. Happily, we can readily orthogonalize and normalize our bases by using the Gram-Schmidt procedure, implemented above.</p>
<p><font color="DarkGreen"><strong>Exercises</strong> <a href=#calculate>Above</a>, select “1. Show basis” for the Section button.</p>
<p><strong>1e</strong>. Orthonormalize the bases by selecting “Orthonormalize”. Use <span class="math notranslate nohighlight">\(N=5\)</span> to examine how the orthonormal <span class="math notranslate nohighlight">\(\phi_k\)</span> functions differ from the original <span class="math notranslate nohighlight">\(\varphi_k\)</span> basis. </font></p>
<p>We’re ready to use the variational method for several systems (Sections 2-6). <font color="Red"><strong>All bases will automatically be orthonormalized in the next sections</strong></font>. Each application will result in 3 graphs:</p>
<p><font color="rgba(255, 255, 0, 0.5)"><strong><u>Left graph</u></strong></font>. This shows the grounds state wave function (<span class="math notranslate nohighlight">\(\Psi_0(x)\)</span>) in <strong><font color="Black">black</font></strong> with values on the <strong><font color="Black">left <span class="math notranslate nohighlight">\(y\)</span>-axis</font></strong>. The potential <span class="math notranslate nohighlight">\(V(x)\)</span> within the confined space is shown in <strong><font color="Blue">bright blue</font></strong> with values (in eV) on the <strong><font color="Blue">right <span class="math notranslate nohighlight">\(y\)</span>-axis</font></strong>; these values are identical to values on the <strong><font color="Blue">right <span class="math notranslate nohighlight">\(y\)</span>-axis</font></strong> of the <strong>middle graph</strong>.</p>
<p><font color="rgba(255, 255, 0, 0.5)"><strong><u>Middle graph</u></strong></font>. The ground state probability that the electron is at position <span class="math notranslate nohighlight">\(x\)</span> is shown as a <strong><font color="Black">black</font></strong> curve. This probability equals <span class="math notranslate nohighlight">\(P_0(x)=\vert \Psi_0(x)\vert^2\)</span>, values are reported on the <strong><font color="Black">left <span class="math notranslate nohighlight">\(y\)</span>-axis</font></strong>. The <strong><font color="LightBlue">light blue</font></strong> shading underneath this curve represents the ground state probability that the electron is between <span class="math notranslate nohighlight">\(x_{-}\)</span> and <span class="math notranslate nohighlight">\(x_{+}\)</span>; this probability equals <span class="math notranslate nohighlight">\(\int_{x_{-}}^{x_{+}} P_0(x) dx\)</span>. The value of this probability is printed underneath the graph; <span class="math notranslate nohighlight">\(x_{-}\)</span> and <span class="math notranslate nohighlight">\(x_{+}\)</span> are set by a slider. The <strong><font color="Blue">bright blue</font></strong> curve shows the potential <span class="math notranslate nohighlight">\(V(x)\)</span> within the confined space; values (in eV) are reported on the <strong><font color="Blue">right <span class="math notranslate nohighlight">\(y\)</span>-axis</font></strong>. This potential is also shown in <strong><font color="Blue">bright blue</font></strong> in the <strong>left graph</strong>.</p>
<p>The top of this graph reports the ground state energy (<span class="math notranslate nohighlight">\(E_0\)</span>), as well as the ground state kinetic (<span class="math notranslate nohighlight">\(K_0 = -\frac{\hbar^2}{2 m}\int \Psi_0(x)  \frac{d^2 \Psi_0(x)}{d x^2} dx\)</span>) and potential (<span class="math notranslate nohighlight">\(V_0 = \int \Psi_0(x) V(x) \Psi_0(x) dx\)</span>) energies (in eV); <span class="math notranslate nohighlight">\(\;E_0 = K_0 + V_0\)</span>. To clarify: <span class="math notranslate nohighlight">\(V(x)\)</span> is the external potential, the potential felt by the particle, while <span class="math notranslate nohighlight">\(V_0\)</span> is the potential energy of the particle in the ground state. As the expression suggests, the kinetic energy is closely related to the <em>curvature</em> of the wave function: <font color="Red">no curvature, no kinetic energy, and high curvature, high kinetic energy</font>.</p>
<p><font color="rgba(255, 255, 0, 0.5)"><strong><u>Right graph</strong></u></font>. This graph shows the <span class="math notranslate nohighlight">\(a_k\)</span> values of the ground state eigenvector. These can be interpreted as the weights of the basis functions <span class="math notranslate nohighlight">\(\phi_k\)</span> for the ground state wave function: zero <span class="math notranslate nohighlight">\(a_k\)</span>, means zero weight for <span class="math notranslate nohighlight">\(\phi_k\)</span>. In order words, <font color="Red">if <span class="math notranslate nohighlight">\(a_k=0\)</span> then <span class="math notranslate nohighlight">\(\phi_k\)</span> has no contribution to <span class="math notranslate nohighlight">\(\Psi_0\)</span></font>.</p>
<p>Energies, probabilities, and first few <span class="math notranslate nohighlight">\(a_k\)</span> elements are also printed underneath the graphs; you can use the mouse to copy these.</p>
<p><font color="DarkGreen"><strong>2. Particle in a box</strong></font></p>
<blockquote>
<div><p><mark><b>Goals:</b> In this section you will explain parity and how this relates to the quality of basis sets. You will discuss delocalization. You will also visualize excited states and apply the variational method to light absorption of certain dyes.<br />
</mark></p>
</div></blockquote>
<p>We will first consider a <em>particle in a box</em>: a confined system for which <span class="math notranslate nohighlight">\(V(x)=0\)</span>:</p>
<img src="https://variationalmethod.net/images/box.png" width=500><p><font color="DarkGreen"><a name='2a'><strong>Exercises</strong> <a href=#calculate>Above</a>, Select “2. Particle in a box” for the Section button, deselect “Show excited states”, choose “Electron” for mass, and set <span class="math notranslate nohighlight">\(L\)</span> to 1.00 <span class="math notranslate nohighlight">\(\overset{\circ}{A}\)</span>.</p>
<p><strong>2a</strong>. Using the mouse to copy and paste, complete the following table with reported total ground state energies <span class="math notranslate nohighlight">\(E_0\)</span> (in eV), using all decimals:</font></p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>N</p></th>
<th class="head"><p>Legendre-like</p></th>
<th class="head"><p>Polynomial 1</p></th>
<th class="head"><p>Polynomial 2</p></th>
<th class="head"><p>Sin</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
</div>
<p><font color="DarkGreen"> Use this filled-out table to answer the next questions.
</font></p>
<p><font color="DarkGreen"><strong>2b</strong>. Why do the “Legendre-like”, “Polynomial 1”, and “Polynomial 2” bases give the same energy when using 1 basis function? Hint: visualize <span class="math notranslate nohighlight">\(\phi_1\)</span> using “1. Show basis” for the section button with “Orthonormalize” selected.
</font></p>
<p><font color="DarkGreen"><strong>2c</strong>. Upon <u>convergence</u>, additional basis functions do not change the energy. Which basis set converges to the lowest energy? How many basis functions does each function need for convergence?
Therefore, which basis is best (converges to the lowest energy the quickest)?
</font></p>
<p><font color="DarkGreen"><strong>2d</strong>. Why do “Polynomial 1” and “Polynomial 2” give the exact same answers for any <span class="math notranslate nohighlight">\(N\)</span>? Hint: <a href=#calculate>Above</a>, visualize the orthonormal “Polynomial 1” and “Polynomial 2” bases using “1. Show basis” for the section button with “Orthonormalize” selected.
</font></p>
<p><font color="DarkGreen"><strong>2e</strong>. In going from <span class="math notranslate nohighlight">\(N=1\)</span> to 2, to 3, to 4, to 5, does the energy always decrease for the “Polynomial 1” and “Polynomial 2” bases? Does each basis function contribute to the eigenvector?
</font></p>
<p>The behavior of Exercise 2e can be explained by <font color="red"><strong>symmetry</strong></font>. <span class="math notranslate nohighlight">\(V(x)\)</span> is symmetric with respect to a reflection at <span class="math notranslate nohighlight">\(x=\frac{L}{2}\)</span>. Our wave function has to obey the same symmetry: <font color="red">if the potential is symmetric upon reflection, our ground state wave function has to be symmetric upon reflection as well</font>. This symmetry upon reflection is called <font color="red"><em>parity</em></font>; parity is <em>even</em> for symmetry and <em>odd</em> for antisymmetry upon reflection. <u>We will encounter the effect of parity many times</u>.</p>
<p><font color="DarkGreen"><a name='2f'><strong>2f</strong>. Examine <a href=#calculate>above</a> which of the “Polynomial 1”/”Polynomial 2” <span class="math notranslate nohighlight">\(\phi_k\)</span> basis functions are symmetric upon reflection, and use this to explain your observations of Exercise 2e.
</font></p>
<p>Why do symmetric potentials give even parity ground state wave functions? First consider the wave function for any energy state (not just the ground state). The probability should be symmetric when the potential is symmetric (because the particle feels the same on either side of the midpoint). The probability is the square of the wavefunction, so the wave function is either symmetric or antisymmetric for symmetric potentials. Now, let’s apply this finding to the ground state. The ground state has the lowest energy (<span class="math notranslate nohighlight">\(E\)</span>). The lower the curvature of the wave function, the lower the kinetic energy (<span class="math notranslate nohighlight">\(K\)</span>), and therefore the lower the total energy (<span class="math notranslate nohighlight">\(E=K+V\)</span>). Thus, the fewer <em>nodes</em> (places where the wave function equals zero) the wave function has, the lower the curvature, and the lower the energy; in fact, the lowest energy wave function will have no nodes. No nodes is only possible for a wave function with even parity.
This proves that <font color="Red">symmetric potentials will have even parity ground states</font>.</p>
<p><font color="DarkGreen"><strong>2g</strong>. Use the left graph <a href=#calculate>above</a> to verify that the ground state wave function has even parity for all bases and no nodes.
</font></p>
<p>Since the ground state wave function doesn’t have nodes, the ground state probability distribution (<span class="math notranslate nohighlight">\(P_0(x)\)</span>) won’t either. Thus, the ground state will be maximally <strong>delocalized</strong> (spread out over space). <font color="Red">The more delocalized the system, the lower the energy</font>.</p>
<p><a name='2h'><font color="DarkGreen"><strong>2h</strong>. In words, explain why the ground state is maximally delocalized.</font></p>
<p><font color="DarkGreen"><a name='2i'><strong>2i</strong> </a>. Use the “Sin” basis <a href=#calculate>above</a> and examine the ground state eigenvector (<span class="math notranslate nohighlight">\(a_k\)</span>; plotted in the right graph, and printed below the graphs). What does it mean that the eigenvector is <span class="math notranslate nohighlight">\((1, 0, 0, 0, \ldots)\)</span> for the “Sin” basis for any <span class="math notranslate nohighlight">\(N\)</span>?
</font></p>
<p><font color="DarkGreen"><a name='2j'><strong>2j</strong></a>. What is the effect of <span class="math notranslate nohighlight">\(L\)</span> on the ground state energy? Does this make physical sense?
</font></p>
<p>The variational method obtained the ground state by minimizing the energy. This was shown to correspond to solving the eigenvalue equation <span class="math notranslate nohighlight">\(H \overrightarrow{a} = E \overrightarrow{a}\)</span>. The ground state energy (<span class="math notranslate nohighlight">\(E_0\)</span>) is then the lowest eigenvalue, with the ground state wave function (<span class="math notranslate nohighlight">\(\Psi_0\)</span>) the associated eigenvector. But what are the other eigenvalues/eigenvectors?</p>
<p>The other eigenvalues are the energies of the <strong>excited states</strong>, and the associated eigenvectors the wave functions of the excited states. Excited states are states that are higher in energy; these play important roles in photochemistry, for example. In general, the variational method is less good at calculating excited states. It gives an upper bound for these states, but deviations with the “true” excited states are generally larger than for the “true” ground states. We can show this deficiency for the particle in the box when using the “Legendre-like” basis (exercise 2k). In contrast, the “Sin” base will give the exact value of the excited states of the particle in a box, since the “Sin” base yields the exact analytical solution for this problem (see exercise <a href=#2h>2h</a>).</p>
<p><font color="DarkGreen"><a name='2k'><strong>2k</strong> </a>. Visualize the excited states of the particle in a box <a href=#calculate>above</a> by selecting the “Sin” basis and selecting “Show excited states”. The left graph shows the energy of the excited states as a straight line; the the shape of the associated wave function is also shown. The ground state is shown in black, the potential in bright blue.<br />
How many nodes does the ground state, the first excited state, the second excited state, the third excited state, …., have?
</font></p>
<p><font color="DarkGreen"><strong>2l</strong>. What state is the most delocalized?</p>
<p><font color="DarkGreen"><strong>2m</strong>. Contrast the energy of the first excited state (printed below the graphs) and the shape of the first excited state wave function (including the number of nodes) as correctly calculated by the “Sin” basis with that of the “Legendre-like” basis for <span class="math notranslate nohighlight">\(N=20\)</span>. Explain your observation.
</font></p>
<p><font color="DarkGreen"><a name='2n'><strong>2n</strong></a>. Cyanine dyes are conjugated molecules with <span class="math notranslate nohighlight">\((n+3)\)</span> <span class="math notranslate nohighlight">\(\pi\)</span>-electron pairs:</font></p>
<img src="https://variationalmethod.net/images/dye.png" width=225><p><font color="DarkGreen">The length of the conjugated chain backbone is <span class="math notranslate nohighlight">\(2.49 (n + 1) + 5.67\;\overset{\circ}{A}\)</span>. <span class="math notranslate nohighlight">\(\pi\)</span>-electrons will occupy energy levels in pairs, starting from the lowest energy level. The highest occupied energy level is called the HOMO, the lowest unoccupied energy level the LUMO. Thus, for the <span class="math notranslate nohighlight">\(n=0\)</span> cyanine dye, the HOMO is the third energy level (or second excited state above the ground state), the LUMO the fourth (or third excited state). The transition from the HOMO to the LUMO can be measured with UV-vis spectroscopy; the wave length of the transition follows from <span class="math notranslate nohighlight">\(E_{LUMO}-E_{HOMO}=h \nu = \frac{h c}{\lambda}\)</span>, where <span class="math notranslate nohighlight">\(\nu\)</span> is the frequency, <span class="math notranslate nohighlight">\(\lambda\)</span> the wave length, <span class="math notranslate nohighlight">\(c\)</span> the speed of light (<span class="math notranslate nohighlight">\(c=299792458\)</span> m/s), and <span class="math notranslate nohighlight">\(h\)</span> the Planck constant (<span class="math notranslate nohighlight">\(h=6.62607015\cdot 10^{-34}\)</span> J<span class="math notranslate nohighlight">\(\cdot\)</span>s). Using the particle in a box model for <span class="math notranslate nohighlight">\(E_{HOMO}\)</span> and <span class="math notranslate nohighlight">\(E_{LUMO}\)</span> <a href=#calculate>above</a>, calculate the wave length of the HOMO to LUMO transition for cyanine dyes with <span class="math notranslate nohighlight">\(n=0\)</span>, <span class="math notranslate nohighlight">\(n=1\)</span>, and <span class="math notranslate nohighlight">\(n=2\)</span>; 1 eV = <span class="math notranslate nohighlight">\(1.602176634\cdot 10^{-19}\)</span> J. What colors do these wave lengths correspond to? Experimentally, the transitions are found at 313, 416, and 519 nm, respectively.</font></p>
<p><font color="DarkGreen"><strong>3. Step potential</strong></font></p>
<blockquote>
<div><p><mark><b>Goals:</b> In this section you will identify tunneling and discuss its effect in chemistry. You will also discover more consequences of parity.
</mark></p>
</div></blockquote>
<p>Let’s now consider <span class="math notranslate nohighlight">\(V(x)\ne 0\)</span>; unlike the particle in a box potential, <span class="math notranslate nohighlight">\(V(x)\ne 0\)</span> does not have an exact analytical solution. The sliders above implement:</p>
<p><span class="math notranslate nohighlight">\(V(x) = \left \{
\begin{array}{ll}V(x) = 0 &amp; \text{if} \; x&lt; x_{1}\\
V(x) = h_1 &amp; \text{otherwise}\end{array}
\right .\)</span></p>
<p>We now have two regions: a region where <span class="math notranslate nohighlight">\(V(x)=0\)</span> eV and a region where <span class="math notranslate nohighlight">\(V(x)=h_1\)</span> eV. Unlike the particle in a box, the potential is not symmetrical; consequences of this will be encountered in the exercises below. We expect a difference in probabilities over these regions, since particles prefer regions of low potential.</p>
<p><font color="DarkGreen"><a name='3a'><strong>Exercises</strong> <a href=#calculate>Above</a>, select “3. Step potential” for the Section button, deselect “Show excited states”, choose “Electron” for mass, and set <span class="math notranslate nohighlight">\(L\)</span> to <span class="math notranslate nohighlight">\(1.00\;\overset{\circ}{A}\)</span>. Set <span class="math notranslate nohighlight">\(x_1=0.5\;\overset{\circ}{A}\)</span> and <span class="math notranslate nohighlight">\(h_1\)</span> to 100 eV. Set <span class="math notranslate nohighlight">\(x_{-}-x_{+}\)</span> (for <span class="math notranslate nohighlight">\(P_0\)</span>) to 0.5-1.0. <br>
<strong>3a</strong>. Use the “Sin” basis to compare the shape of <span class="math notranslate nohighlight">\(P_0(x)\)</span> and the total probability between <span class="math notranslate nohighlight">\(x=0.5\)</span> and <span class="math notranslate nohighlight">\(x=1.0\)</span> (the value of <span class="math notranslate nohighlight">\(\int\limits_{0.5}^{1.0} P_0(x) dx\)</span>, which is printed below the graph and shaded light blue in the graph) when <span class="math notranslate nohighlight">\(N=1\)</span> and when <span class="math notranslate nohighlight">\(N=2\)</span>. Explain the difference.
</font></p>
<p><font color="DarkGreen"><strong>3b</strong>. Using the “Sin” basis, explain why the shape of <span class="math notranslate nohighlight">\(P_0(x)\)</span> and relative value of the total probability between <span class="math notranslate nohighlight">\(x=0.5\)</span> and <span class="math notranslate nohighlight">\(x=1.0\)</span>  for <span class="math notranslate nohighlight">\(N&gt;1\)</span> makes physical sense. Hint: is the system rather at low or high potential?
</font></p>
<p><font color="DarkGreen"><strong>3c</strong>. <a href=#calculate>Above</a>, compare the shape of <span class="math notranslate nohighlight">\(P_0(x)\)</span> at a given value of <span class="math notranslate nohighlight">\(N&gt;1\)</span> for the “Legendre-like” basis and the “Sin” basis. Based on the energy, which shape is better? Does high <span class="math notranslate nohighlight">\(N\)</span> improve the shape of <span class="math notranslate nohighlight">\(P_0(x)\)</span> for both bases? Explain your result by visualizing the orthonormal “Legendre-like” basis using “1. Show basis” for the section button with “Orthonormalize” selected.
</font></p>
<p><font color="DarkGreen"><strong>3d</strong>. Would a classical particle enter the region <span class="math notranslate nohighlight">\(x\in[0,0.5]\)</span> where <span class="math notranslate nohighlight">\(V(x)&gt;E_0\)</span>? What about our quantum mechanical particle? This penetration of barriers is called “tunneling”.
</font></p>
<p>Tunneling is favorable, since it allows the system to spread out more (become more delocalized; see <a href=#2h>Exercise 2h</a> and <a href=#2j>2j</a>): it can spread out over into the classically forbidden barrier region. We can also show favorability of tunneling by comparing the energy of a step potential to that of a particle in a box. When <span class="math notranslate nohighlight">\(L\)</span> is identical, the particle in a box is favored (has lower energy):</p>
<p><font color="DarkGreen"><a name='3e'><strong>3e</strong>. <a href=#calculate>Above</a>, use <span class="math notranslate nohighlight">\(L=2\)</span>, <span class="math notranslate nohighlight">\(N=50\)</span>, and the “Sin” basis to compare the ground state energy and shape of <span class="math notranslate nohighlight">\(P_0(x)\)</span> of the step potential with <span class="math notranslate nohighlight">\(x_1=1\)</span> and <span class="math notranslate nohighlight">\(h_1=5000\)</span> to that of the particle in a box with <span class="math notranslate nohighlight">\(L=2\)</span>. Explain why it makes physical sense that the energy of the particle in a box is lower.
</font></p>
<p>But when we compare a step potential in a box of length <span class="math notranslate nohighlight">\(L\)</span> to a particle in a box of length <span class="math notranslate nohighlight">\(x_1\)</span>, the favorable energetic effect of tunneling is clearly visible:</p>
<p><font color="DarkGreen"><strong>3f</strong>. <a href=#calculate>Above</a>, use the “Sin” basis and <span class="math notranslate nohighlight">\(N=50\)</span> to compare the ground state energy for the step potential with <span class="math notranslate nohighlight">\(L=2\)</span>, <span class="math notranslate nohighlight">\(x_1=1\)</span> and <span class="math notranslate nohighlight">\(h_1=5000\)</span>, to that of the particle in a box with <span class="math notranslate nohighlight">\(L=1\)</span>. Was there tunneling in the step potential? Based on this comparison, is tunneling energetically favorable?
</font></p>
<p><font color="DarkGreen"><strong>3g</strong>. <a href=#calculate>Above</a>, use the “Sin” basis, <span class="math notranslate nohighlight">\(N=50\)</span>, <span class="math notranslate nohighlight">\(L=1\)</span>, <span class="math notranslate nohighlight">\(x_1=0.5\)</span>, and <span class="math notranslate nohighlight">\(h_1=100\)</span>. Investigate if the tunneling probability depends on mass.
</font></p>
<p>Exercise 3g shows that tunneling strongly depends on mass: light particles tunnel more easily than heavy particles. In chemistry tunneling is responsible for very large kinetic isotope effects: the observation that certain reactions involving hydrogen atoms are much faster than the same reaction done with deuterons (heavy hydrogen). Tunneling is also responsible for the very high rates of certain reactions, for example the intramolecular rearrangement of aryl radicals such as 2,4,6-tri-tert-butylphenyl to 3,5-di-tertbutylneophyl:</p>
<img src="https://variationalmethod.net/images/radical.png" width=350><p>We will see another important example of tunneling in chemistry in exercise 6c-e.</p>
<p><font color="DarkGreen"><strong>4. Central potential</strong></font></p>
<blockquote>
<div><p><mark><b>Goals:</b> In this section you will compare and contrast classical and quantum particles. You will also identify more consequences of parity.
</mark></p>
</div></blockquote>
<p>For the central potential:
<span class="math notranslate nohighlight">\(V(x) = \left \{
\begin{array}{ll}0 &amp; \text{if} \; x&lt; x_{11}\\
h_1 &amp; \text{if} \; x_{11} \le x \le x_{12}\\
 0 &amp; \text{if} \; x&gt; x_{12}\end{array}
\right .\)</span></p>
<p><font color="DarkGreen"><strong>Exercises</strong>.
<a href=#calculate>Above</a>, select the “4. Central potential” section. Set <span class="math notranslate nohighlight">\(L=1\)</span> and set the <span class="math notranslate nohighlight">\(x_{11}-x_{12}\)</span> sliders to 0.3-0.7. Set <span class="math notranslate nohighlight">\(x_{-}-x_{+}\)</span> to 0.3-0.7. Deselect “Show excited states”, choose “Electron” for mass.</p>
<p><a name='4a'><strong>4a</strong>. Use the “Sin” basis with <span class="math notranslate nohighlight">\(N=50\)</span> <a href=#calculate>above</a> to compare the value of the total probabililty between <span class="math notranslate nohighlight">\(x=0.3\)</span> and <span class="math notranslate nohighlight">\(x=0.7\)</span> (<em>i.e.</em> <span class="math notranslate nohighlight">\(\int\limits_{0.3}^{0.7} P_0(x) dx\)</span>) when <span class="math notranslate nohighlight">\(h_1=0\)</span> and <span class="math notranslate nohighlight">\(h_1=10\)</span>. Explain the difference. </font></p>
<p><font color="DarkGreen"><strong>4b</strong>. Use the “Sin” basis, <span class="math notranslate nohighlight">\(N=50\)</span>, and <span class="math notranslate nohighlight">\(h_1=150\)</span> <a href=#calculate>above</a>. What are the values of <span class="math notranslate nohighlight">\(E_0\)</span> and <span class="math notranslate nohighlight">\(\int\limits_{0.3}^{0.7} P_0(x) dx\)</span>? Would <span class="math notranslate nohighlight">\(\int\limits_{0.3}^{0.7} P_0(x) dx&gt;0\)</span> for a classical system? What is this quantum mechanical behavior called?
</font></p>
<p><font color="DarkGreen"><strong>4c</strong>. Use the “Sin” basis and <span class="math notranslate nohighlight">\(N=50\)</span> <a href=#calculate>above</a>.
Calculate <span class="math notranslate nohighlight">\(P_0(x)\)</span> when <span class="math notranslate nohighlight">\(h_1=104.45324\)</span> (<span class="math notranslate nohighlight">\(h_1=E_0\)</span>). Explain why the shape of <span class="math notranslate nohighlight">\(P_0(x)\)</span> between <span class="math notranslate nohighlight">\(x=0.3\)</span> and <span class="math notranslate nohighlight">\(0.7\)</span> makes physical sense. Also explain what this shape would be if the system was classical.</font></p>
<p><font color="DarkGreen"><strong>4d</strong>. <a href=#calculate>Above</a>, use the “Sin” basis and <span class="math notranslate nohighlight">\(N=50\)</span> to compare the shape of <span class="math notranslate nohighlight">\(P_0(x)\)</span> and value of <span class="math notranslate nohighlight">\(\int\limits_{0.3}^{0.7} P_0(x) dx\)</span> when a) <span class="math notranslate nohighlight">\(h_1=10\)</span> (<span class="math notranslate nohighlight">\(h_1&lt;E_0\)</span>), b) <span class="math notranslate nohighlight">\(h_1=104.45324\)</span> (<span class="math notranslate nohighlight">\(h_1=E_0\)</span>), and c) <span class="math notranslate nohighlight">\(h_1=150\)</span> (<span class="math notranslate nohighlight">\(h_1&gt;E_0\)</span>). Explain the behavior and contrast it to a classical system.
</font></p>
<p><font color="DarkGreen"><strong>4e</strong>.
<a href=#calculate>Above</a>, use the “Sin” basis and set <span class="math notranslate nohighlight">\(h_1=10\)</span>. Monitor how the energy changes as <span class="math notranslate nohighlight">\(N\)</span> is increased from 1 to 2, 3, 4, <span class="math notranslate nohighlight">\(\ldots\)</span>; also monitor how the <span class="math notranslate nohighlight">\(a_k\)</span> values change. Does adding a function always improve the result? Repeat the analysis for the “Polynomial 1” basis. Then, explain the behavior by visualizing the orthonormal basis functions.
</font></p>
<p><font color="DarkGreen"><strong>4f</strong>. What is the best basis for this potential?
</font></p>
<p><font color="DarkGreen"><strong>5. Double barrier potential</strong></font></p>
<blockquote>
<div><p><mark><b>Goals:</b> In this section you will explain the effect of boundaries on quantum particles. You will also identify more consequences of parity.
</mark></p>
</div></blockquote>
<p>For the double barrier potential:
<span class="math notranslate nohighlight">\(V(x) = \left \{\begin{array}{ll}
h_1 &amp; \text{if} \; x_{11} \le x \le x_{12}\\
h_2 &amp; \text{if} \; x_{21} \le x \le x_{22}\\
  0 &amp; \text{otherwise}\end{array}
\right .\)</span></p>
<p><font color="DarkGreen"><strong>Exercises</strong>.
<a name='5a'><a href=#calculate>Above</a>, select the “5. Double barrier potential” section. Set <span class="math notranslate nohighlight">\(L=2\)</span>, <span class="math notranslate nohighlight">\(x_{11}-x_{12}\)</span> to 0.4-0.8, and <span class="math notranslate nohighlight">\(x_{21}-x_{22}\)</span> to 1.2-1.6; set <span class="math notranslate nohighlight">\(x_{-}-x_{+}\)</span> to 0.8-1.2. Deselect “Show excited states”, choose “Electron” for mass.</p>
<p><strong>5a</strong>. Set <span class="math notranslate nohighlight">\(h_1\)</span> and <span class="math notranslate nohighlight">\(h_2\)</span> to 50, and investigate which basis is the best. Do this for <span class="math notranslate nohighlight">\(N\le 20\)</span>.</font></p>
<p><font color="DarkGreen"><strong>5b</strong>. Use the “Sin” basis and <span class="math notranslate nohighlight">\(N=50\)</span> <a href=#calculate>above</a>, and compare the shapes of <span class="math notranslate nohighlight">\(P_0(x)\)</span> and the values of <span class="math notranslate nohighlight">\(\int\limits_{0.8}^{1.2} P_0(x) dx\)</span> when <span class="math notranslate nohighlight">\(h_1=h_2=50\)</span> and when <span class="math notranslate nohighlight">\(h_1=h_2=500\)</span>. We have three equally large regions of zero potential (<span class="math notranslate nohighlight">\(x \in [0, 0.4], x \in [0.8, 1.2], x \in [1.6, 2.0]\)</span>): why are the probabilities in these regions so different from each other?
</font></p>
<p><font color="DarkGreen"><strong>5c</strong>. For <span class="math notranslate nohighlight">\(L=2\)</span> and <span class="math notranslate nohighlight">\(N=20\)</span>, compare the behavior of the “Sin” basis to the “Legendre-like” basis <a href=#calculate>above</a> for a) <span class="math notranslate nohighlight">\(h_1=500\)</span>, <span class="math notranslate nohighlight">\(h_2=50\)</span>, while <span class="math notranslate nohighlight">\(x_{11}-x_{12}\)</span> is 0.4-0.8 and <span class="math notranslate nohighlight">\(x_{21}-x_{22}\)</span> is 1.2-1.6, b) <span class="math notranslate nohighlight">\(h_1=h_2=50\)</span>, and <span class="math notranslate nohighlight">\(x_{11}-x_{12}\)</span> is 0.0-0.8 and <span class="math notranslate nohighlight">\(x_{21}-x_{22}\)</span> is 1.2-1.6. Explain your results.
</font></p>
<p><font color="DarkGreen"><strong>6. Intersecting parabolas</strong></font></p>
<blockquote>
<div><p><mark><b>Goals:</b> In this section you will model covalent bonds as springs and calculate vibrational transitions of HCl. You will encounter more tunneling and apply this to the inversion of ammonia. You will also discuss the effects of potential curvature on the partitioning of the system.
</mark></p>
</div></blockquote>
<p>Covalent bonds can be approximated as a spring. The potential for a spring is parabolic: <span class="math notranslate nohighlight">\(V(x)=k_1 (x-x_1)^2\)</span>, where <span class="math notranslate nohighlight">\(k_1\)</span> is the force constant, <span class="math notranslate nohighlight">\(x\)</span> the length of the spring, and <span class="math notranslate nohighlight">\(x_1\)</span> the resting/equilibrium length of the spring. This spring model is called “the harmonic oscillator” and describes bond vibrations.</p>
<p><font color="DarkGreen"><a name='6a'><strong>Exercises</strong></a>. Let’s first model the proton in hydrogen chloride, HCl. <a href=#calculate>Above</a>, select “6. Intersecting parabola” for section. Select “proton” for mass. Set <span class="math notranslate nohighlight">\(L\)</span> to 2.0, <span class="math notranslate nohighlight">\(h_2\)</span> to 4000, <span class="math notranslate nohighlight">\(x_1\)</span> to 1.0 and <span class="math notranslate nohighlight">\(x_2\)</span> to 2.0. Set <span class="math notranslate nohighlight">\(k_1\)</span> to 16.2, set <span class="math notranslate nohighlight">\(k_2\)</span> to 500. Select the “Sin” base, and set <span class="math notranslate nohighlight">\(N\)</span> to 50. Set <span class="math notranslate nohighlight">\(x_{-}-x_{+}\)</span> to 0.8-1.2. Select “Show excited states”; while the variational method generally converges more poorly for excited states, it works well for the first 5 excited states of the problems presented here.</p>
<p><strong>6a</strong>. How are the energy levels spaced apart? Does this type of spacing differ from that of the particle in a box?
</font></p>
<p><font color="DarkGreen"><strong>6b</strong>. Transition between vibrational levels can be measured in infrared (IR) spectroscopy. Calculate the lowest frequency line in the IR spectrum of HCl, using <span class="math notranslate nohighlight">\(\Delta E = h \nu\)</span>, where <span class="math notranslate nohighlight">\(\nu\)</span> is the frequency, and <span class="math notranslate nohighlight">\(h\)</span> the Planck constant (<span class="math notranslate nohighlight">\(h=6.62607015\cdot 10^{-34}\)</span> J<span class="math notranslate nohighlight">\(\cdot\)</span>s). 1 eV = <span class="math notranslate nohighlight">\(1.602176634\cdot 10^{-19}\)</span> J. Experimentally, this line is found at <span class="math notranslate nohighlight">\(8.88\cdot 10^{13}\)</span> Hz (where Hz = s<span class="math notranslate nohighlight">\(^{-1}\)</span>).
</font></p>
<p>Ammonia (NH<span class="math notranslate nohighlight">\(_3\)</span>) is a pyramidal (umbrella shaped) molecule. Like an umbrella in the wind, it can undergo an inversion, turning the molecule “inside out”. This process is depicted in the following potential energy diagram:</p>
<img src="https://variationalmethod.net/images/ammonia.png" width=350><p>A good reaction coordinate coordinate (<em>i.e.</em> a geometrical function that describes the chemical change) is the position of the nitrogen atom. It switches place from left to right, and <em>vice-versa</em>, moving about 0.8 <span class="math notranslate nohighlight">\(\overset{\circ}{A}\)</span> in the process. The stable “left” and “right” conformations are energy wells, that resemble parabola; in the stable conformations, nitrogen vibrates around the energy minima of the wells. The wells are separated by an energy barrier, which needs to be overcome for inversion. The transition state (<span class="math notranslate nohighlight">\(\ddagger\)</span>, the highest energy intermediate) is a planar molecule; this state is 0.2508 eV above the stable conformations.</p>
<p><font color="DarkGreen"><strong>6c</strong>. Calculate the rate of ammonia inversion at room temperature with classical transition state theory: <span class="math notranslate nohighlight">\(
k = \frac{k_B T}{h}e^{-\Delta G^\ddagger/(k_B T)}\)</span>, where <span class="math notranslate nohighlight">\(k_B\)</span> is the Boltzmann constant (<span class="math notranslate nohighlight">\(k_B = 1.380649\cdot10^{-23}\)</span> J/K), <span class="math notranslate nohighlight">\(h\)</span> the Planck constant (<span class="math notranslate nohighlight">\(h=6.62607015\cdot 10^{-34}\)</span> J<span class="math notranslate nohighlight">\(\cdot\)</span>s), and 1 eV = <span class="math notranslate nohighlight">\(1.602176634\cdot 10^{-19}\)</span> J. Since the entropic contribution is small, you can use <span class="math notranslate nohighlight">\(\Delta G^\ddagger \approx \Delta E^\ddagger\)</span>.
</font></p>
<p>Even when performing the classical calculation correctly (taking the small entropic contribution into account), the calculated rate is about 100 times less than the experimentally measured rate of <span class="math notranslate nohighlight">\(4.74\cdot 10^{10}\)</span> s<span class="math notranslate nohighlight">\(^{-1}\)</span>. The difference is due to <strong>tunneling</strong>: by penetrating the barrier, the crossing rate is significantly increased.</p>
<p><font color="DarkGreen"><a name='6d'><strong>6d</strong> </a>. Let’s calculate this rate by considering the energy levels of ammonia. The inversion potential is modeled by <span class="math notranslate nohighlight">\(V(x)=\frac{k(x^2-r^2)^2}{8 r^2}\)</span>, and hard-coded in the “6d. Ammonia inversion” section <a href=#calculate>above</a>. This setting uses the proper mass and the “Sin” basis set with <span class="math notranslate nohighlight">\(N=50\)</span>; while the variational method generally converges more poorly for excited states, it works well for the first few excited states shown here. The energy of the barrier is printed below the graphs.</p>
<p>Calculate the ground state and first 5 excited states for the inversion of ammonia, and describe what this energy diagram looks like.</font></p>
<p><font color="DarkGreen"><strong>6e</strong>. Time-dependent treatment of the Schrödinger equation shows that the rate for ammonia inversion can be obtained from the energetic difference between the first excited state and ground state: <span class="math notranslate nohighlight">\(k = 2 (E_1 - E_0)/h\)</span>, where <span class="math notranslate nohighlight">\(h\)</span> the Planck constant (<span class="math notranslate nohighlight">\(h=6.62607015\cdot 10^{-34}\)</span> J<span class="math notranslate nohighlight">\(\cdot\)</span>s), and 1 eV = <span class="math notranslate nohighlight">\(1.602176634\cdot 10^{-19}\)</span> J. Calculate the quantum mechanical inversion rate, which incorporates tunneling, and compare it to the experimental value.</font></p>
<p>Intersecting parabolas can serve as a simplistic model for reactions where a bond is broken and formed (say, the <span class="math notranslate nohighlight">\(A \rightleftarrows B\)</span> reaction):</p>
<img src="https://variationalmethod.net/images/parabola.png" width=300><p><span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span> are stable compounds, described by energy wells. In the simplest form, these are given by parabolas (blue for <span class="math notranslate nohighlight">\(A\)</span> and red for <span class="math notranslate nohighlight">\(B\)</span>). The reaction will follow the lowest energy path (black). The transition state (<span class="math notranslate nohighlight">\(\ddagger\)</span>) is where the two parabolas cross; this is the highest energy intermediate in the reaction. Our description is not only simplistic; it also misses temperature effects.</p>
<p><font color="DarkGreen"><a name='6f'><strong>Exercises</strong></a>. Let’s model a proton transfer reaction. <a href=#calculate>Above</a>, select “6. Intersecting parabola” for section. Set <span class="math notranslate nohighlight">\(L=2\)</span>, <span class="math notranslate nohighlight">\(N=20\)</span>. Set <span class="math notranslate nohighlight">\(h_2=0.15\)</span>, <span class="math notranslate nohighlight">\(k_1=16\)</span>, <span class="math notranslate nohighlight">\(k_2=16\)</span>, <span class="math notranslate nohighlight">\(x_1=0.5\)</span>, and <span class="math notranslate nohighlight">\(x_2=1.5\)</span>. Set mass to “Proton”; deselect “Show excited states”. Output will now include the position of the crossing point (<em>i.e.</em> the position of <span class="math notranslate nohighlight">\(\ddagger\)</span>) and its energy, and the probability between <span class="math notranslate nohighlight">\(x=0\)</span> and the crossing point (<span class="math notranslate nohighlight">\(P_A\)</span>). <span class="math notranslate nohighlight">\(P_A\)</span> corresponds to the probability to be in the <span class="math notranslate nohighlight">\(A\)</span> well: the probability to be compound <span class="math notranslate nohighlight">\(A\)</span>. <span class="math notranslate nohighlight">\(P_B = 1-P_A\)</span>: this is the probability to be in the <span class="math notranslate nohighlight">\(B\)</span> well, or the probability to be compound <span class="math notranslate nohighlight">\(B\)</span>.</p>
<p><strong>Exercise 6f</strong>. Compare the energy and probability distribution of the “Sin” basis to that of the “Legendre-like” basis. Why is the “Legendre-like” basis so bad?</font></p>
<p><font color="DarkGreen"><strong>Exercise 6g</strong>. Use the “Sin” basis and <span class="math notranslate nohighlight">\(N=50\)</span> <a href=#calculate>above</a>, with all other settings as in 6f. Is <span class="math notranslate nohighlight">\(A\)</span> or <span class="math notranslate nohighlight">\(B\)</span> favored? Does this make sense?</font></p>
<p>As exercise 6g showed, the difference in basin energy is a determining factor if <span class="math notranslate nohighlight">\(A\)</span> or <span class="math notranslate nohighlight">\(B\)</span> is favored (more probable). Another important factor is the <em>curvature</em> of the basins. The final exercise shows an extreme case:</p>
<p><font color="DarkGreen"><strong>Exercise 6h</strong>. Set <span class="math notranslate nohighlight">\(k_1=17.067\)</span> and <span class="math notranslate nohighlight">\(k_2=0.46\)</span>, while keeping all other settings the same as in 6g. The total energy is identical to that in exercise 6g, but what compound is now favored <a href=#calculate>above</a>? Does this make sense?</font></p>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "conda-base-py"
        },
        kernelOptions: {
            name: "conda-base-py",
            path: "./17MCM_QM_ipynb"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'conda-base-py'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="simple visible nav section-nav flex-column">
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jonny, assisted by Tom
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>