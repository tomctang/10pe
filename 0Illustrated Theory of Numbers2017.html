
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Part 1. Computing with Python 3.x &#8212; Jonny Workbook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=3dee1f50" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '0Illustrated Theory of Numbers2017';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
  
    <p class="title logo__title">Jonny Workbook</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Mathe &amp; FP/Language</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Alevel/Alevel_math.html">1. A-level-math</a></li>
<li class="toctree-l1"><a class="reference internal" href="Alevel/Alevel_math_further.html">2. A-level-further</a></li>
<li class="toctree-l1"><a class="reference internal" href="Course_MCM.html">3. Math Computational Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="Course_Lean.html">4. Lean</a></li>
<li class="toctree-l1"><a class="reference internal" href="math/00intro_math.html">5. Math-FP-Lang Combo</a></li>
<li class="toctree-l1"><a class="reference internal" href="math/01number_algebra.html">6. Number &amp; Algebra</a></li>
<li class="toctree-l1"><a class="reference internal" href="math/02discrete_continuous.html">7. Discrete &amp; Continuous</a></li>
<li class="toctree-l1"><a class="reference internal" href="math/03real_world.html">8. Real World Math</a></li>
<li class="toctree-l1"><a class="reference internal" href="math/05math_as_code.html">9. Math as code</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">CS &amp; Physics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Course_MIT6001Python.html">10. MIT_CS6001-Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="Course_MIT6002thinking.html">11. MIT_CS6002-CS</a></li>
<li class="toctree-l1"><a class="reference internal" href="PE_Informatics/PE_tags.html">12. Project Euler Tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="PE_Informatics/PE100.html">13. Project Euler Q1-100</a></li>
<li class="toctree-l1"><a class="reference internal" href="PE_Informatics/PE200.html">14. Project Euler Q101-</a></li>
<li class="toctree-l1"><a class="reference internal" href="Course_MCM_QM.html">15. Quantum Mechanics</a></li>
<li class="toctree-l1"><a class="reference internal" href="How_Dad_organise_QM.html">16. How Dad learn QM</a></li>
<li class="toctree-l1"><a class="reference internal" href="Course_MCM_QFT.html">17. QFT</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Notebook</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="nb_past_courses.html">18. Past courses</a></li>
<li class="toctree-l1"><a class="reference internal" href="geo/nb_Geo.html">19. Geography and Maps</a></li>
<li class="toctree-l1"><a class="reference internal" href="nb_lottery_simulator.html">20. Lottery Math</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/tomctang/10pe" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/0Illustrated Theory of Numbers2017.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Part 1.  Computing with Python 3.x</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Part 1.  Computing with Python 3.x</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#python-as-a-calculator">Python as a calculator</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-with-booleans">Calculating with booleans</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#declaring-variables">Declaring variables</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lists-and-ranges">Lists and ranges</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#iterating-over-a-range">Iterating over a range</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Exercises</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#part-2-functions-in-python-3-x">Part 2:  Functions in Python 3.x</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-started-with-python-functions">Getting started with Python functions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#control-statements">Control statements</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#while-loops-and-implementation-of-the-eucidean-algorithm">While loops and implementation of the Eucidean algorithm</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-euclidean-algorithm-with-a-while-loop">The Euclidean algorithm with a while loop</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solving-the-linear-diophantine-equation">Solving the linear Diophantine equation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Exercises</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#part-3-lists-and-the-sieve-of-eratosthenes-in-python-3-x">Part 3:  Lists and the sieve of Eratosthenes in Python 3.x</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#primality-testing">Primality testing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#list-manipulation">List manipulation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#list-terms-and-indices">List terms and indices</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#list-slicing">List slicing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#changing-list-slices">Changing list slices</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sieve-of-eratosthenes">Sieve of Eratosthenes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-basic-sieve">The basic sieve</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-analysis">Data analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analyzing-the-list-of-primes">Analyzing the list of primes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-of-the-prime-counting-function">Analysis of the prime counting function</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prime-gaps">Prime gaps</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">Exercises</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#part-4-dictionaries-factorization-and-multiplicative-functions-in-python-3-x">Part 4:  Dictionaries, factorization, and multiplicative functions in Python 3.x</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dictionaries-and-factorization">Dictionaries and factorization</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lists-dictionaries-objects-and-methods">Lists, dictionaries, objects and methods</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-interlude-on-python-objects">An interlude on Python objects</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prime-decomposition-dictionaries">Prime decomposition dictionaries</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiplicative-functions">Multiplicative functions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">Exercises</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#part-5-modular-arithmetic-and-primality-testing-with-python-3-x">Part 5:  Modular arithmetic and primality testing with Python 3.x</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculations-in-modular-arithmetic">Calculations in modular arithmetic</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-mod-operator">The mod (%) operator</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#performance-analysis">Performance analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-miller-rabin-primality-test">The Miller-Rabin primality test</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fermat-s-little-theorem-and-the-roo-property-of-primes">Fermat’s Little Theorem and the ROO property of primes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pingala-s-exponentiation-algorithm">Pingala’s exponentiation algorithm</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-miller-rabin-test">The Miller-Rabin test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id20">Exercises</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#part-6-ciphers-and-key-exchange-in-python-3-x">Part 6:  Ciphers and Key exchange in Python 3.x</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ciphers">Ciphers</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ascii-code-and-the-caesar-cipher">ASCII code and the Caesar cipher</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-vigenere-cipher">The Vigenère cipher</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id22">Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#key-exchange">Key exchange</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#primitive-roots-and-sophie-germain-primes">Primitive roots and Sophie Germain primes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-diffie-hellman-protocol">The Diffie-Hellman protocol</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#alice-and-bob-s-private-secrets">Alice and Bob’s private secrets</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id23">Exercises</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#part-7-the-rsa-cryptosystem-in-python-3-x">Part 7:  The RSA Cryptosystem in Python 3.x</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id24">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#euler-s-theorem-and-modular-roots">Euler’s Theorem and Modular Roots</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#euler-s-theorem-and-the-totient">Euler’s theorem and the totient</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modular-roots">Modular roots</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id25">Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-rsa-protocol">The RSA protocol</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#encryption-and-decryption">Encryption and decryption</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#digital-signatures">Digital signatures</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id26">Exercises</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p>This is notebooks from <a class="reference external" href="http://illustratedtheoryofnumbers.com/">http://illustratedtheoryofnumbers.com/</a></p>
<section class="tex2jax_ignore mathjax_ignore" id="part-1-computing-with-python-3-x">
<h1>Part 1.  Computing with Python 3.x<a class="headerlink" href="#part-1-computing-with-python-3-x" title="Link to this heading">#</a></h1>
<p>What is the difference between <em>Python</em> and a calculator?  We begin this first lesson by showing how Python can be used <strong>as</strong> a calculator, and we move into some of the basic programming language constructs:  data types, variables, lists, and loops.</p>
<p>This programming lesson complements Chapter 0 (Foundations) in <a class="reference external" href="http://bookstore.ams.org/mbk-105/">An Illustrated Theory of Numbers</a>.</p>
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#calculator"><span class="xref myst">Python as a calculator</span></a></p></li>
<li><p><a class="reference internal" href="#booleans"><span class="xref myst">Calculating with booleans</span></a></p></li>
<li><p><a class="reference internal" href="#variables"><span class="xref myst">Declaring variables</span></a></p></li>
<li><p><a class="reference internal" href="#ranges"><span class="xref myst">Lists and Ranges</span></a></p></li>
<li><p><a class="reference internal" href="#iterating"><span class="xref myst">Iterating over a range</span></a></p></li>
</ul>
<p><a id='calculator'></a></p>
</section>
<section id="python-as-a-calculator">
<h2>Python as a calculator<a class="headerlink" href="#python-as-a-calculator" title="Link to this heading">#</a></h2>
<p>Different kinds of data are stored as different <em>types</em> in Python.  For example, if you wish to work with integers, your data is typically stored as an <em>int</em>.  A real number might be stored as a <em>float</em>.  There are types for booleans (True/False data), strings (like “Hello World!”), and many more we will see.</p>
<p>A more complete reference for Python’s numerical types and arithmetic operations can be found in the <a class="reference external" href="https://docs.python.org/2/library/stdtypes.html#numeric-types-int-float-long-complex">official Python documentation</a>.  The <a class="reference external" href="https://docs.python.org/2/tutorial/introduction.html">official Python tutorial</a> is also a great place to start.</p>
<p>Python allows you to perform arithmetic operations:  addition, subtraction, multiplication, and division, on numerical types.  The operation symbols are <code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">-</span></code>, <code class="docutils literal notranslate"><span class="pre">*</span></code>, and <code class="docutils literal notranslate"><span class="pre">/</span></code>.   Evaluate each of the following cells to see how Python performs operations on <em>integers</em>.  To evaluate the cell, click anywhere within the cell to select it (a selected cell will probably have a thick <span style="color:green">green</span> line on its left side) and use the keyboard shortcut <em>Shift-Enter</em> to evaluate.  As you go through this and later lessons, try to <em>predict</em> what will happen when you evaluate the cell before you hit Shift-Enter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">2</span> <span class="o">+</span> <span class="mi">3</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">2</span> <span class="o">*</span> <span class="mi">3</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">5</span> <span class="o">-</span> <span class="mi">11</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mf">5.0</span> <span class="o">-</span> <span class="mi">11</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">5</span> <span class="o">/</span> <span class="mi">11</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">6</span> <span class="o">/</span> <span class="mi">3</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">5</span> <span class="o">//</span> <span class="mi">11</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">6</span> <span class="o">//</span> <span class="mi">3</span>
</pre></div>
</div>
</div>
</div>
<p>The results are probably not too surprising, though the last two require a bit of explanation.  Python <em>interprets</em> the input number 5 as an <em>int</em> (integer) and 5.0 as a <em>float</em>.  “Float” stands for “floating point number,” which are decimal approximations to real numbers.  The word “float” refers to the fact that the decimal (or binary, for computers) point can float around (as in 1.2345 or 12.345 or 123.45 or 1234.5 or 0.00012345).  There are deep computational issues related to how computers handle decimal approximations, and you can <a class="reference external" href="https://en.wikipedia.org/wiki/IEEE_754">read about the IEEE standards</a> if you’re interested.</p>
<p>Python enables different kinds of division.  The single-slash division in Python 3.x gives a floating point approximation of the quotient.  That’s why <code class="docutils literal notranslate"><span class="pre">5</span> <span class="pre">/</span> <span class="pre">11</span></code> and <code class="docutils literal notranslate"><span class="pre">6</span> <span class="pre">/</span> <span class="pre">3</span></code> both output floats.  On the other hand, <code class="docutils literal notranslate"><span class="pre">5</span> <span class="pre">//</span> <span class="pre">11</span></code> and <code class="docutils literal notranslate"><span class="pre">6</span> <span class="pre">//</span> <span class="pre">3</span></code> yield integer outputs (rounding down) – this is useful, but one has to be careful!</p>
<p>In fact the designers of Python changed their mind.  <strong>This tutorial assumes that you are using Python 3.x.</strong>  If you are using Python 2.x, the command <code class="docutils literal notranslate"><span class="pre">5</span> <span class="pre">/</span> <span class="pre">11</span></code> would output zero.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="mi">12</span> <span class="o">//</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
</div>
<p>Why use integer division <code class="docutils literal notranslate"><span class="pre">//</span></code> and why use floating point division?  In practice, integer division is typically a faster operation.  So if you only need the rounded result (and that will often be the case), use integer division.  It will run much faster than carrying out floating point division then manually rounding down.</p>
<p>Observe that floating point operations involve approximation.  The result of <code class="docutils literal notranslate"><span class="pre">5.0/11.0</span></code> might not be what you expect in the last digit.  Over time, especially with repeated operations, <em>floating point approximation</em> errors can add up!</p>
<p>Python allows you to group expressions with parentheses, and follows the order of operations that you learn in school.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">3</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">3</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">5</span>   <span class="c1">#  What do you think will be the result?  Remember PEMDAS?</span>
</pre></div>
</div>
</div>
</div>
<p>Now is a good time to try a few computations of your own, in the empty cell below.  You can type any Python commands you want in the empty cell.  If you want to insert a new cell into this notebook, it takes two steps:</p>
<ol class="arabic simple">
<li><p>Click to the left of any existing cell.  This should make a <span style="color:blue">blue</span> bar appear to the left of the cell.</p></li>
<li><p>Use the keyboard shortcut <strong>a</strong> to insert a new cell <strong>above</strong> the blue-selected cell or <strong>b</strong> to insert a new cell <strong>below</strong> the blue-selected cell.
You can also use the keyboard shortcut <strong>x</strong> do delete a blue-selected cell… be careful!</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  An empty cell.  Have fun!</span>
</pre></div>
</div>
</div>
</div>
<p>For number theory, <em>division with remainder</em> is an operation of central importance.  Integer division provides the quotient, and the operation <code class="docutils literal notranslate"><span class="pre">%</span></code> provides the remainder.  It’s a bit strange that the percent symbol is used for the remainder, but this <a class="reference external" href="https://softwareengineering.stackexchange.com/questions/294297/in-what-programming-language-did-the-use-of-the-percent-sign-to-mean-modulo">dates at least to the early 1970s</a> and has become standard across computer languages.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">23</span> <span class="o">//</span> <span class="mi">5</span>  <span class="c1"># Integer division</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">23</span> <span class="o">%</span> <span class="mi">5</span>  <span class="c1"># The remainder after division</span>
</pre></div>
</div>
</div>
</div>
<p>Note in the code above, there are little “comments”.  To place a short comment on a line of code, just put a hashtag <code class="docutils literal notranslate"><span class="pre">#</span></code> at the end of the line of code, followed by your comment.</p>
<p>Python gives a single command for division with remainder.  Its output is a <em>tuple</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">divmod</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="nb">divmod</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>All data in Python has a type, but a common complaint about Python is that types are a bit concealed “under the hood”.  But they are not far under the hood.  Anyone can find out the type of some data with a single command.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="s1">&#39;Hello&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>The key to careful computation in Python is always being <em>aware of the type</em> of your data, and <em>knowing</em> how Python operates differently on data of different types.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">3</span> <span class="o">+</span> <span class="mi">3</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mf">3.0</span> <span class="o">+</span> <span class="mf">3.0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;Hello&#39;</span> <span class="o">+</span> <span class="s1">&#39;World!&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">3</span> <span class="o">+</span> <span class="mf">3.0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">3</span> <span class="o">+</span> <span class="s1">&#39;Hello!&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  An empty cell.  Have fun!</span>
</pre></div>
</div>
</div>
</div>
<p>As you can see, addition (the <code class="docutils literal notranslate"><span class="pre">+</span></code> operator) is interpreted differently in the contexts of numbers, strings, and lists.  The designers of Python allowed us to add <em>numbers</em> of different types:  if you try to operate on an <em>int</em> and a <em>float</em>, the <em>int</em> will typically be <em>coerced</em> into a float in order to perform the operation.  But the designers of Python did not give meaning to the addition of a number with a string, for example.  That’s why you probably received a <em>TypeError</em> after trying the above line.</p>
<p>On the other hand, Python does interpret <em>multiplication</em> of a natural number with a string or a list.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">3</span> <span class="o">*</span> <span class="s1">&#39;Hello!&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">0</span> <span class="o">*</span> <span class="s1">&#39;Hello!&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">2</span> <span class="o">*</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Can you create a string with 100 A’s (like <code class="docutils literal notranslate"><span class="pre">AAA...</span></code>)?  Use an appropriate operation in the cell below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  Practice cell</span>
</pre></div>
</div>
</div>
</div>
<p>Exponents in Python are given by the <code class="docutils literal notranslate"><span class="pre">**</span></code> operator.  The following lines compute 2 to the 1000th power, in two different ways.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">2</span><span class="o">**</span><span class="mi">1000</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mf">2.0</span><span class="o">**</span><span class="mi">1000</span>
</pre></div>
</div>
</div>
</div>
<p>As before, Python interprets an operation (<code class="docutils literal notranslate"><span class="pre">**</span></code>) differently in different contexts.  When given integer input, Python evaluates <code class="docutils literal notranslate"><span class="pre">2**1000</span></code> <strong>exactly</strong>.  The result is a large integer.  A nice fact about Python, for number theorists, is that it handles exact integers of arbitrary length!  Many other programming languages (like C++) will give an error message if integers get too large in the midst of a computation.</p>
<p>New in version 3.x, Python implements long integers without giving signals to the programmer or changing types.  In Python 2.x, there were two types: <em>int</em> for somewhat small integers (e.g., up to <span class="math notranslate nohighlight">\(2^{31}\)</span>) and <em>long</em> type for all larger integers.  Python 2.x would signal which type of integer was being used, by placing the letter “L” at the end of a long integer.  Now, in Python 3.x, the programmer doesn’t really see the difference.  There is only the <em>int</em> type.  But Python still optimizes computations, using hardware functionality for arithmetic of small integers and custom routines for large integers.  The programmer doesn’t have to worry about it most of the time.</p>
<p>For scientific applications, one often wants to keep track of only a certain number of significant digits.  If one computes the floating point exponent <code class="docutils literal notranslate"><span class="pre">2.0**1000</span></code>, the result is a decimal approximation.  It is still a float.  The expression “e+301” stands for “multiplied by 10 to the 301st power”, i.e., Python uses <em>scientific notation</em> for large floats.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="mf">2.0</span><span class="o">**</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  An empty cell.  Have fun!</span>
</pre></div>
</div>
</div>
</div>
<p>Now is a good time for reflection.  Double-click in the cell below to answer the given questions.  Cells like this one are used for text rather than Python code.  Text is entered using <em>markdown</em>, but you can typically just enter text as you would in any text editor without problems.  Press <em>shift-Enter</em> after editing a markdown cell to complete the editing process.</p>
<p>Note that a dropdown menu in the toolbar above the notebook allows you to choose whether a cell is Markdown or Code (or a few other things), if you want to add or remove markdown/code cells.</p>
<section id="exercises">
<h3>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>What data types have you seen, and what kinds of data are they used for?  Can you remember them without looking back?</p></li>
<li><p>How is division <code class="docutils literal notranslate"><span class="pre">/</span></code> interpreted differently for different types of data?</p></li>
<li><p>How is multiplication <code class="docutils literal notranslate"><span class="pre">*</span></code> interpreted differently for different types of data?</p></li>
<li><p>What is the difference between 100 and 100.0, for Python?</p></li>
</ol>
<p>Double-click this markdown cell to edit it, and answer the exercises.</p>
<p><a id='booleans'></a></p>
</section>
</section>
<section id="calculating-with-booleans">
<h2>Calculating with booleans<a class="headerlink" href="#calculating-with-booleans" title="Link to this heading">#</a></h2>
<p>A <em>boolean</em> (type <em>bool</em>) is the smallest possible piece of data.  While an <em>int</em> can be any integer, positive or negative, a <em>boolean</em> can only be one of two things:  <em>True</em> or <em>False</em>.  In this way, booleans are useful for storing the answers to yes/no questions.</p>
<p>Questions about (in)equality of numbers are answered in Python by <em>operations</em> with numerical input and boolean output.  Here are some examples.  A more complete reference is <a class="reference external" href="https://docs.python.org/2/library/stdtypes.html#boolean-operations-and-or-not">in the official Python documentation</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">3</span> <span class="o">&gt;</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="mi">3</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">10</span> <span class="o">&lt;</span> <span class="mi">3</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mf">2.4</span> <span class="o">&lt;</span> <span class="mf">2.4000001</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">32</span> <span class="o">&gt;=</span> <span class="mi">32</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">32</span> <span class="o">&gt;=</span> <span class="mi">31</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">4</span>
</pre></div>
</div>
</div>
</div>
<p>Which number is bigger:  <span class="math notranslate nohighlight">\(23^{32}\)</span> or <span class="math notranslate nohighlight">\(32^{23}\)</span>?  Use the cell below to answer the question!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  Write your code here.</span>
</pre></div>
</div>
</div>
</div>
<p>The expressions <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code> are interpreted here as <strong>operations</strong> with numerical input and boolean output.  The symbol <code class="docutils literal notranslate"><span class="pre">==</span></code> (two equal symbols!) gives a True result if the numbers are equal, and False if the numbers are not equal.  An extremely common typo is to confuse <code class="docutils literal notranslate"><span class="pre">=</span></code> with <code class="docutils literal notranslate"><span class="pre">==</span></code>.  But the single equality symbol <code class="docutils literal notranslate"><span class="pre">=</span></code> has an entirely different meaning, as we shall see.</p>
<p>Using the remainder operator <code class="docutils literal notranslate"><span class="pre">%</span></code> and equality, we obtain a divisibility test.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">63</span> <span class="o">%</span> <span class="mi">7</span> <span class="o">==</span> <span class="mi">0</span>  <span class="c1"># Is 63 divisible by 7?</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">101</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span>  <span class="c1"># Is 101 even?</span>
</pre></div>
</div>
</div>
</div>
<p>Use the cell below to determine whether 1234567890 is divisible by 3.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your code goes here.</span>
</pre></div>
</div>
</div>
</div>
<p>Booleans can be operated on by the standard logical operations and, or, not.  In ordinary English usage, “and” and “or” are conjunctions, while here in <em>Boolean algebra</em>, “and” and “or” are operations with Boolean inputs and Boolean output.  The precise meanings of “and” and “or” are given by the following <strong>truth tables</strong>.</p>
<p>| and || True | False |
|—–||——|——-|
|||||
| <strong>True</strong> || True | False |
| <strong>False</strong> || False | False|</p>
<p>| or || True | False |
|—–||——|——-|
|||||
| <strong>True</strong> || True | True |
| <strong>False</strong> || True | False|</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kc">True</span> <span class="ow">and</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kc">True</span> <span class="ow">or</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kc">True</span> <span class="ow">or</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="ow">not</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
<p>Use the truth tables to predict the result (True or False) of each of the following, before evaluating the code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="mi">3</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="ow">not</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">4</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">4</span>  <span class="c1"># For &quot;not equal&quot;, Python uses the operation `!=`.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">5</span>  <span class="c1"># Is 2+2 *not* equal to 5?</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="ow">not</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># The same as above, but a bit longer to write.</span>
</pre></div>
</div>
</div>
</div>
<p>Experiment below to see how Python handles a double or triple negative, i.e., something with a <code class="docutils literal notranslate"><span class="pre">not</span></code> <code class="docutils literal notranslate"><span class="pre">not</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Experiment here.</span>
</pre></div>
</div>
</div>
</div>
<p>Python does give an interpretation to arithmetic operations with booleans and numbers.  Try to guess this interpretation with the following examples.  Change the examples to experiment!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kc">False</span> <span class="o">*</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kc">True</span> <span class="o">+</span> <span class="mi">13</span>
</pre></div>
</div>
</div>
</div>
<p>This ability of Python to interpret operations based on context is a mixed blessing.  On one hand, it leads to handy shortcuts – quick ways of writing complicated programs.  On the other hand, it can lead to code that is harder to read, especially for a Python novice.  Good programmers aim for code that is easy to read, not just short!</p>
<p>The <a class="reference external" href="https://www.python.org/dev/peps/pep-0020/">Zen of Python</a> is a series of 20 aphorisms for Python programmers.  The first seven are below.</p>
<blockquote>
<div><p>Beautiful is better than ugly.</p>
</div></blockquote>
<blockquote>
<div><p>Explicit is better than implicit.</p>
</div></blockquote>
<blockquote>
<div><p>Simple is better than complex.</p>
</div></blockquote>
<blockquote>
<div><p>Complex is better than complicated.</p>
</div></blockquote>
<blockquote>
<div><p>Flat is better than nested.</p>
</div></blockquote>
<blockquote>
<div><p>Sparse is better than dense.</p>
</div></blockquote>
<blockquote>
<div><p>Readability counts.</p>
</div></blockquote>
<section id="id1">
<h3>Exercises<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Did you look at the truth tables closely?  Can you remember, from memory, what <code class="docutils literal notranslate"><span class="pre">True</span> <span class="pre">or</span> <span class="pre">False</span></code> equals, or what <code class="docutils literal notranslate"><span class="pre">True</span> <span class="pre">and</span> <span class="pre">False</span></code> equals?</p></li>
<li><p>How might you easily remember the truth tables?  How do they resemble the standard English usage of the words “and” and “or”?</p></li>
<li><p>If you wanted to know whether a number, like 2349872348723, is a multiple of 7 but <strong>not</strong> a multiple of 11, how might you write this in one line of Python code?</p></li>
<li><p>You can chain together <code class="docutils literal notranslate"><span class="pre">and</span></code> commands, e.g., with an expression like <code class="docutils literal notranslate"><span class="pre">True</span> <span class="pre">and</span> <span class="pre">True</span> <span class="pre">and</span> <span class="pre">True</span></code> (which would evaluate to <code class="docutils literal notranslate"><span class="pre">True</span></code>).  You can also group booleans, e.g., with <code class="docutils literal notranslate"><span class="pre">True</span> <span class="pre">and</span> <span class="pre">(True</span> <span class="pre">or</span> <span class="pre">False)</span></code>.  Experiment to figure out the order of operations (<code class="docutils literal notranslate"><span class="pre">and</span></code>, <code class="docutils literal notranslate"><span class="pre">or</span></code>, <code class="docutils literal notranslate"><span class="pre">not</span></code>) for booleans.</p></li>
<li><p>The operation <code class="docutils literal notranslate"><span class="pre">xor</span></code> means “exclusive or”.  Its truth table is: <code class="docutils literal notranslate"><span class="pre">True</span> <span class="pre">xor</span> <span class="pre">True</span> <span class="pre">=</span> <span class="pre">False</span></code> and <code class="docutils literal notranslate"><span class="pre">False</span> <span class="pre">xor</span> <span class="pre">False</span> <span class="pre">=</span> <span class="pre">False</span></code> and <code class="docutils literal notranslate"><span class="pre">True</span> <span class="pre">xor</span> <span class="pre">False</span> <span class="pre">=</span> <span class="pre">True</span></code> and <code class="docutils literal notranslate"><span class="pre">False</span> <span class="pre">xor</span> <span class="pre">True</span> <span class="pre">=</span> <span class="pre">True</span></code>.  How might you implement <code class="docutils literal notranslate"><span class="pre">xor</span></code> in terms of the usual <code class="docutils literal notranslate"><span class="pre">and</span></code>, <code class="docutils literal notranslate"><span class="pre">or</span></code>, and <code class="docutils literal notranslate"><span class="pre">not</span></code>?</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  Use this space to work on the exercises</span>
</pre></div>
</div>
</div>
</div>
<p><a id='variables'></a></p>
</section>
</section>
<section id="declaring-variables">
<h2>Declaring variables<a class="headerlink" href="#declaring-variables" title="Link to this heading">#</a></h2>
<p>A central feature of programming is the declaration of variables.  When you declare a variable, you are <em>storing</em> data in the computer’s <em>memory</em> and you are assigning a <em>name</em> to that data.  Both storage and name-assignment are carried out with the <em>single</em> equality symbol =.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="mf">2.71828</span>
</pre></div>
</div>
</div>
</div>
<p>With this command, the float 2.71828 is stored somewhere inside your computer, and Python can access this stored number by the name “e” thereafter.  So if you want to compute “e squared”, a single command will do.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">*</span> <span class="n">e</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>You can use just about any name you want for a variable, but your name <em>must</em> start with a letter, <em>must</em> not contain spaces, and your name <em>must</em> not be an existing Python word.  Characters in a variable name can include letters (uppercase and lowercase) and numbers and underscores <code class="docutils literal notranslate"><span class="pre">_</span></code>.</p>
<p>So <code class="docutils literal notranslate"><span class="pre">e</span></code> is a valid name for a variable, but <code class="docutils literal notranslate"><span class="pre">type</span></code> is a bad name.  It is very tempting for beginners to use very short abbreviation-style names for variables (like <code class="docutils literal notranslate"><span class="pre">dx</span></code> or <code class="docutils literal notranslate"><span class="pre">vbn</span></code>).  But resist that temptation and use more descriptive names for variables, like <code class="docutils literal notranslate"><span class="pre">difference_x</span></code> or <code class="docutils literal notranslate"><span class="pre">very_big_number</span></code>.  This will make your code readable by you and others!</p>
<p>There are different style conventions for variable names.  We use lowercase names, with underscores separating words,  roughly following <a class="reference external" href="https://google.github.io/styleguide/pyguide.html#Python_Style_Rules">Google’s style conventions</a> for Python code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_number</span> <span class="o">=</span> <span class="mi">17</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_number</span> <span class="o">&lt;</span> <span class="mi">23</span>
</pre></div>
</div>
</div>
</div>
<p>After you declare a variable, its value remains the same until it is changed.  You can change the value of a variable with a simple assignment.  After the above lines, the value of my_number is 17.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_number</span> <span class="o">=</span> <span class="mf">3.14</span>
</pre></div>
</div>
</div>
</div>
<p>This command reassigns the value of my_number to 3.14.  Note that it changes the type too!  It effectively overrides the previous value and replaces it with the new value.</p>
<p>Often it is useful to change the value of a variable <em>incrementally</em> or <em>recursively</em>.  Python, like many programming languages, allows one to assign variables in a self-referential way.  What do you think the value of S will be after the following four lines?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">S</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">S</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">S</span> <span class="o">+</span> <span class="mi">2</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">S</span> <span class="o">+</span> <span class="mi">3</span>
<span class="nb">print</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The first line <code class="docutils literal notranslate"><span class="pre">S</span> <span class="pre">=</span> <span class="pre">0</span></code> is the initial declaration:  the value 0 is stored in memory, and the name S is assigned to this value.</p>
<p>The next line <code class="docutils literal notranslate"><span class="pre">S</span> <span class="pre">=</span> <span class="pre">S</span> <span class="pre">+</span> <span class="pre">1</span></code> looks like nonsense, as an algebraic sentence.  But reading = as <strong>assignment</strong> rather than <strong>equality</strong>, you should read the line <code class="docutils literal notranslate"><span class="pre">S</span> <span class="pre">=</span> <span class="pre">S</span> <span class="pre">+</span> <span class="pre">1</span></code> as assigning the <em>value</em> <code class="docutils literal notranslate"><span class="pre">S</span> <span class="pre">+</span> <span class="pre">1</span></code> to the <em>name</em> <code class="docutils literal notranslate"><span class="pre">S</span></code>.  When Python interprets <code class="docutils literal notranslate"><span class="pre">S</span> <span class="pre">=</span> <span class="pre">S</span> <span class="pre">+</span> <span class="pre">1</span></code>, it carries out the following steps.</p>
<ol class="arabic simple">
<li><p>Compute the value of the right side, <code class="docutils literal notranslate"><span class="pre">S+1</span></code>.  (The value is 1, since <code class="docutils literal notranslate"><span class="pre">S</span></code> was assigned the value 0 in the previous line.)</p></li>
<li><p>Assign this value to the left side, <code class="docutils literal notranslate"><span class="pre">S</span></code>.  (Now <code class="docutils literal notranslate"><span class="pre">S</span></code> has the value 1.)</p></li>
</ol>
<p>Well, this is a slight lie.  Python probably does something more efficient, when given the command <code class="docutils literal notranslate"><span class="pre">S</span> <span class="pre">=</span> <span class="pre">S</span> <span class="pre">+</span> <span class="pre">1</span></code>, since such operations are hard-wired in the computer and the Python interpreter is smart enough to take the most efficient route.  But at this level, it is most useful to think of a self-referential assignment of the form <code class="docutils literal notranslate"><span class="pre">X</span> <span class="pre">=</span> <span class="pre">expression(X)</span></code> as a two step process as above.</p>
<ol class="arabic simple">
<li><p>Compute the value of <code class="docutils literal notranslate"><span class="pre">expression(X)</span></code>.</p></li>
<li><p>Assign this value to <code class="docutils literal notranslate"><span class="pre">X</span></code>.</p></li>
</ol>
<p>Now consider the following three commands.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_number</span> <span class="o">=</span> <span class="mi">17</span>
<span class="n">new_number</span> <span class="o">=</span> <span class="n">my_number</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">my_number</span> <span class="o">=</span> <span class="mf">3.14</span>
</pre></div>
</div>
</div>
</div>
<p>What are the values of the variables my_number and new_number, after the execution of these three lines?</p>
<p>To access these values, you can use the <em>print</em> function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">my_number</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">new_number</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Python is an <em>interpreted</em> language, which means (roughly) that Python carries out commands line-by-line from top to bottom.  So consider the three lines</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">my_number</span> <span class="o">=</span> <span class="mi">17</span>
<span class="n">new_number</span> <span class="o">=</span> <span class="n">my_number</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">my_number</span> <span class="o">=</span> <span class="mf">3.14</span>
</pre></div>
</div>
<p>Line 1 sets the value of my_number to 17.  Line 2 sets the value of new_number to 18.  Line 3 sets the value of my_number to 3.14.  But Line 3 does <em>not</em> change the value of new_number at all.</p>
<p>(This will become confusing and complicated later, as we study mutable and immutable types.)</p>
<section id="id2">
<h3>Exercises<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>What is the difference between <code class="docutils literal notranslate"><span class="pre">=</span></code> and <code class="docutils literal notranslate"><span class="pre">==</span></code> in the Python language?</p></li>
<li><p>If the variable <code class="docutils literal notranslate"><span class="pre">x</span></code> has value <code class="docutils literal notranslate"><span class="pre">3</span></code>, and you then evaluate the Python command <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">x</span> <span class="pre">*</span> <span class="pre">x</span></code>, what will be the value of <code class="docutils literal notranslate"><span class="pre">x</span></code> after evaluation?</p></li>
<li><p>Imagine you have two variables <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code>, and you want to switch their values.  How could you do this in Python?</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  Use this space to work on the exercises.</span>
</pre></div>
</div>
</div>
</div>
<p><a id='ranges'></a></p>
</section>
</section>
<section id="lists-and-ranges">
<h2>Lists and ranges<a class="headerlink" href="#lists-and-ranges" title="Link to this heading">#</a></h2>
<p>Python stands out for the central role played by <em>lists</em>.  A <em>list</em> is what it sounds like – a list of data.  Data within a list can be of any type.  Multiple types are possible within the same list!  The basic syntax for a list is to use brackets to enclose the list items and commas to separate the list items.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">([</span><span class="s1">&#39;Hello&#39;</span><span class="p">,</span><span class="mi">17</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>There is another type called a <em>tuple</em> that we will rarely use.  Tuples use parentheses for enclosure instead of brackets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>There’s another list-like type in Python 3, called the <code class="docutils literal notranslate"><span class="pre">range</span></code> type.  Ranges are kind of like lists, but instead of plunking every item into a slot of memory, ranges just have to remember three integers:  their <em>start</em>, their <em>stop</em>, and their <em>step</em>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">range</span></code> command creates a range with a given start, stop, and step.  If you only input one number, the range will <em><strong>start at zero</strong></em> and use <em><strong>steps of one</strong></em> and will stop <em><strong>just before</strong></em> the given stop-number.</p>
<p>One can create a list from a range (plunking every term in the range into a slot of memory), by using the <code class="docutils literal notranslate"><span class="pre">list</span></code> command.  Here are a few examples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span> <span class="c1"># Ranges are their own type, in Python 3.x.  Not in Python 2.x!</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span> <span class="c1"># Let&#39;s see what&#39;s in the range.  Note it starts at zero!  Where does it stop?</span>
</pre></div>
</div>
</div>
</div>
<p>A more complicated two-input form of the range command produces a range of integers <strong>starting at</strong> a given number, and <strong>terminating before</strong> another given number.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>This is a common source of difficulty for Python beginners.  While the first parameter (-4) is the starting point of the list, the list ends just before the second parameter (5).  This takes some getting used to, but experienced Python programmers grow to like this convention.</p>
<p>The <em>length</em> of a list can be accessed by the len command.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>  <span class="c1"># The len command can deal with lists and ranges.  No need to convert.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span> <span class="c1"># Can you figure out the length, before evaluating?</span>
</pre></div>
</div>
</div>
</div>
<p>The final variant of the range command (for now) is the <em>three-parameter</em> command of the form <code class="docutils literal notranslate"><span class="pre">range(a,b,s)</span></code>.  This produces a list like <code class="docutils literal notranslate"><span class="pre">range(a,b)</span></code>, but with a “step size” of <code class="docutils literal notranslate"><span class="pre">s</span></code>.  In other words, it produces a list of integers, beginning at <code class="docutils literal notranslate"><span class="pre">a</span></code>, increasing by <code class="docutils literal notranslate"><span class="pre">s</span></code> from one entry to the next, and going up to (but not including) <code class="docutils literal notranslate"><span class="pre">b</span></code>.  It is best to experiment a bit to get the feel for it!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">17</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>This can be used for descending ranges too, and observe that the final number b in range(a,b,s) is not included.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>How many multiples of 7 are between 10 and 100?  We can find out pretty quickly with the range command and the len command (to count).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>  <span class="c1"># What list will this create?  It won&#39;t answer the question...</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>  <span class="c1"># Starting at 14 gives the multiples of 7.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>  <span class="c1"># Gives the length of the list, and answers the question!</span>
</pre></div>
</div>
</div>
</div>
<section id="id3">
<h3>Exercises<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> are integers, what is the length of <code class="docutils literal notranslate"><span class="pre">range(a,b)</span></code>?</p></li>
<li><p>Use a list and range command to produce the list <code class="docutils literal notranslate"><span class="pre">[1,2,3,4,5,6,7,8,9,10]</span></code>.</p></li>
<li><p>Create the list [1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5] with a single list and range command and another operation.</p></li>
<li><p>How many multiples of 3 are there between 300 and 3000?</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  Use this space to work on the exercises.</span>
</pre></div>
</div>
</div>
</div>
<p><a id='iterating'></a></p>
</section>
</section>
<section id="iterating-over-a-range">
<h2>Iterating over a range<a class="headerlink" href="#iterating-over-a-range" title="Link to this heading">#</a></h2>
<p>Computers are excellent at repetitive reliable tasks.  If we wish to perform a similar computation, many times over, a computer a great tool.  Here we look at a common and simple way to carry out a repetetive computation:  the “for loop”.  The “for loop” <em>iterates</em> through items in a list or range, carrying out some action for each item.  Two examples will illustrate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;Am&#39;</span><span class="p">,</span><span class="s1">&#39;Python&#39;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="s2">&quot;!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The first loop, <strong>unraveled</strong>, carries out the following sequence of commands.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">2</span>
<span class="nb">print</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">3</span>
<span class="nb">print</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">4</span>
<span class="nb">print</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">5</span>
<span class="nb">print</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>But the “for loop” is more efficient <em>and</em> more readable to programmers.  Indeed, it saves the repetition of writing the same command <code class="docutils literal notranslate"><span class="pre">print</span> <span class="pre">n*n</span></code> over and over again.  It also makes transparent, from the beginning, the range of values that <code class="docutils literal notranslate"><span class="pre">n</span></code> is assigned to.</p>
<p>When you read and write “for loops”, you should consider how they look unravelled – that is how Python will carry out the loop.  And when you find yourself faced with a repetetive task, you might consider whether it may be wrapped up in a for loop.</p>
<p>Try to unravel the loop below, and predict the result, before evaluating the code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">P</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">):</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">P</span> <span class="o">*</span> <span class="n">n</span>
<span class="nb">print</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This might have been difficult!  So what if you want to trace through the loop, as it goes?  Sometimes, especially when debugging, it’s useful to inspect every step of the loop to see what Python is doing.  We can inspect the loop above, by inserting a print command within the <em>scope</em> of the loop.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">P</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">):</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">P</span> <span class="o">*</span> <span class="n">n</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n is&quot;</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="s2">&quot;and P is&quot;</span><span class="p">,</span><span class="n">P</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here we have used the <em>print</em> command with strings and numbers together.  In Python 3.x, you can print multiple things on the same line by separating them by commas.  The “things” can be strings (enclosed by single or double-quotes) and numbers (int, float, etc.).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;My favorite number is&quot;</span><span class="p">,</span><span class="mi">17</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>If we unravel the loop above, the linear sequence of commands interpreted by Python is the following.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">P</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">P</span> <span class="o">*</span> <span class="n">n</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n is&quot;</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="s2">&quot;and P is&quot;</span><span class="p">,</span><span class="n">P</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">P</span> <span class="o">*</span> <span class="n">n</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n is&quot;</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="s2">&quot;and P is&quot;</span><span class="p">,</span><span class="n">P</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">P</span> <span class="o">*</span> <span class="n">n</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n is&quot;</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="s2">&quot;and P is&quot;</span><span class="p">,</span><span class="n">P</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">P</span> <span class="o">*</span> <span class="n">n</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n is&quot;</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="s2">&quot;and P is&quot;</span><span class="p">,</span><span class="n">P</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">P</span> <span class="o">*</span> <span class="n">n</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n is&quot;</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="s2">&quot;and P is&quot;</span><span class="p">,</span><span class="n">P</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">P</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s analyze the loop syntax in more detail.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">P</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">):</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">P</span> <span class="o">*</span> <span class="n">n</span>  <span class="c1"># this command is in the scope of the loop.</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n is&quot;</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="s2">&quot;and P is&quot;</span><span class="p">,</span><span class="n">P</span><span class="p">)</span>  <span class="c1"># this command is in the scope of the loop too!</span>
<span class="nb">print</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
</pre></div>
</div>
<p>The “for” command ends with a colon <code class="docutils literal notranslate"><span class="pre">:</span></code>, and the <strong>next two</strong> lines are indented.  The colon and indentation are indicators of <strong>scope</strong>.  The <em>scope</em> of the for loop begins after the colon, and includes all indented lines.  The <em>scope</em> of the for loop is what is repeated in every step of the loop (in addition to the reassignment of <code class="docutils literal notranslate"><span class="pre">n</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">P</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">):</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">P</span> <span class="o">*</span> <span class="n">n</span>  <span class="c1"># this command is in the scope of the loop.</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n is&quot;</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="s2">&quot;and P is&quot;</span><span class="p">,</span><span class="n">P</span><span class="p">)</span>  <span class="c1"># this command is in the scope of the loop too!</span>
<span class="nb">print</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>If we change the indentation, it changes the scope of the for loop.  Predict what the following loop will do, by unraveling, before evaluating it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">P</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">):</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">P</span> <span class="o">*</span> <span class="n">n</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n is&quot;</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="s2">&quot;and P is&quot;</span><span class="p">,</span><span class="n">P</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Scopes can be nested by nesting indentation.  What do you think the following loop will do?  Can you unravel it?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>How might you create a nested loop which prints <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">a</span></code> then <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">a</span></code> then <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">a</span></code> then <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">b</span></code> then <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">b</span></code> then <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">b</span></code>?  Try it below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Insert your loop here.</span>
</pre></div>
</div>
</div>
</div>
<p>Among popular programming languages, Python is particular about indentation.  Other languages indicate scope with open/close braces, for example, and indentation is just a matter of style.  By requiring indentation to indicate scope, Python effectively removes the need for open/close braces, and enforces a readable style.</p>
<p>We have now encountered data types, operations, variables, and loops.  Taken together, these are powerful tools for computation!  Try the following exercises for more practice.  You can also try the exercises at the end of Chapter 0 of <a class="reference external" href="http://bookstore.ams.org/mbk-105/">An Illustrated Theory of Numbers</a> – some can be done easily by writing a few lines of Python code.</p>
</section>
<section id="id4">
<h2>Exercises<a class="headerlink" href="#id4" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Describe how Python interprets division with remainder when the divisor and/or dividend is negative.</p></li>
<li><p>What is the remainder when <span class="math notranslate nohighlight">\(2^{90}\)</span> is divided by <span class="math notranslate nohighlight">\(91\)</span>?</p></li>
<li><p>How many multiples of 13 are there between 1 and 1000?</p></li>
<li><p>How many <em>odd</em> multiples of 13 are there between 1 and 1000?</p></li>
<li><p>What is the sum of the numbers from 1 to 1000?</p></li>
<li><p>What is the sum of the squares, from <span class="math notranslate nohighlight">\(1 \cdot 1\)</span> to <span class="math notranslate nohighlight">\(1000 \cdot 1000\)</span>?</p></li>
</ol>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="part-2-functions-in-python-3-x">
<h1>Part 2:  Functions in Python 3.x<a class="headerlink" href="#part-2-functions-in-python-3-x" title="Link to this heading">#</a></h1>
<p>A distinguishing property of <em>programming</em> languages is that the programmer can create their own <em>functions</em>.  Creating a <em>function</em> is like teaching the computer a new trick.  Typically a function will receive some data as <em>input</em>, will perform an <em>algorithm</em> involving the input data, and will <em>output</em> data when the algorithm terminates.</p>
<p>In this part, we explore Python functions.  We also explore control statements, which allow a program to behave in different ways for different inputs.  We also introduce the <em>while loop</em>, a loop whose repetition can be more carefully controlled than a for loop.  As an application of these techniques, we implement the Euclidean algorithm as a Python function in a few ways, to effectively find the GCD of integers and solve linear Diophantine equations.  This complements <strong>Chapter 1</strong> of An Illustrated Theory of Numbers.</p>
<section id="id5">
<h2>Table of Contents<a class="headerlink" href="#id5" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#functions"><span class="xref myst">Getting started with Python functions</span></a></p></li>
<li><p><a class="reference internal" href="#controls"><span class="xref myst">Control statements</span></a></p></li>
<li><p><a class="reference internal" href="#while"><span class="xref myst">While loops and implementation of the Eucidean algorithm</span></a></p></li>
<li><p><a class="reference internal" href="#solving"><span class="xref myst">Solving the linear Diophantine equation</span></a></p></li>
</ul>
<p><a id='functions'></a></p>
</section>
<section id="getting-started-with-python-functions">
<h2>Getting started with Python functions<a class="headerlink" href="#getting-started-with-python-functions" title="Link to this heading">#</a></h2>
<p>A <em>function</em> in Python is a construction which takes input data, performs some actions, and outputs data.  It is best to start with a few examples and break down the code.  Here is a function <code class="docutils literal notranslate"><span class="pre">square</span></code>.  Run the code as usual by pressing <em>shift-Enter</em> when the code block is selected.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">answer</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span>
    <span class="k">return</span> <span class="n">answer</span>
</pre></div>
</div>
</div>
</div>
<p>When you run the code block, you probably didn’t see anything happen.  But you have effectively taught your computer a new trick, increasing the vocabulary of commands it understands through the Python interpreter.  Now you can use the <code class="docutils literal notranslate"><span class="pre">square</span></code> command as you wish.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">square</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">square</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s break down the syntax of the <em>function declaration</em>, line by line.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">answer</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span>
    <span class="k">return</span> <span class="n">answer</span>
</pre></div>
</div>
<p>The first line begins with the Python reserved word <code class="docutils literal notranslate"><span class="pre">def</span></code>.  (So don’t use <code class="docutils literal notranslate"><span class="pre">def</span></code> as a variable name!).  The word <code class="docutils literal notranslate"><span class="pre">def</span></code> stands for “define” and it defines a function called <code class="docutils literal notranslate"><span class="pre">square</span></code>.  After the function name <code class="docutils literal notranslate"><span class="pre">square</span></code> comes parentheses <code class="docutils literal notranslate"><span class="pre">(x)</span></code> containing the <strong>argument</strong> <code class="docutils literal notranslate"><span class="pre">x</span></code>.  The <em>arguments</em> or <em>parameters</em> of a function refer to the input data.  Even if your function has no arguments, you need parentheses.  The argument <code class="docutils literal notranslate"><span class="pre">x</span></code> is used to name whatever number is input into the <code class="docutils literal notranslate"><span class="pre">square</span></code> function.</p>
<p>At the end of the function declaration line is a colon <code class="docutils literal notranslate"><span class="pre">:</span></code> and the following two lines are indented.  As in the case of for loops, the colon and indentation are signals of <em>scope</em>.  Everything on the indented lines is considered the <em>scope of the function</em> and is carried out when the function is used later.</p>
<p>The second line <code class="docutils literal notranslate"><span class="pre">answer</span> <span class="pre">=</span> <span class="pre">x</span> <span class="pre">*</span> <span class="pre">x</span></code> is the beginning of the scope of the function.  It declares a variable <code class="docutils literal notranslate"><span class="pre">answer</span></code> and sets the value to be <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">*</span> <span class="pre">x</span></code>.  So if the argument <code class="docutils literal notranslate"><span class="pre">x</span></code> is 12, then <code class="docutils literal notranslate"><span class="pre">answer</span></code> will be set to 144.  The variable <code class="docutils literal notranslate"><span class="pre">answer</span></code>, being declared within the scope of the function, will not be accessible outside the scope of the function.  It is called a <strong>local variable</strong>.</p>
<p>The last line <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">answer</span></code> contains the Python reserved word <code class="docutils literal notranslate"><span class="pre">return</span></code>, which terminates the function and outputs the value of the variable <code class="docutils literal notranslate"><span class="pre">answer</span></code>.  So when you apply the function with the command <code class="docutils literal notranslate"><span class="pre">square(1.5)</span></code>, the number <code class="docutils literal notranslate"><span class="pre">1.5</span></code> is the argument <code class="docutils literal notranslate"><span class="pre">x</span></code>, and <code class="docutils literal notranslate"><span class="pre">answer</span></code> is <code class="docutils literal notranslate"><span class="pre">2.25</span></code>, and that number <code class="docutils literal notranslate"><span class="pre">2.25</span></code> becomes the output.</p>
<p>A function does not have to return a value.  Some functions might just provide some information.  Here is a function which displays the result of division with remainder as a sentence with addition and multiplication.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">display_divmod</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="n">quotient</span> <span class="o">=</span> <span class="n">a</span> <span class="o">//</span> <span class="n">b</span> <span class="c1"># Integer division</span>
    <span class="n">remainder</span> <span class="o">=</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span> <span class="c1">#</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> = </span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">) + </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">quotient</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">remainder</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display_divmod</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Notice that this function has no <code class="docutils literal notranslate"><span class="pre">return</span></code> line.  The function terminates automatically at the end of its scope.</p>
<p>The function also uses Python’s <strong>string formatting</strong>.  This has changed between Python 2.x and 3.x, and this notebook uses Python 3.x syntax.</p>
<p>String formatting allows you to insert placeholders like <code class="docutils literal notranslate"><span class="pre">{}</span></code> within a string, and later fill those places with a list of things.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;My favorite number is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">17</span><span class="p">))</span>  <span class="c1"># The .format &quot;method&quot; substitutes 17 for {}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> + </span><span class="si">{}</span><span class="s2"> = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="o">+</span><span class="mi">12</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">format</span></code> command is an example of a <strong>string method</strong>.  It has the effect of replacing all placeholders <code class="docutils literal notranslate"><span class="pre">{}</span></code> by the its inputs, in sequence.  There is an intricate syntax for these placeholders, to allow one to match placeholders with values in different orders, and to format different kinds of values.  Here is the <a class="reference external" href="https://docs.python.org/3/library/string.html#formatstrings">official reference for string formatting in Python 3.x</a>.  We will only use the most basic features, exhibited below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;The number </span><span class="si">{}</span><span class="s2"> comes before </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="c1"># This should be familiar.</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;The number </span><span class="si">{1}</span><span class="s2"> comes before </span><span class="si">{0}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="c1"># What happens?</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;The number </span><span class="si">{1}</span><span class="s2"> comes before </span><span class="si">{1}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="c1"># Got it now?</span>
</pre></div>
</div>
</div>
</div>
<p>By placing a number in the placeholder, like <code class="docutils literal notranslate"><span class="pre">{1}</span></code>, one can fill in the placeholders with the values in a different order, or repeat the same value.  The format method takes multiple parameters, and they are numbered:  parameter 0, parameter 1, parameter 2, etc..  So the placeholder <code class="docutils literal notranslate"><span class="pre">{1}</span></code> will be replaced by the second parameter (parameter 1).  It’s confusing at first, but Python almost always starts counting at zero.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;pi is approximately </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">3.14159265</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;pi is approximately </span><span class="si">{0:f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">3.14159265</span><span class="p">))</span> <span class="c1"># The &quot;f&quot; in &quot;0:f&quot; formats the float.</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;pi is approximately </span><span class="si">{0:0.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">3.14159265</span><span class="p">))</span> <span class="c1"># Choose 3 digits of precision.</span>
</pre></div>
</div>
</div>
</div>
<p>If you give some information about how the placeholder is being used, the format method will format things more nicely for printing.  The placeholder <code class="docutils literal notranslate"><span class="pre">{0:f}</span></code> will be replaced by parameter 0, and it will be formatted in a way that is nice for floats (hence the <code class="docutils literal notranslate"><span class="pre">f</span></code>).  Don’t try formatting things outside of their type!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:d}</span><span class="s2"> is a pretty big integer.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">100</span><span class="p">))</span> <span class="c1"># d is the formatting code for integers.</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:f}</span><span class="s2"> is an integer, formatted like a float.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">100</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:f}</span><span class="s2"> is a float, of course.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">7</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2"> is a string.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Hi there!&#39;</span><span class="p">))</span> <span class="c1"># s is the formatting code for strings.</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:d}</span><span class="s2"> will give us an error message.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">7</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">sqrt</span>  <span class="c1"># Make sure the square root function is loaded.</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The square root of </span><span class="si">{0:d}</span><span class="s2"> is about </span><span class="si">{1:f}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">1000</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<section id="id6">
<h3>Exercises<a class="headerlink" href="#id6" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>What are the signals of scope in Python?</p></li>
<li><p>Write a function called area_circle, which takes one argument radius. The function should return the area of the circle, as a floating point number. Then add one line to the function, using string formatting, so that it additionally prints a helpful sentence of the form “The area of a circle of radius 1.0 is 3.14159.” (depending on the radius and the area it computes).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">format</span></code> is an example of a method.  Another neat one is <code class="docutils literal notranslate"><span class="pre">replace</span></code>.  Try <code class="docutils literal notranslate"><span class="pre">&quot;Python&quot;.replace(&quot;yth&quot;,&quot;arag&quot;)</span></code> to see what it does.</p></li>
<li><p>Try the formatting codes <code class="docutils literal notranslate"><span class="pre">%</span></code> and <code class="docutils literal notranslate"><span class="pre">E</span></code> (instead of <code class="docutils literal notranslate"><span class="pre">f</span></code>) for a floating point number.  What do they do?</p></li>
<li><p>Can you think of a reason you might want to have a function with <em>no</em> arguments?</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  Use this space to work on the Exercises.  </span>
<span class="c1">#  Remember that you can add a new cell above/below by clicking to the left of a cell,</span>
<span class="c1">#  (the cell will have a blue bar at the left) and then pressing &quot;a&quot; or &quot;b&quot; on the keyboard.</span>
</pre></div>
</div>
</div>
</div>
<p><a id='controls'></a></p>
</section>
</section>
<section id="control-statements">
<h2>Control statements<a class="headerlink" href="#control-statements" title="Link to this heading">#</a></h2>
<p>It is important for a computer program to behave differently under different circumstances.  The simplest control statements, <code class="docutils literal notranslate"><span class="pre">if</span></code> and its relative <code class="docutils literal notranslate"><span class="pre">else</span></code>, can be used to tell Python to carry out different actions depending on the value of a boolean variable.  The following function exhibits the syntax.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">is_even</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span><span class="o">%</span><span class="k">2</span> == 0:
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is even.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is odd.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">is_even</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">is_even</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The broad syntax of the function should be familiar.  We have created a function called <code class="docutils literal notranslate"><span class="pre">is_even</span></code> with one argument called <code class="docutils literal notranslate"><span class="pre">n</span></code>.  The body of the function uses the <strong>control statement</strong> <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">n%2</span> <span class="pre">==</span> <span class="pre">0:</span></code>.  Recall that <code class="docutils literal notranslate"><span class="pre">n%2</span></code> gives the remainder after dividing <code class="docutils literal notranslate"><span class="pre">n</span></code> by <code class="docutils literal notranslate"><span class="pre">2</span></code>.  Thus <code class="docutils literal notranslate"><span class="pre">n%2</span></code> is 0 or 1, depending on whether <code class="docutils literal notranslate"><span class="pre">n</span></code> is even or odd.  Therefore the <strong>boolean</strong> <code class="docutils literal notranslate"><span class="pre">n%2</span> <span class="pre">==</span> <span class="pre">0</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> if <code class="docutils literal notranslate"><span class="pre">n</span></code> is even, and <code class="docutils literal notranslate"><span class="pre">False</span></code> if <code class="docutils literal notranslate"><span class="pre">n</span></code> is odd.</p>
<p>The next two lines (the first <code class="docutils literal notranslate"><span class="pre">print</span></code> and <code class="docutils literal notranslate"><span class="pre">return</span></code> statements) are within the <strong>scope</strong> of the <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">&lt;boolean&gt;:</span></code> statement, as indicated by the colon and the indentation.  The <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">&lt;boolean&gt;:</span></code> statement tells the Python interpreter to perform the statements within the scope if the boolean is <code class="docutils literal notranslate"><span class="pre">True</span></code>, and to ignore the statements within the scope if the boolean is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<p>Putting it together, we can analyze the code.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">if</span> <span class="n">n</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is even.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">n</span></code> is even, then the Python interpreter will print a sentence of the form <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">is</span> <span class="pre">even</span></code>.  Then the interpreter will return (output) the value <code class="docutils literal notranslate"><span class="pre">True</span></code> and the function will terminate.  If <code class="docutils literal notranslate"><span class="pre">n</span></code> is odd, the Python interpreter will ignore the two lines of scope.</p>
<p>Often we don’t just want Python to <em>do nothing</em> when a condition is not satisfied.  In the case above, we would rather Python tell us that the number is odd.  The <code class="docutils literal notranslate"><span class="pre">else:</span></code> control statement tells Python what to do in case the <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">&lt;boolean&gt;:</span></code> control statement receives a <code class="docutils literal notranslate"><span class="pre">False</span></code> boolean.  We analyze the code</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is odd.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">print</span></code> and <code class="docutils literal notranslate"><span class="pre">return</span></code> commands are within the scope of the <code class="docutils literal notranslate"><span class="pre">else:</span></code> control statement.  So when the <code class="docutils literal notranslate"><span class="pre">if</span></code> statement receives a false signal (the number <code class="docutils literal notranslate"><span class="pre">n</span></code> is odd), the program prints a sentence of the form <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">is</span> <span class="pre">odd.</span></code> and then returns the value <code class="docutils literal notranslate"><span class="pre">False</span></code> and terminates the function.</p>
<p>The function <code class="docutils literal notranslate"><span class="pre">is_even</span></code> is a verbose, or “talkative” sort of function.  Such a function is sometimes useful in an interactive setting, where the programmer wants to understand everything that’s going on.  But if the function had to be called a million times, the screen would fill with printed sentences!  In practice, an efficient and silent function <code class="docutils literal notranslate"><span class="pre">is_even</span></code> might look like the following.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">is_even</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">n</span><span class="o">%</span><span class="k">2</span> == 0)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">is_even</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">for</span></code> loop and an <code class="docutils literal notranslate"><span class="pre">if</span></code> control statement, used together, allow us to carry out a <strong>brute force</strong> search.  We can search for factors in order to check whether a number is prime.  Or we can look for solutions to an equation until we find one.</p>
<p>One thing to note:  the function below begins with a block of text between a triple-quote (three single-quotes when typing).  That text is called a <strong>docstring</strong> and it is meant to document what the function does.  Writing clear docstrings becomes more important as you write longer programs, collaborate with other programmers, and when you want to return months or years later to use a program again.  There are different style conventions for docstrings; for example, here are <a class="reference external" href="https://google.github.io/styleguide/pyguide.html?showone=Comments#Comments">Google’s docstring conventions</a>.  We take a less formal approach.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">is_prime</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Checks whether the argument n is a prime number.</span>
<span class="sd">    Uses a brute force search for factors between 1 and n.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>  <span class="c1"># the list of numbers 2,3,...,n-1.</span>
        <span class="k">if</span> <span class="n">n</span><span class="o">%</span><span class="k">j</span> == 0:  # is n divisible by j?
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is a factor of </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
<p>An important note:  the <code class="docutils literal notranslate"><span class="pre">return</span></code> keyword <strong>terminates</strong> the function.  So as soon as a factor is found, the function terminates and outputs <code class="docutils literal notranslate"><span class="pre">False</span></code>.  If no factor is found, then the function execution survives past the loop, and the line <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">True</span></code> is executed to terminate the function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">is_prime</span><span class="p">(</span><span class="mi">91</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">is_prime</span><span class="p">(</span><span class="mi">101</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Try the <code class="docutils literal notranslate"><span class="pre">is_prime</span></code> function on bigger numbers – try numbers with 4 digits, 5 digits, 6 digits.  Where does it start to slow down?  Do you get any errors when the numbers are large?  Make sure to save your work first, just in case this crashes your computer!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Experiment with is_prime here.</span>
</pre></div>
</div>
</div>
</div>
<p>There are two limiting factors, which we study in more detail in the next lesson.  These are <strong>time</strong> and <strong>space</strong> (your computer’s memory space).  As the loop of <code class="docutils literal notranslate"><span class="pre">is_prime</span></code> goes on and on, it might take your computer a long time!  If each step of the loop takes only a nanosecond (1 billionth of a second), the loop would take about a second when executing <code class="docutils literal notranslate"><span class="pre">is_prime(1000000001)</span></code>.  If you tried <code class="docutils literal notranslate"><span class="pre">is_prime</span></code> on a much larger number, like <code class="docutils literal notranslate"><span class="pre">is_prime(2**101</span> <span class="pre">-</span> <span class="pre">1)</span></code>, the loop would take longer than the lifetime of the Earth.</p>
<p>The other issue that can arise is a problem with <em>space</em>.  In Python 3.x, the <code class="docutils literal notranslate"><span class="pre">range(2,n)</span></code> cleverly <em>avoids</em> storing all the numbers between <code class="docutils literal notranslate"><span class="pre">2</span></code> and <code class="docutils literal notranslate"><span class="pre">n-1</span></code> in memory.  It just remembers the endpoints, and how to proceed from one number to the next.  In the older version, Python 2.x, the range command <code class="docutils literal notranslate"><span class="pre">range(2,n)</span></code> would have tried to store the entire list of numbers <code class="docutils literal notranslate"><span class="pre">[2,3,4,...,n-1]</span></code> in the memory of your computer.  Your computer has some (4 or 8 or 16, perhaps) gigabytes of memory (RAM).  A gigabyte is a billion bytes, and a byte is enough memory to store a number between 0 and 255.  (More detail about this later!).  So a gigabyte will not even hold a billion numbers.  So our <code class="docutils literal notranslate"><span class="pre">is_prime</span></code> function would have led to memory problems in Python 2.x, but in Python 3.x we don’t have to worry (for now) about space.</p>
<section id="id7">
<h3>Exercises<a class="headerlink" href="#id7" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Create a function <code class="docutils literal notranslate"><span class="pre">my_abs(x)</span></code> which outputs the absolute value of the argument <code class="docutils literal notranslate"><span class="pre">x</span></code>.  (Note that Python already has a built-in <code class="docutils literal notranslate"><span class="pre">abs(x)</span></code> function).</p></li>
<li><p>Modify the <code class="docutils literal notranslate"><span class="pre">is_prime</span></code> function so that it prints a message <code class="docutils literal notranslate"><span class="pre">Number</span> <span class="pre">too</span> <span class="pre">big</span></code> and returns <code class="docutils literal notranslate"><span class="pre">None</span></code> if the input argument is bigger than one million.  (Note that <code class="docutils literal notranslate"><span class="pre">None</span></code> is a Python reserved word.  You can use the one-line statement <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">None</span></code>.)</p></li>
<li><p>Write a Python function <code class="docutils literal notranslate"><span class="pre">thrarity</span></code> which takes an argument <code class="docutils literal notranslate"><span class="pre">n</span></code>, and outputs the string <code class="docutils literal notranslate"><span class="pre">threeven</span></code> if <code class="docutils literal notranslate"><span class="pre">n</span></code> is a multiple of three, or <code class="docutils literal notranslate"><span class="pre">throdd</span></code> is <code class="docutils literal notranslate"><span class="pre">n</span></code> is one more than a multiple of three, or <code class="docutils literal notranslate"><span class="pre">thrugly</span></code> if <code class="docutils literal notranslate"><span class="pre">n</span></code> is one less than a multiple of three.  Example:  <code class="docutils literal notranslate"><span class="pre">thrarity(31)</span></code> should output <code class="docutils literal notranslate"><span class="pre">throdd</span></code> and <code class="docutils literal notranslate"><span class="pre">thrarity(44)</span></code> should output <code class="docutils literal notranslate"><span class="pre">thrugly</span></code>.  Hint:  study the <code class="docutils literal notranslate"><span class="pre">if</span></code>/<code class="docutils literal notranslate"><span class="pre">elif</span></code> syntax at <a class="reference external" href="https://docs.python.org/2/tutorial/controlflow.html#if-statements">the official Python tutorial</a></p></li>
<li><p>Write a Python function <code class="docutils literal notranslate"><span class="pre">sum_of_squares(n)</span></code> which finds and prints a pair of natural numbers <span class="math notranslate nohighlight">\(x\)</span>, <span class="math notranslate nohighlight">\(y\)</span>, such that <span class="math notranslate nohighlight">\(x^2 + y^2 = n\)</span>.  The function should use a brute force search and return <code class="docutils literal notranslate"><span class="pre">None</span></code> if no such pair of numbers <span class="math notranslate nohighlight">\(x,y\)</span> exists.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  Use this space for your solutions to the questions.</span>
</pre></div>
</div>
</div>
</div>
<p><a id='while'></a></p>
</section>
</section>
<section id="while-loops-and-implementation-of-the-eucidean-algorithm">
<h2>While loops and implementation of the Eucidean algorithm<a class="headerlink" href="#while-loops-and-implementation-of-the-eucidean-algorithm" title="Link to this heading">#</a></h2>
<p>We <em>almost</em> have all the tools we need to implement the Euclidean algorithm.  The last tool we will need is the <strong>while loop</strong>.  We have seen the <em>for loop</em> already, which is very useful for iterating over a range of numbers.  The Euclidean algorithm involves repetition, but there is no way to know in advance how many steps it will take.  The while loop allows us to repeat a process as long as a boolean value (sometimes called a <strong>flag</strong>) is True.  The following countdown example illustrates the structure of a while loop.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">countdown</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">current_value</span> <span class="o">=</span> <span class="n">n</span>
    <span class="k">while</span> <span class="n">current_value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># The condition (current_value &gt; 0) is checked before every instance of the scope!</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">current_value</span><span class="p">)</span>
        <span class="n">current_value</span> <span class="o">=</span> <span class="n">current_value</span> <span class="o">-</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">countdown</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The while loop syntax begins with <code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">&lt;boolean&gt;:</span></code> and the following indented lines comprise the scope of the loop.  If the boolean is <code class="docutils literal notranslate"><span class="pre">True</span></code>, then the scope of the loop is executed.  If the boolean is <code class="docutils literal notranslate"><span class="pre">True</span></code> again afterwards, then the scope of the loop is executed again.  And again and again and so on.</p>
<p>This can be a <strong>dangerous process</strong>!  For example, what would happen if you made a little typo and the last line of the while loop read <code class="docutils literal notranslate"><span class="pre">current_value</span> <span class="pre">=</span> <span class="pre">current_value</span> <span class="pre">+</span> <span class="pre">1</span></code>?  The numbers would increase and increase… and the boolean <code class="docutils literal notranslate"><span class="pre">current_value</span> <span class="pre">&gt;</span> <span class="pre">0</span></code> would <strong>always</strong> be <code class="docutils literal notranslate"><span class="pre">True</span></code>.  Therefore the loop would never end.  Bigger and bigger numbers would scroll down your computer screen.</p>
<p>You might panic under such a circumstance, and maybe turn your computer off to stop the loop.  Here is some advice for when your computer gets stuck in such a neverending loop:</p>
<ol class="arabic simple">
<li><p>Back up your work often.  When you’re programming, make sure everything else is saved just in case.</p></li>
<li><p>Save your programming work (use “Save and checkpoint” under the “File” menu) often, especially before running a cell with a loop for the first time.</p></li>
<li><p>If you <em>do</em> get stuck in a neverending loop, click on “Kernel… Interrupt”.  This will often unstick the loop and allow you to pick up where you left off.</p></li>
<li><p>On a Mac, you might try a “Force Quit” of the Python process, using the Activity Manager.</p></li>
</ol>
<p>Now, if you’re feeling brave, save your work, change the while loop so that it never ends, and try to recover where you left off.  But be aware that this could cause your computer to freeze or behave erratically, crashing your browser, etc.  Don’t panic… it won’t break your computer permanently.</p>
<p>The neverending loop causes two problems here.  One is with your computer processor, which will be essentially spinning its wheels.  This is called <a class="reference external" href="https://en.wikipedia.org/wiki/Busy_waiting">busy waiting</a>, and your computer will essentially be busy waiting forever.  The other problem is that your loop is printing more and more lines of text into the notebook.  This could easily crash your web browser, which is trying to store and display zillions of lines of numbers.  So be ready for problems!</p>
<section id="the-euclidean-algorithm-with-a-while-loop">
<h3>The Euclidean algorithm with a while loop<a class="headerlink" href="#the-euclidean-algorithm-with-a-while-loop" title="Link to this heading">#</a></h3>
<p>The <strong>Euclidean Algorithm</strong> is a process of repeated division with remainder.  Beginning with two integers <code class="docutils literal notranslate"><span class="pre">a</span></code> (dividend) and <code class="docutils literal notranslate"><span class="pre">b</span></code> (divisor), one computes quotient <code class="docutils literal notranslate"><span class="pre">q</span></code> and remainder <code class="docutils literal notranslate"><span class="pre">q</span></code> to express <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">qb</span> <span class="pre">+</span> <span class="pre">r</span></code>.  Then <code class="docutils literal notranslate"><span class="pre">b</span></code> becomes the dividend and <code class="docutils literal notranslate"><span class="pre">r</span></code> becomes the divisor, and one repeats.  The repetition continues, and the <strong>last nonzero</strong> remainder is the greatest common divisor of <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code>.  It is the subject of Chapter 1 of <a class="reference external" href="http://bookstore.ams.org/mbk-105">An Illustrated Theory of Numbers</a>.</p>
<p>We implement the Euclidean algorithm in a few variations.  The first will be a verbose version, to show the user what happens at every step.  We use a while loop to take care of the repetition.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">Euclidean_algorithm</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="n">dividend</span> <span class="o">=</span> <span class="n">a</span>
    <span class="n">divisor</span> <span class="o">=</span> <span class="n">b</span>
    <span class="k">while</span> <span class="n">divisor</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>   <span class="c1"># Recall that != means &quot;is not equal to&quot;.</span>
        <span class="n">quotient</span> <span class="o">=</span> <span class="n">dividend</span> <span class="o">//</span> <span class="n">divisor</span>
        <span class="n">remainder</span> <span class="o">=</span> <span class="n">dividend</span> <span class="o">%</span> <span class="n">divisor</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> = </span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">) + </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dividend</span><span class="p">,</span> <span class="n">quotient</span><span class="p">,</span> <span class="n">divisor</span><span class="p">,</span> <span class="n">remainder</span><span class="p">))</span>
        <span class="n">dividend</span> <span class="o">=</span> <span class="n">divisor</span>  
        <span class="n">divisor</span> <span class="o">=</span> <span class="n">remainder</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Euclidean_algorithm</span><span class="p">(</span><span class="mi">133</span><span class="p">,</span> <span class="mi">58</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Euclidean_algorithm</span><span class="p">(</span><span class="mi">1312331323</span><span class="p">,</span> <span class="mi">58123123</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This is excellent if we want to know every step of the Euclidean algorithm.  If we just want to know the GCD of two numbers, we can be less verbose.  We carefully return the last nonzero remainder after the while loop is concluded.  This last nonzero remainder becomes the divisor when the remainder becomes zero, and then it would become the dividend in the next (unprinted) line.  That is why we return the (absolute value) of the dividend after the loop is concluded.  You might insert a line at the end of the loop, like <code class="docutils literal notranslate"><span class="pre">print</span> <span class="pre">dividend,</span> <span class="pre">divisor,</span> <span class="pre">remainder</span></code> to help you track the variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">GCD</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="n">dividend</span> <span class="o">=</span> <span class="n">a</span> <span class="c1"># The first dividend is a.</span>
    <span class="n">divisor</span> <span class="o">=</span> <span class="n">b</span> <span class="c1"># The first divisor is b.</span>
    <span class="k">while</span> <span class="n">divisor</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>   <span class="c1"># Recall that != means &quot;not equal to&quot;.</span>
        <span class="n">quotient</span> <span class="o">=</span> <span class="n">dividend</span> <span class="o">//</span> <span class="n">divisor</span>
        <span class="n">remainder</span> <span class="o">=</span> <span class="n">dividend</span> <span class="o">%</span> <span class="n">divisor</span>
        <span class="n">dividend</span> <span class="o">=</span> <span class="n">divisor</span>  
        <span class="n">divisor</span> <span class="o">=</span> <span class="n">remainder</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dividend</span><span class="p">)</span>  <span class="c1">#  abs() is used, since we like our GCDs to be positive.</span>
</pre></div>
</div>
</div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">dividend</span></code> statement occurs <em>after</em> the scope of the while loop.  So as soon as the <em>divisor</em> variable equals zero, the funtion <code class="docutils literal notranslate"><span class="pre">GCD</span></code> returns the <em>dividend</em> variable and terminates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">GCD</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span><span class="mi">27</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">GCD</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span><span class="o">-</span><span class="mi">27</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can refine our code in a few ways.  First, note that the <code class="docutils literal notranslate"><span class="pre">quotient</span></code> variable is never used!  It was nice in the verbose version of the Euclidean algorithm, but plays no role in finding the GCD.  Our refined code reads</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">GCD</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="n">dividend</span> <span class="o">=</span> <span class="n">a</span>  
    <span class="n">divisor</span> <span class="o">=</span> <span class="n">b</span>  
    <span class="k">while</span> <span class="n">divisor</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>   <span class="c1"># Recall that != means &quot;not equal to&quot;.</span>
        <span class="n">remainder</span> <span class="o">=</span> <span class="n">dividend</span> <span class="o">%</span> <span class="n">divisor</span>
        <span class="n">dividend</span> <span class="o">=</span> <span class="n">divisor</span>  
        <span class="n">divisor</span> <span class="o">=</span> <span class="n">remainder</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dividend</span><span class="p">)</span> 
</pre></div>
</div>
<p>Now there are two slick Python tricks we can use to shorten the code.  The first is called <strong>multiple assignment</strong>.  It is possible to set the values of two variables in a single line of code, with a syntax like below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="mi">3</span>  <span class="c1"># Sets x to 2 and y to 3.</span>
</pre></div>
</div>
</div>
</div>
<p>This is particular useful for self-referential assignments, because as for ordinary assignment, the right side is evaluated first and then bound to the variables on the left side.  For example, after the line above, try the line below.  Use print statements to see what the values of the variables are afterwards!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span><span class="n">x</span> <span class="c1">#  Guess what this does!</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;x =&quot;</span><span class="p">,</span><span class="n">x</span><span class="p">)</span> <span class="c1"># One could use &quot;x = {}&quot;.format(x) too.</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;y =&quot;</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can use multiple assignment to turn three lines of code into one line of code.  For the <code class="docutils literal notranslate"><span class="pre">remainder</span></code> variable is only used temporarily before its value is given to the <code class="docutils literal notranslate"><span class="pre">divisor</span></code> variable.  Using multiple assignment, the three lines</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">remainder</span> <span class="o">=</span> <span class="n">dividend</span> <span class="o">%</span> <span class="n">divisor</span>
    <span class="n">dividend</span> <span class="o">=</span> <span class="n">divisor</span>  
    <span class="n">divisor</span> <span class="o">=</span> <span class="n">remainder</span>
</pre></div>
</div>
<p>can be written in one line,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">dividend</span><span class="p">,</span> <span class="n">divisor</span> <span class="o">=</span> <span class="n">divisor</span><span class="p">,</span> <span class="n">dividend</span> <span class="o">%</span> <span class="n">divisor</span> <span class="c1"># Evaluations on the right occur before any assignments!</span>
</pre></div>
</div>
<p>Our newly shortened GCD function looks like this.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">GCD</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="n">dividend</span> <span class="o">=</span> <span class="n">a</span>  
    <span class="n">divisor</span> <span class="o">=</span> <span class="n">b</span>  
    <span class="k">while</span> <span class="n">divisor</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>   <span class="c1"># Recall that != means &quot;not equal to&quot;.</span>
        <span class="n">dividend</span><span class="p">,</span> <span class="n">divisor</span> <span class="o">=</span> <span class="n">divisor</span><span class="p">,</span> <span class="n">dividend</span> <span class="o">%</span> <span class="n">divisor</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dividend</span><span class="p">)</span>
</pre></div>
</div>
<p>The next trick involves the while loop.  The usual syntax has the form <code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">&lt;boolean&gt;:</span></code>.  But if <code class="docutils literal notranslate"><span class="pre">while</span></code> is followed by a numerical type, e.g. <code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">&lt;int&gt;:</span></code>, then the scope of the while loop will execute as long as the number is nonzero!  Therefore, the line</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="n">divisor</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</pre></div>
</div>
<p>can be replaced by the shorter line</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="n">divisor</span><span class="p">:</span>
</pre></div>
</div>
<p>This is truly a trick.  It probably won’t speed anything up, and it does not make your program easier to read for beginners.  So use it if you prefer communicating with experienced Python programmers!  Here is the whole function again.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">GCD</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="n">dividend</span> <span class="o">=</span> <span class="n">a</span>  
    <span class="n">divisor</span> <span class="o">=</span> <span class="n">b</span>  
    <span class="k">while</span> <span class="n">divisor</span><span class="p">:</span>   <span class="c1"># Executes the scope if divisor is nonzero.</span>
        <span class="n">dividend</span><span class="p">,</span> <span class="n">divisor</span> <span class="o">=</span> <span class="n">divisor</span><span class="p">,</span> <span class="n">dividend</span> <span class="o">%</span> <span class="n">divisor</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dividend</span><span class="p">)</span>
</pre></div>
</div>
<p>The next optimization is a bit more dangerous for beginners, but it works here.  In general, it can be dangerous to operate directly on the arguments to a function.  But in this setting, it is safe, and makes no real difference to the Python interpreter.  Instead of creating new variables called <code class="docutils literal notranslate"><span class="pre">dividend</span></code> and <code class="docutils literal notranslate"><span class="pre">divisor</span></code>, one can manipulate <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> directly within the function.  If you do this, the GCD function can be shortened to the following.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">GCD</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">b</span><span class="p">:</span>   <span class="c1"># Recall that != means &quot;not equal to&quot;.</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Try it out.  Try it on some big numbers and see how quick it runs!</span>
</pre></div>
</div>
</div>
</div>
<p>This code is essentially optimal, if one wishes to execute the Euclidean algorithm to find the GCD of two integers.  It almost <a class="reference external" href="https://stackoverflow.com/a/18944210">matches the GCD code in a standard Python library</a>.  It might be slightly faster than our original code – but there is a tradeoff here between execution speed and readability of code.  In this and the following lessons, we often optimize enough for everyday purposes, but not so much that readability is lost.</p>
</section>
<section id="id8">
<h3>Exercises<a class="headerlink" href="#id8" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Modify the <code class="docutils literal notranslate"><span class="pre">is_prime</span></code> function by using a while loop instead of <code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">j</span> <span class="pre">in</span> <span class="pre">range(2,n):</span></code>.  Hint:  the function should contain the lines <code class="docutils literal notranslate"><span class="pre">j</span> <span class="pre">=</span> <span class="pre">2</span></code> and <code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">j</span> <span class="pre">&lt;</span> <span class="pre">n:</span></code> and <code class="docutils literal notranslate"><span class="pre">j</span> <span class="pre">=</span> <span class="pre">j</span> <span class="pre">+</span> <span class="pre">1</span></code> in various places.  Why might this be an improvement from the for loop?</p></li>
<li><p>Modify the <code class="docutils literal notranslate"><span class="pre">Euclidean_algorithm</span></code> function to create a function which returns the <em>number of steps</em> that the Euclidean algorithm requires, i.e., the number of divisions-with-remainder.</p></li>
<li><p>Create a function which carries out division with minimal remainder.  In other words, given integers a,b, the function expresses a = q(b) + r, where r is a <em>positive or negative</em> integer of magnitude bounded by b/2.  Use such a function to create a new Euclidean algorithm function which uses minimal remainder.</p></li>
<li><p>What <code class="docutils literal notranslate"><span class="pre">GCD(a,b)</span></code> function do you think strikes the best balance between efficiency and readability?</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use this space to work on the exercises.</span>
</pre></div>
</div>
</div>
</div>
<p><a id='solving'></a></p>
</section>
</section>
<section id="solving-the-linear-diophantine-equation">
<h2>Solving the linear Diophantine equation<a class="headerlink" href="#solving-the-linear-diophantine-equation" title="Link to this heading">#</a></h2>
<p>In Chapter 1 of <a class="reference external" href="http://bookstore.ams.org/mbk-105">An Illustrated Theory of Numbers</a>, we not only used the Euclidean algorithm to find the GCD of two integers, but also to solve the linear Diophantine equation <span class="math notranslate nohighlight">\(ax + by = c\)</span>.  On paper, this required us to perform the Euclidean algorithm, then “work backwards” to carefully solve a series of linear equations.  This process is repetetive and error-prone… perfect for a computer.</p>
<p>So here we develop a function <code class="docutils literal notranslate"><span class="pre">solve_LDE(a,b,c)</span></code> which will describe all integer solutions <span class="math notranslate nohighlight">\(x,y\)</span> to the equation <span class="math notranslate nohighlight">\(ax + by = c\)</span>.</p>
<p>The idea of the algorithm is to keep track of “hops” and “skips” throughout the Euclidean algorithm.  A general step in the Euclidean algorithm looks like <code class="docutils literal notranslate"><span class="pre">u</span> <span class="pre">=</span> <span class="pre">q(v)</span> <span class="pre">+</span> <span class="pre">r</span></code>.  The remainder can then be expressed by the formula <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">=</span> <span class="pre">u</span> <span class="pre">-</span> <span class="pre">q(v)</span></code>.  If <code class="docutils literal notranslate"><span class="pre">u</span></code> and <code class="docutils literal notranslate"><span class="pre">v</span></code> can be built from hops and skips, then <code class="docutils literal notranslate"><span class="pre">r</span></code> can be built from hops and skips.  How many?  Just tally the hops and skips to find:</p>
<p style="text-align: center;">`r_hops = u_hops - q (v_hops)` and `r_skips = u_skips - q (v_skips)`.</p>
<p>This sort of tallying is what makes the algorithm below work.  The function below does not introduce any new programming concepts, but it assembles many ideas together.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">hop_and_skip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Takes two integer arguments a,b, and prints a sentence of the form</span>
<span class="sd">    GCD(a,b) = x(a) + y(b).  The method is the Euclidean algorithm,</span>
<span class="sd">    tallying hops (units of a) and skips (units of b) along the way.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">a</span> <span class="c1"># We use u instead of dividend.</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">b</span> <span class="c1"># We use v instead of divisor.</span>
    <span class="n">u_hops</span><span class="p">,</span> <span class="n">u_skips</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">0</span> <span class="c1"># u is built from one hop (a) and no skips, for now.</span>
    <span class="n">v_hops</span><span class="p">,</span> <span class="n">v_skips</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span> <span class="c1"># v is built from no hops and one skip (b), for now.</span>
    <span class="k">while</span> <span class="n">v</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>   <span class="c1"># We could just write &quot;while v:&quot;</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">u</span> <span class="o">//</span> <span class="n">v</span>  <span class="c1"># q stands for quotient.</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">u</span> <span class="o">%</span> <span class="n">v</span>  <span class="c1"># r stands for remainder.  So u = q(v) + r.</span>
        
        <span class="n">r_hops</span> <span class="o">=</span> <span class="n">u_hops</span> <span class="o">-</span> <span class="n">q</span> <span class="o">*</span> <span class="n">v_hops</span>  <span class="c1"># Tally hops</span>
        <span class="n">r_skips</span> <span class="o">=</span> <span class="n">u_skips</span> <span class="o">-</span> <span class="n">q</span> <span class="o">*</span> <span class="n">v_skips</span>  <span class="c1"># Tally skips</span>
        
        <span class="n">u</span><span class="p">,</span><span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">,</span><span class="n">r</span>  <span class="c1"># The new dividend,divisor is the old divisor,remainder.</span>
        <span class="n">u_hops</span><span class="p">,</span> <span class="n">v_hops</span> <span class="o">=</span> <span class="n">v_hops</span><span class="p">,</span> <span class="n">r_hops</span> <span class="c1"># The new u_hops, v_hops is the old v_hops, r_hops</span>
        <span class="n">u_skips</span><span class="p">,</span> <span class="n">v_skips</span> <span class="o">=</span> <span class="n">v_skips</span><span class="p">,</span> <span class="n">r_skips</span> <span class="c1"># The new u_skips, v_skips is the old v_skips, r_skips</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> = </span><span class="si">{}</span><span class="s2">(</span><span class="si">{}</span><span class="s2">) + </span><span class="si">{}</span><span class="s2">(</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">u_hops</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">u_skips</span><span class="p">,</span><span class="n">b</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hop_and_skip</span><span class="p">(</span><span class="mi">102</span><span class="p">,</span><span class="mi">45</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Try out the hop_and_skip code on some integers of your choice.  Does it behave correctly?  Check the results, using Python as a calculator.  Does it run quickly for large integers?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  Experimentation space here.</span>
</pre></div>
</div>
</div>
</div>
<p>To conclude this lesson, we put everything together to create a long(ish) function to solve linear Diophantine equations.  We want this function to be smart enough to respond when an equation has no solutions, and to describe <em>all</em> solutions when they exist.</p>
<p>The first part of the function <code class="docutils literal notranslate"><span class="pre">solve_LDE</span></code> is the same as the hop and skip function above.  But rather than expressing <span class="math notranslate nohighlight">\(GCD(a,b)\)</span> as <span class="math notranslate nohighlight">\(ax + by\)</span>, the function uses the GCD to determine the existence and the general form of a solution to <span class="math notranslate nohighlight">\(ax + by = c\)</span>.  The formula for the general form comes from <a class="reference external" href="http://bookstore.ams.org/mbk-105">An Illustrated Theory of Numbers</a>, Chapter 1, Corollary 1.25.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">solve_LDE</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Describes all of the solutions to the linear Diophantine equation</span>
<span class="sd">    ax + by = c.  There are either no solutions or infinitely many solutions.</span>
<span class="sd">    Prints a description of the solution set, and returns None if there are no solutions</span>
<span class="sd">    or returns a single solution if one exists.</span>
<span class="sd">    &#39;&#39;&#39;</span>  
    <span class="n">u</span> <span class="o">=</span> <span class="n">a</span> <span class="c1"># We use u instead of dividend.</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">b</span> <span class="c1"># We use v instead of divisor.</span>
    <span class="n">u_hops</span><span class="p">,</span> <span class="n">u_skips</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">0</span> <span class="c1"># u is built from one hop (a) and no skips.</span>
    <span class="n">v_hops</span><span class="p">,</span> <span class="n">v_skips</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span> <span class="c1"># v is built from no hops and one skip (b).</span>
    <span class="k">while</span> <span class="n">v</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>   <span class="c1"># We could just write while v:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">u</span> <span class="o">//</span> <span class="n">v</span>  <span class="c1"># q stands for quotient.</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">u</span> <span class="o">%</span> <span class="n">v</span>  <span class="c1"># r stands for remainder.  So u = q(v) + r.</span>
        
        <span class="n">r_hops</span> <span class="o">=</span> <span class="n">u_hops</span> <span class="o">-</span> <span class="n">q</span> <span class="o">*</span> <span class="n">v_hops</span>  <span class="c1"># Tally hops</span>
        <span class="n">r_skips</span> <span class="o">=</span> <span class="n">u_skips</span> <span class="o">-</span> <span class="n">q</span> <span class="o">*</span> <span class="n">v_skips</span>  <span class="c1"># Tally skips</span>
        
        <span class="n">u</span><span class="p">,</span><span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">,</span><span class="n">r</span>  <span class="c1"># The new dividend,divisor is the old divisor,remainder.</span>
        <span class="n">u_hops</span><span class="p">,</span> <span class="n">v_hops</span> <span class="o">=</span> <span class="n">v_hops</span><span class="p">,</span> <span class="n">r_hops</span> <span class="c1"># The new u_hops, v_hops is the old v_hops, r_hops</span>
        <span class="n">u_skips</span><span class="p">,</span> <span class="n">v_skips</span> <span class="o">=</span> <span class="n">v_skips</span><span class="p">,</span> <span class="n">r_skips</span> <span class="c1"># The new u_skips, v_skips is the old v_skips, r_skips</span>
    
    <span class="n">g</span> <span class="o">=</span> <span class="n">u</span> <span class="c1"># The variable g now describes the GCD of a and b.</span>
    
    <span class="k">if</span> <span class="n">c</span><span class="o">%</span><span class="k">g</span> == 0:  # When GCD(a,b) divides c...
        <span class="n">d</span> <span class="o">=</span> <span class="n">c</span><span class="o">//</span><span class="n">g</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="n">u_hops</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="n">u_skips</span>  <span class="c1"># Now ax + by = c is a specific solution!</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> x + </span><span class="si">{}</span><span class="s2"> y = </span><span class="si">{}</span><span class="s2"> if and only if &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;x = </span><span class="si">{}</span><span class="s2"> + </span><span class="si">{}</span><span class="s2"> n and y = </span><span class="si">{}</span><span class="s2"> - </span><span class="si">{}</span><span class="s2"> n, for some integer n.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">b</span><span class="o">//</span><span class="n">g</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="o">-</span><span class="n">a</span><span class="o">//</span><span class="n">g</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># When GCD(a,b) does not divide c...</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There are no solutions to </span><span class="si">{}</span><span class="s2"> x + </span><span class="si">{}</span><span class="s2"> y = </span><span class="si">{}</span><span class="s2">,&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;because GCD(</span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">) = </span><span class="si">{}</span><span class="s2">, which does not divide </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">c</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">solve_LDE</span><span class="p">(</span><span class="mi">102</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">solve_LDE</span><span class="p">(</span><span class="mi">72</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">17</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="id9">
<h3>Exercises<a class="headerlink" href="#id9" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Solve problems 4-7 of Chapter 1 of <a class="reference external" href="http://bookstore.ams.org/mbk-105">An Illustrated Theory of Numbers</a> using the <code class="docutils literal notranslate"><span class="pre">solve_LDE</span></code> function.</p></li>
<li><p>Write an <code class="docutils literal notranslate"><span class="pre">LCM</span></code> function, using the previous <code class="docutils literal notranslate"><span class="pre">GCD</span></code> function and the GCD-LCM product formula, Theorem 1.23 of <a class="reference external" href="http://bookstore.ams.org/mbk-105">An Illustrated Theory of Numbers</a>.</p></li>
<li><p>Sometimes it is important to find not the integer solutions, but the <em>positive</em> integer solutions to a Diophantine equation.  Modify the <code class="docutils literal notranslate"><span class="pre">solve_LDE</span></code> function to create a <code class="docutils literal notranslate"><span class="pre">solve_LDE_positive(a,b,c)</span></code> function.  The output of the function should be all pairs of <em>positive</em> integers <span class="math notranslate nohighlight">\(x\)</span>, <span class="math notranslate nohighlight">\(y\)</span>, such that <span class="math notranslate nohighlight">\(ax + by = c\)</span> (if any pairs exist), and a helpful message if no pairs exist (and a <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">None</span></code> should be used in this case).</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  Use this space to work on the exercises.</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="part-3-lists-and-the-sieve-of-eratosthenes-in-python-3-x">
<h1>Part 3:  Lists and the sieve of Eratosthenes in Python 3.x<a class="headerlink" href="#part-3-lists-and-the-sieve-of-eratosthenes-in-python-3-x" title="Link to this heading">#</a></h1>
<p>Python provides a powerful set of tools to create and manipulate lists of data.  In this part, we take a deep dive into the Python list type.  We use Python lists to implement and optimize the Sieve of Eratosthenes, which will produce a list of all prime numbers up to a big number (like 10 million) in a snap.  Along the way, we introduce some Python techniques for mathematical functions and data analysis.  This programming lesson is meant to complement <strong>Chapter 2</strong> of An Illustrated Theory of Numbers, and mathematical background can be found there.</p>
<section id="id10">
<h2>Table of Contents<a class="headerlink" href="#id10" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#primetest"><span class="xref myst">Primality test</span></a></p></li>
<li><p><a class="reference internal" href="#lists"><span class="xref myst">List manipulation</span></a></p></li>
<li><p><a class="reference internal" href="#sieve"><span class="xref myst">The sieve</span></a></p></li>
<li><p><a class="reference internal" href="#analysis"><span class="xref myst">Data analysis</span></a></p></li>
</ul>
<p><a id='primetest'></a></p>
</section>
<section id="primality-testing">
<h2>Primality testing<a class="headerlink" href="#primality-testing" title="Link to this heading">#</a></h2>
<p>Before diving into lists, we recall the <strong>brute force</strong> primality test that we created in the last lesson.  To test whether a number <code class="docutils literal notranslate"><span class="pre">n</span></code> is prime, we can simply check for factors.  This yields the following primality test.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">is_prime</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Checks whether the argument n is a prime number.</span>
<span class="sd">    Uses a brute force search for factors between 1 and n.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>  <span class="c1"># the range of numbers 2,3,...,n-1.</span>
        <span class="k">if</span> <span class="n">n</span><span class="o">%</span><span class="k">j</span> == 0:  # is n divisible by j?
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is a factor of </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
<p>We can also implement this test with a <strong>while loop</strong> instead of a for loop.  This doesn’t make much of a difference, in Python 3.x.  (In Python 2.x, this would save memory).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">is_prime</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Checks whether the argument n is a prime number.</span>
<span class="sd">    Uses a brute force search for factors between 1 and n.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">j</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>  <span class="c1"># j will proceed through the list of numbers 2,3,...,n-1.</span>
        <span class="k">if</span> <span class="n">n</span><span class="o">%</span><span class="k">j</span> == 0:  # is n divisible by j?
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is a factor of </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># There&#39;s a Python abbreviation for this:  j += 1.</span>
    <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">is_prime</span><span class="p">(</span><span class="mi">10001</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">is_prime</span><span class="p">(</span><span class="mi">101</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>If <span class="math notranslate nohighlight">\(n\)</span> is a prime number, then the <code class="docutils literal notranslate"><span class="pre">is_prime(n)</span></code> function will iterate through all the numbers between <span class="math notranslate nohighlight">\(2\)</span> and <span class="math notranslate nohighlight">\(n-1\)</span>.  But this is overkill!  Indeed, if <span class="math notranslate nohighlight">\(n\)</span> is not prime, it will have a factor between <span class="math notranslate nohighlight">\(2\)</span> and the square root of <span class="math notranslate nohighlight">\(n\)</span>.  This is because factors come in pairs:  if <span class="math notranslate nohighlight">\(ab = n\)</span>, then one of the factors, <span class="math notranslate nohighlight">\(a\)</span> or <span class="math notranslate nohighlight">\(b\)</span>, must be less than or equal to the square root of <span class="math notranslate nohighlight">\(n\)</span>.  So it suffices to search for factors up to (and including) the square root of <span class="math notranslate nohighlight">\(n\)</span>.</p>
<p>We haven’t worked with square roots in Python yet.  But Python comes with a <a class="reference external" href="https://docs.python.org/2/library/math.html">standard math package</a> which enables square roots, trig functions, logs, and more.  Click the previous link for documentation.  This package doesn’t load automatically when you start Python, so you have to load it with a little Python code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">sqrt</span>
</pre></div>
</div>
</div>
</div>
<p>This command <strong>imports</strong> the square root function (<code class="docutils literal notranslate"><span class="pre">sqrt</span></code>) from the <strong>package</strong> called <code class="docutils literal notranslate"><span class="pre">math</span></code>.  Now you can find square roots.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>There are a few different ways to import functions from packages.  The above syntax is a good starting point, but sometimes problems can arise if different packages have functions with the same name.  Here are a few methods of importing the <code class="docutils literal notranslate"><span class="pre">sqrt</span></code> function and how they differ.</p>
<p><code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">math</span> <span class="pre">import</span> <span class="pre">sqrt</span></code>:  After this command, <code class="docutils literal notranslate"><span class="pre">sqrt</span></code> will refer to the function from the <code class="docutils literal notranslate"><span class="pre">math</span></code> package (overriding any previous definition).</p>
<p><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">math</span></code>:  After this command, all the functions from the <code class="docutils literal notranslate"><span class="pre">math</span></code> package will be imported.  But to call <code class="docutils literal notranslate"><span class="pre">sqrt</span></code>, you would type a command like <code class="docutils literal notranslate"><span class="pre">math.sqrt(1000)</span></code>.  This is convenient if there are potential conflicts with other packages.</p>
<p><code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">math</span> <span class="pre">import</span> <span class="pre">*</span></code>:  After this command, all the functions from the <code class="docutils literal notranslate"><span class="pre">math</span></code> package will be imported.  To call them, you can access them directly with a command like <code class="docutils literal notranslate"><span class="pre">sqrt(1000)</span></code>.  This can easily cause conflicts with other packages, since packages can have hundreds of functions in them!</p>
<p><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">math</span> <span class="pre">as</span> <span class="pre">mth</span></code>:  Some people like abbreviations.  This imports all the functions from the <code class="docutils literal notranslate"><span class="pre">math</span></code> package.  To call one, you type a command like <code class="docutils literal notranslate"><span class="pre">mth.sqrt(1000)</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">factorial</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># This will cause an error!</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">math</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># This is ok, since the math package comes with a function called factorial.</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s improve our <code class="docutils literal notranslate"><span class="pre">is_prime(n)</span></code> function by searching for factors only up to the square root of the number <code class="docutils literal notranslate"><span class="pre">n</span></code>.  We consider two options.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">is_prime_slow</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Checks whether the argument n is a prime number.</span>
<span class="sd">    Uses a brute force search for factors between 1 and n.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">j</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>  <span class="c1"># j will proceed through the list of numbers 2,3,... up to sqrt(n).</span>
        <span class="k">if</span> <span class="n">n</span><span class="o">%</span><span class="k">j</span> == 0:  # is n divisible by j?
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is a factor of </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># There&#39;s a Python abbreviation for this:  j += 1.</span>
    <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">is_prime_fast</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Checks whether the argument n is a prime number.</span>
<span class="sd">    Uses a brute force search for factors between 1 and n.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">j</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">root_n</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">root_n</span><span class="p">:</span>  <span class="c1"># j will proceed through the list of numbers 2,3,... up to sqrt(n).</span>
        <span class="k">if</span> <span class="n">n</span><span class="o">%</span><span class="k">j</span> == 0:  # is n divisible by j?
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is a factor of </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># There&#39;s a Python abbreviation for this:  j += 1.</span>
    <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">is_prime_fast</span><span class="p">(</span><span class="mi">1000003</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">is_prime_slow</span><span class="p">(</span><span class="mi">1000003</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>I’ve chosen function names with “fast” and “slow” in them.  But what makes them faster or slower?  Are they faster than the original?  And how can we tell?</p>
<p>Python comes with a great set of tools for these questions.  The simplest (for the user) are the time utilities.  By placing the <strong>magic</strong> <code class="docutils literal notranslate"><span class="pre">%timeit</span></code> before a command, Python does something like the following:</p>
<ol class="arabic simple">
<li><p>Python makes a little container in your computer devoted to the computations, to avoid interference from other running programs if possible.</p></li>
<li><p>Python executes the command lots and lots of times.</p></li>
<li><p>Python averages the amount of time taken for each execution.</p></li>
</ol>
<p>Give it a try below, to compare the speed of the functions <code class="docutils literal notranslate"><span class="pre">is_prime</span></code> (the original) with the new <code class="docutils literal notranslate"><span class="pre">is_prime_fast</span></code> and <code class="docutils literal notranslate"><span class="pre">is_prime_slow</span></code>.  Note that the <code class="docutils literal notranslate"><span class="pre">%timeit</span></code> commands might take a little while.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> is_prime_fast(1000003)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> is_prime_slow(1000003)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> is_prime(1000003)
</pre></div>
</div>
</div>
</div>
<p>Time is measured in seconds, milliseconds (1 ms = 1/1000 second), microseconds (1 µs = 1/1,000,000 second), and nanoseconds (1 ns = 1/1,000,000,000 second).  So it might appear at first that <code class="docutils literal notranslate"><span class="pre">is_prime</span></code> is the fastest, or about the same speed.  But check the units!  The other two approaches are about a thousand times faster!  How much faster were they on your computer?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">is_prime_fast</span><span class="p">(</span><span class="mi">10000000000037</span><span class="p">)</span>  <span class="c1"># Don&#39;t try this with `is_prime` unless you want to wait for a long time!</span>
</pre></div>
</div>
</div>
</div>
<p>Indeed, the <code class="docutils literal notranslate"><span class="pre">is_prime_fast(n)</span></code> function will go through a loop of length about <code class="docutils literal notranslate"><span class="pre">sqrt(n)</span></code> when <code class="docutils literal notranslate"><span class="pre">n</span></code> is prime.  But <code class="docutils literal notranslate"><span class="pre">is_prime(n)</span></code> will go through a loop of length about <code class="docutils literal notranslate"><span class="pre">n</span></code>.  Since <code class="docutils literal notranslate"><span class="pre">sqrt(n)</span></code> is much less than <code class="docutils literal notranslate"><span class="pre">n</span></code>, especially when <code class="docutils literal notranslate"><span class="pre">n</span></code> is large, the <code class="docutils literal notranslate"><span class="pre">is_prime_fast(n)</span></code> function is much faster.</p>
<p>Between <code class="docutils literal notranslate"><span class="pre">is_prime_fast</span></code> and <code class="docutils literal notranslate"><span class="pre">is_prime_slow</span></code>, the difference is that the <code class="docutils literal notranslate"><span class="pre">fast</span></code> version <strong>precomputes</strong> the square root <code class="docutils literal notranslate"><span class="pre">sqrt(n)</span></code> before going through the loop, where the <code class="docutils literal notranslate"><span class="pre">slow</span></code> version repeats the <code class="docutils literal notranslate"><span class="pre">sqrt(n)</span></code> every time the loop is repeated.  Indeed, writing <code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">j</span> <span class="pre">&lt;=</span> <span class="pre">sqrt(n):</span></code> suggests that Python might execute <code class="docutils literal notranslate"><span class="pre">sqrt(n)</span></code> every time to check.  This <em>might</em> lead to Python computing the same square root a million times… unnecessarily!</p>
<p>A basic principle of programming is to <strong>avoid repetition</strong>.  If you have the memory space, just compute once and store the result.  It will probably be faster to pull the result out of memory than to compute it again.</p>
<p>Python does tend to be pretty smart, however.  It’s possible that Python <strong>is precomputing</strong> <code class="docutils literal notranslate"><span class="pre">sqrt(n)</span></code> even in the slow loop, just because it’s clever enough to tell in advance that the same thing is being computed over and over again.  This depends on your Python version and takes place behind the scenes.  If you want to figure it out, there’s a whole set of tools (for advanced programmers) like the <a class="reference external" href="https://docs.python.org/2.7/library/dis.html">disassembler</a> to figure out what Python is doing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">is_prime_fast</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">14</span> <span class="o">+</span> <span class="mi">37</span><span class="p">)</span> <span class="c1"># This might get a bit of delay.</span>
</pre></div>
</div>
</div>
</div>
<p>Now we have a function <code class="docutils literal notranslate"><span class="pre">is_prime_fast(n)</span></code> that is speedy for numbers <code class="docutils literal notranslate"><span class="pre">n</span></code> in the trillions!  You’ll probably start to hit a delay around <span class="math notranslate nohighlight">\(10^{15}\)</span> or so, and the delays will become intolerable if you add too many more digits.  In a future lesson, we will see a different primality test that will be essentially instant even for numbers around <span class="math notranslate nohighlight">\(10^{1000}\)</span>!</p>
<section id="id11">
<h3>Exercises<a class="headerlink" href="#id11" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>To check whether a number <code class="docutils literal notranslate"><span class="pre">n</span></code> is prime, you can first check whether <code class="docutils literal notranslate"><span class="pre">n</span></code> is even, and then check whether <code class="docutils literal notranslate"><span class="pre">n</span></code> has any odd factors.  Change the <code class="docutils literal notranslate"><span class="pre">is_prime_fast</span></code> function by implementing this improvement.  How much of a speedup did you get?</p></li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">%timeit</span></code> tool to study the speed of <code class="docutils literal notranslate"><span class="pre">is_prime_fast</span></code> for various sizes of <code class="docutils literal notranslate"><span class="pre">n</span></code>.  Using 10-20 data points, make a graph relating the size of <code class="docutils literal notranslate"><span class="pre">n</span></code> to the time taken by the <code class="docutils literal notranslate"><span class="pre">is_prime_fast</span></code> function.</p></li>
<li><p>Write a function <code class="docutils literal notranslate"><span class="pre">is_square(n)</span></code> to test whether a given integer <code class="docutils literal notranslate"><span class="pre">n</span></code> is a perfect square (like 0, 1, 4, 9, 16, etc.).  How fast can you make it run?  Describe the different approaches you try and which are fastest.</p></li>
</ol>
<p><a id='lists'></a></p>
</section>
</section>
<section id="list-manipulation">
<h2>List manipulation<a class="headerlink" href="#list-manipulation" title="Link to this heading">#</a></h2>
<p>We have already (briefly) encountered the <code class="docutils literal notranslate"><span class="pre">list</span></code> type in Python.  Recall that the <code class="docutils literal notranslate"><span class="pre">range</span></code> command produces a range, which can be used to produce a list.  For example, <code class="docutils literal notranslate"><span class="pre">list(range(10))</span></code> produces the list <code class="docutils literal notranslate"><span class="pre">[0,1,2,3,4,5,6,7,8,9]</span></code>.  You can also create your own list by a writing out its terms, e.g. <code class="docutils literal notranslate"><span class="pre">L</span> <span class="pre">=</span> <span class="pre">[4,7,10]</span></code>.</p>
<p>Here we work with lists, and a very Pythonic approach to list manipulation.  With practice, this can be a powerful tool to write fast algorithms, exploiting the hard-wired capability of your computer to shift and slice large chunks of data.  Our application will be to implement the Sieve of Eratosthenes, producing a long list of prime numbers (without using any <code class="docutils literal notranslate"><span class="pre">is_prime</span></code> test along the way).</p>
<p>We begin by creating two lists to play with.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;one&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;three&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;five&#39;</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;seven&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="s1">&#39;nine&#39;</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<section id="list-terms-and-indices">
<h3>List terms and indices<a class="headerlink" href="#list-terms-and-indices" title="Link to this heading">#</a></h3>
<p>Notice that the entries in a list can be of any type.  The above list <code class="docutils literal notranslate"><span class="pre">L</span></code> has some integer entries and some string entries.  Lists are <strong>ordered</strong> in Python, <strong>starting at zero</strong>.  One can access the <span class="math notranslate nohighlight">\(n^{th}\)</span> entry in a list with a command like <code class="docutils literal notranslate"><span class="pre">L[n]</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>  <span class="c1"># Note that Python has slightly different approaches to the print-function, and the output above.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>  <span class="c1"># We will use the print function, because it makes our printing intentions clear.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>The location of an entry is called its <strong>index</strong>.  So <em>at</em> the index 3, the list <code class="docutils literal notranslate"><span class="pre">L</span></code> stores the entry <code class="docutils literal notranslate"><span class="pre">three</span></code>.  Note that the same entry can occur in many places in a list.  E.g. <code class="docutils literal notranslate"><span class="pre">[7,7,7]</span></code> is a list with 7 at the zeroth, first, and second index.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>The last bit of code demonstrates a cool Python trick.  The “-1st” entry in a list refers to the last entry. The “-2nd entry” refers to the second-to-last entry, and so on.  It gives a convenient way to access both sides of the list, even if you don’t know how long it is.</p>
<p>Of course, you can use Python to find out how long a list is.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>You can also use Python to find the sum of a list of numbers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">sum</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">sum</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>  <span class="c1"># Be careful.  This is the sum of which numbers?  # The sum function can take lists or ranges.</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="list-slicing">
<h3>List slicing<a class="headerlink" href="#list-slicing" title="Link to this heading">#</a></h3>
<p><strong>Slicing</strong> lists allows us to create new lists (or ranges) from old lists (or ranges), by chopping off one end or the other, or even slicing out entries at a fixed interval.  The simplest syntax has the form <code class="docutils literal notranslate"><span class="pre">L[a:b]</span></code> where <code class="docutils literal notranslate"><span class="pre">a</span></code> denotes the index of the starting entry and index of the final entry is one less than <code class="docutils literal notranslate"><span class="pre">b</span></code>.  It is best to try a few examples to get a feel for it.</p>
<p>Slicing a list with a command like <code class="docutils literal notranslate"><span class="pre">L[a:b]</span></code> doesn’t actually <em>change</em> the original list <code class="docutils literal notranslate"><span class="pre">L</span></code>.  It just extracts some terms from the list and outputs those terms.  Soon enough, we will change the list <code class="docutils literal notranslate"><span class="pre">L</span></code> using a list assignment.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">11</span><span class="p">]</span>  <span class="c1"># Notice that L[0:5] and L[5:11] together recover the whole list.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>This continues the strange (for beginners) Python convention of starting at the first number and ending just before the last number.  Compare to <code class="docutils literal notranslate"><span class="pre">range(3,7)</span></code>, for example.</p>
<p>The command <code class="docutils literal notranslate"><span class="pre">L[0:5]</span></code> can be replaced by <code class="docutils literal notranslate"><span class="pre">L[:5]</span></code> to abbreviate.  The empty opening index tells Python to start at the beginning.  Similarly, the command <code class="docutils literal notranslate"><span class="pre">L[5:11]</span></code> can be replaced by <code class="docutils literal notranslate"><span class="pre">L[5:]</span></code>.  The empty closing index tells Python to end the slice and the end.  This is helpful if one doesn’t know where the list ends.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
</pre></div>
</div>
</div>
</div>
<p>Just like the <code class="docutils literal notranslate"><span class="pre">range</span></code> command, list slicing can take an optional third argument to give a step size.  To understand this, try the command below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>If, in this three-argument syntax, the first or second argument is absent, then the slice starts at the beginning of the list or ends at the end of the list accordingly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span>  <span class="c1"># Just a reminder.  We haven&#39;t modified the original list!</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[:</span><span class="mi">9</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># Start at zero, go up to (but not including) 9, by steps of 3.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="c1"># Start at two, go up through the end of the list, by steps of 3.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[::</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># Start at zero, go up through the end of the list, by steps of 3.</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="changing-list-slices">
<h3>Changing list slices<a class="headerlink" href="#changing-list-slices" title="Link to this heading">#</a></h3>
<p>Not only can we extract and study terms or slices of a list, we can change them by assignment.  The simplest case would be changing a single term of a list.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="c1"># Start with the list L.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Bacon!&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>  <span class="c1"># What do you think L is now?</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">2</span><span class="p">::</span><span class="mi">3</span><span class="p">])</span> <span class="c1"># What do you think this will do?</span>
</pre></div>
</div>
</div>
</div>
<p>We can change an entire slice of a list with a single assignment.  Let’s change the first two terms of <code class="docutils literal notranslate"><span class="pre">L</span></code> in one line.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Pancakes&#39;</span><span class="p">,</span> <span class="s1">&#39;Ham&#39;</span><span class="p">]</span>  <span class="c1"># What was L[:2] before?</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="c1"># Oh... what have we done!</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>We can change a slice of a list with a single assignment, even when that slice does not consist of consecutive terms.  Try to predict what the following commands will do.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>  <span class="c1"># Let&#39;s see what the list looks like before.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">]</span>  <span class="c1"># What was L[::2] before this assignment? </span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>  <span class="c1"># What do you predict?</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id12">
<h3>Exercises<a class="headerlink" href="#id12" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Create a list L with L = [1,2,3,…,100] (all the numbers from 1 to 100).  What is L[50]?</p></li>
<li><p>Take the same list L, and extract a slice of the form [5,10,15,…,95] with a command of the form L[a:b:c].</p></li>
<li><p>Take the same list L, and change all the even numbers to zeros, so that L looks like [1,0,3,0,5,0,…,99,0].  Hint:  You might wish to use the list [0]*50.</p></li>
<li><p>Try the command <code class="docutils literal notranslate"><span class="pre">L[-1::-1]</span></code> on a list.  What does it do?  Can you guess before executing it?  Can you understand why?  In fact, strings are lists too.  Try setting <code class="docutils literal notranslate"><span class="pre">L</span> <span class="pre">=</span> <span class="pre">'Hello'</span></code> and the previous command.</p></li>
</ol>
<p><a id='sieve'></a></p>
</section>
</section>
<section id="sieve-of-eratosthenes">
<h2>Sieve of Eratosthenes<a class="headerlink" href="#sieve-of-eratosthenes" title="Link to this heading">#</a></h2>
<p>The <strong>Sieve of Eratosthenes</strong> (hereafter called “the sieve”) is a very fast way of producing long lists of primes, without doing repeated primality checking.  It is described in more detail in Chapter 2 of <a class="reference external" href="http://bookstore.ams.org/mbk-105">An Illustrated Theory of Numbers</a>.  The basic idea is to start with all of the natural numbers, and successively filter out, or <a class="reference external" href="https://en.wikipedia.org/wiki/Sieve"><strong>sieve</strong></a>, the multiples of 2, then the multiples of 3, then the multiples of 5, etc., until only primes are left.</p>
<p>Using list slicing, we can carry out this sieving process efficiently.  And with a few more tricks we encounter here, we can carry out the Sieve <strong>very</strong> efficiently.</p>
<section id="the-basic-sieve">
<h3>The basic sieve<a class="headerlink" href="#the-basic-sieve" title="Link to this heading">#</a></h3>
<p>The first approach we introduce is a bit naive, but is a good starting place.  We will begin with a list of numbers up to 100, and sieve out the appropriate multiples of 2,3,5,7.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">primes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span> <span class="c1"># Let&#39;s start with the numbers 0...99.</span>
</pre></div>
</div>
</div>
</div>
<p>Now, to “filter”, i.e., to say that a number is <em>not</em> prime, let’s just change the number to the value <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">primes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Zero is not prime.</span>
<span class="n">primes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># One is not prime.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">primes</span><span class="p">)</span> <span class="c1"># What have we done?</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s filter out the multiples of 2, starting at 4.  This is the slice <code class="docutils literal notranslate"><span class="pre">primes[4::2]</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">primes</span><span class="p">[</span><span class="mi">4</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">primes</span><span class="p">[</span><span class="mi">4</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>  <span class="c1"># The right side is a list of Nones, of the necessary length.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">primes</span><span class="p">)</span> <span class="c1"># What have we done?</span>
</pre></div>
</div>
</div>
</div>
<p>Now we filter out the multiples of 3, starting at 9.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">primes</span><span class="p">[</span><span class="mi">9</span><span class="p">::</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">primes</span><span class="p">[</span><span class="mi">9</span><span class="p">::</span><span class="mi">3</span><span class="p">])</span>  <span class="c1"># The right side is a list of Nones, of the necessary length.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">primes</span><span class="p">)</span> <span class="c1"># What have we done?</span>
</pre></div>
</div>
</div>
</div>
<p>Next the multiples of 5, starting at 25 (the first multiple of 5 greater than 5 that’s left!)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">primes</span><span class="p">[</span><span class="mi">25</span><span class="p">::</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">primes</span><span class="p">[</span><span class="mi">25</span><span class="p">::</span><span class="mi">5</span><span class="p">])</span>  <span class="c1"># The right side is a list of Nones, of the necessary length.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">primes</span><span class="p">)</span> <span class="c1"># What have we done?</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, the multiples of 7, starting at 49 (the first multiple of 7 greater than 7 that’s left!)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">primes</span><span class="p">[</span><span class="mi">49</span><span class="p">::</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">primes</span><span class="p">[</span><span class="mi">49</span><span class="p">::</span><span class="mi">7</span><span class="p">])</span>  <span class="c1"># The right side is a list of Nones, of the necessary length.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">primes</span><span class="p">)</span> <span class="c1"># What have we done?</span>
</pre></div>
</div>
</div>
</div>
<p>What’s left?  A lot of <code class="docutils literal notranslate"><span class="pre">None</span></code>s and the prime numbers up to 100.  We have successfully sieved out all the nonprime numbers in the list, using just four sieving steps (and setting 0 and 1 to <code class="docutils literal notranslate"><span class="pre">None</span></code> manually).</p>
<p>But there’s a lot of room for improvement, from beginning to end!</p>
<ol class="arabic simple">
<li><p>The format of the end result is not so nice.</p></li>
<li><p>We had to sieve each step manually.  It would be much better to have a function <code class="docutils literal notranslate"><span class="pre">prime_list(n)</span></code> which would output a list of primes up to <code class="docutils literal notranslate"><span class="pre">n</span></code> without so much supervision.</p></li>
<li><p>The memory usage will be large, if we need to store all the numbers up to a large <code class="docutils literal notranslate"><span class="pre">n</span></code> at the beginning.</p></li>
</ol>
<p>We solve these problems in the following way.</p>
<ol class="arabic simple">
<li><p>We will use a list of <strong>booleans</strong> rather than a list of numbers.  The ending list will have a <code class="docutils literal notranslate"><span class="pre">True</span></code> value at prime indices and a <code class="docutils literal notranslate"><span class="pre">False</span></code> value at composite indices.  This reduces the memory usage and increases the speed.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">which</span></code> function (explained soon) will make the desired list of primes after everything else is done.</p></li>
<li><p>We will proceed through the sieving steps algorithmically rather than entering each step manually.</p></li>
</ol>
<p>Here is a somewhat efficient implementation of the Sieve in Python.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">isprime_list</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">    Return a list of length n+1</span>
<span class="sd">    with Trues at prime indices and Falses at composite indices.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">flags</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># A list [True, True, True,...] to start.</span>
    <span class="n">flags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Zero is not prime.  So its flag is set to False.</span>
    <span class="n">flags</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># One is not prime.  So its flag is set to False.</span>
    <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># The first prime is 2.  And we start sieving by multiples of 2.</span>
    
    <span class="k">while</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>  <span class="c1"># We only need to sieve by p is p &lt;= sqrt(n).</span>
        <span class="k">if</span> <span class="n">flags</span><span class="p">[</span><span class="n">p</span><span class="p">]:</span>  <span class="c1"># We sieve the multiples of p if flags[p]=True.</span>
            <span class="n">flags</span><span class="p">[</span><span class="n">p</span><span class="o">*</span><span class="n">p</span><span class="p">::</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">flags</span><span class="p">[</span><span class="n">p</span><span class="o">*</span><span class="n">p</span><span class="p">::</span><span class="n">p</span><span class="p">])</span> <span class="c1"># Sieves out multiples of p, starting at p*p.</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># Try the next value of p.</span>
        
    <span class="k">return</span> <span class="n">flags</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">isprime_list</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>If you look carefully at the list of booleans, you will notice a <code class="docutils literal notranslate"><span class="pre">True</span></code> value at the 2nd index, the 3rd index, the 5th index, the 7th index, etc..  The indices where the values are <code class="docutils literal notranslate"><span class="pre">True</span></code> are precisely the <strong>prime</strong> indices.  Since booleans take the smallest amount of memory of any data type (one <strong>bit</strong> of memory per boolean), your computer can carry out the <code class="docutils literal notranslate"><span class="pre">isprime_list(n)</span></code> function even when <code class="docutils literal notranslate"><span class="pre">n</span></code> is very large.</p>
<p>To be more precise, there are 8 bits in a <strong>byte</strong>.  There are 1024 bytes (about 1000) in a kilobyte.  There are 1024 kilobytes in a megabyte.  There are 1024 megabytes in a gigabyte.  Therefore, a gigabyte of memory is enough to store about 8 billion bits.  That’s enough to store the result of <code class="docutils literal notranslate"><span class="pre">isprime_list(n)</span></code> when <code class="docutils literal notranslate"><span class="pre">n</span></code> is about 8 billion.  Not bad!  And your computer probably has 4 or 8 or 12 or 16 gigabytes of memory to use.</p>
<p>To transform the list of booleans into a list of prime numbers, we create a function called <code class="docutils literal notranslate"><span class="pre">where</span></code>.  This function uses another Python technique called <strong>list comprehension</strong>.  We discuss this technique later in this lesson, so just use the <code class="docutils literal notranslate"><span class="pre">where</span></code> function as a tool for now, or <a class="reference external" href="https://docs.python.org/2/tutorial/datastructures.html#list-comprehensions">read about list comprehension</a> if you’re curious.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">where</span><span class="p">(</span><span class="n">L</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Take a list of booleans as input and</span>
<span class="sd">    outputs the list of indices where True occurs.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">))</span> <span class="k">if</span> <span class="n">L</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span>
    
</pre></div>
</div>
</div>
</div>
<p>Combined with the <code class="docutils literal notranslate"><span class="pre">isprime_list</span></code> function, we can produce long lists of primes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">where</span><span class="p">(</span><span class="n">isprime_list</span><span class="p">(</span><span class="mi">100</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s push it a bit further.  How many primes are there between 1 and 1 million?  We can figure this out in three steps:</p>
<ol class="arabic simple">
<li><p>Create the isprime_list.</p></li>
<li><p>Use where to get the list of primes.</p></li>
<li><p>Find the length of the list of primes.</p></li>
</ol>
<p>But it’s better to do it in two steps.</p>
<ol class="arabic simple">
<li><p>Create the isprime_list.</p></li>
<li><p>Sum the list!  (Note that <code class="docutils literal notranslate"><span class="pre">True</span></code> is 1, for the purpose of summation!)</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">sum</span><span class="p">(</span><span class="n">isprime_list</span><span class="p">(</span><span class="mi">1000000</span><span class="p">))</span>  <span class="c1"># The number of primes up to a million!</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> isprime_list(10**6)  # 1000 ms = 1 second.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> sum(isprime_list(10**6))
</pre></div>
</div>
</div>
</div>
<p>This isn’t too bad!  It takes a fraction of a second to identify the primes up to a million, and a smaller fraction of a second to count them!  But we can do a little better.</p>
<p>The first improvement is to take care of the even numbers first.  If we count carefully, then the sequence 4,6,8,…,n (ending at n-1 if n is odd) has the floor of (n-2)/2 terms.  Thus the line <code class="docutils literal notranslate"><span class="pre">flags[4::2]</span> <span class="pre">=</span> <span class="pre">[False]</span> <span class="pre">*</span> <span class="pre">((n-2)//2)</span></code> will set all the flags to False in the sequence 4,6,8,10,…  From there, we can begin sieving by <em>odd</em> primes starting with 3.</p>
<p>The next improvement is that, since we’ve already sieved out all the even numbers (except 2), we don’t have to sieve out again by <em>even multiples</em>.  So when sieving by multiples of 3, we don’t have to sieve out 9,12,15,18,21,etc..  We can just sieve out 9,15,21,etc..  When <code class="docutils literal notranslate"><span class="pre">p</span></code> is an odd prime, this can be taken care of with the code <code class="docutils literal notranslate"><span class="pre">flags[p*p::2*p]</span> <span class="pre">=</span> <span class="pre">[False]</span> <span class="pre">*</span> <span class="pre">len(flags[p*p::2*p])</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">isprime_list</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">    Return a list of length n+1</span>
<span class="sd">    with Trues at prime indices and Falses at composite indices.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">flags</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># A list [True, True, True,...] to start.</span>
    <span class="n">flags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Zero is not prime.  So its flag is set to False.</span>
    <span class="n">flags</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># One is not prime.  So its flag is set to False.</span>
    <span class="n">flags</span><span class="p">[</span><span class="mi">4</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">((</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">while</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>  <span class="c1"># We only need to sieve by p is p &lt;= sqrt(n).</span>
        <span class="k">if</span> <span class="n">flags</span><span class="p">[</span><span class="n">p</span><span class="p">]:</span>  <span class="c1"># We sieve the multiples of p if flags[p]=True.</span>
            <span class="n">flags</span><span class="p">[</span><span class="n">p</span><span class="o">*</span><span class="n">p</span><span class="p">::</span><span class="mi">2</span><span class="o">*</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">flags</span><span class="p">[</span><span class="n">p</span><span class="o">*</span><span class="n">p</span><span class="p">::</span><span class="mi">2</span><span class="o">*</span><span class="n">p</span><span class="p">])</span> <span class="c1"># Sieves out multiples of p, starting at p*p.</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="mi">2</span> <span class="c1"># Try the next value of p.  Note that we can proceed only through odd p!</span>
        
    <span class="k">return</span> <span class="n">flags</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> sum(isprime_list(10**6))  # How much did this speed it up?
</pre></div>
</div>
</div>
</div>
<p>Another modest improvement is the following.  In the code above, the program <em>counts</em> the terms in sequences like 9,15,21,27,…, in order to set them to <code class="docutils literal notranslate"><span class="pre">False</span></code>.  This is accomplished with the length command <code class="docutils literal notranslate"><span class="pre">len(flags[p*p::2*p])</span></code>.  But that length computation is a bit too intensive.  A bit of algebraic work shows that the length is given formulaically in terms of <code class="docutils literal notranslate"><span class="pre">p</span></code> and <code class="docutils literal notranslate"><span class="pre">n</span></code> by the formula:</p>
<div class="math notranslate nohighlight">
\[len = \lfloor \frac{n - p^2 - 1}{2p} \rfloor + 1\]</div>
<p>(Here <span class="math notranslate nohighlight">\(\lfloor x \rfloor\)</span> denotes the floor function, i.e., the result of rounding down.)  Putting this into the code yields the following.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">isprime_list</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">    Return a list of length n+1</span>
<span class="sd">    with Trues at prime indices and Falses at composite indices.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">flags</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># A list [True, True, True,...] to start.</span>
    <span class="n">flags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Zero is not prime.  So its flag is set to False.</span>
    <span class="n">flags</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># One is not prime.  So its flag is set to False.</span>
    <span class="n">flags</span><span class="p">[</span><span class="mi">4</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">((</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">while</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>  <span class="c1"># We only need to sieve by p is p &lt;= sqrt(n).</span>
        <span class="k">if</span> <span class="n">flags</span><span class="p">[</span><span class="n">p</span><span class="p">]:</span>  <span class="c1"># We sieve the multiples of p if flags[p]=True.</span>
            <span class="n">flags</span><span class="p">[</span><span class="n">p</span><span class="o">*</span><span class="n">p</span><span class="p">::</span><span class="mi">2</span><span class="o">*</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">((</span><span class="n">n</span><span class="o">-</span><span class="n">p</span><span class="o">*</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">p</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Sieves out multiples of p, starting at p*p.</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="mi">2</span> <span class="c1"># Try the next value of p.</span>
        
    <span class="k">return</span> <span class="n">flags</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> sum(isprime_list(10**6))  # How much did this speed it up?
</pre></div>
</div>
</div>
</div>
<p>That should be pretty fast!  It should be under 100 ms (one tenth of one second!) to determine the primes up to a million, and on a newer computer it should be under 50ms.  We have gotten pretty close to the fastest algorithms that you can find in Python, without using external packages (like SAGE or sympy).  See the related <a class="reference external" href="https://stackoverflow.com/questions/2068372/fastest-way-to-list-all-primes-below-n">discussion on StackOverflow</a>… the code in this lesson was influenced by the code presented there.</p>
</section>
<section id="id13">
<h3>Exercises<a class="headerlink" href="#id13" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Prove that the length of <code class="docutils literal notranslate"><span class="pre">range(p*p,</span> <span class="pre">n,</span> <span class="pre">2*p)</span></code> equals <span class="math notranslate nohighlight">\(\lfloor \frac{n - p^2 - 1}{2p} \rfloor + 1\)</span>.</p></li>
<li><p>A natural number <span class="math notranslate nohighlight">\(n\)</span> is called squarefree if it has no perfect square divides <span class="math notranslate nohighlight">\(n\)</span> except for 1.  Write a function <code class="docutils literal notranslate"><span class="pre">squarefree_list(n)</span></code> which outputs a list of booleans:  <code class="docutils literal notranslate"><span class="pre">True</span></code> if the index is squarefree and <code class="docutils literal notranslate"><span class="pre">False</span></code> if the index is not squarefree.  For example, if you execute <code class="docutils literal notranslate"><span class="pre">squarefree_list(12)</span></code>, the output should be <code class="docutils literal notranslate"><span class="pre">[False,</span> <span class="pre">True,</span> <span class="pre">True,</span> <span class="pre">True,</span> <span class="pre">False,</span> <span class="pre">True,</span> <span class="pre">True,</span> <span class="pre">True,</span> <span class="pre">False,</span> <span class="pre">False,</span> <span class="pre">True,</span> <span class="pre">True,</span> <span class="pre">False]</span></code>.  Note that the <code class="docutils literal notranslate"><span class="pre">False</span></code> entries are located the indices 0, 4, 8, 9, 12.  These natural numbers have perfect square divisors besides 1.</p></li>
<li><p>Your DNA contains about 3 billion base pairs.  Each “base pair” can be thought of as a letter, A, T, G, or C.  How many bits would be required to store a single base pair?  In other words, how might you convert a sequence of booleans into a letter A,T,G, or C?  Given this, how many megabytes or gigabytes are required to store your DNA?  How many people’s DNA would fit on a thumb-drive?</p></li>
</ol>
<p><a id='analysis'></a></p>
</section>
</section>
<section id="data-analysis">
<h2>Data analysis<a class="headerlink" href="#data-analysis" title="Link to this heading">#</a></h2>
<p>Now that we can produce a list of prime numbers quickly, we can do some data analysis:  some experimental number theory to look for trends or patterns in the sequence of prime numbers.  Since Euclid (about 300 BCE), we have known that there are infinitely many prime numbers.  But how are they distributed?  What proportion of numbers are prime, and how does this proportion change over different ranges?  As theoretical questions, these belong the the field of analytic number theory.  But it is hard to know what to prove without doing a bit of experimentation.  And so, at least since Gauss <a class="reference external" href="http://www.ams.org/journals/bull/2006-43-01/S0273-0979-05-01096-7/S0273-0979-05-01096-7.pdf">(read Tschinkel’s article about Gauss’s tables)</a> started examining his extensive tables of prime numbers, mathematicians have been carrying out experimental number theory.</p>
<section id="analyzing-the-list-of-primes">
<h3>Analyzing the list of primes<a class="headerlink" href="#analyzing-the-list-of-primes" title="Link to this heading">#</a></h3>
<p>Let’s begin by creating our data set:  the prime numbers up to 1 million.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">primes</span> <span class="o">=</span> <span class="n">where</span><span class="p">(</span><span class="n">isprime_list</span><span class="p">(</span><span class="mi">1000000</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">primes</span><span class="p">)</span> <span class="c1"># Our population size.  A statistician might call it N.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">primes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># The last prime in our list, just before one million.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">primes</span><span class="p">)</span> <span class="c1"># What type is this data?</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">primes</span><span class="p">[:</span><span class="mi">100</span><span class="p">])</span> <span class="c1"># The first hundred prime numbers.</span>
</pre></div>
</div>
</div>
</div>
<p>To carry out serious analysis, we will use the method of <strong>list comprehension</strong> to place our population into “bins” for statistical analysis.  Our first type of list comprehension has the form <code class="docutils literal notranslate"><span class="pre">[x</span> <span class="pre">for</span> <span class="pre">x</span> <span class="pre">in</span> <span class="pre">LIST</span> <span class="pre">if</span> <span class="pre">CONDITION]</span></code>.  This produces the list of all elements of LIST satisfying CONDITION.  It is similar to list slicing, except we pull out terms from the list according to whether a condition is true or false.</p>
<p>For example, let’s divide the (odd) primes into two classes.  Red primes will be those of the form 4n+1.  Blue primes will be those of the form 4n+3.  In other words, a prime <code class="docutils literal notranslate"><span class="pre">p</span></code> is red if <code class="docutils literal notranslate"><span class="pre">p%4</span> <span class="pre">==</span> <span class="pre">1</span></code> and blue if <code class="docutils literal notranslate"><span class="pre">p%4</span> <span class="pre">==</span> <span class="pre">3</span></code>.  And the prime 2 is neither red nor blue.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">redprimes</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">primes</span> <span class="k">if</span> <span class="n">p</span><span class="o">%</span><span class="k">4</span> == 1] # Note the [x for x in LIST if CONDITION] syntax.
<span class="n">blueprimes</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">primes</span> <span class="k">if</span> <span class="n">p</span><span class="o">%</span><span class="k">4</span> == 3]

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Red primes:&#39;</span><span class="p">,</span><span class="n">redprimes</span><span class="p">[:</span><span class="mi">20</span><span class="p">])</span> <span class="c1"># The first 20 red primes.</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Blue primes:&#39;</span><span class="p">,</span><span class="n">blueprimes</span><span class="p">[:</span><span class="mi">20</span><span class="p">])</span> <span class="c1"># The first 20 blue primes.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There are </span><span class="si">{}</span><span class="s2"> red primes and </span><span class="si">{}</span><span class="s2"> blue primes, up to 1 million.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">redprimes</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">blueprimes</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p>This is pretty close!  It seems like prime numbers are about evenly distributed between red and blue.  Their remainder after division by 4 is about as likely to be 1 as it is to be 3.  In fact, it is proven that <em>asymptotically</em> the ratio between the number of red primes and the number of blue primes approaches 1.  However, Chebyshev noticed a persistent slight bias towards blue primes along the way.</p>
<p>Some of the deepest conjectures in mathematics relate to the <a class="reference external" href="https://en.wikipedia.org/wiki/Prime-counting_function">prime counting function</a> <span class="math notranslate nohighlight">\(\pi(x)\)</span>.  Here <span class="math notranslate nohighlight">\(\pi(x)\)</span> is the <strong>number of primes</strong> between 1 and <span class="math notranslate nohighlight">\(x\)</span> (inclusive).  So <span class="math notranslate nohighlight">\(\pi(2) = 1\)</span> and <span class="math notranslate nohighlight">\(\pi(3) = 2\)</span> and <span class="math notranslate nohighlight">\(\pi(4) = 2\)</span> and <span class="math notranslate nohighlight">\(\pi(5) = 3\)</span>.  One can compute a value of <span class="math notranslate nohighlight">\(\pi(x)\)</span> pretty easily using a list comprehension.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">primes_upto</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">primes</span> <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">])</span> <span class="c1"># List comprehension recovers the primes up to x.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">primes_upto</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>  <span class="c1"># There are 168 primes between 1 and 1000.</span>
</pre></div>
</div>
</div>
</div>
<p>Now we graph the prime counting function.  To do this, we use a list comprehension, and the visualization library called matplotlib.  For graphing a function, the basic idea is to create a list of x-values, a list of corresponding y-values (so the lists have to be the same length!), and then we feed the two lists into matplotlib to make the graph.</p>
<p>We begin by loading the necessary packages.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span>  <span class="c1">#  A powerful graphics package.</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>  <span class="c1">#  A math package</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>  <span class="c1"># A plotting subpackage in matplotlib.</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s graph the function <span class="math notranslate nohighlight">\(y = x^2\)</span> over the domain <span class="math notranslate nohighlight">\(-2 \leq x \leq 2\)</span> for practice.  As a first step, we use numpy’s <code class="docutils literal notranslate"><span class="pre">linspace</span></code> function to create an evenly spaced set of 11 x-values between -2 and 2.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_values</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span>  <span class="c1"># The argument 11 is the *number* of terms, not the step size!</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x_values</span><span class="p">)</span>
<span class="nb">type</span><span class="p">(</span><span class="n">x_values</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>You might notice that the format looks a bit different from a list.  Indeed, if you check <code class="docutils literal notranslate"><span class="pre">type(x_values)</span></code>, it’s not a list but something else called a numpy array.  Numpy is a package that excels with computations on large arrays of data.  On the surface, it’s not so different from a list.  The <code class="docutils literal notranslate"><span class="pre">numpy.linspace</span></code> command is a convenient way of producing an evenly spaced list of inputs.</p>
<p>The big difference is that operations on numpy arrays are interpreted differently than operations on ordinary Python lists.  Try the two commands for comparison.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_values</span> <span class="o">+</span> <span class="n">x_values</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_values</span> <span class="o">=</span> <span class="n">x_values</span> <span class="o">*</span> <span class="n">x_values</span>  <span class="c1"># How is multiplication interpreted on numpy arrays?</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_values</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we use matplotlib to create a simple line graph.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">y_values</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;The graph of $y = x^2$&#39;</span><span class="p">)</span>  <span class="c1"># The dollar signs surround the formula, in LaTeX format.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s analyze the graphing code a bit more.  See the <a class="reference external" href="https://matplotlib.org/users/pyplot_tutorial.html">official pyplot tutorial</a> for more details.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">y_values</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;The graph of $y = x^2$&#39;</span><span class="p">)</span>  <span class="c1"># The dollar signs surround the formula, in LaTeX format.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>The first line contains the <strong>magic</strong> <code class="docutils literal notranslate"><span class="pre">%matplotlib</span> <span class="pre">inline</span></code>.  We have seen a magic word before, in <code class="docutils literal notranslate"><span class="pre">%timeit</span></code>.  <a class="reference external" href="http://ipython.readthedocs.io/en/stable/interactive/magics.html">Magic words</a> can call another program to assist.  So here, the magic <code class="docutils literal notranslate"><span class="pre">%matplotlib</span> <span class="pre">inline</span></code> calls matplotlib for help, and places the resulting figure within the notebook.</p>
<p>The next line <code class="docutils literal notranslate"><span class="pre">plt.plot(x_values,</span> <span class="pre">y_values)</span></code> creates a <code class="docutils literal notranslate"><span class="pre">plot</span> <span class="pre">object</span></code> based on the data of the x-values and y-values.  It is an abstract sort of object, behind the scenes, in a format that matplotlib understands.  The following lines set the title of the plot, the axis labels, and turns a grid on.  The last line <code class="docutils literal notranslate"><span class="pre">plt.show</span></code> renders the plot as an image in your notebook.  There’s an infinite variety of graphs that matplotlib can produce – see <a class="reference external" href="https://matplotlib.org/gallery.html">the gallery</a> for more!  Other graphics packages include <a class="reference external" href="http://bokeh.pydata.org/en/latest/">bokeh</a> and <a class="reference external" href="http://seaborn.pydata.org/">seaborn</a>, which extends matplotlib.</p>
</section>
<section id="analysis-of-the-prime-counting-function">
<h3>Analysis of the prime counting function<a class="headerlink" href="#analysis-of-the-prime-counting-function" title="Link to this heading">#</a></h3>
<p>Now, to analyze the prime counting function, let’s graph it.  To make a graph, we will first need a list of many values of x and many corresponding values of <span class="math notranslate nohighlight">\(\pi(x)\)</span>.  We do this with two commands.  The first might take a minute to compute.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_values</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1000000</span><span class="p">,</span><span class="mi">1001</span><span class="p">)</span> <span class="c1"># The numpy array [0,1000,2000,3000,...,1000000]</span>
<span class="n">pix_values</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">primes_upto</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_values</span><span class="p">])</span>  <span class="c1"># [FUNCTION(x) for x in LIST] syntax</span>
</pre></div>
</div>
</div>
</div>
<p>We created an array of x-values as before.  But the creation of an array of y-values (here, called <code class="docutils literal notranslate"><span class="pre">pix_values</span></code> to stand for <span class="math notranslate nohighlight">\(\pi(x)\)</span>) probably looks strange.  We have done two new things!</p>
<ol class="arabic simple">
<li><p>We have used a list comprehension <code class="docutils literal notranslate"><span class="pre">[primes_upto(x)</span> <span class="pre">for</span> <span class="pre">x</span> <span class="pre">in</span> <span class="pre">x_values]</span></code> to create a <strong>list</strong> of y-values.</p></li>
<li><p>We have used numpy.array(LIST) syntax to convert a Python list into a numpy array.</p></li>
</ol>
<p>First, we explain the list comprehension.  Instead of pulling out values of a list according to a condition, with <code class="docutils literal notranslate"><span class="pre">[x</span> <span class="pre">for</span> <span class="pre">x</span> <span class="pre">in</span> <span class="pre">LIST</span> <span class="pre">if</span> <span class="pre">CONDITION]</span></code>, we have created a new list based on performing a function each element of a list.  The syntax, used above, is <code class="docutils literal notranslate"><span class="pre">[FUNCTION(x)</span> <span class="pre">for</span> <span class="pre">x</span> <span class="pre">in</span> <span class="pre">LIST]</span></code>.  These two methods of list comprehension can be combined, in fact.  The most general syntax for list comprehension is <code class="docutils literal notranslate"><span class="pre">[FUNCTION(x)</span> <span class="pre">for</span> <span class="pre">x</span> <span class="pre">in</span> <span class="pre">LIST</span> <span class="pre">if</span> <span class="pre">CONDITION]</span></code>.</p>
<p>Second, a list comprehension can be carried out on a numpy array, but the result is a plain Python list.  It will be better to have a numpy array instead for what follows, so we use the <code class="docutils literal notranslate"><span class="pre">numpy.array()</span></code> function to convert the list into a numpy array.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]))</span>  <span class="c1"># For example.</span>
</pre></div>
</div>
</div>
</div>
<p>Now we have two numpy arrays:  the array of x-values and the array of y-values.  We can make a plot with matplotlib.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">x_values</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">pix_values</span><span class="p">)</span>  <span class="c1"># These better be the same, or else matplotlib will be unhappy.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">pix_values</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;The prime counting function&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\pi(x)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>In this range, the prime counting function might look nearly linear.  But if you look closely, there’s a subtle downward bend.  This is more pronounced in smaller ranges.  For example, let’s look at the first 10 x-values and y-values only.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span> <span class="n">pix_values</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>  <span class="c1"># Look closer to 0.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;The prime counting function&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\pi(x)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>It still looks almost linear, but there’s a visible downward bend here.  How can we see this bend more clearly?  If the graph were linear, its equation would have the form <span class="math notranslate nohighlight">\(\pi(x) = mx\)</span> for some fixed slope <span class="math notranslate nohighlight">\(m\)</span> (since the graph <em>does</em> pass through the origin).  Therefore, the quantity <span class="math notranslate nohighlight">\(\pi(x)/x\)</span> would be <em>constant</em> if the graph were linear.</p>
<p>Hence, if we graph <span class="math notranslate nohighlight">\(\pi(x) / x\)</span> on the y-axis and <span class="math notranslate nohighlight">\(x\)</span> on the x-axis, and the result is nonconstant, then the function <span class="math notranslate nohighlight">\(\pi(x)\)</span> is nonlinear.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m_values</span> <span class="o">=</span> <span class="n">pix_values</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">/</span> <span class="n">x_values</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>  <span class="c1"># We start at 1, to avoid a division by zero error.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">m_values</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;The ratio $\pi(x) / x$ as $x$ varies.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\pi(x) / x$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>That is certainly not constant!  The decay of <span class="math notranslate nohighlight">\(\pi(x) / x\)</span> is not so different from <span class="math notranslate nohighlight">\(1 / \log(x)\)</span>, in fact.  To see this, let’s overlay the graphs.  We use the <code class="docutils literal notranslate"><span class="pre">numpy.log</span></code> function, which computes the natural logarithm of its input (and allows an entire array as input).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">m_values</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\pi(x)/x$&#39;</span><span class="p">)</span>  <span class="c1"># The same as the plot above.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_values</span><span class="p">[</span><span class="mi">1</span><span class="p">:]),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$1 / \log(x)$&#39;</span><span class="p">)</span>  <span class="c1"># Overlay the graph of 1 / log(x)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;The ratio of $\pi(x) / x$ as $x$ varies.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\pi(x) / x$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>  <span class="c1"># Turn on the legend.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The shape of the decay of <span class="math notranslate nohighlight">\(\pi(x) / x\)</span> is very close to <span class="math notranslate nohighlight">\(1 / \log(x)\)</span>, but it looks like there is an offset.  In fact, there is, and it is pretty close to <span class="math notranslate nohighlight">\(1 / \log(x)^2\)</span>.  And that is close, but again there’s another little offset, this time proportional to <span class="math notranslate nohighlight">\(2 / \log(x)^3\)</span>.  This goes on forever, if one wishes to approximate <span class="math notranslate nohighlight">\(\pi(x) / x\)</span> by an “asymptotic expansion” (not a good idea, it turns out).</p>
<p>The closeness of <span class="math notranslate nohighlight">\(\pi(x) / x\)</span> to <span class="math notranslate nohighlight">\(1 / \log(x)\)</span> is expressed in the <strong>prime number theorem</strong>:
$<span class="math notranslate nohighlight">\(\lim_{x \rightarrow \infty} \frac{\pi(x)}{x / \log(x)} = 1.\)</span>$</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_values</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">m_values</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_values</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>  <span class="p">)</span>  <span class="c1"># Should get closer to 1.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;The ratio $\pi(x) / (x / \log(x))$ approaches 1... slowly&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\pi(x) / (x / \log(x)) $&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">1.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Comparing the graph to the theoretical result, we find that the ratio <span class="math notranslate nohighlight">\(\pi(x) / (x / \log(x))\)</span> approaches <span class="math notranslate nohighlight">\(1\)</span> (the theoretical result) but very slowly (see the graph above!).</p>
<p>A much stronger result relates <span class="math notranslate nohighlight">\(\pi(x)\)</span> to the “logarithmic integral” <span class="math notranslate nohighlight">\(li(x)\)</span>.  The <a class="reference external" href="http://www.claymath.org/millennium-problems/riemann-hypothesis">Riemann hypothesis</a> is equivalent to the statement
$<span class="math notranslate nohighlight">\(\left\vert \pi(x) - li(x) \right\vert = O(\sqrt{x} \log(x)).\)</span><span class="math notranslate nohighlight">\(
In other words, the error if one approximates \)</span>\pi(x)<span class="math notranslate nohighlight">\( by \)</span>li(x)<span class="math notranslate nohighlight">\( is bounded by a constant times \)</span>\sqrt{x} \log(x)$.  The logarithmic integral function isn’t part of Python or numpy, but it is in the mpmath package.  If you have this package installed, then you can try the following.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">mpmath</span><span class="w"> </span><span class="kn">import</span> <span class="n">li</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">primes_upto</span><span class="p">(</span><span class="mi">1000000</span><span class="p">))</span>  <span class="c1"># The number of primes up to 1 million.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">li</span><span class="p">(</span><span class="mi">1000000</span><span class="p">))</span>  <span class="c1"># The logarithmic integral of 1 million.</span>
</pre></div>
</div>
</div>
</div>
<p>Not too shabby!</p>
</section>
<section id="prime-gaps">
<h3>Prime gaps<a class="headerlink" href="#prime-gaps" title="Link to this heading">#</a></h3>
<p>As a last bit of data analysis, we consider the <strong>prime gaps</strong>.  These are the numbers that occur as differences between consecutive primes.  Since all primes except 2 are odd, all prime gaps are even except for the 1-unit gap between 2 and 3.  There are many unsolved problems about prime gaps; the most famous might be that a gap of 2 occurs infinitely often (as in the gaps between 3,5 and between 11,13 and between 41,43, etc.).</p>
<p>Once we have our data set of prime numbers, it is not hard to create a data set of prime gaps.  Recall that <code class="docutils literal notranslate"><span class="pre">primes</span></code> is our list of prime numbers up to 1 million.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">primes</span><span class="p">)</span> <span class="c1"># The number of primes up to 1 million.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">primes_allbutlast</span> <span class="o">=</span> <span class="n">primes</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># This excludes the last prime in the list.</span>
<span class="n">primes_allbutfirst</span> <span class="o">=</span> <span class="n">primes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>  <span class="c1"># This excludes the first (i.e., with index 0) prime in the list.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">primegaps</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">primes_allbutfirst</span><span class="p">)</span> <span class="o">-</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">primes_allbutlast</span><span class="p">)</span> <span class="c1"># Numpy is fast!</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">primegaps</span><span class="p">[:</span><span class="mi">100</span><span class="p">])</span>  <span class="c1"># The first hundred prime gaps!</span>
</pre></div>
</div>
</div>
</div>
<p>What have we done?  It is useful to try out this method on a short list.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">20</span><span class="p">]</span>  <span class="c1"># A nice short list.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">L</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</pre></div>
</div>
</div>
</div>
<p>Now we have two lists of the same length.  The gaps in the original list <code class="docutils literal notranslate"><span class="pre">L</span></code> are the differences between terms of the <em>same</em> index in the two new lists.  One might be tempted to just subtract, e.g., with the command <code class="docutils literal notranslate"><span class="pre">L[1:]</span> <span class="pre">-</span> <span class="pre">L[:-1]</span></code>, but subtraction is not defined for lists.</p>
<p>Fortunately, by converting the lists to numpy arrays, we can use numpy’s term-by-term subtraction operation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">L</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># This will give a TypeError.  You can&#39;t subtract lists!</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">-</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">L</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># That&#39;s better.  See the gaps in the list [1,3,7,20] in the output.</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s return to our primegaps data set.  It contains all the gap-sizes for primes up to 1 million.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">primes</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">primegaps</span><span class="p">))</span>  <span class="c1"># This should be one less than the number of primes.</span>
</pre></div>
</div>
</div>
</div>
<p>As a last example of data visualization, we use matplotlib to produce a histogram of the prime gaps.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">max</span><span class="p">(</span><span class="n">primegaps</span><span class="p">)</span>  <span class="c1"># The largest prime gap that appears!</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>  <span class="c1">#  Makes the resulting figure 12in by 5in.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">primegaps</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">115</span><span class="p">))</span> <span class="c1">#  Makes a histogram with one bin for each possible gap from 1 to 114.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Gap size&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;The frequency of prime gaps, for primes up to 1 million&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Observe that gaps of 2 (twin primes) are pretty frequent.  There are over 8000 of them, and about the same number of 4-unit gaps!  But gaps of 6 are most frequent in the population, and there are some interesting peaks at 6, 12, 18, 24, 30.  What else do you observe?</p>
</section>
<section id="id14">
<h3>Exercises<a class="headerlink" href="#id14" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Create functions <code class="docutils literal notranslate"><span class="pre">redprimes_upto(x)</span></code> and <code class="docutils literal notranslate"><span class="pre">blueprimes_upto(x)</span></code> which count the number of red/blue primes up to a given number <code class="docutils literal notranslate"><span class="pre">x</span></code>.  Recall that we defined red/blue primes to be those of the form 4n+1 or 4n+3, respectively.  Graph the relative proportion of red/blue primes as <code class="docutils literal notranslate"><span class="pre">x</span></code> varies from 1 to 1 million.  E.g., are the proportions 50%/50% or 70%/30%, and how do these proportions change?  Note:  this is also visualized in <a class="reference external" href="http://bookstore.ams.org/mbk-105">An Illustrated Theory of Numbers</a> and you can read <a class="reference external" href="https://projecteuclid.org/euclid.em/1048515870">an article by Rubinstein and Sarnak</a> for more.</p></li>
<li><p>Does there seem to be a bias in the last digits of primes?  Note that, except for 2 and 5, every prime ends in 1,3,7, or 9.  Note: the last digit of a number <code class="docutils literal notranslate"><span class="pre">n</span></code> is obtained from <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">%</span> <span class="pre">10</span></code>.</p></li>
<li><p>Read about the <a class="reference external" href="https://www.quantamagazine.org/mathematicians-discover-prime-conspiracy-20160313">“Prime Conspiracy”</a>, recently discovered by Lemke Oliver and Soundararajan.  Can you detect their conspiracy in our data set of primes?</p></li>
</ol>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="part-4-dictionaries-factorization-and-multiplicative-functions-in-python-3-x">
<h1>Part 4:  Dictionaries, factorization, and multiplicative functions in Python 3.x<a class="headerlink" href="#part-4-dictionaries-factorization-and-multiplicative-functions-in-python-3-x" title="Link to this heading">#</a></h1>
<p>The <em>list type</em> is perfect for keeping track of ordered data.  Here we introduce the <em>dict</em> (dictionary) type, which can be used for <em>key-value pairs</em>.  This data structure is well suited for storing the prime decomposition of integers, in which each prime (<em>key</em>) is given an exponent (<em>value</em>).  As we introduce the <em>dict</em> type, we also discuss some broader issues of <em>objects</em> and <em>methods</em> in Python programming.</p>
<p>We apply these programming concepts to prime decomposition and multiplicative functions (e.g., the divisor sum function).  This material accompanies Chapter 2 of <a class="reference external" href="http://illustratedtheoryofnumbers.com/index.html">An Illustrated Theory of Numbers</a>.</p>
<section id="id15">
<h2>Table of Contents<a class="headerlink" href="#id15" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#dictfact"><span class="xref myst">Dictionaries and factorization</span></a></p></li>
<li><p><a class="reference internal" href="#multfunc"><span class="xref myst">Multiplicative functions</span></a></p></li>
</ul>
<p><a id='dictfact'></a></p>
</section>
<section id="dictionaries-and-factorization">
<h2>Dictionaries and factorization<a class="headerlink" href="#dictionaries-and-factorization" title="Link to this heading">#</a></h2>
<section id="lists-dictionaries-objects-and-methods">
<h3>Lists, dictionaries, objects and methods<a class="headerlink" href="#lists-dictionaries-objects-and-methods" title="Link to this heading">#</a></h3>
<p>Lists, like <code class="docutils literal notranslate"><span class="pre">[2,3,5,7]</span></code> are data structures built for sequentially ordered data.  The <strong>items</strong> of a list (in this case, the numbers 2,3,5,7) are <em>indexed</em> by natural numbers (in this case, the <strong>indices</strong> are 0,1,2,3).  Python allows you to access the items of a list through their index.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span>
<span class="nb">type</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># What is the output?</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>  <span class="c1"># What is the output?</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>  <span class="c1"># This should give an IndexError.</span>
</pre></div>
</div>
</div>
</div>
<p>Python <strong>dictionaries</strong> are structures built for data that have a <em>key-value</em> structure.  The <strong>keys</strong> are like indices.  But instead of numerical indices (0,1,2,etc.), the keys can be any numbers or strings (technically, any hashable type)!  Each key in the dictionary references a <strong>value</strong>, in the same way that each index of a list references an item.  The syntax for defining a dictionary is <code class="docutils literal notranslate"><span class="pre">{key1:value1,</span> <span class="pre">key2:value2,</span> <span class="pre">key3:value3,</span> <span class="pre">...}</span></code>.  A first example is below.  You can also read the <a class="reference external" href="https://docs.python.org/3/tutorial/datastructures.html#dictionaries">official tutorial</a> for more on dictionaries.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nemo</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;species&#39;</span><span class="p">:</span><span class="s1">&#39;clownfish&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span><span class="mi">6</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nemo</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>  <span class="c1"># The key &#39;color&#39; references the value &#39;orange&#39;.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nemo</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span>  <span class="c1"># Predict the result.  Notice the quotes are necessary.  The *string* &#39;age&#39; is the key.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nemo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># This yields a KeyError, since 1 is not a key in the dictionary.</span>
</pre></div>
</div>
</div>
</div>
<p>Dictionaries can have values of any type, and their keys can be numbers or strings.  In this case, the keys are all strings, while the values include strings and integers.  In this way, dictionaries are useful for storing properties of different kinds – they can be used to store [records](<a class="reference external" href="https://en.wikipedia.org/wiki/Record_">https://en.wikipedia.org/wiki/Record_</a>(computer_science%29 ), as they are called in other programming languages.</p>
</section>
<section id="an-interlude-on-python-objects">
<h3>An interlude on Python objects<a class="headerlink" href="#an-interlude-on-python-objects" title="Link to this heading">#</a></h3>
<p>We have discussed how Python stores data of various <em>types</em>:  int, bool, str, list, dict, among others.  But now seems like a good time to discuss the fundamental “units” which are stored:  these are called Python <strong>objects</strong>.  If you have executed the cells above, Python is currently storing a lot of objects in your computer’s memory.  These objects include <code class="docutils literal notranslate"><span class="pre">nemo</span></code> and <code class="docutils literal notranslate"><span class="pre">L</span></code>.  Also <code class="docutils literal notranslate"><span class="pre">L[0]</span></code> is an object and <code class="docutils literal notranslate"><span class="pre">nemo['age']</span></code> is an object.  Each of these objects are occupying a little space in memory.</p>
<p>We reference these objects by the names we created, like <code class="docutils literal notranslate"><span class="pre">nemo</span></code> and <code class="docutils literal notranslate"><span class="pre">L</span></code>.  But for internal purposes, Python assigns every object a unique ID number.  You can see an object’s ID number with the <code class="docutils literal notranslate"><span class="pre">id</span></code> function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">id</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">id</span><span class="p">(</span><span class="n">nemo</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">id</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>It is sometimes useful to check the ID numbers of objects, to look “under the hood” a bit.  For example, consider the following.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">3</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">y</span><span class="p">)</span>  <span class="c1"># This should be true!</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">id</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">id</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>What happened?  You probably noticed that both variables <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> have the same id number.  That means that Python is being efficient, and not filling up two different slots of memory with the same number (3).  Instead, it puts the number in one memory slot, and uses <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> as alternative names for this slot.</p>
<p>But what happens if we change a value of one variable?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">id</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">id</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Python won’t be confused by this.  When we assigned <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">5</span></code>, Python opened up a new memory slot for the number 5, and assigned <code class="docutils literal notranslate"><span class="pre">x</span></code> to refer to the number in this new slot.  Note that <code class="docutils literal notranslate"><span class="pre">y</span></code> still “points” at the old slot.  Python tries to be smart about memory, remembering where numbers are stored, and putting numbers into slots “under the hood” as it sees fit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">id</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># Does Python remember where it put 3?</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">id</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># Does Python remember where it put 5?</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">id</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>  <span class="c1">#  4 was probably not in memory before.  But now it is!</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">id</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>  <span class="c1">#  Did Python change the number in a slot?  Or did it point `y` at another slot?</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">id</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="c1">#  Python doesn&#39;t like to waste space.</span>
</pre></div>
</div>
</div>
</div>
<p>This sort of memory management can be helpful to avoid repetetion.  For example, consider a list with repetition.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">R</span> <span class="o">=</span> <span class="p">[</span><span class="mi">19</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">19</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">id</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>  <span class="c1"># The list itself is an object.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">id</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># The 0th item in the list is an object.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">id</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># The 1st item in the list is an object.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">id</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>  <span class="c1"># The 2nd item in the list is an object.</span>
</pre></div>
</div>
</div>
</div>
<p>By having each list entry point to the same location in memory, Python avoids having to fill three blocks of memory with the same number 19.</p>
<p>Python <em>objects</em> can have <strong>methods</strong> attached to them.  Methods are functions which can utilize and change the data within an object.  The basic syntax for using methods is <code class="docutils literal notranslate"><span class="pre">&lt;object&gt;.&lt;method&gt;()</span></code>.  Here are two examples to get started:  The keys and values of a dictionary can be recovered using the <code class="docutils literal notranslate"><span class="pre">keys()</span></code> and <code class="docutils literal notranslate"><span class="pre">values()</span></code> methods.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nemo</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>  <span class="c1"># What are the keys of nemo?</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nemo</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>  <span class="c1"># What are the values of nemo?</span>
</pre></div>
</div>
</div>
</div>
<p>The output of the <code class="docutils literal notranslate"><span class="pre">keys()</span></code> and <code class="docutils literal notranslate"><span class="pre">values()</span></code> methods are list-like.  As such, they are convenient for iteration and membership-testing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;color&#39;</span> <span class="ow">in</span> <span class="n">nemo</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;taste&#39;</span> <span class="ow">in</span> <span class="n">nemo</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;orange&#39;</span> <span class="ow">in</span> <span class="n">nemo</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>  <span class="c1"># Is &#39;orange&#39; a key in the dictionary?</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nemo</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>  <span class="c1"># Iterates through the keys.</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Nemo</span><span class="se">\&#39;</span><span class="s1">s </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">nemo</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>  <span class="c1"># \&#39; is used to get a single-quote in a string.</span>
</pre></div>
</div>
</div>
</div>
<p>In fact, Python provides a simpler syntax for iterating over keys or testing membership in keys.  The syntax <code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">k</span> <span class="pre">in</span> <span class="pre">&lt;dictionary&gt;:</span></code> iterates the variable <code class="docutils literal notranslate"><span class="pre">k</span></code> through the keys of the <code class="docutils literal notranslate"><span class="pre">&lt;dictionary&gt;</span></code>.  Similarly the syntax <code class="docutils literal notranslate"><span class="pre">k</span> <span class="pre">in</span> <span class="pre">&lt;dictionary&gt;</span></code> is shorthand for <code class="docutils literal notranslate"><span class="pre">k</span> <span class="pre">in</span> <span class="pre">&lt;dictionary&gt;.keys()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nemo</span><span class="p">:</span>  <span class="c1"># This will iterate through the *keys* of the dictionary nemo.</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Nemo</span><span class="se">\&#39;</span><span class="s1">s </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">nemo</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<p>Sometimes we’ll want to change a dictionary.  Perhaps we learn that nemo has gotten lost.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nemo</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lost&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">id</span><span class="p">(</span><span class="n">nemo</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">id</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">nemo</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The command <code class="docutils literal notranslate"><span class="pre">nemo['status']</span> <span class="pre">=</span> <span class="pre">'lost'</span></code> creates a <em>new key</em> in the dictionary called <code class="docutils literal notranslate"><span class="pre">'status'</span></code> and assigns the value <code class="docutils literal notranslate"><span class="pre">'lost'</span></code> to the key.  If we find nemo, then we can change the value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nemo</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;found&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">nemo</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Since <code class="docutils literal notranslate"><span class="pre">'status'</span></code> is already among the keys of <code class="docutils literal notranslate"><span class="pre">nemo</span></code>, the command <code class="docutils literal notranslate"><span class="pre">nemo['status']</span> <span class="pre">=</span> <span class="pre">'found'</span></code> does not create a new key this time.  It just changes the associated value from <code class="docutils literal notranslate"><span class="pre">'lost'</span></code> to <code class="docutils literal notranslate"><span class="pre">'found'</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nemo</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>  <span class="c1"># What are the keys of nemo now?</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nemo</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>  <span class="c1"># What are the values of nemo now?</span>
</pre></div>
</div>
</div>
</div>
<p>We mentioned earlier that <code class="docutils literal notranslate"><span class="pre">keys()</span></code> and <code class="docutils literal notranslate"><span class="pre">values()</span></code> are <strong>methods</strong> attached to the object <code class="docutils literal notranslate"><span class="pre">nemo</span></code>, and methods are functions which are attached to Python objects.</p>
<p>Python objects often (and often by default!) have methods attached to them.  Every dictionary and every list in Python comes with attached methods.  Methods can be used to extract properties of objects or change them.  Here are examples of some list methods.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="c1"># Let&#39;s remember what the list L is.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># What is this?</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">id</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># What is the ID number of the 0th item in the list?</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span> <span class="c1"># The reverse() method changes L!</span>
<span class="nb">print</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># We have definitely changed L.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># The last item in the list L.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">id</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="c1"># The ID number of the last item in the list L.</span>
</pre></div>
</div>
</div>
</div>
<p>Observe that Python changed the order of the items in the list.  But it didn’t move them around in memory!  The object <code class="docutils literal notranslate"><span class="pre">2</span></code> maintains the same ID number, and stays in the same place in memory.  But the list item <code class="docutils literal notranslate"><span class="pre">L[0]</span></code> points at <code class="docutils literal notranslate"><span class="pre">2</span></code> before reversing while <code class="docutils literal notranslate"><span class="pre">L[3]</span></code> points at <code class="docutils literal notranslate"><span class="pre">2</span></code> after reversing.  This kind of thing is confusing at first, but the general framework is <code class="docutils literal notranslate"><span class="pre">&lt;variable&gt;</span> <span class="pre">points</span> <span class="pre">at</span> <span class="pre">&lt;memory</span> <span class="pre">location&gt;</span></code>.  You choose the name of the variable and work with the variable directly.  Python labels each memory location with an ID number, and puts stuff in memory and retrieves values from memory according to your wishes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="c1"># Let&#39;s add another term to the list with the append(*) method.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>  <span class="c1"># Let&#39;s get this list back in order.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Some more useful list methods can be found at the <a class="reference external" href="https://docs.python.org/3/tutorial/datastructures.html#more-on-lists">official Python tutorial</a>.</p>
</section>
<section id="prime-decomposition-dictionaries">
<h3>Prime decomposition dictionaries<a class="headerlink" href="#prime-decomposition-dictionaries" title="Link to this heading">#</a></h3>
<p>If <span class="math notranslate nohighlight">\(N\)</span> is a positive integer, then <span class="math notranslate nohighlight">\(N\)</span> can be uniquely decomposed into a product of primes.  Here “uniquely” means that <span class="math notranslate nohighlight">\(N\)</span> has a unique expression of the form
$<span class="math notranslate nohighlight">\(N = 2^{e_2} 3^{e_3} 5^{e_5} \cdots\)</span><span class="math notranslate nohighlight">\(
in which the exponents \)</span>e_2, e_3, e_5$, etc., are natural numbers (and only finitely many are nonzero).</p>
<p>A Python dictionary is well-suited to store the resulting prime decomposition.  For example, we might store the prime decomposition <span class="math notranslate nohighlight">\(2^3 3^2 7\)</span> with the dictionary <code class="docutils literal notranslate"><span class="pre">{2:3,</span> <span class="pre">3:2,</span> <span class="pre">7:1}</span></code>.  The primes which occur in the decomposition become the <em>keys</em> of the dictionary, and the natural number exponents becomes the <em>values</em> of the dictionary.</p>
<p>The functions below decompose a positive integer <code class="docutils literal notranslate"><span class="pre">N</span></code> into primes, storing the result in a dictionary.  The strategy is to repeatedly strip off (divide by) the smallest prime factor of a number, adjusting the dictionary along the way, until the number is reduced to 1.  The first function below finds the smallest prime factor of a number.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">sqrt</span>  <span class="c1"># We&#39;ll want to use the square root.</span>

<span class="k">def</span><span class="w"> </span><span class="nf">smallest_factor</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Gives the smallest prime factor of n.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span> <span class="c1"># No prime factors!</span>
    
    <span class="n">test_factor</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># The smallest possible prime factor.</span>
    <span class="n">max_factor</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="c1"># we don&#39;t have to search past sqrt(n).</span>
    
    <span class="k">while</span> <span class="n">test_factor</span> <span class="o">&lt;=</span> <span class="n">max_factor</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">n</span><span class="o">%</span><span class="k">test_factor</span> == 0:
            <span class="k">return</span> <span class="n">test_factor</span>
        <span class="n">test_factor</span> <span class="o">=</span> <span class="n">test_factor</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># This could be sped up.</span>
    
    <span class="k">return</span> <span class="n">n</span>  <span class="c1"># If we didn&#39;t find a factor up to sqrt(n), n itself is prime!</span>
        
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">smallest_factor</span><span class="p">(</span><span class="mi">105</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">smallest_factor</span><span class="p">(</span><span class="mi">1999</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 1999 might be called the Prince of primes.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">smallest_factor</span><span class="p">(</span><span class="mi">11</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">13</span><span class="o">**</span><span class="mi">9</span><span class="p">)</span> <span class="c1"># The result should be 11.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">decompose</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Gives the unique prime decomposition of a positive integer N,</span>
<span class="sd">    as a dictionary with primes as keys and exponents as values.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">current_number</span> <span class="o">=</span> <span class="n">N</span>  <span class="c1"># We&#39;ll divide out factors from current_number until we get 1.</span>
    <span class="n">decomp</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># An empty dictionary to start.</span>
    <span class="k">while</span> <span class="n">current_number</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">smallest_factor</span><span class="p">(</span><span class="n">current_number</span><span class="p">)</span> <span class="c1"># The smallest prime factor of the current number.</span>
        <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">decomp</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>  <span class="c1"># Is p already in the list of keys?</span>
            <span class="n">decomp</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">decomp</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># Increase the exponent (value with key p) by 1.</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># &quot;else&quot; here means &quot;if p is not in decomp.keys()&quot;.</span>
            <span class="n">decomp</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Creates a new entry in the dictionary, with key p and value 1.</span>
        <span class="n">current_number</span> <span class="o">=</span> <span class="n">current_number</span> <span class="o">//</span> <span class="n">p</span> <span class="c1"># Factor out p.  Integer division!</span>
    <span class="k">return</span> <span class="n">decomp</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">decompose</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="c1"># What is the prime decomposition of 100?</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">decompose</span><span class="p">(</span><span class="mi">56401910421778813463</span><span class="p">)</span> <span class="c1"># This should be quick.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">decompose</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Good to test the base case!</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  Use this space to experiment a bit with the decompose function.</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we have a function to compute the prime decomposition of a positive integer, we write a function to recover a positive integer from such a prime decomposition.  The function is deceptively simple, since Python makes it easy to iterate through the keys of a dictionary.  Make sure that you understand every line.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">recompose</span><span class="p">(</span><span class="n">D</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    If D is a dictionary with prime keys and natural values,</span>
<span class="sd">    this function outputs the product of terms of the form</span>
<span class="sd">    key^value.  In this way, it recovers a single number from a</span>
<span class="sd">    prime decomposition.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">N</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">D</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>  <span class="c1"># iterate p through all the keys of D.</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span> <span class="o">**</span> <span class="n">D</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>  <span class="c1"># Note that D[p] refers to the value (exponent) for the key p.</span>
    <span class="k">return</span> <span class="n">N</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">D</span> <span class="o">=</span> <span class="n">decompose</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">recompose</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>  <span class="c1"># This should recover 1000.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">recompose</span><span class="p">({</span><span class="mi">2</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>  <span class="c1"># What will this give?</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use this space to experiment with decompose and recompose.</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id16">
<h3>Exercises<a class="headerlink" href="#id16" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Create the list [1,100,2,99,3,98,4,97,…,50,51] with as few list commands as you can.</p></li>
<li><p>If you try the commands <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">7</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">11</span></code>, then <code class="docutils literal notranslate"><span class="pre">x,y</span> <span class="pre">=</span> <span class="pre">y,x</span></code>, what do you expect happens with <code class="docutils literal notranslate"><span class="pre">id(x)</span></code> and <code class="docutils literal notranslate"><span class="pre">id(y)</span></code> along the way?</p></li>
<li><p>How might you adapt the decompose function to work with all integers (positive and negative)?  Note that zero does not have a prime decomposition, but negative numbers have an associated sign.</p></li>
<li><p>Write a function <code class="docutils literal notranslate"><span class="pre">multiply(A,B)</span></code>, in which the parameters <code class="docutils literal notranslate"><span class="pre">A</span></code> and <code class="docutils literal notranslate"><span class="pre">B</span></code> are prime decomposition dictionaries and the output is the prime decomposition of their product.</p></li>
<li><p>Write a function <code class="docutils literal notranslate"><span class="pre">divides(A,B)</span></code>, in which the parameters <code class="docutils literal notranslate"><span class="pre">A</span></code> and <code class="docutils literal notranslate"><span class="pre">B</span></code> are prime decomposition dictionaries and the output is a boolean:  True if <code class="docutils literal notranslate"><span class="pre">A</span></code> divides <code class="docutils literal notranslate"><span class="pre">B</span></code> and false otherwise.</p></li>
<li><p>The <em>radical</em> of a positive integer <code class="docutils literal notranslate"><span class="pre">N</span></code> is the positive integer whose prime factors are the same as <code class="docutils literal notranslate"><span class="pre">N</span></code>, but in which every prime occurs with exponent 1.  For example, <span class="math notranslate nohighlight">\(rad(500) = 2 \cdot 5 = 10\)</span>.  Write a function <code class="docutils literal notranslate"><span class="pre">radical(N)</span></code> which computes the radical of <code class="docutils literal notranslate"><span class="pre">N</span></code>.  You can use the <code class="docutils literal notranslate"><span class="pre">decompose(N)</span></code> and <code class="docutils literal notranslate"><span class="pre">recompose(N)</span></code> functions along the way.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use this space for the exercises.</span>
</pre></div>
</div>
</div>
</div>
<p><a id='multfunc'></a></p>
</section>
</section>
<section id="multiplicative-functions">
<h2>Multiplicative functions<a class="headerlink" href="#multiplicative-functions" title="Link to this heading">#</a></h2>
<p>A <em>multiplicative function</em> is a function <span class="math notranslate nohighlight">\(f(n)\)</span> which takes positive integer input <span class="math notranslate nohighlight">\(n\)</span>, and which satisfies <span class="math notranslate nohighlight">\(f(1) = 1\)</span> and <span class="math notranslate nohighlight">\(f(ab) = f(a) f(b)\)</span> whenever <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span> are <em>coprime</em>.  A good example is the divisor-sum function, implemented below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">divisor_sum</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">S</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Start the sum at zero.</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>  <span class="c1"># potential divisors between 1 and n.</span>
        <span class="k">if</span> <span class="n">n</span><span class="o">%</span><span class="k">d</span> == 0:
            <span class="n">S</span> <span class="o">=</span> <span class="n">S</span> <span class="o">+</span> <span class="n">d</span>
    <span class="k">return</span> <span class="n">S</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">divisor_sum</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>  <span class="c1"># The sum 1 + 2 + 4 + 5 + 10 + 20 + 25 + 50 + 100</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> divisor_sum(730) # Let&#39;s see how quickly this runs.
</pre></div>
</div>
</div>
</div>
<p>A perfect number is a positive integer which equals the sum of its proper factors (its positive factors, not including itself).  Thus a number <span class="math notranslate nohighlight">\(n\)</span> is perfect if its divisor sum equals <span class="math notranslate nohighlight">\(2n\)</span>.  This can be implemented in a very short function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">is_perfect</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">divisor_sum</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="o">*</span><span class="n">n</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">is_perfect</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">is_perfect</span><span class="p">(</span><span class="mi">28</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s find the perfect numbers up to 10000.  It might take a few seconds.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10000</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">is_perfect</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is perfect!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Multiplicative functions like the divisor sum function can be computed via prime decomposition.  Indeed, if <span class="math notranslate nohighlight">\(f\)</span> is a multiplicative function, and $<span class="math notranslate nohighlight">\(n = 2^{e_2} 3^{e_3} 5^{e_5} \cdots,\)</span><span class="math notranslate nohighlight">\( then the value \)</span>f(n)<span class="math notranslate nohighlight">\( satisfies
\)</span><span class="math notranslate nohighlight">\(f(n) = f(2^{e_2}) \cdot f(3^{e_3}) \cdot f(5^{e_5}) \cdots.\)</span>$</p>
<p>So if we can compute the values of <span class="math notranslate nohighlight">\(f\)</span> on prime powers, we can compute the values of <span class="math notranslate nohighlight">\(f\)</span> for all positive integers.</p>
<p>The following function computes the divisor sum function, for a prime power <span class="math notranslate nohighlight">\(p^e\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">divisor_sum_pp</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">e</span><span class="p">):</span>  <span class="c1"># pp stands for prime power</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Computes the divisor sum of the prime power p**e,</span>
<span class="sd">    when p is prime and e is a positive integer.</span>
<span class="sd">    This is just 1 + p^2 + p^3 + ... + p^e,</span>
<span class="sd">    simplified using a geometric series formula.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">p</span><span class="o">**</span><span class="p">(</span><span class="n">e</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">divisor_sum_pp</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># Should equal 1 + 2 + 4 + 8</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">divisor_sum_pp</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Should equal 1 + 3</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s re-implement the divisor sum function, using prime decomposition and the divisor_sum_pp function for prime powers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">divisor_sum</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Computes the sum of the positive divisors of a </span>
<span class="sd">    positive integer n.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">decompose</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>  <span class="c1"># We require the decompose function from before!</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">D</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">*</span> <span class="n">divisor_sum_pp</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">D</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">result</span>
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">divisor_sum</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">timeit</span><span class="p">(</span><span class="n">divisor_sum</span><span class="p">(</span><span class="mi">730</span><span class="p">))</span> <span class="c1"># this probably runs faster than the previous version.</span>
</pre></div>
</div>
</div>
</div>
<p>There are a lot of interesting multiplicative functions.  We could implement each one by a two-step process as above:  implementing the function for prime powers, then defining a version for positive integers by using the decompose function.  But there’s a shortcut for the second step, which brings in a very cool aspect of Python.</p>
<p>In Python, <strong>functions are Python objects</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">divisor_sum_pp</span><span class="p">)</span> <span class="c1"># Every object has a type.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">id</span><span class="p">(</span><span class="n">divisor_sum_pp</span><span class="p">)</span> <span class="c1"># Yes, every object gets an ID number.</span>
</pre></div>
</div>
</div>
</div>
<p>Since functions are Python objects, it is possible to define a function which takes a function as input and outputs a function too!  You can pass a function as an input parameter to another function, just as if it were any other variable.  You can output a function with the <code class="docutils literal notranslate"><span class="pre">return</span></code> keyword, just as if it were another variable.  And you can define a new function within the scope of a function!</p>
<p>Here’s a basic example as a warmup.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">addone</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>  <span class="c1"># Let&#39;s make a simple function.</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># It&#39;s not a very interesting function, is it.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">addone</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># Predict the result.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">do_twice</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    If a function f is input, then the output is the function</span>
<span class="sd">    &quot;f composed with f.&quot;</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ff</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>  <span class="c1"># Defines a new function ff!</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="c1"># This is what ff does.</span>
    
    <span class="k">return</span> <span class="n">ff</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">addtwo</span> <span class="o">=</span> <span class="n">do_twice</span><span class="p">(</span><span class="n">addone</span><span class="p">)</span>  <span class="c1"># addtwo is a function!</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">addtwo</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># What is the result?</span>
</pre></div>
</div>
</div>
</div>
<p>Now we exploit this function-as-object approach to create a Python function called <code class="docutils literal notranslate"><span class="pre">mult_function</span></code>.  Given a function <code class="docutils literal notranslate"><span class="pre">f_pp(p,e)</span></code>, the function <code class="docutils literal notranslate"><span class="pre">mult_function</span></code> outputs the <em>multiplicative function</em> which coincides with <code class="docutils literal notranslate"><span class="pre">f_pp</span></code> on prime powers.  In other words, if <code class="docutils literal notranslate"><span class="pre">f</span> <span class="pre">=</span> <span class="pre">mult_function(f_pp)</span></code>, then <code class="docutils literal notranslate"><span class="pre">f(p**e)</span></code> will equal <code class="docutils literal notranslate"><span class="pre">f_pp(p,e)</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">mult_function</span><span class="p">(</span><span class="n">f_pp</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    When a function f_pp(p,e) of two arguments is input,</span>
<span class="sd">    this outputs a multiplicative function obtained from f_pp</span>
<span class="sd">    via prime decomposition.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">decompose</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">D</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">*</span> <span class="n">f_pp</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">D</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">result</span>
    
    <span class="k">return</span> <span class="n">f</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s see how this works for the <em>divisor-counting</em> function.  This is the function <span class="math notranslate nohighlight">\(\sigma_0(n)\)</span> whose value is the <em>number</em> of positive divisors of <span class="math notranslate nohighlight">\(n\)</span>.  For prime powers, it is easy to count divisors, $<span class="math notranslate nohighlight">\(\sigma_0(p^e) = e + 1.\)</span>$</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">sigma0_pp</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">e</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">e</span><span class="o">+</span><span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<p>Since the divisor-counting function is multiplicative, we can implement it by applying <code class="docutils literal notranslate"><span class="pre">mult_function</span></code> to <code class="docutils literal notranslate"><span class="pre">sigma0_pp</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sigma0</span> <span class="o">=</span> <span class="n">mult_function</span><span class="p">(</span><span class="n">sigma0_pp</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sigma0</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>  <span class="c1"># How many divisors does 100 have?</span>
</pre></div>
</div>
</div>
</div>
<section id="id17">
<h3>Exercises<a class="headerlink" href="#id17" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>A positive integer <span class="math notranslate nohighlight">\(n\)</span> is called deficient/perfect/abundant according to whether the sum of its proper divisors is less than/equal to/greater than <span class="math notranslate nohighlight">\(n\)</span> itself.  Among the numbers up to 10000, how many are deficient, perfect, and abundant?</p></li>
<li><p>If <span class="math notranslate nohighlight">\(f(n)\)</span> is a function with natural number input and real output, define <span class="math notranslate nohighlight">\(F(n)\)</span> to be the function given by the formula <span class="math notranslate nohighlight">\(F(n) = \sum_{i=0}^n f(i)\)</span>.  Create a function <code class="docutils literal notranslate"><span class="pre">sumfun(f)</span></code> which takes as input a function <code class="docutils literal notranslate"><span class="pre">f</span></code> and outputs the function <code class="docutils literal notranslate"><span class="pre">F</span></code> as described above.</p></li>
<li><p>Consider the function <span class="math notranslate nohighlight">\(f(n)\)</span> which counts the number of positive divisors of <span class="math notranslate nohighlight">\(n\)</span> which <em>are not</em> divisible by 4.  Verify that this is a multiplicative function, and implement it using <code class="docutils literal notranslate"><span class="pre">mult_function</span></code>.</p></li>
<li><p>Write a function <code class="docutils literal notranslate"><span class="pre">foursquare(n)</span></code> which counts the number of ways that a positive integer <code class="docutils literal notranslate"><span class="pre">n</span></code> can be expressed as <code class="docutils literal notranslate"><span class="pre">a*a</span> <span class="pre">+</span> <span class="pre">b*b</span> <span class="pre">+</span> <span class="pre">c*c</span> <span class="pre">+</span> <span class="pre">d*d</span></code> for integers <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code>, <code class="docutils literal notranslate"><span class="pre">c</span></code>, <code class="docutils literal notranslate"><span class="pre">d</span></code>.  Hint:  loop the variables through integers between <span class="math notranslate nohighlight">\(-\sqrt{n}\)</span> and <span class="math notranslate nohighlight">\(\sqrt{n}\)</span>.  Compare the values of <code class="docutils literal notranslate"><span class="pre">foursquare(n)</span></code> to the multiplicative function in the previous problem.</p></li>
<li><p>A positive integer is “square-free” if it has no square factors besides 1.  The <strong>Mobius</strong> function <span class="math notranslate nohighlight">\(\mu(n)\)</span> is defined by <span class="math notranslate nohighlight">\(\mu(n) = 0\)</span> if <span class="math notranslate nohighlight">\(n\)</span> is not square-free, and otherwise <span class="math notranslate nohighlight">\(\mu(n) = 1\)</span> or <span class="math notranslate nohighlight">\(\mu(n) = -1\)</span> according to whether <span class="math notranslate nohighlight">\(n\)</span> has an even or odd number of prime factors.  Verify that the Mobius function is multiplicative and implement it.  Try to reproduce the graph of the Mertens function <span class="math notranslate nohighlight">\(M(n)\)</span> as described at <a class="reference external" href="https://en.wikipedia.org/wiki/Mertens_conjecture">Wikipedia’s article on the Mertens conjecture</a>.  (See the previous Python notebook for an introduction to matplotlib for creating graphs.)</p></li>
</ol>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="part-5-modular-arithmetic-and-primality-testing-with-python-3-x">
<h1>Part 5:  Modular arithmetic and primality testing with Python 3.x<a class="headerlink" href="#part-5-modular-arithmetic-and-primality-testing-with-python-3-x" title="Link to this heading">#</a></h1>
<p>Python, like most programming languages, comes with a “mod operation” <code class="docutils literal notranslate"><span class="pre">%</span></code> to compute remainders.  This makes basic modular arithmetic straightforward.  The more interesting aspects – from the standpoint of programming and number theory – arise in <strong>algorithms</strong> related to modular arithmetic.  Here we focus on Pingala’s algorithm, a method for computing exponents based on an ancient method for enumerating poetic meters.  We analyze the <strong>expected performance</strong> of this algorithm using Python’s <code class="docutils literal notranslate"><span class="pre">timeit</span></code> function for timing and <code class="docutils literal notranslate"><span class="pre">randint</span></code> function to randomize input parameters.  We also see how the performance depends on the number of <strong>bits</strong> of the input parameters.  In this way, we gently introduce some practical and theoretical issues in computer science.</p>
<p>We apply this algorithm to implement the Miller-Rabin primality test.  This test can very quickly determine (probabilistically) whether a large (hundreds or thousands of digits!) number is prime.  Our implementation is deterministic for smaller (under 64 bits) numbers.  This programming tutorial complements <strong>Chapters 5 and 6</strong> of An Illustrated Theory of Numbers.</p>
<section id="id18">
<h2>Table of Contents<a class="headerlink" href="#id18" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#modcalc"><span class="xref myst">Calculations in modular arithmetic</span></a></p></li>
<li><p><a class="reference internal" href="#millerrabin"><span class="xref myst">The Miller-Rabin Primality Test</span></a></p></li>
</ul>
<p><a id='modcalc'></a></p>
</section>
<section id="calculations-in-modular-arithmetic">
<h2>Calculations in modular arithmetic<a class="headerlink" href="#calculations-in-modular-arithmetic" title="Link to this heading">#</a></h2>
<section id="the-mod-operator">
<h3>The mod (%) operator<a class="headerlink" href="#the-mod-operator" title="Link to this heading">#</a></h3>
<p>For basic modular arithmetic, one can use Python’s “mod operator” <code class="docutils literal notranslate"><span class="pre">%</span></code> to obtain remainders.  There is a conceptual difference between the “mod” of computer programming and the “mod” of number theorists.  In computer programming, “mod” is typically the operator which outputs the remainder after division.  So for a computer scientist, “23 mod 5 = 3”, because 3 is the remainder after dividing 23 by 5.</p>
<p>Number theorists (starting with Gauss) take a radical conceptual shift.  A number theorist would write <span class="math notranslate nohighlight">\(23 \equiv 3\)</span> mod <span class="math notranslate nohighlight">\(5\)</span>, to say that 23 is <strong>congruent</strong> to 3 modulo 5.  In this sense “mod 5” (standing for “modulo 5”) is a <a class="reference external" href="https://www.economist.com/blogs/johnson/2012/08/grammar">prepositional phrase</a>, describing the “modular world” in which 23 is the same as (“congruent to”) 3.</p>
<p>To connect these perspectives, we would say that the computer scientist’s statement “23 mod 5 = 3” gives the <strong>natural representative</strong> 3 for the number 23 in the mathematician’s “ring of integers mod 5”.  (Here “ring” is a term from abstract algebra.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">23</span> <span class="o">%</span> <span class="mi">5</span>  <span class="c1"># What is the remainder after dividing 23 by 5?  What is the natural representative of 23 modulo 5?</span>
</pre></div>
</div>
</div>
</div>
<p>The miracle that makes modular arithmetic work is that the end-result of a computation “mod m” is not changed if one works “mod m” along the way.  At least this is true if the computation only involves <strong>addition, subtraction, and multiplication</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">((</span><span class="mi">17</span> <span class="o">+</span> <span class="mi">38</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">105</span> <span class="o">-</span> <span class="mi">193</span><span class="p">))</span> <span class="o">%</span> <span class="mi">13</span>  <span class="c1"># Do a bunch of stuff, then take the representative modulo 13.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(((</span><span class="mi">17</span><span class="o">%</span><span class="k">13</span>) + (38%13)) * ((105%13) - (193%13)) ) % 13 # Working modulo 13 along the way.
</pre></div>
</div>
</div>
</div>
<p>It might seem tedious to carry out this “reduction mod m” at every step along the way.  But the advantage is that you never have to work with numbers much bigger than the modulus (m) if you can reduce modulo m at each step.</p>
<p>For example, consider the following computation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">3</span><span class="o">**</span><span class="mi">999</span> <span class="c1"># A very large integer.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">3</span><span class="o">**</span><span class="mi">999</span><span class="p">)</span> <span class="o">%</span> <span class="mi">1000</span>  <span class="c1"># What are the last 3 digits of 3 raised to the 999 power?</span>
</pre></div>
</div>
</div>
</div>
<p>To compute the last three digits of <span class="math notranslate nohighlight">\(3^{999}\)</span>, Python works with some very large integers along the way.  But what if we could reduce modulo 1000 at every step?  Then, as Python multiplies terms, it will never have to multiply numbers bigger than 1000.  Here is a brute-force implementation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">P</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># The &quot;running product&quot; starts at 1.</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">999</span><span class="p">):</span>  <span class="c1"># We repeat the following line 999 times, as i traverses the list [0,1,...,998].</span>
    <span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="n">P</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span><span class="o">%</span><span class="k">1000</span>  # We reduce modulo 1000 along the way!
<span class="nb">print</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In this computation, Python never has to work with long integers.  Computations with long integers are time-consuming, and unnecessary if you only care about the result of a computation modulo a small number m.</p>
</section>
<section id="performance-analysis">
<h3>Performance analysis<a class="headerlink" href="#performance-analysis" title="Link to this heading">#</a></h3>
<p>The above loop works quickly, but it is far from optimal.  Let’s carry out some <strong>performance analysis</strong> by writing two <code class="docutils literal notranslate"><span class="pre">powermod</span></code> functions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">powermod_1</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">exponent</span><span class="p">,</span> <span class="n">modulus</span><span class="p">):</span>  <span class="c1"># The naive approach.</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">base</span><span class="o">**</span><span class="n">exponent</span><span class="p">)</span> <span class="o">%</span> <span class="n">modulus</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">powermod_2</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">exponent</span><span class="p">,</span> <span class="n">modulus</span><span class="p">):</span>
    <span class="n">P</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># Start the running product at 1.</span>
    <span class="n">e</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">exponent</span><span class="p">):</span>
        <span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="n">P</span> <span class="o">*</span> <span class="n">base</span><span class="p">)</span> <span class="o">%</span> <span class="n">modulus</span>
    <span class="k">return</span> <span class="n">P</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s compare the performance of these two functions.  It’s also good to double check the code in <code class="docutils literal notranslate"><span class="pre">powermod_2</span></code> and run it to check the results.  The reason is that loops like this are classic sources of <a class="reference external" href="https://en.wikipedia.org/wiki/Off-by-one_error">Off by One Errors</a>.  One has to unravel the loop carefully to be completely certain, and testing is a necessity to avoid bugs!</p>
<p>We can compare the performance of the two functions with identical input parameters below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> powermod_1(3,999,1000)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> powermod_2(3,999,1000)
</pre></div>
</div>
</div>
</div>
<p>The second <code class="docutils literal notranslate"><span class="pre">powermod</span></code> function was probably much slower, even though we reduced the size of the numbers along the way.  But perhaps we just chose some input parameters (3,999,1000) which were inconvenient for the second function.  To compare the performance of the two functions, it would be useful to try many different inputs.</p>
<p>For this, we use Python’s timeit features in a different way.  Above we used the “magic” <code class="docutils literal notranslate"><span class="pre">%timeit</span></code> to time a line of code.  The magic command <code class="docutils literal notranslate"><span class="pre">%timeit</span></code> is convenient but limited in flexibility.  Here we use a larger Python <code class="docutils literal notranslate"><span class="pre">timeit</span></code> package which we import (as <code class="docutils literal notranslate"><span class="pre">TI</span></code>) and demonstrate below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">timeit</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">TI</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">TI</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="s1">&#39;powermod_1(3,999,1000)&#39;</span><span class="p">,</span> <span class="s2">&quot;from __main__ import powermod_1&quot;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">TI</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="s1">&#39;powermod_2(3,999,1000)&#39;</span><span class="p">,</span> <span class="s2">&quot;from __main__ import powermod_2&quot;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The syntax of the timeit <em>function</em> is a bit challenging.  The first parameter is the Python code which we are timing (as a string), in this case <code class="docutils literal notranslate"><span class="pre">powermod_*(3,999,1000)</span></code>.  The second parameter probably looks strange.  It exists because the timeit function sets up a little isolation chamber to run the code – within this isolation chamber, it only knows standard Python commands and not the new functions you’ve created.  So you have to <em>import</em> your functions (<code class="docutils literal notranslate"><span class="pre">powermod_1</span></code> or <code class="docutils literal notranslate"><span class="pre">powermod_2</span></code>) into its isolation box.  Where are these imported from?  They are contained in <code class="docutils literal notranslate"><span class="pre">__main__</span></code> which is the location of all of your other code.  Finally, the third parameter <code class="docutils literal notranslate"><span class="pre">number</span></code> is the number of times the timeit function will repeat the code (by default, this might be a large number like 1000000).</p>
<p>The output of the timeit function is a <em>float</em>, which represents the number of seconds taken for <em>all</em> of the repetitions.  Contrast this with the timeit magic, which found the average.  So you need to divide by the <code class="docutils literal notranslate"><span class="pre">number</span></code> parameter (10000 in the above examples) to find the average time taken.</p>
<p>Using the timeit <em>function</em>, we can compare the performance of the two <code class="docutils literal notranslate"><span class="pre">powermod</span></code> functions on multiple inputs, wrapping the whole comparison process in a bigger function.  We choose our inputs <em>randomly</em> in order to estimate the <strong>expected performance</strong> of our functions.  To choose random inputs, Python has a package aptly called random.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">random</span><span class="w"> </span><span class="kn">import</span> <span class="n">randint</span> <span class="c1"># randint chooses random integers.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;My number is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)))</span> <span class="c1"># Run this line many times over to see what happens!</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">randint(a,b)</span></code> command chooses a random integer between <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code>, inclusive!  Unlike the <code class="docutils literal notranslate"><span class="pre">range(a,b)</span></code> command which iterates from <code class="docutils literal notranslate"><span class="pre">a</span></code> to <code class="docutils literal notranslate"><span class="pre">b-1</span></code>, the <code class="docutils literal notranslate"><span class="pre">randint</span></code> command includes both <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> as possibilities.  The following lines iterate the <code class="docutils literal notranslate"><span class="pre">randint(1,10)</span></code> and keep track of how often each output occurs.  The resulting <em>frequency distribution</em> should be nearly flat, i.e., each number between 1 and 10 should occur about 10% of the time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Freq</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>  <span class="c1"># We like to use a dictionary here.</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># Choose a random number between 1 and 10.</span>
    <span class="n">Freq</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">Freq</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

<span class="nb">print</span><span class="p">(</span><span class="n">Freq</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>For fun, and as a template for other explorations, we plot the frequencies in a histogram.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">Freq</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">Freq</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="c1"># The keys 1,...,10 are used as bins.  The values are used as bar heights.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Putting together the <code class="docutils literal notranslate"><span class="pre">randint</span></code> function and the <code class="docutils literal notranslate"><span class="pre">timeit</span></code> function, we can compare the performance of <code class="docutils literal notranslate"><span class="pre">powermod_1</span></code> and <code class="docutils literal notranslate"><span class="pre">powermod_2</span></code> when given random inputs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">time_1</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Tracking the time taken by the powermod_1 function.</span>
<span class="n">time_2</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Tracking the time taken by the powermod_2 function.</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span> <span class="c1"># One thousand samples are taken!</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">99</span><span class="p">)</span> <span class="c1"># A random 2-digit base.</span>
    <span class="n">exponent</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1999</span><span class="p">)</span> <span class="c1"># A random 3-digit exponent.</span>
    <span class="n">modulus</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1999</span><span class="p">)</span> <span class="c1"># A random 3-digit modulus.</span>
    
    <span class="c1"># Note in the lines below that we have to import the functions powermod_1, powermod_2 and </span>
    <span class="c1"># the variables base, exponent, modulus, into the isolation chamber used by timeit.</span>
    <span class="c1"># We set number=10 to allow 10 trials of each function on each sample input.</span>
    <span class="c1"># We do a head-to-head comparison of the two functions on the same inputs!</span>
    <span class="c1"># Note that when the lines get too long in Python, you can press &lt;enter&gt;/&lt;return&gt; to start a new line.</span>
    <span class="c1"># Python will ignore the line break.  Just keep things indented for clarity.</span>
    
    <span class="n">time_1</span> <span class="o">=</span> <span class="n">time_1</span> <span class="o">+</span> <span class="n">TI</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="s1">&#39;powermod_1(base,exponent,modulus)&#39;</span><span class="p">,</span> 
                              <span class="s2">&quot;from __main__ import powermod_1, base, exponent, modulus&quot;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">time_2</span> <span class="o">=</span> <span class="n">time_2</span> <span class="o">+</span> <span class="n">TI</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="s1">&#39;powermod_2(base,exponent,modulus)&#39;</span><span class="p">,</span> 
                              <span class="s2">&quot;from __main__ import powermod_2, base, exponent, modulus&quot;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;powermod_1 took </span><span class="si">{}</span><span class="s2"> seconds.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;powermod_2 took </span><span class="si">{}</span><span class="s2"> seconds.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_2</span><span class="p">))</span> <span class="c1"># Which is faster?</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can be pretty sure that the <code class="docutils literal notranslate"><span class="pre">powermod_1</span></code> function is faster (perhaps by a factor of 8-10) than the <code class="docutils literal notranslate"><span class="pre">powermod_2</span></code> function we designed.  At least, this is the case for inputs in the 2-3 digit range that we sampled.  But why?  We reduced the complexity of the calculation by using the mod operation <code class="docutils literal notranslate"><span class="pre">%</span></code> throughout.  Here are a few issues one might suspect.</p>
<ol class="arabic simple">
<li><p>The mod operation itself takes a bit of time.  Maybe that time added up in <code class="docutils literal notranslate"><span class="pre">powermod_2</span></code>?</p></li>
<li><p>The Python power operation <code class="docutils literal notranslate"><span class="pre">**</span></code> is highly optimized already, and outperforms our while loop.</p></li>
<li><p>We used more multiplications than necessary.</p></li>
</ol>
<p>It turns out that the mod operation is extremely fast… as in <em>nanoseconds</em> (billionths of a second) fast.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> 1238712 % 1237
</pre></div>
</div>
</div>
</div>
<p>So the speed difference is not due to the number of mod operations.  But the other issues are relevant.  The Python developers have worked hard to make Python run fast – built-in operations like <code class="docutils literal notranslate"><span class="pre">**</span></code> will almost certainly be faster than any function that you write with a loop in Python.  The developers have written programs in the <strong>C programming language</strong> (typically) to implement operations like <code class="docutils literal notranslate"><span class="pre">**</span></code> (see the <a class="reference external" href="https://hg.python.org/cpython/file/c7163a7f7cd2/Python/bltinmodule.c#l1505">CPython implementation</a>, if you wish); their programs have been <strong>compiled</strong> into <strong>machine code</strong> – the basic sets of instructions that your computer understands (and that are not meant for people to understand).  When you call a built-in operation like <code class="docutils literal notranslate"><span class="pre">**</span></code>, Python just tells your computer to run the developers’ optimized and <strong>precompiled</strong> machine code… this is very fast!  When you run your own loop, Python is basically converting the code to machine code “on the fly” and this is slower.</p>
<p>Still, it is unfortunate to use long integers if you ask Python to compute <code class="docutils literal notranslate"><span class="pre">(3**999)</span> <span class="pre">%</span> <span class="pre">1000</span></code>.  The good news is that such modular exponents are so frequently used that the Python developers have a built-in operation:  the <code class="docutils literal notranslate"><span class="pre">pow</span></code> function.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">pow</span></code> function has two versions.  The simplest version <code class="docutils literal notranslate"><span class="pre">pow(b,e)</span></code> raises <code class="docutils literal notranslate"><span class="pre">b</span></code> to the <code class="docutils literal notranslate"><span class="pre">e</span></code> power.  It is the same as computing <code class="docutils literal notranslate"><span class="pre">b</span> <span class="pre">**</span> <span class="pre">e</span></code>.  But it also has a modular version!  The command <code class="docutils literal notranslate"><span class="pre">pow(b,e,m)</span></code> raises <code class="docutils literal notranslate"><span class="pre">b</span></code> to the <code class="docutils literal notranslate"><span class="pre">e</span></code> modulo <code class="docutils literal notranslate"><span class="pre">m</span></code>, efficiently reducing modulo <code class="docutils literal notranslate"><span class="pre">m</span></code> along the way.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">pow</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">999</span><span class="p">)</span>  <span class="c1"># A long number.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">pow</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">999</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span> <span class="c1"># The result, modulo 1000.  </span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">pow</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">999</span><span class="p">)</span> <span class="o">%</span> <span class="mi">1000</span> <span class="c1"># The old way</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> pow(3,999,1000)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> pow(3,999) % 1000
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">pow(b,e,m)</span></code> command should give a significant speedup, as compared to the <code class="docutils literal notranslate"><span class="pre">pow(b,e)</span></code> command.  Remember that ns stands for nanoseconds (billionths of a second) and µs stands for microseconds (millionths of a second).</p>
<p>Exponentiation runs so quickly because not only is Python reducing modulo <code class="docutils literal notranslate"><span class="pre">m</span></code> along the way, it is performing a surprisingly small number of multiplications.  In our loop approach, we computed <span class="math notranslate nohighlight">\(3^{999}\)</span> by multiplying repeatedly.  There were 999 multiplications!  But consider this carefully – did we need to perform so many multiplications?  Can you compute <span class="math notranslate nohighlight">\(3^{999}\)</span> with far fewer multiplications?  What if you can place results in memory along the way?</p>
<p>In the next section, we study a very efficient <strong>algorithm</strong> for computing such exponents.  The goal in designing a good algorithm is to create something which runs <strong>quickly</strong>, minimizes the need for <strong>memory</strong>, and runs reliably for all the necessary input values.  Often there are trade-offs between speed and memory usage, but our exponentiation algorithm will be excellent in both respects.  The ideas go back to <a class="reference external" href="https://en.wikipedia.org/wiki/Pingala">Pingala</a>, an Indian mathematician of the 2nd or 3rd century BCE, who developed his ideas to enumerate possible poetic meters (arrangements of long and short syllables into verses of a given length).</p>
<p>You may wonder why it is necessary to learn the algorithm at all, if Python has an optimized algorithm built into its <code class="docutils literal notranslate"><span class="pre">pow</span></code> command.  First, it is interesting!  But also, we will need to understand the algorithm in finer detail to implement the Miller-Rabin test:  a way of quickly testing whether very large numbers are prime.</p>
</section>
<section id="id19">
<h3>Exercises<a class="headerlink" href="#id19" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Adapt the <code class="docutils literal notranslate"><span class="pre">solve_LDE</span></code> function from <a class="reference external" href="http://illustratedtheoryofnumbers.com/prog.html#notebooks">PwNT Notebook 2</a>, in order to write a function <code class="docutils literal notranslate"><span class="pre">modular_inverse(a,m)</span></code> which computes the multiplicative inverse of <code class="docutils literal notranslate"><span class="pre">a</span></code> modulo <code class="docutils literal notranslate"><span class="pre">m</span></code> (if they are coprime).</p></li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">timeit</span></code> and <code class="docutils literal notranslate"><span class="pre">randint</span></code> functions to investigate how the speed of the command <code class="docutils literal notranslate"><span class="pre">pow(a,e,m)</span></code> depends on how many digits the numbers <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">e</span></code>, and <code class="docutils literal notranslate"><span class="pre">m</span></code> have.  Note that <code class="docutils literal notranslate"><span class="pre">randint(10**(d-1),</span> <span class="pre">10**d</span> <span class="pre">-</span> <span class="pre">1)</span></code> will produce a random integer with <code class="docutils literal notranslate"><span class="pre">d</span></code> digits.  If you hold two of these variables fixed, consider how the time changes as the third variable is changed.</p></li>
<li><p>Imagine that you are going to compute <span class="math notranslate nohighlight">\(3^{100}\)</span> by multiplying positive integers together.  If each multiplication operation costs 1 dollar, how much money do you need to spend?  You can assume that <strong>remembering</strong> previously computed numbers is free.  What if it costs 1 dollar each time you need to place a number into memory or recover a number from memory?  What is the cheapest way to compute <span class="math notranslate nohighlight">\(3^{100}\)</span>?</p></li>
</ol>
<p><a id='millerrabin'></a></p>
</section>
</section>
<section id="the-miller-rabin-primality-test">
<h2>The Miller-Rabin primality test<a class="headerlink" href="#the-miller-rabin-primality-test" title="Link to this heading">#</a></h2>
<section id="fermat-s-little-theorem-and-the-roo-property-of-primes">
<h3>Fermat’s Little Theorem and the ROO property of primes<a class="headerlink" href="#fermat-s-little-theorem-and-the-roo-property-of-primes" title="Link to this heading">#</a></h3>
<p>Fermat’s Little Theorem states that if <span class="math notranslate nohighlight">\(p\)</span> is a prime number, and <span class="math notranslate nohighlight">\(GCD(a,p) = 1\)</span>, then $<span class="math notranslate nohighlight">\(a^{p-1} \equiv 1 \text{ mod } p.\)</span>$
Under the assumptions above, if we ask Python to compute <code class="docutils literal notranslate"><span class="pre">(a**(p-1))%p</span></code>, or even better, <code class="docutils literal notranslate"><span class="pre">pow(a,p-1,p)</span></code>, the result should be 1.  We use and refine this idea to develop a powerful and practical primality test.  Let’s begin with a few checks of Fermat’s Little Theorem.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">pow</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">37</span><span class="p">)</span>  <span class="c1"># a = 3, p = 37, p-1 = 36</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">pow</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">101</span><span class="p">)</span> <span class="c1"># 101 is prime.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">pow</span><span class="p">(</span><span class="mi">303</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>  <span class="c1"># Why won&#39;t we get 1?</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">pow</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">91</span><span class="p">)</span> <span class="c1"># What&#39;s the answer?</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">pow</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">12318</span><span class="p">,</span> <span class="mi">12319</span><span class="p">)</span> <span class="c1"># What&#39;s the answer?</span>
</pre></div>
</div>
</div>
</div>
<p>We can learn something from the previous two examples.  Namely, 91 and 12319 are <strong>not</strong> prime numbers.  We say that 7 <strong>witnesses</strong> the non-primality of 12319.  Moreover, we learned this fact without actually finding a factor of 12319!  Indeed, the factors of 12319 are 97 and 127, which have no relationship to the “witness” 7.</p>
<p>In this way, Fermat’s Little Theorem – a statement about prime numbers – can be turned into a way of discovering that numbers are not prime.  After all, if <span class="math notranslate nohighlight">\(p\)</span> is not prime, then what are the chances that <span class="math notranslate nohighlight">\(a^{p-1} \equiv 1\)</span> mod <span class="math notranslate nohighlight">\(p\)</span> by coincidence?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">pow</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">91</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Well, ok.  Sometimes coincidences happen.  We say that 3 is a <strong>bad witness</strong> for 91, since 91 is not prime, but <span class="math notranslate nohighlight">\(3^{90} \equiv 1\)</span> mod <span class="math notranslate nohighlight">\(91\)</span>.  But we could try multiple bases (witnesses).  We can expect that someone (some base) will witness the nonprimality.  Indeed, for the non-prime 91 there are many good witnesses (ones that detect the nonprimality).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">witness</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">flt</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">witness</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">91</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is a bad witness.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">witness</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> raised to the 90th power equals </span><span class="si">{}</span><span class="s2">, mod 91&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">witness</span><span class="p">,</span> <span class="n">flt</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>For some numbers – the <a class="reference external" href="https://en.wikipedia.org/wiki/Carmichael_number">Carmichael numbers</a> – there are more bad witnesses than good witnesses.  For example, take the Carmichael number 41041, which is not prime (<span class="math notranslate nohighlight">\(41041 = 7 \cdot 11 \cdot 13 \cdot 41\)</span>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">witness</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">flt</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">witness</span><span class="p">,</span> <span class="mi">41040</span><span class="p">,</span> <span class="mi">41041</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is a bad witness.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">witness</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> raised to the 41040th power equals </span><span class="si">{}</span><span class="s2">, mod 41041&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">witness</span><span class="p">,</span> <span class="n">flt</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>For Carmichael numbers, it turns out that finding a good witness is just as difficult as finding a factor.  Although Carmichael numbers are rare, they demonstrate that Fermat’s Little Theorem by itself is not a great way to be certain of primality.  Effectively, Fermat’s Little Theorem can often be used to quickly prove that a number <strong>is not prime</strong>… but it is not so good if we want to be sure that a number <strong>is prime</strong>.</p>
<p>The Miller-Rabin primality test will refine the Fermat’s Little Theorem test, by cleverly taking advantage of another property of prime numbers.  We call this the ROO (Roots Of One) property:  if <span class="math notranslate nohighlight">\(p\)</span> is a prime number, and <span class="math notranslate nohighlight">\(x^2 \equiv 1\)</span> mod <span class="math notranslate nohighlight">\(p\)</span>, then <span class="math notranslate nohighlight">\(x \equiv 1\)</span> or <span class="math notranslate nohighlight">\(x \equiv -1\)</span> mod <span class="math notranslate nohighlight">\(p\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">41</span><span class="p">):</span>  
    <span class="k">if</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">%</span> <span class="mi">41</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> squared is congruent to 1, mod 41.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>  <span class="c1"># What numbers do you think will be printed?</span>
</pre></div>
</div>
</div>
</div>
<p>Note that we use “natural representatives” when doing modular arithmetic in Python.  So the only numbers whose square is 1 mod 41 are 1 and 40.  (Note that 40 is the natural representative of -1, mod 41).  If we consider the “square roots of 1” with a composite modulus, we find more (as long as the modulus has at least two odd prime factors).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">91</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">%</span> <span class="mi">91</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> squared is congruent to 1, mod 91.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>  <span class="c1"># What numbers do you think will be printed?</span>
</pre></div>
</div>
</div>
</div>
<p>We have described two properties of prime numbers, and therefore two possible indicators that a number is not prime.</p>
<ol class="arabic simple">
<li><p>If <span class="math notranslate nohighlight">\(p\)</span> is a number which violates Fermat’s Little Theorem, then <span class="math notranslate nohighlight">\(p\)</span> is not prime.</p></li>
<li><p>If <span class="math notranslate nohighlight">\(p\)</span> is a number which violates the ROO property, then <span class="math notranslate nohighlight">\(p\)</span> is not prime.</p></li>
</ol>
<p>The Miller Rabin test will combine these indicators.  But first we have to introduce an ancient algorithm for exponentiation.</p>
</section>
<section id="pingala-s-exponentiation-algorithm">
<h3>Pingala’s exponentiation algorithm<a class="headerlink" href="#pingala-s-exponentiation-algorithm" title="Link to this heading">#</a></h3>
<p>If we wish to compute <span class="math notranslate nohighlight">\(5^{90}\)</span> mod <span class="math notranslate nohighlight">\(91\)</span>, without the <code class="docutils literal notranslate"><span class="pre">pow</span></code> command, we don’t have to carry out 90 multiplications.  Instead, we carry out <strong>Pingala’s algorithm</strong>.  To understand this algorithm, we begin with the desired exponent (e.g. <span class="math notranslate nohighlight">\(e=90\)</span>), and carry out a series of steps:  replace <span class="math notranslate nohighlight">\(e\)</span> by <span class="math notranslate nohighlight">\(e/2\)</span> if <span class="math notranslate nohighlight">\(e\)</span> is even, and replace <span class="math notranslate nohighlight">\(e\)</span> by <span class="math notranslate nohighlight">\((e-1) / 2\)</span> if <span class="math notranslate nohighlight">\(e\)</span> is odd.  Repeat this until the exponent is decreased to zero.  The following function carries out this process on any input <span class="math notranslate nohighlight">\(e\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">Pingala</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
    <span class="n">current_number</span> <span class="o">=</span> <span class="n">e</span>
    <span class="k">while</span> <span class="n">current_number</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">current_number</span><span class="o">%</span><span class="k">2</span> == 0:
            <span class="n">current_number</span> <span class="o">=</span> <span class="n">current_number</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exponent </span><span class="si">{}</span><span class="s2"> BIT 0&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current_number</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">current_number</span><span class="o">%</span><span class="k">2</span> == 1:
            <span class="n">current_number</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_number</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exponent </span><span class="si">{}</span><span class="s2"> BIT 1&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current_number</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Pingala</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The codes “BIT 1” and “BIT 0” tell us what happened at each step, and allow the process to be reversed.  In a line with BIT 0, the exponent gets <strong>doubled</strong> as one goes <strong>up</strong> one line (e.g., from 11 to 22).  In a line with BIT 1, the exponent gets <strong>doubled then increased by 1</strong> as one goes <strong>up</strong> one line (e.g., from 2 to 5).</p>
<p>We can use these BIT codes in order to compute an exponent.  Below, we follow the BIT codes to compute <span class="math notranslate nohighlight">\(5^{90}\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># This is where we start.</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="n">n</span> <span class="o">*</span> <span class="mi">5</span> <span class="c1"># BIT 1 is interpreted as square-then-multiply-by-5, since the exponent is doubled then increased by 1.</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="n">n</span>  <span class="c1"># BIT 0 is interpreted as squaring, since the exponent is doubled.</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="n">n</span> <span class="o">*</span> <span class="mi">5</span> <span class="c1"># BIT 1</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="n">n</span> <span class="o">*</span> <span class="mi">5</span> <span class="c1"># BIT 1 again.</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="n">n</span> <span class="c1"># BIT 0</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="n">n</span> <span class="o">*</span> <span class="mi">5</span> <span class="c1"># BIT 1</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="n">n</span> <span class="c1"># BIT 0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>  <span class="c1"># What we just computed.</span>
<span class="nb">print</span><span class="p">(</span><span class="mi">5</span><span class="o">**</span><span class="mi">90</span><span class="p">)</span> <span class="c1"># I hope these match!!</span>
</pre></div>
</div>
</div>
</div>
<p>Note that along the way, we carried out 11 multiplications (count the <code class="docutils literal notranslate"><span class="pre">*</span></code> symbols), and didn’t have to remember too many numbers along the way.  So this process was efficient in both time and memory.  We just followed the BIT code.  The number of multiplications is bounded by twice the number of BITs, since each BIT requires at most two multiplications (squaring then multiplication by 5) to execute.</p>
<p>Why did we call the code a BIT code?  It’s because the code consists precisely of the bits (binary digits) of the exponent 90!  Since computers store numbers in binary, the computer “knows” the BIT code as soon as it knows the exponent.  In Python, the <code class="docutils literal notranslate"><span class="pre">bin</span></code> command recovers the binary expansion of a number.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">bin</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>  <span class="c1"># Compare this to the sequence of bits, from bottom up.</span>
</pre></div>
</div>
</div>
</div>
<p>Python outputs binary expansions as strings, beginning with <code class="docutils literal notranslate"><span class="pre">'0b'</span></code>.  To summarize, we can compute an exponent like <span class="math notranslate nohighlight">\(b^e\)</span> by the following process:</p>
<p><strong>Pingala’s Exponentiation Algorithm</strong></p>
<ol class="arabic simple">
<li><p>Set the number to 1.</p></li>
<li><p>Read the bits of <span class="math notranslate nohighlight">\(e\)</span>, from left to right.<br />
a. When the bit is zero, square the number.<br />
b. When the bit is one, square the number, then multiply by <span class="math notranslate nohighlight">\(b\)</span>.</p></li>
<li><p>Output the resulting number.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">pow_Pingala</span><span class="p">(</span><span class="n">base</span><span class="p">,</span><span class="n">exponent</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">bitstring</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="n">exponent</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span> <span class="c1"># Chop off the &#39;0b&#39; part of the binary expansion of exponent</span>
    <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="n">bitstring</span><span class="p">:</span> <span class="c1"># Iterates through the &quot;letters&quot; of the string.  Here the letters are &#39;0&#39; or &#39;1&#39;.</span>
        <span class="k">if</span> <span class="n">bit</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">*</span><span class="n">result</span>
        <span class="k">if</span> <span class="n">bit</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">*</span><span class="n">result</span> <span class="o">*</span> <span class="n">base</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pow_Pingala</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">90</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>It is straightforward to modify Pingala’s algorithm to compute exponents in modular arithmetic.  Just reduce along the way.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">powmod_Pingala</span><span class="p">(</span><span class="n">base</span><span class="p">,</span><span class="n">exponent</span><span class="p">,</span><span class="n">modulus</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">bitstring</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="n">exponent</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span> <span class="c1"># Chop off the &#39;0b&#39; part of the binary expansion of exponent</span>
    <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="n">bitstring</span><span class="p">:</span> <span class="c1"># Iterates through the &quot;letters&quot; of the string.  Here the letters are &#39;0&#39; or &#39;1&#39;.</span>
        <span class="k">if</span> <span class="n">bit</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">result</span><span class="o">*</span><span class="n">result</span><span class="p">)</span> <span class="o">%</span> <span class="n">modulus</span> 
        <span class="k">if</span> <span class="n">bit</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">result</span><span class="o">*</span><span class="n">result</span> <span class="o">*</span> <span class="n">base</span><span class="p">)</span> <span class="o">%</span> <span class="n">modulus</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">powmod_Pingala</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">91</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s compare the performance of our new modular exponentiation algorithm.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> powmod_Pingala(3,999,1000)  # Pingala&#39;s algorithm, modding along the way.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> powermod_1(3,999,1000)  # Raise to the power, then mod, using Python built-in exponents.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> powermod_2(3,999,1000)  #  Multiply 999 times, modding along the way.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> pow(3,999,1000)  #  Use the Python built-in modular exponent.
</pre></div>
</div>
</div>
</div>
<p>The fully built-in modular exponentiation <code class="docutils literal notranslate"><span class="pre">pow(b,e,m)</span></code> command is probably the fastest.  But our implementation of Pingala’s algorithm isn’t bad – it probably beats the simple <code class="docutils literal notranslate"><span class="pre">(b**e)</span> <span class="pre">%</span> <span class="pre">m</span></code> command (in the <code class="docutils literal notranslate"><span class="pre">powermod_1</span></code> function), and it’s certainly faster than our naive loop in <code class="docutils literal notranslate"><span class="pre">powermod_2</span></code>.</p>
<p>One can quantify the efficiency of these algorithms by analyzing how the <strong>time</strong> depends on the <strong>size</strong> of the input parameters.  For the sake of exposition, let us keep the base and modulus constant, and consider how the time varies with the size of the exponent.</p>
<p>As a function of the exponent <span class="math notranslate nohighlight">\(e\)</span>, our <code class="docutils literal notranslate"><span class="pre">powmod_Pingala</span></code> algorithm required some number of multiplications, bounded by twice the number of bits of <span class="math notranslate nohighlight">\(e\)</span>.  The number of bits of <span class="math notranslate nohighlight">\(e\)</span> is approximately <span class="math notranslate nohighlight">\(\log_2(e)\)</span>.  The size of the numbers multiplied is bounded by the size of the (constant) modulus.  In this way, the time taken by the <code class="docutils literal notranslate"><span class="pre">powmod_Pingala</span></code> algorithm should be <span class="math notranslate nohighlight">\(O(\log(e))\)</span>, meaning bounded by a constant times the logarithm of the exponent.</p>
<p>Contrast this with the slow <code class="docutils literal notranslate"><span class="pre">powermod_2</span></code> algorithm, which performs <span class="math notranslate nohighlight">\(e\)</span> multiplications, and has thus has runtime <span class="math notranslate nohighlight">\(O(e)\)</span>.</p>
</section>
<section id="the-miller-rabin-test">
<h3>The Miller-Rabin test<a class="headerlink" href="#the-miller-rabin-test" title="Link to this heading">#</a></h3>
<p>Pingala’s algorithm is effective for computing exponents, in ordinary arithmetic or in modular arithmetic.  In this way, we can look for violations of Fermat’s Little Theorem as before, to find witnesses to non-primality.  But if we look more closely at the algorithm… we can sometimes find violations of the ROO property of primes.  This strengthens the primality test.</p>
<p>To see this, we create out a “verbose” version of Pingala’s algorithm for modular exponentiation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">powmod_verbose</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">exponent</span><span class="p">,</span> <span class="n">modulus</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computing </span><span class="si">{}</span><span class="s2"> raised to </span><span class="si">{}</span><span class="s2">, modulo </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">exponent</span><span class="p">,</span> <span class="n">modulus</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The current number is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
    <span class="n">bitstring</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="n">exponent</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span> <span class="c1"># Chop off the &#39;0b&#39; part of the binary expansion of exponent</span>
    <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="n">bitstring</span><span class="p">:</span> <span class="c1"># Iterates through the &quot;letters&quot; of the string.  Here the letters are &#39;0&#39; or &#39;1&#39;.</span>
        <span class="n">sq_result</span> <span class="o">=</span> <span class="n">result</span><span class="o">*</span><span class="n">result</span> <span class="o">%</span> <span class="n">modulus</span>  <span class="c1"># We need to compute this in any case.</span>
        <span class="k">if</span> <span class="n">bit</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BIT 0:  </span><span class="si">{}</span><span class="s2"> squared is congruent to </span><span class="si">{}</span><span class="s2">, mod </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">sq_result</span><span class="p">,</span> <span class="n">modulus</span><span class="p">))</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">sq_result</span> 
        <span class="k">if</span> <span class="n">bit</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
            <span class="n">newresult</span> <span class="o">=</span> <span class="p">(</span><span class="n">sq_result</span> <span class="o">*</span> <span class="n">base</span><span class="p">)</span> <span class="o">%</span> <span class="n">modulus</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BIT 1:  </span><span class="si">{}</span><span class="s2"> squared times </span><span class="si">{}</span><span class="s2"> is congruent to </span><span class="si">{}</span><span class="s2">, mod </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">newresult</span><span class="p">,</span> <span class="n">modulus</span><span class="p">))</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">newresult</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">powmod_verbose</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">560</span><span class="p">,</span><span class="mi">561</span><span class="p">)</span>  <span class="c1"># 561 is a Carmichael number.</span>
</pre></div>
</div>
</div>
</div>
<p>The function has displayed every step in Pingala’s algorithm.  The final result is that <span class="math notranslate nohighlight">\(2^{560} \equiv 1\)</span> mod <span class="math notranslate nohighlight">\(561\)</span>.  So in this sense, <span class="math notranslate nohighlight">\(2\)</span> is a bad witness.  For <span class="math notranslate nohighlight">\(561\)</span> is not prime (3 is a factor), but it does not violate Fermat’s Little Theorem when <span class="math notranslate nohighlight">\(2\)</span> is the base.</p>
<p>But within the verbose output above, there is a violation of the ROO property.  The penultimate line states that “67 squared is congruent to 1, mod 561”.  But if 561 were prime, only 1 and 560 are square roots of 1.  Hence this penultimate line implies that 561 is not prime (again, without finding a factor!).</p>
<p>This underlies the Miller-Rabin test.  We carry out Pingala’s exponentiation algorithm to compute <span class="math notranslate nohighlight">\(b^{p-1}\)</span> modulo <span class="math notranslate nohighlight">\(p\)</span>.  If we find a violation of ROO along the way, then the test number <span class="math notranslate nohighlight">\(p\)</span> is not prime.  And if, at the end, the computation does not yield <span class="math notranslate nohighlight">\(1\)</span>, we have found a Fermat’s Little Theorem (FLT) violation, and the test number <span class="math notranslate nohighlight">\(p\)</span> is not prime.</p>
<p>The function below implements the Miller-Rabin test on a number <span class="math notranslate nohighlight">\(p\)</span>, using a given base.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">base</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Tests whether p is prime, using the given base.</span>
<span class="sd">    The result False implies that p is definitely not prime.</span>
<span class="sd">    The result True implies that p **might** be prime.</span>
<span class="sd">    It is not a perfect test!</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">exponent</span> <span class="o">=</span> <span class="n">p</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">modulus</span> <span class="o">=</span> <span class="n">p</span>
    <span class="n">bitstring</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="n">exponent</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span> <span class="c1"># Chop off the &#39;0b&#39; part of the binary expansion of exponent</span>
    <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="n">bitstring</span><span class="p">:</span> <span class="c1"># Iterates through the &quot;letters&quot; of the string.  Here the letters are &#39;0&#39; or &#39;1&#39;.</span>
        <span class="n">sq_result</span> <span class="o">=</span> <span class="n">result</span><span class="o">*</span><span class="n">result</span> <span class="o">%</span> <span class="n">modulus</span>  <span class="c1"># We need to compute this in any case.</span>
        <span class="k">if</span> <span class="n">sq_result</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">result</span> <span class="o">!=</span> <span class="n">exponent</span><span class="p">):</span>  <span class="c1"># Note that exponent is congruent to -1, mod p.</span>
                <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># a ROO violation occurred, so p is not prime</span>
        <span class="k">if</span> <span class="n">bit</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">sq_result</span> 
        <span class="k">if</span> <span class="n">bit</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">sq_result</span> <span class="o">*</span> <span class="n">base</span><span class="p">)</span> <span class="o">%</span> <span class="n">modulus</span>
    <span class="k">if</span> <span class="n">result</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># a FLT violation occurred, so p is not prime.</span>
    
    <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># If we made it this far, no violation occurred and p might be prime.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="mi">101</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>How good is the Miller-Rabin test?  Will this modest improvement (looking for ROO violations) improve the reliability of witnesses?  Let’s see how many witnesses observe the nonprimality of 41041.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">witness</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">MR</span> <span class="o">=</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="mi">41041</span><span class="p">,</span> <span class="n">witness</span><span class="p">)</span> <span class="c1"># </span>
    <span class="k">if</span> <span class="n">MR</span><span class="p">:</span> 
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is a bad witness.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">witness</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> detects that 41041 is not prime.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">witness</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>In fact, one can prove that at least 3/4 of the witnesses will detect the non-primality of any non-prime.  Thus, if you keep on asking witnesses at random, your chances of detecting non-primality increase exponentially!  In fact, the witness 2 suffices to check whether any number is prime or not up to 2047.  In other words, if <span class="math notranslate nohighlight">\(p &lt; 2047\)</span>, then <span class="math notranslate nohighlight">\(p\)</span> is prime if and only if <code class="docutils literal notranslate"><span class="pre">Miller_Rabin(p,2)</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code>.  Just using the witnesses 2 and 3 suffice to check primality for numbers up to a million (1373653, to be precise, according to <a class="reference external" href="https://en.wikipedia.org/wiki/Miller%E2%80%93Rabin_primality_test">Wikipedia</a>.)</p>
<p>The general strategy behind the Miller-Rabin test then is to use just a few witnesses for smallish potential primes (say, up to <span class="math notranslate nohighlight">\(2^{64}\)</span>).  For larger numbers, try some number <span class="math notranslate nohighlight">\(x\)</span> (like 20 or 50) random bases.  If the tested number <strong>is</strong> composite, then the probability of all witnesses reporting <code class="docutils literal notranslate"><span class="pre">True</span></code> is is less than <span class="math notranslate nohighlight">\(1 / 4^x\)</span>.  With 50 random witnesses, the chance that a composite number tests as prime is less than <span class="math notranslate nohighlight">\(10^{-30}\)</span>.</p>
<p>Note that these are statements about <strong>conditional probability</strong>.  In more formal language,
$<span class="math notranslate nohighlight">\(\text{Prob} \left( \text{tests prime} \ \vert \ \text{ is composite} \right) &lt; \frac{1}{4^{\# \text{witnesses} } }.\)</span><span class="math notranslate nohighlight">\(
As those who study medical testing know, this probability differs from the probability that most people care about:  the probability that a number is prime, given that it tests prime.  The relationship between the two probabilities is given by Bayes Theorem, and depends on the **prevalence** of primes among the sample.  If our sample consists of numbers of absolute value about \)</span>N<span class="math notranslate nohighlight">\(, then the prevalence of primes will be about \)</span>1 / \log(N)<span class="math notranslate nohighlight">\(, and the probability of primality given a positive test result can be approximated. 
\)</span><span class="math notranslate nohighlight">\(\text{Prob} \left( \text{ is prime } \ \vert \ \text{ tests prime } \right) &gt; 1 - \frac{\log(N) - 1}{4^{\# \text{witnesses}}}.\)</span><span class="math notranslate nohighlight">\(
As one chooses more witnesses, this probability becomes extremely close to \)</span>1$.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">mpmath</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="c1"># The mpmath package allows us to compute with arbitrary precision!</span>
<span class="c1"># It has specialized functions for log, sin, exp, etc.., with arbitrary precision.</span>
<span class="c1"># It is probably installed with your version of Python.</span>

<span class="k">def</span><span class="w"> </span><span class="nf">prob_prime</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">witnesses</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Conservatively estimates the probability of primality, given a positive test result.</span>
<span class="sd">    N is an approximation of the size of the tested number.</span>
<span class="sd">    witnesses is the number of witnesses.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">mp</span><span class="o">.</span><span class="n">dps</span> <span class="o">=</span> <span class="n">witnesses</span> <span class="c1"># mp.dps is the number of digits of precision.  We adapt this as needed for input.</span>
    <span class="n">prob_prime</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span><span class="o">**</span><span class="n">witnesses</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">prob_prime</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">% c</span><span class="s2">hance of primality&quot;</span><span class="p">)</span> <span class="c1"># Use str to convert mpmath float to string for printing.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prob_prime</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span> <span class="c1"># Chance of primality with 50 witnesses, if a 100-digit number is tested.</span>
</pre></div>
</div>
</div>
</div>
<p>We implement the Miller-Rabin test for primality in the <code class="docutils literal notranslate"><span class="pre">is_prime</span></code> function below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">is_prime</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">witnesses</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>  <span class="c1"># witnesses is a parameter with a default value.</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Tests whether a positive integer p is prime.</span>
<span class="sd">    For p &lt; 2^64, the test is deterministic, using known good witnesses.</span>
<span class="sd">    Good witnesses come from a table at Wikipedia&#39;s article on the Miller-Rabin test,</span>
<span class="sd">    based on research by Pomerance, Selfridge and Wagstaff, Jaeschke, Jiang and Deng.</span>
<span class="sd">    For larger p, a number (by default, 50) of witnesses are chosen at random.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">%</span><span class="k">2</span> == 0): # Might as well take care of even numbers at the outset!
        <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span> 
    
    <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="o">**</span><span class="mi">64</span><span class="p">:</span>  <span class="c1"># We use the probabilistic test for large p.</span>
        <span class="n">trial</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">trial</span> <span class="o">&lt;</span> <span class="n">witnesses</span><span class="p">:</span>
            <span class="n">trial</span> <span class="o">=</span> <span class="n">trial</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">witness</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">p</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># A good range for possible witnesses</span>
            <span class="k">if</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">witness</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>
    
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># We use a determinisic test for p &lt;= 2**64.</span>
        <span class="n">verdict</span> <span class="o">=</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">2047</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">verdict</span> <span class="c1"># The witness 2 suffices.</span>
        <span class="n">verdict</span> <span class="o">=</span> <span class="n">verdict</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">1373653</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">verdict</span> <span class="c1"># The witnesses 2 and 3 suffice.</span>
        <span class="n">verdict</span> <span class="o">=</span> <span class="n">verdict</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">25326001</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">verdict</span> <span class="c1"># The witnesses 2,3,5 suffice.</span>
        <span class="n">verdict</span> <span class="o">=</span> <span class="n">verdict</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">3215031751</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">verdict</span> <span class="c1"># The witnesses 2,3,5,7 suffice.</span>
        <span class="n">verdict</span> <span class="o">=</span> <span class="n">verdict</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">2152302898747</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">verdict</span> <span class="c1"># The witnesses 2,3,5,7,11 suffice.</span>
        <span class="n">verdict</span> <span class="o">=</span> <span class="n">verdict</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">13</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">3474749660383</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">verdict</span> <span class="c1"># The witnesses 2,3,5,7,11,13 suffice.</span>
        <span class="n">verdict</span> <span class="o">=</span> <span class="n">verdict</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">17</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">341550071728321</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">verdict</span> <span class="c1"># The witnesses 2,3,5,7,11,17 suffice.</span>
        <span class="n">verdict</span> <span class="o">=</span> <span class="n">verdict</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">19</span><span class="p">)</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">23</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">3825123056546413051</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">verdict</span> <span class="c1"># The witnesses 2,3,5,7,11,17,19,23 suffice.</span>
        <span class="n">verdict</span> <span class="o">=</span> <span class="n">verdict</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">29</span><span class="p">)</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">31</span><span class="p">)</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">37</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">verdict</span> <span class="c1"># The witnesses 2,3,5,7,11,17,19,23,29,31,37 suffice for testing up to 2^64. </span>
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">is_prime</span><span class="p">(</span><span class="mi">1000000000000066600000000000001</span><span class="p">)</span>  <span class="c1"># This is Belphegor&#39;s prime.</span>
</pre></div>
</div>
</div>
</div>
<p>How fast is our new <code class="docutils literal notranslate"><span class="pre">is_prime</span></code> function?  Let’s give it a try.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> is_prime(234987928347928347928347928734987398792837491)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> is_prime(1000000000000066600000000000001)
</pre></div>
</div>
</div>
</div>
<p>The results will probably on the order of a millisecond, perhaps even a tenth of a millisecond (<span class="math notranslate nohighlight">\(10^{-4}\)</span> seconds) for non-primes!  That’s much faster than looking for factors, for numbers of this size.  In this way, we can test primality of numbers of hundreds of digits!</p>
<p>For an application, let’s find some Mersenne primes.  Recall that a Mersenne prime is a prime of the form <span class="math notranslate nohighlight">\(2^p - 1\)</span>.  Note that when <span class="math notranslate nohighlight">\(2^p - 1\)</span> is prime, it must be the case that <span class="math notranslate nohighlight">\(p\)</span> is a prime too.  We will quickly find the Mersenne primes with <span class="math notranslate nohighlight">\(p\)</span> up to 1000 below!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1000</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">is_prime</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>  <span class="c1"># We only need to check these p.</span>
        <span class="n">M</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span> <span class="c1"># A candidate for a Mersenne prime.</span>
        <span class="k">if</span> <span class="n">is_prime</span><span class="p">(</span><span class="n">M</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2^</span><span class="si">{}</span><span class="s2"> - 1 = </span><span class="si">{}</span><span class="s2"> is a Mersenne prime.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">M</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id20">
<h3>Exercises<a class="headerlink" href="#id20" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Recall that if <span class="math notranslate nohighlight">\(2^p - 1\)</span> is a Mersenne prime, then Euclid proved that <span class="math notranslate nohighlight">\((2^p - 1) \cdot 2^{p-1}\)</span> is a perfect number.  Find all the (even) perfect numbers up to <span class="math notranslate nohighlight">\(2^{1000}\)</span>.  (Note:  nobody has ever found an odd perfect number.  All even perfect numbers arise from Mersenne primes by Euclid’s recipe.)</p></li>
<li><p>The Fermat sequence is the sequence of numbers 3, 5, 257, 65537, etc., of the form <span class="math notranslate nohighlight">\(2^{2^n} + 1\)</span> for <span class="math notranslate nohighlight">\(n \geq 0\)</span>.  Test the primality of these numbers for <span class="math notranslate nohighlight">\(n\)</span> up to 10.</p></li>
<li><p>Why does the is_prime function (using Miller-Rabin) runs more quickly on non-primes than it does on primes?</p></li>
<li><p>Compare the performance of the new <code class="docutils literal notranslate"><span class="pre">is_prime</span></code> function to “trial division” (looking for factors up to the square root of the test number).  Which is faster for small numbers (1-digit, 2-digits, 3-digits, etc.)?  Adapt the <code class="docutils literal notranslate"><span class="pre">is_prime</span></code> function to perform trial division for small numbers in order to optimize performance.</p></li>
<li><p>Estimate the probability that a randomly chosen 10-digit number is prime, by running is_prime on a large number of samples.  How does this probability vary as the number of digits increases (e.g., from 10 digits to 11 digits to 12 digits, etc., onto 20 digits)?</p></li>
</ol>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="part-6-ciphers-and-key-exchange-in-python-3-x">
<h1>Part 6:  Ciphers and Key exchange in Python 3.x<a class="headerlink" href="#part-6-ciphers-and-key-exchange-in-python-3-x" title="Link to this heading">#</a></h1>
<p>In this notebook, we introduce cryptography – how to communicate securely over insecure channels.  We begin with a study of two basic ciphers, the Caesar cipher and its fancier variant, the Vigenère cipher.  The Vigenère cipher uses a <strong>key</strong> to turn <strong>plaintext</strong> (i.e., the  message) into <strong>ciphertext</strong> (the coded message), and uses the same key to turn the ciphertext back into plaintext.  Therefore, two parties can communicate securely if they – and only they – possess the key.</p>
<p>If the security of communication rests on possession of a common key, then we’re left with a new problem:  how do the two parties agree on a common key, especially if they are far apart and communicating over an insecure channel?</p>
<p>A clever solution to this problem was published in 1976 by Whitfield Diffie and Martin Hellman, and so it’s called Diffie-Hellman key exchange.  It takes advantage of modular arithmetic:  the existence of a primitive root (modulo a prime) and the difficulty of solving the <strong>discrete logarithm</strong> problem.</p>
<p>This part complements <strong>Chapter 6</strong> of An Illustrated Theory of Numbers.</p>
<section id="id21">
<h2>Table of Contents<a class="headerlink" href="#id21" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#cipher"><span class="xref myst">Ciphers</span></a></p></li>
<li><p><a class="reference internal" href="#keyexchange"><span class="xref myst">Key exchange</span></a></p></li>
</ul>
<p><a id='cipher'></a></p>
</section>
<section id="ciphers">
<h2>Ciphers<a class="headerlink" href="#ciphers" title="Link to this heading">#</a></h2>
<p>A cipher is a way of transforming a message, called the <strong>plaintext</strong> into a different form, the <strong>ciphertext</strong>, which conceals the meaning to all but the intended recipient(s).  A cipher is a <em>code</em>, and can take many forms.  A <strong>substitution cipher</strong> might simply change every letter to a different letter in the alphabet.  This is the idea behind “Cryptoquip” puzzles.  These are not too hard for people to solve, and are easy for computers to solve, using frequency analysis (understanding how often different letters or letter-combinations occur).</p>
<section id="ascii-code-and-the-caesar-cipher">
<h3>ASCII code and the Caesar cipher<a class="headerlink" href="#ascii-code-and-the-caesar-cipher" title="Link to this heading">#</a></h3>
<p>Even though substitution ciphers are easy to break, they are a good starting point.  To implement substitution ciphers in Python, we need to study the <em>string</em> type in a bit more detail.  To declare a string variable, just put your string in quotes.  You can use any letters, numbers, spaces, and many symbols inside a string.  You can enclose your string by single quotes, like <code class="docutils literal notranslate"><span class="pre">'Hello'</span></code> or double-quotes, like <code class="docutils literal notranslate"><span class="pre">&quot;Hello&quot;</span></code>.  This flexibility is convenient, if you want to <em>use</em> quotes within your string.  For example, the string <em>Prince’s favorite prime is 1999</em> should be described in Python with double-quotes <code class="docutils literal notranslate"><span class="pre">&quot;Prince's</span> <span class="pre">favorite</span> <span class="pre">prime</span> <span class="pre">is</span> <span class="pre">1999&quot;</span></code> so that the apostrophe doesn’t confuse things.</p>
<p>Strings are indexed, and their letters can be retrieved as if the string were a <em>list</em> of letters.  Python experts will note that strings are <em>immutable</em> while lists are <em>mutable</em> objects, but we aren’t going to worry about that here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">W</span> <span class="o">=</span> <span class="s2">&quot;Hello&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">W</span><span class="p">)):</span>  <span class="c1"># len(W) is the length of the string W.</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">W</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>  <span class="c1"># Access the jth character of the string.</span>
</pre></div>
</div>
</div>
</div>
<p>Each “letter” of a string again belongs to the string type.  A string of length one is called a <strong>character</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">W</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">W</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>  <span class="c1"># W[0] is a character.</span>
</pre></div>
</div>
</div>
</div>
<p>Since computers store data in binary, the designers of early computers (1960s) created a code called <a class="reference external" href="https://en.wikipedia.org/wiki/ASCII"><strong>ASCII</strong></a> (American Standard Code for Information Interchange) to associate to each character a number between 0 and 127.  Every number between 0 and 127 is represented in binary by 7 bits (between 0000000 and 1111111), and so each character is stored with 7 bits of memory.  Later, ASCII was extended with another 128 characters, so that codes between 0 and 255 were used, requiring 8 bits.  8 bits of memory is called a <strong>byte</strong>.  One byte of memory suffices to store one (extended ASCII) character.</p>
<p>You might notice that there are 256 ASCII codes available, but there are fewer than 256 characters available on your keyboard, even once you include symbols like <code class="docutils literal notranslate"><span class="pre">#</span></code> and <code class="docutils literal notranslate"><span class="pre">;</span></code>.  Some of these “extra” codes are for accented letters, and others are relics of old computers.  For example, ASCII code 7 (0000111) stands for the “bell”, and readers born in the 1970s or earlier might remember making the Apple II computer beep by pressing Control-G on the keyboard (“G” is the 7th letter).  You can look up a <a class="reference external" href="http://www.asciitable.com/">full ASCII table</a> if you’re curious.</p>
<p>Nowadays, the global community of computer users requires far more than 256 “letters” – there are many alphabets around the world!  So instead of ASCII, we can access over 100 thousand <strong>unicode</strong> characters.  Scroll through a <a class="reference external" href="https://unicode-table.com/en/">unicode table</a> to see what is possible.  With emoji, unicode tables have entered <a class="reference external" href="https://xkcd.com/1813/">unexpected territory</a>.  Python version 3.x fully supports Unicode in all strings.</p>
<p>But here we stay within old-fashioned ASCII codes, since they will suffice for basic English messages.  Python has built-in commands <code class="docutils literal notranslate"><span class="pre">chr</span></code> and <code class="docutils literal notranslate"><span class="pre">ord</span></code> for converting from code-number (0–255) to character and back again.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">chr</span><span class="p">(</span><span class="mi">65</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The following code will produce a table of the ASCII characters with codes between 32 and 126.  This is a good range which includes all the most common English characters and symbols on a U.S. keyboard.  Note that ASCII code 32 corresponds to an empty space (an important character for long messages!)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span><span class="mi">127</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ASCII </span><span class="si">{}</span><span class="s2"> is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Since we only work with the ASCII range between 32 and 126, it will be useful to “cycle” other numbers into this range.  For example, we will interpret 127 as 32, 128 as 33, etc., when we convert out-of-range numbers into characters.</p>
<p>The following function forces a number into a given range, using the mod operator.  It’s a common trick, to make lists loop around cyclically.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">inrange</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">range_min</span><span class="p">,</span> <span class="n">range_max</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    The input number n can be any integer.</span>
<span class="sd">    The output number will be between range_min and range_max (inclusive)</span>
<span class="sd">    If the input number is already within range, it will not change.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">range_len</span> <span class="o">=</span> <span class="n">range_max</span> <span class="o">-</span> <span class="n">range_min</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">n</span> <span class="o">%</span> <span class="n">range_len</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">range_min</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">range_len</span>
    <span class="k">return</span> <span class="n">a</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inrange</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inrange</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can implement a <strong>substitution cipher</strong> by converting characters to their ASCII codes, shuffling the codes, and converting back.  One of the simplest substitution ciphers is called a <strong>Caesar cipher</strong>, in which each character is shifted – by a fixed amount – down the list.  For example, a Caesar cipher of shift 3 would send ‘A’ to ‘D’ and ‘B’ to ‘E’, etc..  Near the end of the list, characters are shifted back to the beginning – the list is considered cyclicly, using our <code class="docutils literal notranslate"><span class="pre">inrange</span></code> function.</p>
<p>Here is an implementation of the Caesar cipher, using the ASCII range between 32 and 126.  We begin with a function to shift a single character.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">Caesar_shift</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">shift</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Shifts the character c by shift units</span>
<span class="sd">    within the ASCII table between 32 and 126. </span>
<span class="sd">    The shift parameter can be any integer!</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">ascii</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">ascii</span> <span class="o">+</span> <span class="n">shift</span> <span class="c1"># Now we have a number between 32+shift and 126+shift.</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">inrange</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">126</span><span class="p">)</span> <span class="c1"># Put the number back in range.</span>
    <span class="k">return</span> <span class="nb">chr</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s see the effect of the Caesar cipher on our ASCII table.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span><span class="mi">127</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ASCII </span><span class="si">{}</span><span class="s2"> is </span><span class="si">{}</span><span class="s2">, which shifts to </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">Caesar_shift</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="mi">5</span><span class="p">)))</span> <span class="c1"># Shift by 5.</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can use the Caesar cipher to encrypt <em>strings</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">Caesar_cipher</span><span class="p">(</span><span class="n">plaintext</span><span class="p">,</span> <span class="n">shift</span><span class="p">):</span>
    <span class="n">ciphertext</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">plaintext</span><span class="p">:</span>  <span class="c1"># Iterate through the characters of a string.</span>
        <span class="n">ciphertext</span> <span class="o">=</span> <span class="n">ciphertext</span> <span class="o">+</span> <span class="n">Caesar_shift</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">shift</span><span class="p">)</span>  
    <span class="k">return</span> <span class="n">ciphertext</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">Caesar_cipher</span><span class="p">(</span><span class="s1">&#39;Hello!  Can you read this?&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>  <span class="c1"># Shift forward 5 units in ASCII.</span>
</pre></div>
</div>
</div>
</div>
<p>As designed, the Caesar cipher turns <em>plaintext</em> into <em>ciphertext</em> by using a shift of the ASCII table.  To <em>decipher</em> the ciphertext, one can just use the Caesar cipher again, with the negative shift.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">Caesar_cipher</span><span class="p">(</span><span class="s1">&#39;Mjqqt&amp;</span><span class="si">%%</span><span class="s1">Hfs%~tz%wjfi%ymnxD&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">))</span>  <span class="c1"># Shift back 5 units in ASCII.</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-vigenere-cipher">
<h3>The Vigenère cipher<a class="headerlink" href="#the-vigenere-cipher" title="Link to this heading">#</a></h3>
<p>The Caesar cipher is pretty easy to break, by a brute force attack (shift by all possible values) or a frequency analysis (compare the frequency of characters in a message to the frequency of characters in typical English messages, to make a guess).</p>
<p>The Vigenère cipher is a variant of the Caesar cipher which uses an <strong>ecryption key</strong> to vary the shift-parameter throughout the encryption process.  For example, to encrypt the message “This is very secret” using the key “Key”, you line up the characters of the message above repeated copies of the key.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>T</p></th>
<th class="head"><p>h</p></th>
<th class="head"><p>i</p></th>
<th class="head"><p>s</p></th>
<th class="head"><p></p></th>
<th class="head"><p>i</p></th>
<th class="head"><p>s</p></th>
<th class="head"><p></p></th>
<th class="head"><p>v</p></th>
<th class="head"><p>e</p></th>
<th class="head"><p>r</p></th>
<th class="head"><p>y</p></th>
<th class="head"><p></p></th>
<th class="head"><p>s</p></th>
<th class="head"><p>e</p></th>
<th class="head"><p>c</p></th>
<th class="head"><p>r</p></th>
<th class="head"><p>e</p></th>
<th class="head"><p>t</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>K</p></td>
<td><p>e</p></td>
<td><p>y</p></td>
<td><p>K</p></td>
<td><p>e</p></td>
<td><p>y</p></td>
<td><p>K</p></td>
<td><p>e</p></td>
<td><p>y</p></td>
<td><p>K</p></td>
<td><p>e</p></td>
<td><p>y</p></td>
<td><p>K</p></td>
<td><p>e</p></td>
<td><p>y</p></td>
<td><p>K</p></td>
<td><p>e</p></td>
<td><p>y</p></td>
<td><p>K</p></td>
</tr>
</tbody>
</table>
</div>
<p>Then, you turn everything into ASCII (or your preferred numerical system), and use the bottom row to shift the top row.</p>
<p>ASCII message | 84 | 104 | 105 | 115 | 32 | 105 | 115 | 32 | 118 | 101 | 114 | 121 | 32 | 115 | 101 | 99 | 114 | 101 | 116
—|—–|—–
Shift | 75 | 101 | 121 | 75 | 101 | 121 | 75 | 101 | 121 | 75 | 101 | 121 | 75 | 101 | 121 | 75 | 101 | 121 | 75
ASCII shifted | 159 | 205 | 226 | 190 | 133 | 226 | 190 | 133 | 239 | 176 | 215 | 242 | 107 | 216 | 222 | 174 | 215 | 222 | 191
ASCII shifted in range |   64 | 110 | 36 | 95 | 38 | 36 | 95 | 38 | 49 | 81 | 120 | 52 | 107 | 121 | 32 | 79 | 120 | 32 | 96</p>
<p>Finally, the shifted ASCII codes are converted back into characters for transmission.  In this case, the codes 64,110,36,95, etc., are converted to the ciphertext <code class="docutils literal notranslate"><span class="pre">&quot;&#64;n$_&amp;$_&amp;1Qx4ky</span> <span class="pre">Ox</span> <span class="pre">\`&quot;</span></code></p>
<p>The Vigenère cipher is much harder to crack than the Caesar cipher, if you don’t have the key.  Indeed, the varying shifts make frequency analysis more difficult.  The Vigenère cipher is weak by today’s standards (see <a class="reference external" href="https://en.wikipedia.org/wiki/Vigen%C3%A8re_cipher#Cryptanalysis">Wikipedia</a> for a description of 19th century attacks), but illustrates the basic actors in a <strong>symmetric key</strong> cryptosystem: the plaintext, ciphertext, and a single key.  Today, symmetric key cryptosystems like <a class="reference external" href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard">AES</a> and <a class="reference external" href="https://en.wikipedia.org/wiki/Triple_DES">3DES</a> are used all the time for secure communication.</p>
<p>Below, we implement the Vigenère cipher.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">Vigenere_cipher</span><span class="p">(</span><span class="n">plaintext</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="n">ciphertext</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># Start with an empty string</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">plaintext</span><span class="p">)):</span> 
        <span class="n">c</span> <span class="o">=</span> <span class="n">plaintext</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="c1"># the jth letter of the plaintext</span>
        <span class="n">key_index</span> <span class="o">=</span> <span class="n">j</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="c1"># Cycle through letters of the key.</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="n">key_index</span><span class="p">])</span> <span class="c1"># How much we shift c by.</span>
        <span class="n">ciphertext</span> <span class="o">=</span> <span class="n">ciphertext</span> <span class="o">+</span> <span class="n">Caesar_shift</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">shift</span><span class="p">)</span> <span class="c1"># Add new letter to ciphertext</span>
    <span class="k">return</span> <span class="n">ciphertext</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">Vigenere_cipher</span><span class="p">(</span><span class="s1">&#39;This is very secret&#39;</span><span class="p">,</span> <span class="s1">&#39;Key&#39;</span><span class="p">))</span> <span class="c1"># &#39;Key&#39; is probably a bad key!!</span>
</pre></div>
</div>
</div>
</div>
<p>The Vigenère cipher is called a <strong>symmetric</strong> cryptosystem, because the same key that is used to encrypt the plaintext can be used to decrypt the ciphertext.  All we do is <em>subtract</em> the shift at each stage.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">Vigenere_decipher</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="n">plaintext</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># Start with an empty string</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">)):</span> 
        <span class="n">c</span> <span class="o">=</span> <span class="n">ciphertext</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="c1"># the jth letter of the ciphertext</span>
        <span class="n">key_index</span> <span class="o">=</span> <span class="n">j</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="c1"># Cycle through letters of the key.</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="o">-</span> <span class="nb">ord</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="n">key_index</span><span class="p">])</span> <span class="c1"># Note the negative sign to decipher!</span>
        <span class="n">plaintext</span> <span class="o">=</span> <span class="n">plaintext</span> <span class="o">+</span> <span class="n">Caesar_shift</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">shift</span><span class="p">)</span> <span class="c1"># Add new letter to plaintext</span>
    <span class="k">return</span> <span class="n">plaintext</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">Vigenere_decipher</span><span class="p">(</span><span class="s1">&#39;@n$_&amp;$_&amp;1Qx4ky Ox `&#39;</span><span class="p">,</span> <span class="s1">&#39;Key&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Try a few cipher/deciphers yourself to get used to the Vigenere system.</span>
</pre></div>
</div>
</div>
</div>
<p>The Vigenère cipher becomes an effective way for two parties to communicate securely, as long as they <strong>share a secret key</strong>.  In the 19th century, this often meant that the parties would require an initial in-person meeting to agree upon a key, or a well-guarded messenger would carry the key from one party to the other.</p>
<p>Today, as we wish to communicate securely over long distances on a regular basis, the process of agreeing on a key is more difficult.  It seems like a chicken-and-egg problem, where we need a shared secret to communicate securely, but we can’t share a secret without communicating securely in the first place!</p>
<p>Remarkably, this secret-sharing problem can be solved with some modular arithmetic tricks.  This is the subject of the next section.</p>
</section>
<section id="id22">
<h3>Exercises<a class="headerlink" href="#id22" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>A Caesar cipher was used to encode a message, with the resulting ciphertext:  <code class="docutils literal notranslate"><span class="pre">'j!\'1r$v1&quot;$v&amp;&amp;+1t}v(v$2'</span></code>.  Use a loop (brute force attack) to figure out the original message.</p></li>
<li><p>Imagine that you encrypt a long message (e.g., 1000 words of standard English) with a Vigenère cipher.  How might you detect the <em>length</em> of the key, if it is short (e.g. 3 or 4 characters)?</p></li>
<li><p>Consider running a plaintext message through a Vigenère cipher with a 3-character key, and then running the ciphertext through a Vigenère cipher with a 4-character key.  Explain how this is equivalent to running the original message through a single cipher with a 12-character key.</p></li>
</ol>
<p><a id='keyexchange'></a></p>
</section>
</section>
<section id="key-exchange">
<h2>Key exchange<a class="headerlink" href="#key-exchange" title="Link to this heading">#</a></h2>
<p>Now we study Diffie-Hellman <strong>key exchange</strong>, a remarkable way for two parties to share a secret without ever needing to directly communicate the secret with each other.  Their method is based on properties of modular exponentiation and the existence of a <strong>primitive root</strong> modulo prime numbers.</p>
<section id="primitive-roots-and-sophie-germain-primes">
<h3>Primitive roots and Sophie Germain primes<a class="headerlink" href="#primitive-roots-and-sophie-germain-primes" title="Link to this heading">#</a></h3>
<p>If <span class="math notranslate nohighlight">\(p\)</span> is a prime number, and <span class="math notranslate nohighlight">\(GCD(a,p) = 1\)</span>, then recall Fermat’s Little Theorem:  $<span class="math notranslate nohighlight">\(a^{p-1} \equiv 1 \text{ mod } p.\)</span><span class="math notranslate nohighlight">\(
It may be the case that \)</span>a^\ell \equiv 1<span class="math notranslate nohighlight">\( mod \)</span>p<span class="math notranslate nohighlight">\( for some smaller (positive) value of \)</span>\ell<span class="math notranslate nohighlight">\( however.  The smallest such positive value of \)</span>\ell<span class="math notranslate nohighlight">\( is called the **order** (multiplicative order, to be precise) of \)</span>a<span class="math notranslate nohighlight">\( modulo \)</span>p<span class="math notranslate nohighlight">\(, and it is always a divisor of \)</span>p-1$.</p>
<p>The following code determines the order of a number, mod <span class="math notranslate nohighlight">\(p\)</span>, with a brute force approach.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">mult_order</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Determines the (multiplicative) order of an integer</span>
<span class="sd">    a, modulo p.  Here p is prime, and GCD(a,p) = 1.</span>
<span class="sd">    If bad inputs are used, this might lead to a </span>
<span class="sd">    never-ending loop!</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">current_number</span> <span class="o">=</span> <span class="n">a</span> <span class="o">%</span> <span class="n">p</span>
    <span class="n">current_exponent</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">current_number</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">current_number</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_number</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span><span class="o">%</span><span class="k">p</span>
        <span class="n">current_exponent</span> <span class="o">=</span> <span class="n">current_exponent</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">current_exponent</span>
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">37</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The multiplicative order of </span><span class="si">{}</span><span class="s2"> modulo 37 is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">mult_order</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">37</span><span class="p">)))</span>
    <span class="c1"># These orders should all be divisors of 36.</span>
</pre></div>
</div>
</div>
</div>
<p>A theorem of Gauss states that, if <span class="math notranslate nohighlight">\(p\)</span> is prime, there exists an integer <span class="math notranslate nohighlight">\(b\)</span> whose order is precisely <span class="math notranslate nohighlight">\(p-1\)</span> (as big as possible!).  Such an integer is called a <strong>primitive root</strong> modulo <span class="math notranslate nohighlight">\(p\)</span>.  For example, the previous computation found 12 primitive roots modulo <span class="math notranslate nohighlight">\(37\)</span>:  they are 2,5,13,15,17,18,19,20,22,24,32,35.  To see these illustrated (mod 37), check out <a class="reference external" href="https://fineartamerica.com/featured/epicycles-modulo-37-martin-weissman.html">this poster</a> (yes, that is blatant self-promotion!)</p>
<p>For everything that follows, suppose that <span class="math notranslate nohighlight">\(p\)</span> is a prime number.  Not only do primitive roots <em>exist</em> mod <span class="math notranslate nohighlight">\(p\)</span>, but they are pretty common.  In fact, the number of primitive roots mod <span class="math notranslate nohighlight">\(p\)</span> equals <span class="math notranslate nohighlight">\(\phi(p-1)\)</span>, where <span class="math notranslate nohighlight">\(\phi\)</span> denotes Euler’s totient.  On average, <span class="math notranslate nohighlight">\(\phi(n)\)</span> is about <span class="math notranslate nohighlight">\(6 / \pi^2\)</span> times <span class="math notranslate nohighlight">\(n\)</span> (for positive integers <span class="math notranslate nohighlight">\(n\)</span>).  While numbers of the form <span class="math notranslate nohighlight">\(p-1\)</span> are not “average”, one still expects that <span class="math notranslate nohighlight">\(\phi(p-1)\)</span> is a not-very-small fraction of <span class="math notranslate nohighlight">\(p-1\)</span>.  You should not have to look very far if you want to <em>find</em> a primitive root.</p>
<p>The more difficult part, in practice, is determining whether a number <span class="math notranslate nohighlight">\(b\)</span> is or is not a primitive root modulo <span class="math notranslate nohighlight">\(p\)</span>.  When <span class="math notranslate nohighlight">\(p\)</span> is very large (like hundreds or thousands of digits), <span class="math notranslate nohighlight">\(p-1\)</span> is also very large.  It is certainly not practical to cycle all the powers (from <span class="math notranslate nohighlight">\(1\)</span> to <span class="math notranslate nohighlight">\(p-1\)</span>) of <span class="math notranslate nohighlight">\(b\)</span> to determine whether <span class="math notranslate nohighlight">\(b\)</span> is a primitive root!</p>
<p>The better approach, sometimes, is to use the fact that the multiplicative order of <span class="math notranslate nohighlight">\(b\)</span> must be a <strong>divisor</strong> of <span class="math notranslate nohighlight">\(p-1\)</span>.  If one can find all the divisors of <span class="math notranslate nohighlight">\(p-1\)</span>, then one can just check whether <span class="math notranslate nohighlight">\(b^d \equiv 1\)</span> mod <span class="math notranslate nohighlight">\(p\)</span> for each divisor <span class="math notranslate nohighlight">\(d\)</span>.  This makes the problem of determining whether <span class="math notranslate nohighlight">\(b\)</span> is a primitive root just about as hard as the problem of factoring <span class="math notranslate nohighlight">\(p-1\)</span>.  This is a hard problem, in general!</p>
<p>But, for the application we’re interested in, we will want to have a large prime number <span class="math notranslate nohighlight">\(p\)</span> <strong>and</strong> a primitive root mod <span class="math notranslate nohighlight">\(p\)</span>.  The easiest way to do this is to use a <strong>Sophie Germain</strong> prime <span class="math notranslate nohighlight">\(q\)</span>.  A Sophie Germain prime is a prime number <span class="math notranslate nohighlight">\(q\)</span> such that <span class="math notranslate nohighlight">\(2q + 1\)</span> is also prime.  When <span class="math notranslate nohighlight">\(q\)</span> is a Sophie Germain prime, the resulting prime <span class="math notranslate nohighlight">\(p = 2q + 1\)</span> is called a <strong>safe prime</strong>.</p>
<p>Observe that when <span class="math notranslate nohighlight">\(p\)</span> is a safe prime, the prime decomposition of <span class="math notranslate nohighlight">\(p-1\)</span> is
$<span class="math notranslate nohighlight">\(p-1 = 2 \cdot q.\)</span><span class="math notranslate nohighlight">\(
That's it.  So the possible multiplicative orders of an element \)</span>b<span class="math notranslate nohighlight">\(, mod \)</span>p<span class="math notranslate nohighlight">\(, are the divisors of \)</span>2q<span class="math notranslate nohighlight">\(, which are
\)</span><span class="math notranslate nohighlight">\(1, 2, q, \text{ or } 2q.\)</span><span class="math notranslate nohighlight">\(
In order to check whether \)</span>b<span class="math notranslate nohighlight">\( is a primitive root, modulo a safe prime \)</span>p = 2q + 1<span class="math notranslate nohighlight">\(, we must check just three things:  is \)</span>b \equiv 1<span class="math notranslate nohighlight">\(, is \)</span>b^2 \equiv 1<span class="math notranslate nohighlight">\(, or is \)</span>b^q \equiv 1<span class="math notranslate nohighlight">\(, mod \)</span>p<span class="math notranslate nohighlight">\(?  If the answer to these three questions is NO, then \)</span>b<span class="math notranslate nohighlight">\( is a primitive root mod \)</span>p$.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">is_primroot_safe</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Checks whether b is a primitive root modulo p,</span>
<span class="sd">    when p is a safe prime.  If p is not safe,</span>
<span class="sd">    the results will not be good!</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">q</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>   <span class="c1"># q is the Sophie Germain prime</span>
    <span class="k">if</span> <span class="n">b</span><span class="o">%</span><span class="k">p</span> == 1:  # Is the multiplicative order 1?
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">b</span><span class="p">)</span><span class="o">%</span><span class="k">p</span> == 1:  # Is the multiplicative order 2?
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="nb">pow</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Is the multiplicative order q?</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># If not, then b is a primitive root mod p.</span>
</pre></div>
</div>
</div>
</div>
<p>This would not be very useful if we couldn’t find Sophie Germain primes.  Fortunately, they are not so rare.  The first few are 2, 3, 5, 11, 23, 29, 41, 53, 83, 89.  It is expected, but unproven that there are infinitely many Sophie Germain primes.  In practice, they occur fairly often.  If we consider numbers of magnitude <span class="math notranslate nohighlight">\(N\)</span>, about <span class="math notranslate nohighlight">\(1 / \log(N)\)</span> of them are prime.  Among such primes, we expect about <span class="math notranslate nohighlight">\(1.3 / \log(N)\)</span> to be Sophie Germain primes.  In this way, we can expect to stumble upon Sophie Germain primes if we search for a bit (and if <span class="math notranslate nohighlight">\(\log(N)^2\)</span> is not too large).</p>
<p>The code below tests whether a number <span class="math notranslate nohighlight">\(p\)</span> is a Sophie Germain prime.  We construct it by simply testing whether <span class="math notranslate nohighlight">\(p\)</span> and <span class="math notranslate nohighlight">\(2p+1\)</span> are both prime.  We use the Miller-Rabin test (the code from the previous Python notebook) in order to test whether each is prime.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">random</span><span class="w"> </span><span class="kn">import</span> <span class="n">randint</span> <span class="c1"># randint chooses random integers.</span>

<span class="k">def</span><span class="w"> </span><span class="nf">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">base</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Tests whether p is prime, using the given base.</span>
<span class="sd">    The result False implies that p is definitely not prime.</span>
<span class="sd">    The result True implies that p **might** be prime.</span>
<span class="sd">    It is not a perfect test!</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">exponent</span> <span class="o">=</span> <span class="n">p</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">modulus</span> <span class="o">=</span> <span class="n">p</span>
    <span class="n">bitstring</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="n">exponent</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span> <span class="c1"># Chop off the &#39;0b&#39; part of the binary expansion of exponent</span>
    <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="n">bitstring</span><span class="p">:</span> <span class="c1"># Iterates through the &quot;letters&quot; of the string.  Here the letters are &#39;0&#39; or &#39;1&#39;.</span>
        <span class="n">sq_result</span> <span class="o">=</span> <span class="n">result</span><span class="o">*</span><span class="n">result</span> <span class="o">%</span> <span class="n">modulus</span>  <span class="c1"># We need to compute this in any case.</span>
        <span class="k">if</span> <span class="n">sq_result</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">result</span> <span class="o">!=</span> <span class="n">exponent</span><span class="p">):</span>  <span class="c1"># Note that exponent is congruent to -1, mod p.</span>
                <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># a ROO violation occurred, so p is not prime</span>
        <span class="k">if</span> <span class="n">bit</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">sq_result</span> 
        <span class="k">if</span> <span class="n">bit</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">sq_result</span> <span class="o">*</span> <span class="n">base</span><span class="p">)</span> <span class="o">%</span> <span class="n">modulus</span>
    <span class="k">if</span> <span class="n">result</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># a FLT violation occurred, so p is not prime.</span>
    
    <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># If we made it this far, no violation occurred and p might be prime.</span>

<span class="k">def</span><span class="w"> </span><span class="nf">is_prime</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">witnesses</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>  <span class="c1"># witnesses is a parameter with a default value.</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Tests whether a positive integer p is prime.</span>
<span class="sd">    For p &lt; 2^64, the test is deterministic, using known good witnesses.</span>
<span class="sd">    Good witnesses come from a table at Wikipedia&#39;s article on the Miller-Rabin test,</span>
<span class="sd">    based on research by Pomerance, Selfridge and Wagstaff, Jaeschke, Jiang and Deng.</span>
<span class="sd">    For larger p, a number (by default, 50) of witnesses are chosen at random.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">%</span><span class="k">2</span> == 0): # Might as well take care of even numbers at the outset!
        <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span> 
    
    <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="o">**</span><span class="mi">64</span><span class="p">:</span>  <span class="c1"># We use the probabilistic test for large p.</span>
        <span class="n">trial</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">trial</span> <span class="o">&lt;</span> <span class="n">witnesses</span><span class="p">:</span>
            <span class="n">trial</span> <span class="o">=</span> <span class="n">trial</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">witness</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">p</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># A good range for possible witnesses</span>
            <span class="k">if</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">witness</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>
    
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># We use a determinisic test for p &lt;= 2**64.</span>
        <span class="n">verdict</span> <span class="o">=</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">2047</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">verdict</span> <span class="c1"># The witness 2 suffices.</span>
        <span class="n">verdict</span> <span class="o">=</span> <span class="n">verdict</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">1373653</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">verdict</span> <span class="c1"># The witnesses 2 and 3 suffice.</span>
        <span class="n">verdict</span> <span class="o">=</span> <span class="n">verdict</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">25326001</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">verdict</span> <span class="c1"># The witnesses 2,3,5 suffice.</span>
        <span class="n">verdict</span> <span class="o">=</span> <span class="n">verdict</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">3215031751</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">verdict</span> <span class="c1"># The witnesses 2,3,5,7 suffice.</span>
        <span class="n">verdict</span> <span class="o">=</span> <span class="n">verdict</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">2152302898747</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">verdict</span> <span class="c1"># The witnesses 2,3,5,7,11 suffice.</span>
        <span class="n">verdict</span> <span class="o">=</span> <span class="n">verdict</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">13</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">3474749660383</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">verdict</span> <span class="c1"># The witnesses 2,3,5,7,11,13 suffice.</span>
        <span class="n">verdict</span> <span class="o">=</span> <span class="n">verdict</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">17</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">341550071728321</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">verdict</span> <span class="c1"># The witnesses 2,3,5,7,11,17 suffice.</span>
        <span class="n">verdict</span> <span class="o">=</span> <span class="n">verdict</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">19</span><span class="p">)</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">23</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">3825123056546413051</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">verdict</span> <span class="c1"># The witnesses 2,3,5,7,11,17,19,23 suffice.</span>
        <span class="n">verdict</span> <span class="o">=</span> <span class="n">verdict</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">29</span><span class="p">)</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">31</span><span class="p">)</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">37</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">verdict</span> <span class="c1"># The witnesses 2,3,5,7,11,17,19,23,29,31,37 suffice for testing up to 2^64. </span>
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">is_SGprime</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Tests whether p is a Sophie Germain prime</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">is_prime</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>  <span class="c1"># A bit faster to check whether p is prime first.</span>
        <span class="k">if</span> <span class="n">is_prime</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1"># and *then* check whether 2p+1 is prime.</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s test this out by finding the Sophie Germain primes up to 100, and their associated safe primes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">is_SGprime</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we find the first 100-digit Sophie Germain prime!  This might take a minute!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_number</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">99</span> <span class="c1"># Start looking at the first 100-digit number, which is 10^99.</span>
<span class="k">while</span> <span class="ow">not</span> <span class="n">is_SGprime</span><span class="p">(</span><span class="n">test_number</span><span class="p">):</span>
    <span class="n">test_number</span> <span class="o">=</span> <span class="n">test_number</span> <span class="o">+</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">test_number</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In the seconds or minutes your computer was running, it checked the primality of almost 90 thousand numbers, each with 100 digits.  Not bad!</p>
</section>
<section id="the-diffie-hellman-protocol">
<h3>The Diffie-Hellman protocol<a class="headerlink" href="#the-diffie-hellman-protocol" title="Link to this heading">#</a></h3>
<p>When we study protocols for secure communication, we must keep track of the communicating parties (often called Alice and Bob), and <strong>who</strong> has knowledge of <strong>what</strong> information.  We assume at all times that the “wire” between Alice and Bob is tapped – anything they say to each other is actively monitored, and is therefore <strong>public</strong> knowledge.  We also assume that what happens on Alice’s private computer is private to Alice, and what happens on Bob’s private computer is private to Bob.  Of course, these last two assumptions are big assumptions – they point towards the danger of computer viruses which infect computers and can violate such privacy!</p>
<p>The goal of the Diffie-Hellman protocol is – at the end of the process – for Alice and Bob to <strong>share a secret</strong> without ever having communicated the secret with each other.  The process involves a series of modular arithmetic calculations performed on each of Alice and Bob’s computers.</p>
<p>The process begins when Alice or Bob creates and publicizes a <strong>large prime number</strong> <code class="docutils literal notranslate"><span class="pre">p</span></code> and a <strong>primitive root</strong> <code class="docutils literal notranslate"><span class="pre">g</span></code> modulo <code class="docutils literal notranslate"><span class="pre">p</span></code>.  It is best, for efficiency and security, to choose a <strong>safe</strong> prime <code class="docutils literal notranslate"><span class="pre">p</span></code>.  Alice and Bob can create their own safe prime, or choose one from a public list online, e.g., from the <a class="reference external" href="https://tools.ietf.org/html/rfc3526">RFC 3526 memo</a>.  Nowadays, it’s common to take <code class="docutils literal notranslate"><span class="pre">p</span></code> with 2048 bits, i.e., a prime which is between <span class="math notranslate nohighlight">\(2^{2046}\)</span> and <span class="math notranslate nohighlight">\(2^{2047}\)</span> (a number with 617 decimal digits!).</p>
<p>For the purposes of this introduction, we use a smaller safe prime, with about 256 bits.  We use the <code class="docutils literal notranslate"><span class="pre">SystemRandom</span></code> functionality of the <code class="docutils literal notranslate"><span class="pre">random</span></code> package to create a good random prime.  It is not so much of an issue here, but in general one must be very careful in cryptography that one’s “random” numbers are really “random”!  The <code class="docutils literal notranslate"><span class="pre">SystemRandom</span></code> function uses chaotic properties of your computer’s innards in order to initialize a random number generator, and is considered cryptographically secure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">random</span><span class="w"> </span><span class="kn">import</span> <span class="n">SystemRandom</span> <span class="c1"># Import the necessary package.</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">SystemRandom</span><span class="p">()</span><span class="o">.</span><span class="n">getrandbits</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The random integer is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;with binary expansion </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">bin</span><span class="p">(</span><span class="n">r</span><span class="p">)))</span>  <span class="c1">#  r is an integer constructed from 256 random bits.</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;with bit-length </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">bin</span><span class="p">(</span><span class="n">r</span><span class="p">))</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span>  <span class="c1"># In case you want to check.  Remember &#39;0b&#39; is at the beginning.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">getrandSGprime</span><span class="p">(</span><span class="n">bitlength</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Creates a random Sophie Germain prime p with about </span>
<span class="sd">    bitlength bits.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">SystemRandom</span><span class="p">()</span><span class="o">.</span><span class="n">getrandbits</span><span class="p">(</span><span class="n">bitlength</span><span class="p">)</span> <span class="c1"># Choose a really random number.</span>
        <span class="k">if</span> <span class="n">is_SGprime</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">p</span>    
</pre></div>
</div>
</div>
</div>
<p>The function above searches and searches among random numbers until it finds a Sophie Germain prime.  The (possibly endless!) search is performed with a <code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">True:</span></code> loop that may look strange.  The idea is to stay in the loop until such a prime is found.  Then the <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">p</span></code> command returns the found prime as output and halts the loop.  One must be careful with <code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">True</span></code> loops, since they are structured to run forever – if there’s not a loop-breaking command like <code class="docutils literal notranslate"><span class="pre">return</span></code> or <code class="docutils literal notranslate"><span class="pre">break</span></code> inside the loop, your computer will be spinning for a long time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="n">getrandSGprime</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span> <span class="c1"># A random ~256 bit Sophie Germain prime</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">q</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># And its associated safe prime</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;p is &quot;</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>  <span class="c1"># Just to see what we&#39;re working with.</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;q is &quot;</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next we find a primitive root, modulo the safe prime <code class="docutils literal notranslate"><span class="pre">p</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">findprimroot_safe</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Finds a primitive root, </span>
<span class="sd">    modulo a safe prime p.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Start trying with 2.</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>  <span class="c1"># We just keep on looking.</span>
        <span class="k">if</span> <span class="n">is_primroot_safe</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">b</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># Try the next base.  Shouldn&#39;t take too long to find one!</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">findprimroot_safe</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The pair of numbers <span class="math notranslate nohighlight">\((g, p)\)</span>, the primitive root and the safe prime, chosen by either Alice or Bob, is now made public.  They can post their <span class="math notranslate nohighlight">\(g\)</span> and <span class="math notranslate nohighlight">\(p\)</span> on a public website or shout it in the streets.  It doesn’t matter.  They are just tools for their secret-creation algorithm below.</p>
</section>
<section id="alice-and-bob-s-private-secrets">
<h3>Alice and Bob’s private secrets<a class="headerlink" href="#alice-and-bob-s-private-secrets" title="Link to this heading">#</a></h3>
<p>Next, Alice and Bob invent <strong>private</strong> secret numbers <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span>.  They do not tell <em>anyone</em> these numbers.  Not each other.  Not their family.  Nobody.  They don’t write them on a chalkboard, or leave them on a thumbdrive that they lose.  These are really secret.</p>
<p>But they don’t use their phone numbers, or social security numbers.  It’s best for Alice and Bob to use a secure random number generator on their separate private computers to create <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span>.  They are often 256 bit numbers in practice, so that’s what we use below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">SystemRandom</span><span class="p">()</span><span class="o">.</span><span class="n">getrandbits</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>  <span class="c1"># Alice&#39;s secret number</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">SystemRandom</span><span class="p">()</span><span class="o">.</span><span class="n">getrandbits</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>  <span class="c1"># Bob&#39;s secret number</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Only Alice should know that a = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Only Bob should know that b = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;But everyone can know p = </span><span class="si">{}</span><span class="s2"> and g = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">g</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Now Alice and Bob use their secrets to generate new numbers.  Alice computes the number
$<span class="math notranslate nohighlight">\(A = g^a \text{ mod } p,\)</span><span class="math notranslate nohighlight">\(
and Bob computes the number
\)</span><span class="math notranslate nohighlight">\(B = g^b \text{ mod } p.\)</span>$</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>  <span class="c1"># This would be computed on Alice&#39;s computer.</span>
<span class="n">B</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>  <span class="c1"># This would be computed on Bob&#39;s computer.</span>
</pre></div>
</div>
</div>
</div>
<p>Now Alice and Bob do something that seems very strange at first.  Alice sends Bob her new number <span class="math notranslate nohighlight">\(A\)</span> and Bob sends Alice his new number <span class="math notranslate nohighlight">\(B\)</span>.  Since they are far apart, and the channel is insecure, we can assume everyone in the world now knows <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Everyone knows A = </span><span class="si">{}</span><span class="s2"> and B = </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Now Alice, on her private computer, computes <span class="math notranslate nohighlight">\(B^a\)</span> mod <span class="math notranslate nohighlight">\(p\)</span>.  She can do that because everyone knows <span class="math notranslate nohighlight">\(B\)</span> and <span class="math notranslate nohighlight">\(p\)</span>, and she knows <span class="math notranslate nohighlight">\(a\)</span> too.</p>
<p>Similarly, Bob, on his private computer, computes <span class="math notranslate nohighlight">\(A^b\)</span> mod <span class="math notranslate nohighlight">\(p\)</span>.  He can do that because everyone knows <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(p\)</span>, and he knows <span class="math notranslate nohighlight">\(b\)</span> too.</p>
<p>Alice and Bob <strong>do not</strong> share the results of their computations!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">p</span><span class="p">))</span>  <span class="c1"># This is what Alice computes.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">p</span><span class="p">))</span>  <span class="c1"># This is what Bob computes.</span>
</pre></div>
</div>
</div>
</div>
<p>Woah!  What happened?  In terms of exponents, it’s elementary.  For
$<span class="math notranslate nohighlight">\(B^a = (g^{b})^a = g^{ba} = g^{ab} = (g^a)^b = A^b.\)</span><span class="math notranslate nohighlight">\(
So these two computations yield the same result (mod \)</span>p$, the whole way through).</p>
<p>In the end, we find that Alice and Bob <strong>share a secret</strong>.  We call this secret number <span class="math notranslate nohighlight">\(S\)</span>.
$<span class="math notranslate nohighlight">\(S = B^a = A^b.\)</span>$</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">S</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>  <span class="c1"># Or we could have used pow(A,b,p)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This common secret <span class="math notranslate nohighlight">\(S\)</span> can be used as a key for Alice and Bob to communicate hereafter.  For example, they might use <span class="math notranslate nohighlight">\(S\)</span> (converted to a string, if needed) as the key for a Vigenère cipher, and chat with each other knowing that only they have the secret key to encrypt and decrypt their messages.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  We use the triple-quotes for a long string, that occupies multiple lines.</span>
<span class="c1">#  The backslash at the end of the line tells Python to ignore the newline character.</span>
<span class="c1">#  Imagine that Alice has a secret message she wants to send to Bob.  </span>
<span class="c1">#  She writes the plaintext on her computer. </span>

<span class="n">plaintext</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;Did you hear that the American Mathematical Society has an annual textbook sale? </span><span class="se">\</span>
<span class="s1">            It&#39;s 40 percent off for members and 25 percent off for everyone else.&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now Alice uses the secret S (as a string) to encrypt.  </span>
<span class="n">ciphertext</span> <span class="o">=</span> <span class="n">Vigenere_cipher</span><span class="p">(</span><span class="n">plaintext</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">S</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">)</span>
<span class="c1"># Alice sends the following ciphertext to Bob, over an insecure channel.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># When Bob receives the ciphertext, he decodes it with the secret S again.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Vigenere_decipher</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">S</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p>To have confidence in this protocol, one needs to be convinced that their secret is truly secret!  The public has a lot of information:  they know</p>
<ol class="arabic simple">
<li><p>the prime <span class="math notranslate nohighlight">\(p\)</span>,</p></li>
<li><p>the primitive root <span class="math notranslate nohighlight">\(g\)</span>,</p></li>
<li><p>the number <span class="math notranslate nohighlight">\(A = g^a\)</span> (mod <span class="math notranslate nohighlight">\(p\)</span>), and</p></li>
<li><p>the number <span class="math notranslate nohighlight">\(B = g^b\)</span> (mod <span class="math notranslate nohighlight">\(p\)</span>).</p></li>
</ol>
<p>If the public could <strong>figure out</strong> either <span class="math notranslate nohighlight">\(a\)</span> or <span class="math notranslate nohighlight">\(b\)</span>, they could figure out the secret (by raising <span class="math notranslate nohighlight">\(A^b\)</span> or <span class="math notranslate nohighlight">\(B^a\)</span> like Alice and Bob did).</p>
<p>This is the essence of the <strong>discrete logarithm problem</strong>.  If we know the value of <span class="math notranslate nohighlight">\(g^a\)</span> mod <span class="math notranslate nohighlight">\(p\)</span>, can we figure out the possible value(s) of <span class="math notranslate nohighlight">\(a\)</span>?  If this were ordinary arithmetic, we would say that <span class="math notranslate nohighlight">\(a = \log_g(A)\)</span>.  But this is modular arithmetic, and there’s no easy way to figure out such logarithms.  The values of <span class="math notranslate nohighlight">\(g^a\)</span> tend to bounce all over the place, mod <span class="math notranslate nohighlight">\(p\)</span>, especially since we chose <span class="math notranslate nohighlight">\(a\)</span> to be pretty large (256 bits!).</p>
<p>The security of the Diffie-Hellman protocol, i.e., the security of Alice and Bob’s shared secret, depends on the <em>difficulty</em> of the discrete logarithm problem.  When <span class="math notranslate nohighlight">\(p\)</span> is a large (e.g. 2048 bits) safe prime, and <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span> are suitably large (roughly 256 bits), there seems to be no way to solve the discrete logarithm problem mod <span class="math notranslate nohighlight">\(p\)</span> in any reasonable amount of time.  Someday we might have quantum computers to quickly solve discrete logarithm problems, and the Diffie-Hellman protocol will not be secure.  But for now, Alice and Bob’s secret key seems safe.</p>
</section>
<section id="id23">
<h3>Exercises<a class="headerlink" href="#id23" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>How many Sophie Germain primes are there between 1 and 1000000?  What proportion of primes in this range are Sophie Germain primes?</p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Artin%27s_conjecture_on_primitive_roots">It is expected</a> that there are infinitely primes <span class="math notranslate nohighlight">\(p\)</span> such that 2 is a primitive root mod <span class="math notranslate nohighlight">\(p\)</span>.  Study the density of such primes.  For example, among the primes up to 1000, how often is <span class="math notranslate nohighlight">\(2\)</span> a primitive root?  Does this density seem to change?</p></li>
<li><p>Adapt Diffie-Hellman to work with a group of <em>three</em> parties who wish to share a common secret.  Hint:  the common secret will have the form <span class="math notranslate nohighlight">\(g^{abc}\)</span>, and other exponents like <span class="math notranslate nohighlight">\(g^a\)</span>, <span class="math notranslate nohighlight">\(g^b\)</span>, <span class="math notranslate nohighlight">\(g^c\)</span>, <span class="math notranslate nohighlight">\(g^{ab}\)</span>, <span class="math notranslate nohighlight">\(g^{bc}\)</span>, <span class="math notranslate nohighlight">\(g^{ac}\)</span> will be public information.</p></li>
<li><p>Sadly, Alice and Bob have agreed to use the primitive root <span class="math notranslate nohighlight">\(g = 3\)</span> and the prime <span class="math notranslate nohighlight">\(p = 65537\)</span>.  Listening into their conversation, you intercept the following: <span class="math notranslate nohighlight">\(A = 40360\)</span> and <span class="math notranslate nohighlight">\(B = 21002\)</span> and the ciphertext is <code class="docutils literal notranslate"><span class="pre">$;6HWD;P5LVJ99W+EH9JVx=I:V7ESpGC^</span></code>.  If you know that they use a protocol with a Vigenère cipher, with key equal the string associated to their secret <span class="math notranslate nohighlight">\(S\)</span>, what is the plaintext message?  Hint:  you should be able to solve the discrete logarithm problem with a brute force attack.</p></li>
</ol>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="part-7-the-rsa-cryptosystem-in-python-3-x">
<h1>Part 7:  The RSA Cryptosystem in Python 3.x<a class="headerlink" href="#part-7-the-rsa-cryptosystem-in-python-3-x" title="Link to this heading">#</a></h1>
<p>In the previous notebook, we studied a few basic ciphers together with Diffie-Hellman key exchange.  The Vigenère cipher we studied uses a <strong>secret key</strong> for encrypting and decrypting messages.  The same key is used for both encryption and decryption, so we say it is a <strong>symmetric key</strong> cipher.  In order for two parties to share the same secret key, we studied the Diffie-Hellman protocol, whose security rests on the difficulty of the discrete logarithm problem.</p>
<p>Although this represents progress towards secure communication, it is particularly vulnerable to problems of authentication.  For example, imagine a “man-in-the-middle attack”:  Alice and Bob wish to communicate securely, and begin the Diffie-Hellman protocol over an insecure line.  But <strong>Eve</strong> has intercepted the line.  To Alice, she pretends to be Bob, and to Bob, she pretends to be Alice.  She goes through the Diffie-Hellman protocol with each, obtaining two secret keys, and decrypting/encrypting messages as they pass through her computer.  In this way, Alice and Bob think they are talking to each other, but Eve is just passing (and understanding) their messages the whole time!</p>
<p>To thwart such an attack, we need some type of authentication.  We need something <strong>asymmetric</strong> – something one person can do that no other person can do, like a verifiable signature, so that we can be sure we’re communicating with the intended person.  For such a purpose, we introduce the RSA cryptosystem.  Computationally based on modular exponentiation, its security rests on the difficulty of factoring large numbers.</p>
<p>The material in this notebook complements <strong>Chapter 7</strong> of An Illustrated Theory of Numbers</p>
<section id="id24">
<h2>Table of Contents<a class="headerlink" href="#id24" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#euler"><span class="xref myst">Euler’s theorem and modular roots</span></a></p></li>
<li><p><a class="reference internal" href="#RSA"><span class="xref myst">The RSA protocol</span></a></p></li>
</ul>
<p><a id='euler'></a></p>
</section>
<section id="euler-s-theorem-and-modular-roots">
<h2>Euler’s Theorem and Modular Roots<a class="headerlink" href="#euler-s-theorem-and-modular-roots" title="Link to this heading">#</a></h2>
<p>Recall Fermat’s Little Theorem:  if <span class="math notranslate nohighlight">\(p\)</span> is prime and <span class="math notranslate nohighlight">\(GCD(a,p) = 1\)</span>, then <span class="math notranslate nohighlight">\(a^{p-1} \equiv 1\)</span> mod <span class="math notranslate nohighlight">\(p\)</span>.  This is a special case of Euler’s theorem, which holds for any modulus <span class="math notranslate nohighlight">\(m\)</span>.</p>
<section id="euler-s-theorem-and-the-totient">
<h3>Euler’s theorem and the totient<a class="headerlink" href="#euler-s-theorem-and-the-totient" title="Link to this heading">#</a></h3>
<p>Euler’s theorem states:  if <span class="math notranslate nohighlight">\(m\)</span> is a positive integer and <span class="math notranslate nohighlight">\(GCD(a,m) = 1\)</span>, then <span class="math notranslate nohighlight">\(a^{\phi(m)} \equiv 1\)</span> mod <span class="math notranslate nohighlight">\(m\)</span>.  Here <span class="math notranslate nohighlight">\(\phi(m)\)</span> denotes the <strong>totient</strong> of <span class="math notranslate nohighlight">\(m\)</span>, which is the number of elements of <span class="math notranslate nohighlight">\(\{ 1,...,m \}\)</span> which are coprime to <span class="math notranslate nohighlight">\(m\)</span>.  We give a brute force implementation of the totient first, using our old Euclidean algorithm code for the GCD.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">GCD</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">b</span><span class="p">:</span>   <span class="c1"># Recall that != means &quot;not equal to&quot;.</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">totient</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
    <span class="n">tot</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># The running total.</span>
    <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">:</span>  <span class="c1"># We go up to m, because the totient of 1 is 1 by convention.</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># Last step of while loop:  j = m-1, and then j = j+1, so j = m.</span>
        <span class="k">if</span> <span class="n">GCD</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">m</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">tot</span> <span class="o">=</span> <span class="n">tot</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">tot</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">totient</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>  <span class="c1"># The totient of a prime p should be p-1.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">totient</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">totient</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Check a borderline case, to make sure we didn&#39;t make an off-by-one error.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">17</span><span class="o">**</span><span class="n">totient</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="o">%</span> <span class="mi">1000</span> <span class="c1"># Let&#39;s demonstrate Euler&#39;s theorem.  Note GCD(17,1000) = 1.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">pow</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="n">totient</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span><span class="mi">1000</span><span class="p">)</span> <span class="c1"># A more efficient version, using the pow command.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> totient(123456)
</pre></div>
</div>
</div>
</div>
<p>The totient is a <strong>multiplicative function</strong>, meaning that if <span class="math notranslate nohighlight">\(GCD(a,b) = 1\)</span>, then <span class="math notranslate nohighlight">\(\phi(ab) = \phi(a) \phi(b)\)</span>.  Therefore, the totient of number can be found quickly from the totient of the prime powers within its decomposition.  We can re-implement the totient using our functions for prime decomposition and multiplicative functions from <a class="reference external" href="http://illustratedtheoryofnumbers.com/prog.html#notebooks">Notebook 4</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">sqrt</span>  <span class="c1"># We&#39;ll want to use the square root.</span>

<span class="k">def</span><span class="w"> </span><span class="nf">smallest_factor</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Gives the smallest prime factor of n.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span> <span class="c1"># No prime factors!</span>
    
    <span class="n">test_factor</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># The smallest possible prime factor.</span>
    <span class="n">max_factor</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="c1"># we don&#39;t have to search past sqrt(n).</span>
    
    <span class="k">while</span> <span class="n">test_factor</span> <span class="o">&lt;=</span> <span class="n">max_factor</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">n</span><span class="o">%</span><span class="k">test_factor</span> == 0:
            <span class="k">return</span> <span class="n">test_factor</span>
        <span class="n">test_factor</span> <span class="o">=</span> <span class="n">test_factor</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># This could be sped up.</span>
    
    <span class="k">return</span> <span class="n">n</span>  <span class="c1"># If we didn&#39;t find a factor up to sqrt(n), n itself is prime!</span>

<span class="k">def</span><span class="w"> </span><span class="nf">decompose</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Gives the unique prime decomposition of a positive integer N,</span>
<span class="sd">    as a dictionary with primes as keys and exponents as values.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">current_number</span> <span class="o">=</span> <span class="n">N</span>  <span class="c1"># We&#39;ll divide out factors from current_number until we get 1.</span>
    <span class="n">decomp</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># An empty dictionary to start.</span>
    <span class="k">while</span> <span class="n">current_number</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">smallest_factor</span><span class="p">(</span><span class="n">current_number</span><span class="p">)</span> <span class="c1"># The smallest prime factor of the current number.</span>
        <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">decomp</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>  <span class="c1"># Is p already in the list of keys?</span>
            <span class="n">decomp</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">decomp</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># Increase the exponent (value with key p) by 1.</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># &quot;else&quot; here means &quot;if p is not in decomp.keys()&quot;.</span>
            <span class="n">decomp</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Creates a new entry in the dictionary, with key p and value 1.</span>
        <span class="n">current_number</span> <span class="o">=</span> <span class="n">current_number</span> <span class="o">//</span> <span class="n">p</span> <span class="c1"># Factor out p.</span>
    <span class="k">return</span> <span class="n">decomp</span>

<span class="k">def</span><span class="w"> </span><span class="nf">mult_function</span><span class="p">(</span><span class="n">f_pp</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    When a function f_pp(p,e) of two arguments is input,</span>
<span class="sd">    this outputs a multiplicative function obtained from f_pp</span>
<span class="sd">    via prime decomposition.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">decompose</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">D</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">*</span> <span class="n">f_pp</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">D</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">result</span>
    
    <span class="k">return</span> <span class="n">f</span>
</pre></div>
</div>
</div>
</div>
<p>When <span class="math notranslate nohighlight">\(p^e\)</span> is a prime power, the numbers among <span class="math notranslate nohighlight">\(1, \ldots, p^e\)</span> are coprime to <span class="math notranslate nohighlight">\(p^e\)</span> precisely when they are <strong>not</strong> multiples of <span class="math notranslate nohighlight">\(p\)</span>.  Therefore, the totient of a prime power is pretty easy to compute:
$<span class="math notranslate nohighlight">\(\phi(p^e) = p^e - p^{e-1} = p^{e-1} (p-1).\)</span>$
We implement this, and use the multiplicative function code to complete the implementation of the totient.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">totient_pp</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">e</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">p</span><span class="o">**</span><span class="p">(</span><span class="n">e</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Note that for efficiency, the computation of <span class="math notranslate nohighlight">\(p^{e-1}(p-1)\)</span> is probably faster than the computation of <span class="math notranslate nohighlight">\(p^e - p^{e-1}\)</span> (which relies on two exponents).  But Python is very smart about these sorts of things, and might do some optimization which makes the computation faster.  It should be very fast anyways, in the 10-20 nanosecond range!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">totient</span> <span class="o">=</span> <span class="n">mult_function</span><span class="p">(</span><span class="n">totient_pp</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">totient</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> totient(123456)
</pre></div>
</div>
</div>
</div>
<p>This should be <strong>much</strong> faster than the previous brute-force computation of the totient.</p>
</section>
<section id="modular-roots">
<h3>Modular roots<a class="headerlink" href="#modular-roots" title="Link to this heading">#</a></h3>
<p>A consequence of Euler’s theorem is that – depending on the modulus – some exponentiation can be “reversed” by another exponentiation, a form of taking a “root” in modular arithmetic.  For example, if we work modulo <span class="math notranslate nohighlight">\(100\)</span>, and <span class="math notranslate nohighlight">\(GCD(a,100) = 1\)</span>, then Euler’s theorem states that
$<span class="math notranslate nohighlight">\(a^{40} \equiv 1 \text{ mod } 100.\)</span><span class="math notranslate nohighlight">\(
It follows that \)</span>a^{80} \equiv 1<span class="math notranslate nohighlight">\( and \)</span>a^{81} \equiv a<span class="math notranslate nohighlight">\(, modulo \)</span>100<span class="math notranslate nohighlight">\(.  Expanding this, we find
\)</span><span class="math notranslate nohighlight">\(a \equiv a^{81} = a^{3 \cdot 27} = (a^3)^{27} \text{ mod } 100.\)</span>$</p>
<p>What all this computation shows is that “raising to the 27th power” is like “taking the cube root”, modulo 100 (and with appropriate bases).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">b_cubed</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">bb</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">b_cubed</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">b_cubed</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">GCD</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In every line ending with <code class="docutils literal notranslate"><span class="pre">True</span></code>, the first and third numbers should match.  This will happen in some <code class="docutils literal notranslate"><span class="pre">False</span></code> lines too, but not reliably since Euler’s theorem does not apply there.</p>
<p>We found the exponent 27 – reversing the cubing operation – by an ad hoc sort of procedure.  The relationship between 27 and 3, which made things work, is that
$<span class="math notranslate nohighlight">\(3 \cdot 27 \equiv 1 \text{ mod } 40.\)</span><span class="math notranslate nohighlight">\(
In other words, \)</span>3 \cdot 27 = 1 + 40k<span class="math notranslate nohighlight">\( for some (positive, in fact) integer \)</span>k$.</p>
<p>Recalling that <span class="math notranslate nohighlight">\(40 = \phi(100)\)</span>, this relationship and Euler’s theorem imply that
$<span class="math notranslate nohighlight">\(a^{3 \cdot 27} = a^{1 + 40k} \equiv a^1 = a \text{ mod } 100.\)</span>$
By this argument, we have the following consequence of Euler’s theorem.</p>
<p>**Theorem: ** If <span class="math notranslate nohighlight">\(GCD(a,m) = 1\)</span>, and <span class="math notranslate nohighlight">\(ef \equiv 1\)</span> mod <span class="math notranslate nohighlight">\(\phi(m)\)</span>, then
$<span class="math notranslate nohighlight">\(a^{ef} \equiv a \text{ mod } \phi(m).\)</span><span class="math notranslate nohighlight">\(
In this way, &quot;raising to the \)</span>f<span class="math notranslate nohighlight">\( power&quot; is like &quot;taking the \)</span>e<span class="math notranslate nohighlight">\(-th root&quot;, modulo \)</span>m$.</p>
<p>If we are given <span class="math notranslate nohighlight">\(f\)</span>, then <span class="math notranslate nohighlight">\(e\)</span> is a <strong>multiplicative inverse</strong> of <span class="math notranslate nohighlight">\(f\)</span> modulo <span class="math notranslate nohighlight">\(\phi(m)\)</span>.  In particular, such a multiplicative inverse exists if and only if <span class="math notranslate nohighlight">\(GCD(e,\phi(m)) = 1\)</span>.  The following function computes a multiplicative inverse, by adapting the <code class="docutils literal notranslate"><span class="pre">solve_LDE</span></code> function from <a class="reference internal" href="#"><span class="xref myst">Notebook 2</span></a>.  After all, solving <span class="math notranslate nohighlight">\(ex \equiv 1\)</span> mod <span class="math notranslate nohighlight">\(m\)</span> is equivalent to solving the linear Diophantine equation <span class="math notranslate nohighlight">\(ex + my = 1\)</span> (and only caring about the <span class="math notranslate nohighlight">\(x\)</span>-value).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">mult_inverse</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">m</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Finds the multiplicative inverse of a, mod m.</span>
<span class="sd">    If GCD(a,m) = 1, this is returned via its natural representative.</span>
<span class="sd">    Otherwise, None is returned.</span>
<span class="sd">    &#39;&#39;&#39;</span>  
    <span class="n">u</span> <span class="o">=</span> <span class="n">a</span> <span class="c1"># We use u instead of dividend.</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">m</span> <span class="c1"># We use v instead of divisor.</span>
    <span class="n">u_hops</span><span class="p">,</span> <span class="n">u_skips</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">0</span> <span class="c1"># u is built from one hop (a) and no skips.</span>
    <span class="n">v_hops</span><span class="p">,</span> <span class="n">v_skips</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span> <span class="c1"># v is built from no hops and one skip (b).</span>
    <span class="k">while</span> <span class="n">v</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>   <span class="c1"># We could just write while v:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">u</span> <span class="o">//</span> <span class="n">v</span>  <span class="c1"># q stands for quotient.</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">u</span> <span class="o">%</span> <span class="n">v</span>  <span class="c1"># r stands for remainder.  So u = q(v) + r.</span>
        
        <span class="n">r_hops</span> <span class="o">=</span> <span class="n">u_hops</span> <span class="o">-</span> <span class="n">q</span> <span class="o">*</span> <span class="n">v_hops</span>  <span class="c1"># Tally hops</span>
        <span class="n">r_skips</span> <span class="o">=</span> <span class="n">u_skips</span> <span class="o">-</span> <span class="n">q</span> <span class="o">*</span> <span class="n">v_skips</span>  <span class="c1"># Tally skips</span>
        
        <span class="n">u</span><span class="p">,</span><span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">,</span><span class="n">r</span>  <span class="c1"># The new dividend,divisor is the old divisor,remainder.</span>
        <span class="n">u_hops</span><span class="p">,</span> <span class="n">v_hops</span> <span class="o">=</span> <span class="n">v_hops</span><span class="p">,</span> <span class="n">r_hops</span> <span class="c1"># The new u_hops, v_hops is the old v_hops, r_hops</span>
        <span class="n">u_skips</span><span class="p">,</span> <span class="n">v_skips</span> <span class="o">=</span> <span class="n">v_skips</span><span class="p">,</span> <span class="n">r_skips</span> <span class="c1"># The new u_skips, v_skips is the old v_skips, r_skips</span>
    
    <span class="n">g</span> <span class="o">=</span> <span class="n">u</span> <span class="c1"># The variable g now describes the GCD of a and b.</span>
    <span class="k">if</span> <span class="n">g</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">u_hops</span> <span class="o">%</span> <span class="n">m</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># When GCD(a,m) is not 1...</span>
        <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mult_inverse</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">40</span><span class="p">)</span>  <span class="c1"># 3 times what is congruent to 1, mod 40?</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mult_inverse</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">40</span><span class="p">)</span>  <span class="c1"># None should be returned.</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s test this out on some bigger numbers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">random</span><span class="w"> </span><span class="kn">import</span> <span class="n">randint</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1000000</span><span class="p">,</span> <span class="mi">9999999</span><span class="p">)</span> <span class="c1"># a random 7-digit number</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">999</span><span class="p">)</span> <span class="c1"># a random 3-digit number</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">99</span><span class="p">)</span> <span class="c1"># a random 2-digit number</span>
    <span class="k">if</span> <span class="n">GCD</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">m</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">tot</span> <span class="o">=</span> <span class="n">totient</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">GCD</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">tot</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">mult_inverse</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">tot</span><span class="p">)</span>
            <span class="n">test_number</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="o">*</span><span class="n">f</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Success!&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> ^ (</span><span class="si">{}</span><span class="s2"> * </span><span class="si">{}</span><span class="s2">) = </span><span class="si">{}</span><span class="s2">, mod </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">test_number</span><span class="p">,</span><span class="n">m</span><span class="p">))</span>
            <span class="k">break</span> <span class="c1"># Escapes the loop once an example is found!</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id25">
<h3>Exercises<a class="headerlink" href="#id25" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>What is the largest integer whose totient is 100?  Study this by a brute force search, i.e., looping through the integers up to 10000</p></li>
<li><p>For which integers <span class="math notranslate nohighlight">\(n\)</span> is it true that <span class="math notranslate nohighlight">\(\phi(n) = n/2\)</span>?  Study this by a brute force search in order to make a conjecture.  Then prove it if you can.</p></li>
<li><p>Compute the totient of the numbers from 1 to 10000, and analyze the results.  The totient <span class="math notranslate nohighlight">\(\phi(n)\)</span> is always less than <span class="math notranslate nohighlight">\(n\)</span> when <span class="math notranslate nohighlight">\(n &gt; 1\)</span>, but how does the ratio <span class="math notranslate nohighlight">\(\phi(n) / n\)</span> behave? Create a graph.  What is the average value of the ratio?</p></li>
<li><p>If <span class="math notranslate nohighlight">\(a^{323} \equiv 802931\)</span>, mod <span class="math notranslate nohighlight">\(5342481\)</span>, and <span class="math notranslate nohighlight">\(GCD(a, 5342481) = 1\)</span>, and <span class="math notranslate nohighlight">\(0 &lt; a &lt; 5342481\)</span>, then what is <span class="math notranslate nohighlight">\(a\)</span>?</p></li>
<li><p>Challenge:  Create a function <code class="docutils literal notranslate"><span class="pre">superpow(x,y,z,m)</span></code> which computes <span class="math notranslate nohighlight">\(x^{y^z}\)</span> modulo <span class="math notranslate nohighlight">\(m\)</span> efficiently, when <span class="math notranslate nohighlight">\(GCD(x,m) = 1\)</span> and <span class="math notranslate nohighlight">\(m\)</span> is small enough to factor.</p></li>
</ol>
<p><a id='RSA'></a></p>
</section>
</section>
<section id="the-rsa-protocol">
<h2>The RSA protocol<a class="headerlink" href="#the-rsa-protocol" title="Link to this heading">#</a></h2>
<p>Like Diffie-Hellman, the RSA protocol involves a series of computations in modular arithmetic, taking care to keep some numbers private while making others public.  RSA was published two years after Diffie-Hellman, in 1978 by Rivest, Shamir, and Adelman (hence its name).  The great advance of the RSA protocol was its <strong>asymmetry</strong>.  While Diffie-Hellman is used for symmetric key cryptography (using the same key to encrypt and decrypt), the RSA protocol has two keys:  a <strong>public key</strong> that can be used by anyone for encryption and a <strong>private key</strong> that can be used by its owner for decryption.</p>
<p>In this way, if Alice publishes her public key online, anyone can send her an encrypted message.  But as long as she keeps her private key private, <strong>only</strong> Alice can decrypt the messages sent to her.  Such an asymmetry allows RSA to be used for authentication – if the owner of a private key has an ability nobody else has, then this ability can be used to prove the owner’s identity.  In practice, this is one of the most common applications of RSA, guaranteeing that we are communicating with the intended person.</p>
<p>In the RSA protocol, the <strong>private key</strong> is a pair of large (e.g. 512 bit) prime numbers, called <span class="math notranslate nohighlight">\(p\)</span> and <span class="math notranslate nohighlight">\(q\)</span>.  The <strong>public key</strong> is the pair <span class="math notranslate nohighlight">\((N, e)\)</span>, where <span class="math notranslate nohighlight">\(N\)</span> is defined to be the product <span class="math notranslate nohighlight">\(N = pq\)</span> and <span class="math notranslate nohighlight">\(e\)</span> is an auxiliary number called the exponent.  The number <span class="math notranslate nohighlight">\(e\)</span> is often (for computational efficiency and other reasons) taken to be 65537 – the same number <span class="math notranslate nohighlight">\(e\)</span> can be used over and over by different people.  But it is absolutely crucial that the same private keys <span class="math notranslate nohighlight">\(p\)</span> and <span class="math notranslate nohighlight">\(q\)</span> are not used by different individuals.  Individuals must create and safely keep their own private key.</p>
<p>We begin with the creation of a private key <span class="math notranslate nohighlight">\((p,q)\)</span>.  We use the <code class="docutils literal notranslate"><span class="pre">SystemRandom</span></code> function (see the previous Python Notebook) to cook up cryptographically secure random numbers, and the Miller-Rabin test to certify primality.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">random</span><span class="w"> </span><span class="kn">import</span> <span class="n">SystemRandom</span><span class="p">,</span> <span class="n">randint</span>

<span class="k">def</span><span class="w"> </span><span class="nf">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">base</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Tests whether p is prime, using the given base.</span>
<span class="sd">    The result False implies that p is definitely not prime.</span>
<span class="sd">    The result True implies that p **might** be prime.</span>
<span class="sd">    It is not a perfect test!</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">exponent</span> <span class="o">=</span> <span class="n">p</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">modulus</span> <span class="o">=</span> <span class="n">p</span>
    <span class="n">bitstring</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="n">exponent</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span> <span class="c1"># Chop off the &#39;0b&#39; part of the binary expansion of exponent</span>
    <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="n">bitstring</span><span class="p">:</span> <span class="c1"># Iterates through the &quot;letters&quot; of the string.  Here the letters are &#39;0&#39; or &#39;1&#39;.</span>
        <span class="n">sq_result</span> <span class="o">=</span> <span class="n">result</span><span class="o">*</span><span class="n">result</span> <span class="o">%</span> <span class="n">modulus</span>  <span class="c1"># We need to compute this in any case.</span>
        <span class="k">if</span> <span class="n">sq_result</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">result</span> <span class="o">!=</span> <span class="n">exponent</span><span class="p">):</span>  <span class="c1"># Note that exponent is congruent to -1, mod p.</span>
                <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># a ROO violation occurred, so p is not prime</span>
        <span class="k">if</span> <span class="n">bit</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">sq_result</span> 
        <span class="k">if</span> <span class="n">bit</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">sq_result</span> <span class="o">*</span> <span class="n">base</span><span class="p">)</span> <span class="o">%</span> <span class="n">modulus</span>
    <span class="k">if</span> <span class="n">result</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># a FLT violation occurred, so p is not prime.</span>
    
    <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># If we made it this far, no violation occurred and p might be prime.</span>

<span class="k">def</span><span class="w"> </span><span class="nf">is_prime</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">witnesses</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>  <span class="c1"># witnesses is a parameter with a default value.</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Tests whether a positive integer p is prime.</span>
<span class="sd">    For p &lt; 2^64, the test is deterministic, using known good witnesses.</span>
<span class="sd">    Good witnesses come from a table at Wikipedia&#39;s article on the Miller-Rabin test,</span>
<span class="sd">    based on research by Pomerance, Selfridge and Wagstaff, Jaeschke, Jiang and Deng.</span>
<span class="sd">    For larger p, a number (by default, 50) of witnesses are chosen at random.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">%</span><span class="k">2</span> == 0): # Might as well take care of even numbers at the outset!
        <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span> 
    
    <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="o">**</span><span class="mi">64</span><span class="p">:</span>  <span class="c1"># We use the probabilistic test for large p.</span>
        <span class="n">trial</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">trial</span> <span class="o">&lt;</span> <span class="n">witnesses</span><span class="p">:</span>
            <span class="n">trial</span> <span class="o">=</span> <span class="n">trial</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">witness</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">p</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># A good range for possible witnesses</span>
            <span class="k">if</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">witness</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>
    
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># We use a determinisic test for p &lt;= 2**64.</span>
        <span class="n">verdict</span> <span class="o">=</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">2047</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">verdict</span> <span class="c1"># The witness 2 suffices.</span>
        <span class="n">verdict</span> <span class="o">=</span> <span class="n">verdict</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">1373653</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">verdict</span> <span class="c1"># The witnesses 2 and 3 suffice.</span>
        <span class="n">verdict</span> <span class="o">=</span> <span class="n">verdict</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">25326001</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">verdict</span> <span class="c1"># The witnesses 2,3,5 suffice.</span>
        <span class="n">verdict</span> <span class="o">=</span> <span class="n">verdict</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">3215031751</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">verdict</span> <span class="c1"># The witnesses 2,3,5,7 suffice.</span>
        <span class="n">verdict</span> <span class="o">=</span> <span class="n">verdict</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">2152302898747</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">verdict</span> <span class="c1"># The witnesses 2,3,5,7,11 suffice.</span>
        <span class="n">verdict</span> <span class="o">=</span> <span class="n">verdict</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">13</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">3474749660383</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">verdict</span> <span class="c1"># The witnesses 2,3,5,7,11,13 suffice.</span>
        <span class="n">verdict</span> <span class="o">=</span> <span class="n">verdict</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">17</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">341550071728321</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">verdict</span> <span class="c1"># The witnesses 2,3,5,7,11,17 suffice.</span>
        <span class="n">verdict</span> <span class="o">=</span> <span class="n">verdict</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">19</span><span class="p">)</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">23</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">3825123056546413051</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">verdict</span> <span class="c1"># The witnesses 2,3,5,7,11,17,19,23 suffice.</span>
        <span class="n">verdict</span> <span class="o">=</span> <span class="n">verdict</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">29</span><span class="p">)</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">31</span><span class="p">)</span> <span class="ow">and</span> <span class="n">Miller_Rabin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">37</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">verdict</span> <span class="c1"># The witnesses 2,3,5,7,11,17,19,23,29,31,37 suffice for testing up to 2^64. </span>
    

<span class="k">def</span><span class="w"> </span><span class="nf">random_prime</span><span class="p">(</span><span class="n">bitlength</span><span class="p">):</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">SystemRandom</span><span class="p">()</span><span class="o">.</span><span class="n">getrandbits</span><span class="p">(</span><span class="n">bitlength</span><span class="p">)</span>  <span class="c1"># A cryptographically secure random number.</span>
        <span class="k">if</span> <span class="n">is_prime</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">p</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">random_prime</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="c1"># A random 100-bit prime</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">random_prime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span> <span class="c1"># A random 512-bit prime.  Should be quick, thanks to Miller-Rabin!</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> random_prime(1024)  # Even 1024-bit primes should be quick!
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">RSA_privatekey</span><span class="p">(</span><span class="n">bitlength</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create private key for RSA, with given bitlength.</span>
<span class="sd">    Just a pair of big primes!</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">random_prime</span><span class="p">(</span><span class="n">bitlength</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">random_prime</span><span class="p">(</span><span class="n">bitlength</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p</span><span class="p">,</span><span class="n">q</span> <span class="c1"># Returns both values, as a &quot;tuple&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">RSA_privatekey</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span>  <span class="c1"># When a function returns multiple values, the type is &quot;tuple&quot;.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="p">,</span><span class="n">q</span> <span class="o">=</span> <span class="n">RSA_privatekey</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>  <span class="c1"># If a function outputs two values, you can assign them to two variables.</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Private key p = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Private key q = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">RSA_publickey</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Makes the RSA public key out of </span>
<span class="sd">    two prime numbers p,q (the private key), </span>
<span class="sd">    and an auxiliary exponent e.  </span>
<span class="sd">    By default, e = 65537.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span>
    <span class="k">return</span> <span class="n">N</span><span class="p">,</span><span class="n">e</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span><span class="p">,</span><span class="n">e</span> <span class="o">=</span> <span class="n">RSA_publickey</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span> <span class="c1"># No value of e is input, so it will default to 65537</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Public key N = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N</span><span class="p">))</span> <span class="c1"># A big number!</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Public key e = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<section id="encryption-and-decryption">
<h3>Encryption and decryption<a class="headerlink" href="#encryption-and-decryption" title="Link to this heading">#</a></h3>
<p>Now we explain how the public key <span class="math notranslate nohighlight">\((N,e)\)</span> and the private key <span class="math notranslate nohighlight">\((p,q)\)</span> are used to encrypt and decrypt a (numerical) message <span class="math notranslate nohighlight">\(m\)</span>.  If you wish to encrypt/decrypt a text message, one case use a numerical scheme like ASCII, of course.  The message should be significantly shorter than the modulus, <span class="math notranslate nohighlight">\(m &lt; N\)</span> (ideally, shorter than the private key primes), but big enough so that <span class="math notranslate nohighlight">\(m^e\)</span> is much bigger than <span class="math notranslate nohighlight">\(N\)</span> (not usually a problem if <span class="math notranslate nohighlight">\(e = 65537\)</span>).</p>
<p>The encryption procedure is simple – it requires just one line of Python code, using the message and public key.  The ciphertext <span class="math notranslate nohighlight">\(c\)</span> is given by the formula
$<span class="math notranslate nohighlight">\(c = m^e \text{ mod } N,\)</span><span class="math notranslate nohighlight">\(
where here we mean the &quot;natural representative&quot; of \)</span>m^e<span class="math notranslate nohighlight">\( modulo \)</span>N$.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">RSA_encrypt</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Encrypts message, using the public keys N,e.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">RSA_encrypt</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">e</span><span class="p">)</span> <span class="c1"># c is the ciphertext.</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The ciphertext is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="c1"># A very long number!</span>
</pre></div>
</div>
</div>
</div>
<p>To decrypt the ciphertext, we need to “undo” the operation of raising to the <span class="math notranslate nohighlight">\(e\)</span>-th power modulo <span class="math notranslate nohighlight">\(N\)</span>.  We must, effectively, take the <span class="math notranslate nohighlight">\(e\)</span>-th root of the ciphertext, modulo <span class="math notranslate nohighlight">\(N\)</span>.  This is what we studied earlier in this notebook.  Namely, if <span class="math notranslate nohighlight">\(c \equiv m^e \text{ mod } N\)</span> is the ciphertext, and <span class="math notranslate nohighlight">\(ef \equiv 1\)</span> modulo <span class="math notranslate nohighlight">\(\phi(N)\)</span>, then
$<span class="math notranslate nohighlight">\(c^f \equiv m^{ef} \equiv m \text{ mod } N.\)</span>$</p>
<p>So we must raise the ciphertext to the <span class="math notranslate nohighlight">\(f\)</span> power, where <span class="math notranslate nohighlight">\(f\)</span> is the multiplicative inverse of <span class="math notranslate nohighlight">\(e\)</span> modulo <span class="math notranslate nohighlight">\(\phi(N)\)</span>.  Given a giant number <span class="math notranslate nohighlight">\(N\)</span>, it is difficult to compute the totient <span class="math notranslate nohighlight">\(\phi(N)\)</span>.  But, with the <strong>private key</strong> <span class="math notranslate nohighlight">\(p\)</span> and <span class="math notranslate nohighlight">\(q\)</span> (primes), the fact that <span class="math notranslate nohighlight">\(N = pq\)</span> implies
$<span class="math notranslate nohighlight">\(\phi(N) = (p-1) \cdot (q-1) = pq - p - q + 1 = N - p - q + 1.\)</span>$</p>
<p>Armed with the private key (and the public key, which everyone has), we can decrypt a message in just a few lines of Python code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">RSA_decrypt</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">e</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Decrypts message, using the private key (p,q) </span>
<span class="sd">    and the public key (N,e).  We allow the public key N as</span>
<span class="sd">    an input parameter, to avoid recomputing it.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">tot</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">mult_inverse</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">tot</span><span class="p">)</span>  <span class="c1"># This uses the Euclidean algorithm... very quick!</span>
    <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RSA_decrypt</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">e</span><span class="p">)</span>  <span class="c1"># We decrypt the ciphertext... what is the result?</span>
</pre></div>
</div>
</div>
</div>
<p>That’s the entire process of encryption and decryption.  Encryption requires just the public key <span class="math notranslate nohighlight">\((N,e)\)</span> and decryption requires the private key <span class="math notranslate nohighlight">\((p,q)\)</span> too.  Everything else is modular arithmetic, using Euler’s theorem and the Euclidean algorithm to find modular multiplicative inverses.</p>
<p>From a practical standpoint, there are many challenges, and we just mention a few here.</p>
<p><strong>Key generation:</strong>  The person who constructs the private key <span class="math notranslate nohighlight">\((p,q)\)</span> needs to be careful.  The primes <span class="math notranslate nohighlight">\(p\)</span> and <span class="math notranslate nohighlight">\(q\)</span> need to be pretty large (512 bits, or 1024 bits perhaps), which is not so difficult.  They also need to be constructed <strong>randomly</strong>.  For imagine that Alice comes up with her private key <span class="math notranslate nohighlight">\((p,q)\)</span> and Anne comes up with her private key <span class="math notranslate nohighlight">\((q,r)\)</span>, with the same prime <span class="math notranslate nohighlight">\(q\)</span> in common.  Their public keys will include the numbers <span class="math notranslate nohighlight">\(N = pq\)</span> and <span class="math notranslate nohighlight">\(M = qr\)</span>.  If someone like Arjen comes along and starts taking GCDs of all the public keys in a database, that person will stumble upon the fact that <span class="math notranslate nohighlight">\(GCD(N,M) = q\)</span>, from which the private keys <span class="math notranslate nohighlight">\((p,q)\)</span> and <span class="math notranslate nohighlight">\((q,r)\)</span> can be derived.  And this sort of disaster has happened!  Poorly generated keys were stored in a database, and <a class="reference external" href="https://eprint.iacr.org/2012/064.pdf">discovered by Arjen Lenstra et al.</a>.</p>
<p><strong>Security by difficulty of factoring:</strong>  The security of RSA is based on the difficulty of obtaining the private key <span class="math notranslate nohighlight">\((p,q)\)</span> from the public key <span class="math notranslate nohighlight">\((N,e)\)</span>.  Since <span class="math notranslate nohighlight">\(N = pq\)</span>, this is precisely the difficulty of factoring a large number <span class="math notranslate nohighlight">\(N\)</span> into two primes (given the knowledge that it is the product of two primes).  Currently it seems very difficult to factor large numbers.  The RSA factoring challenges give monetary rewards for factoring such large <span class="math notranslate nohighlight">\(N\)</span>.  The record (2017) is factoring a <a class="reference external" href="https://en.wikipedia.org/wiki/RSA_numbers#RSA-768">768-bit (232 digit) number, RSA-768</a>.  For this reason, we may consider a 1024-bit number secure for now (i.e. <span class="math notranslate nohighlight">\(p\)</span> and <span class="math notranslate nohighlight">\(q\)</span> are 512-bit primes), or use a 2048-bit number if we are paranoid.  If quantum computers develop sufficiently, they could make factoring large numbers easy, and RSA will have to be replaced by a quantum-secure protocol.</p>
<p><strong>Web of Trust:</strong>  Trust needs to begin somewhere.  Every time Alice and Bob communicate, Alice should not come up with a new private key, and give Bob the new public key.  For if they are far apart, how does Bob know he’s receiving Alice’s public key and not talking to an eavesdropper Eve?  Instead, it is better for Alice to register (in person, perhaps) her public key at some time.  She can create her private key <span class="math notranslate nohighlight">\((p,q)\)</span> and register the resulting public key <span class="math notranslate nohighlight">\((N,e)\)</span> with some “key authority” who checks her identity at the time.  The key authority then stores everyone’s public keys – effectively they say “if you want to send a secure message to Alice, use the following public key:  (…, …)”  Then Bob can consult the key authority when he wishes to communicate securely to Alice, and this private/public key combination can be used for years.</p>
<p>But, as one might guess, this kicks the trust question to another layer.  How does Bob know he’s communicating with the key authority?  The key authorities need to have their own authentication mechanism, etc..  One way to avoid going down a rabbithole of mistrust is to <em>distribute</em> trust across a network of persons.  Instead of a centralized “key authority”, one can distribute one’s public keys across an entire network of communicators (read about <a class="reference external" href="https://en.wikipedia.org/wiki/Pretty_Good_Privacy#OpenPGP">openPGP</a>).  Then Bob, if he wishes, can double-check Alice’s public keys against the records of numerous members of the network – assuming that hackers haven’t gotten to all of them!</p>
<p>In practice, some implementations of RSA use a more centralized authority and others rely on a web of trust.  Cryptography requires a clever application of modular arithmetic (in Diffie-Hellman, RSA, and many other systems), but also a meticulous approach to implementation.  Often the challenges of implementation introduce new problems in number theory.</p>
</section>
<section id="digital-signatures">
<h3>Digital signatures<a class="headerlink" href="#digital-signatures" title="Link to this heading">#</a></h3>
<p>A variant of RSA is used to “digitally sign” a document.  Not worrying about keeping a message private for now, suppose that Alice wants to send Bob a message and <strong>sign</strong> the message in such a way that Bob can be confident it was sent by Alice.</p>
<p>Alice can digitally sign her message by first <strong>hashing</strong> the message and then encrypting the hash using her <strong>private key</strong> (previously the <em>public key</em> was used for encryption – this is different!).  Hashing a message is an irreversible process that turns a message of possibly long length into a nonsense-message of typically fixed length, in such a way that the original message cannot be recovered from the nonsense-message.</p>
<p>There is a science to secure hashing, which we don’t touch on here.  Instead, we import the <code class="docutils literal notranslate"><span class="pre">sha512</span></code> hashing function from the Python standard package <code class="docutils literal notranslate"><span class="pre">hashlib</span></code>.  The input to <code class="docutils literal notranslate"><span class="pre">sha512</span></code> is a string of arbitrary length, and the output is a sequence of 512 bits.  Here in Python 3, we also must specify the Unicode encoding (<code class="docutils literal notranslate"><span class="pre">utf-8</span></code>) for the string to be hashed.  One can convert the 512 bits of hash into 64 bytes (512/8 = 64) which can be viewed as a 64-character string via ASCII.  This 64-byte string is called the <em>digest</em> of the hash.  It’s all very biological.  Note that many of the characters won’t display very nicely, since they are out of the code range 32-126!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">hashlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">sha512</span>

<span class="nb">print</span><span class="p">(</span><span class="n">sha512</span><span class="p">(</span><span class="s2">&quot;I like sweet potato hash.&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">digest</span><span class="p">())</span> <span class="c1"># A 64-character string of hash.</span>
</pre></div>
</div>
</div>
</div>
<p>Hashes are designed to be irreversible.  Nobody should be able to reverse the hashing process and recover the original string (‘I like sweet potato hash’) from the output of sha512.  Moreover, hashes should avoid collisions – although different input strings <em>can</em> yield the same hashed result, such “collisions” should be exceedingly rare in practice.  You can read more about <a class="reference external" href="https://en.wikipedia.org/wiki/SHA-2">SHA-512 and others at Wikipedia</a>.</p>
<p>Now, if Alice wishes to sign a message <code class="docutils literal notranslate"><span class="pre">m</span></code>, and send it to Bob, she goes through the following steps (in the RSA signature protocol).</p>
<ol class="arabic simple">
<li><p>Alice hashes her message using a method such as SHA-512.  Let <code class="docutils literal notranslate"><span class="pre">h</span></code> be the resulting hash.</p></li>
<li><p>Alice <strong>encrypts</strong> the hash by computing <span class="math notranslate nohighlight">\(s = h^f\)</span> modulo <span class="math notranslate nohighlight">\(N\)</span>.  Here <span class="math notranslate nohighlight">\(f\)</span> is the multiplicative inverse of <span class="math notranslate nohighlight">\(e\)</span> modulo <span class="math notranslate nohighlight">\(\phi(N)\)</span>, just as it was in RSA encryption.  Note that this step requires knowledge of the private key <span class="math notranslate nohighlight">\((p,q)\)</span> to compute <span class="math notranslate nohighlight">\(\phi(N)\)</span> to compute <span class="math notranslate nohighlight">\(f\)</span>.  Hence only Alice can encrypt the has in this way.</p></li>
<li><p>Alice sends this encrypted hash along with her message to Bob, along with a note that she signed it using SHA-512 and her RSA key (without revealing her private keys, of course!).</p></li>
</ol>
<p>When Bob receives the (plaintext) message <span class="math notranslate nohighlight">\(m\)</span> and signature <span class="math notranslate nohighlight">\(s\)</span>, he carries out the following authentication process.</p>
<ol class="arabic simple">
<li><p>Bob computes <span class="math notranslate nohighlight">\(s^e\)</span> modulo <span class="math notranslate nohighlight">\(N\)</span>.  Since <span class="math notranslate nohighlight">\(s^e = h^{fe} = h\)</span> modulo <span class="math notranslate nohighlight">\(N\)</span>, Bob now has the hash of the message <span class="math notranslate nohighlight">\(h\)</span>.</p></li>
<li><p>Bob also computes the SHA-512 hash of the received message <span class="math notranslate nohighlight">\(m\)</span>, and compares it to the has he computed in step 1.  If they match, then Alice indeed signed the message he received.</p></li>
</ol>
<p>We leave implementation of this process to the exercises.</p>
</section>
<section id="id26">
<h3>Exercises<a class="headerlink" href="#id26" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Why might the exponent <span class="math notranslate nohighlight">\(e = 65537\)</span> be a computationally convenient choice?  Consider Pingala’s algorithm.</p></li>
<li><p>What would happen if the message <span class="math notranslate nohighlight">\(m\)</span> encrypted by RSA were <em>equal</em> to one of these primes of the private key?  How might such an occurrence be avoided, and is this something to be concerned about in practice?</p></li>
<li><p>Look at the technical document <a class="reference external" href="https://tools.ietf.org/html/rfc4880">on OpenPGP</a>, and try to figure out how RSA and/or other cryptosystems are being used and implemented in practice.  Write a 1-2 paragraph nontechnical summary of your findings.</p></li>
<li><p>Suppose that you choose <span class="math notranslate nohighlight">\(M\)</span> prime numbers at random between <span class="math notranslate nohighlight">\(2^{b-1}\)</span> and <span class="math notranslate nohighlight">\(2^{b}\)</span>.  Assuming that prime numbers near <span class="math notranslate nohighlight">\(x\)</span> have a density <span class="math notranslate nohighlight">\(1 / \log(x)\)</span>, estimate the probability that there is a “collision” – that at least two of the <span class="math notranslate nohighlight">\(M\)</span> prime numbers are the same.  What is this probability when <span class="math notranslate nohighlight">\(b = 512\)</span> and <span class="math notranslate nohighlight">\(M\)</span> is two billion?  (E.g., if a billion people use a pair of 512-bit private keys).  Look up the “Birthday Problem” for some hints if you haven’t seen this before.</p></li>
<li><p>Create a function <code class="docutils literal notranslate"><span class="pre">sign(message,</span> <span class="pre">p,q,N,e)</span></code> to carry out the RSA signature protocol described above, based on a private key <span class="math notranslate nohighlight">\((p,q)\)</span> with public key <span class="math notranslate nohighlight">\((N,e)\)</span>.  Create a function <code class="docutils literal notranslate"><span class="pre">verify(message,</span> <span class="pre">signature,</span> <span class="pre">N,</span> <span class="pre">e)</span></code> to verify a signed message.  Use the SHA-512 algorithm throughout, and check that your functions work.</p></li>
</ol>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Part 1.  Computing with Python 3.x</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#python-as-a-calculator">Python as a calculator</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-with-booleans">Calculating with booleans</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#declaring-variables">Declaring variables</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lists-and-ranges">Lists and ranges</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#iterating-over-a-range">Iterating over a range</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Exercises</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#part-2-functions-in-python-3-x">Part 2:  Functions in Python 3.x</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-started-with-python-functions">Getting started with Python functions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#control-statements">Control statements</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#while-loops-and-implementation-of-the-eucidean-algorithm">While loops and implementation of the Eucidean algorithm</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-euclidean-algorithm-with-a-while-loop">The Euclidean algorithm with a while loop</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solving-the-linear-diophantine-equation">Solving the linear Diophantine equation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Exercises</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#part-3-lists-and-the-sieve-of-eratosthenes-in-python-3-x">Part 3:  Lists and the sieve of Eratosthenes in Python 3.x</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#primality-testing">Primality testing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#list-manipulation">List manipulation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#list-terms-and-indices">List terms and indices</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#list-slicing">List slicing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#changing-list-slices">Changing list slices</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sieve-of-eratosthenes">Sieve of Eratosthenes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-basic-sieve">The basic sieve</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-analysis">Data analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analyzing-the-list-of-primes">Analyzing the list of primes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-of-the-prime-counting-function">Analysis of the prime counting function</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prime-gaps">Prime gaps</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">Exercises</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#part-4-dictionaries-factorization-and-multiplicative-functions-in-python-3-x">Part 4:  Dictionaries, factorization, and multiplicative functions in Python 3.x</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dictionaries-and-factorization">Dictionaries and factorization</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lists-dictionaries-objects-and-methods">Lists, dictionaries, objects and methods</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-interlude-on-python-objects">An interlude on Python objects</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prime-decomposition-dictionaries">Prime decomposition dictionaries</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiplicative-functions">Multiplicative functions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">Exercises</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#part-5-modular-arithmetic-and-primality-testing-with-python-3-x">Part 5:  Modular arithmetic and primality testing with Python 3.x</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculations-in-modular-arithmetic">Calculations in modular arithmetic</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-mod-operator">The mod (%) operator</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#performance-analysis">Performance analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-miller-rabin-primality-test">The Miller-Rabin primality test</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fermat-s-little-theorem-and-the-roo-property-of-primes">Fermat’s Little Theorem and the ROO property of primes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pingala-s-exponentiation-algorithm">Pingala’s exponentiation algorithm</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-miller-rabin-test">The Miller-Rabin test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id20">Exercises</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#part-6-ciphers-and-key-exchange-in-python-3-x">Part 6:  Ciphers and Key exchange in Python 3.x</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ciphers">Ciphers</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ascii-code-and-the-caesar-cipher">ASCII code and the Caesar cipher</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-vigenere-cipher">The Vigenère cipher</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id22">Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#key-exchange">Key exchange</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#primitive-roots-and-sophie-germain-primes">Primitive roots and Sophie Germain primes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-diffie-hellman-protocol">The Diffie-Hellman protocol</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#alice-and-bob-s-private-secrets">Alice and Bob’s private secrets</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id23">Exercises</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#part-7-the-rsa-cryptosystem-in-python-3-x">Part 7:  The RSA Cryptosystem in Python 3.x</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id24">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#euler-s-theorem-and-modular-roots">Euler’s Theorem and Modular Roots</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#euler-s-theorem-and-the-totient">Euler’s theorem and the totient</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modular-roots">Modular roots</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id25">Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-rsa-protocol">The RSA protocol</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#encryption-and-decryption">Encryption and decryption</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#digital-signatures">Digital signatures</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id26">Exercises</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jonny, assisted by Tom
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>